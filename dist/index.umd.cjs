(function(j,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(j=typeof globalThis<"u"?globalThis:j||self,T(j.TinybirdTriggerTasks={}))})(this,function(j){"use strict";var Lp=Object.defineProperty;var po=j=>{throw TypeError(j)};var Kp=(j,T,W)=>T in j?Lp(j,T,{enumerable:!0,configurable:!0,writable:!0,value:W}):j[T]=W;var v=(j,T,W)=>Kp(j,typeof T!="symbol"?T+"":T,W),$s=(j,T,W)=>T.has(j)||po("Cannot "+W);var F=(j,T,W)=>($s(j,T,"read from private field"),W?W.call(j):T.get(j)),G=(j,T,W)=>T.has(j)?po("Cannot add the same private member more than once"):T instanceof WeakSet?T.add(j):T.set(j,W),Rt=(j,T,W,m)=>($s(j,T,"write to private field"),m?m.call(j,W):T.set(j,W),W),_=(j,T,W)=>($s(j,T,"access private method"),W);var bt,yn,on,go,cn,mo,Et,_n,X,Pe,hr,Tt,pr,ln,_o,N,C,vn,gr,Ls,ye,et,Ce,St,je,wt,mr,Ks,de,Me;var T;(function(t){t.assertEqual=a=>a;function e(a){}t.assertIs=e;function r(a){throw new Error}t.assertNever=r,t.arrayToEnum=a=>{const i={};for(const o of a)i[o]=o;return i},t.getValidEnumValues=a=>{const i=t.objectKeys(a).filter(c=>typeof a[a[c]]!="number"),o={};for(const c of i)o[c]=a[c];return t.objectValues(o)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},t.find=(a,i)=>{for(const o of a)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function s(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=s,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(T||(T={}));var W;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(W||(W={}));const m=T.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ve=t=>{switch(typeof t){case"undefined":return m.undefined;case"string":return m.string;case"number":return isNaN(t)?m.nan:m.number;case"boolean":return m.boolean;case"function":return m.function;case"bigint":return m.bigint;case"symbol":return m.symbol;case"object":return Array.isArray(t)?m.array:t===null?m.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?m.promise:typeof Map<"u"&&t instanceof Map?m.map:typeof Set<"u"&&t instanceof Set?m.set:typeof Date<"u"&&t instanceof Date?m.date:m.object;default:return m.unknown}},h=T.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),vo=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class J extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(i){return i.message},s={_errors:[]},a=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)s._errors.push(r(o));else{let c=s,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(r(o))):c[l]=c[l]||{_errors:[]},c=c[l],u++}}};return a(this),s}static assert(e){if(!(e instanceof J))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,T.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},s=[];for(const a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(e(a))):s.push(e(a));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}}J.create=t=>new J(t);const tt=(t,e)=>{let r;switch(t.code){case h.invalid_type:t.received===m.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case h.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,T.jsonStringifyReplacer)}`;break;case h.unrecognized_keys:r=`Unrecognized key(s) in object: ${T.joinValues(t.keys,", ")}`;break;case h.invalid_union:r="Invalid input";break;case h.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${T.joinValues(t.options)}`;break;case h.invalid_enum_value:r=`Invalid enum value. Expected ${T.joinValues(t.options)}, received '${t.received}'`;break;case h.invalid_arguments:r="Invalid function arguments";break;case h.invalid_return_type:r="Invalid function return type";break;case h.invalid_date:r="Invalid date";break;case h.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:T.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case h.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case h.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case h.custom:r="Invalid input";break;case h.invalid_intersection_types:r="Intersection results could not be merged";break;case h.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case h.not_finite:r="Number must be finite";break;default:r=e.defaultError,T.assertNever(t)}return{message:r}};let Ws=tt;function bo(t){Ws=t}function Tr(){return Ws}const Rr=t=>{const{data:e,path:r,errorMaps:s,issueData:a}=t,i=[...r,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let c="";const u=s.filter(l=>!!l).slice().reverse();for(const l of u)c=l(o,{data:e,defaultError:c}).message;return{...a,path:i,message:c}},Eo=[];function y(t,e){const r=Tr(),s=Rr({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===tt?void 0:tt].filter(a=>!!a)});t.common.issues.push(s)}class H{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const s=[];for(const a of r){if(a.status==="aborted")return w;a.status==="dirty"&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,r){const s=[];for(const a of r){const i=await a.key,o=await a.value;s.push({key:i,value:o})}return H.mergeObjectSync(e,s)}static mergeObjectSync(e,r){const s={};for(const a of r){const{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return w;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}}const w=Object.freeze({status:"aborted"}),rt=t=>({status:"dirty",value:t}),Z=t=>({status:"valid",value:t}),bn=t=>t.status==="aborted",En=t=>t.status==="dirty",At=t=>t.status==="valid",It=t=>typeof Promise<"u"&&t instanceof Promise;function Sr(t,e,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function Vs(t,e,r,s,a){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}typeof SuppressedError=="function"&&SuppressedError;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(R||(R={}));var kt,Ot;class ne{constructor(e,r,s,a){this._cachedPath=[],this.parent=e,this.data=r,this._path=s,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Gs=(t,e)=>{if(At(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new J(t.common.issues);return this._error=r,this._error}}};function A(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:s,description:a}=t;if(e&&(r||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,c)=>{var u,l;const{message:d}=t;return o.code==="invalid_enum_value"?{message:d??c.defaultError}:typeof c.data>"u"?{message:(u=d??s)!==null&&u!==void 0?u:c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:(l=d??r)!==null&&l!==void 0?l:c.defaultError}},description:a}}class I{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return ve(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:ve(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new H,ctx:{common:e.parent.common,data:e.data,parsedType:ve(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(It(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const s=this.safeParse(e,r);if(s.success)return s.data;throw s.error}safeParse(e,r){var s;const a={common:{issues:[],async:(s=r==null?void 0:r.async)!==null&&s!==void 0?s:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ve(e)},i=this._parseSync({data:e,path:a.path,parent:a});return Gs(a,i)}async parseAsync(e,r){const s=await this.safeParseAsync(e,r);if(s.success)return s.data;throw s.error}async safeParseAsync(e,r){const s={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ve(e)},a=this._parse({data:e,path:s.path,parent:s}),i=await(It(a)?a:Promise.resolve(a));return Gs(s,i)}refine(e,r){const s=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,i)=>{const o=e(a),c=()=>i.addIssue({code:h.custom,...s(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(c(),!1)):o?!0:(c(),!1)})}refinement(e,r){return this._refinement((s,a)=>e(s)?!0:(a.addIssue(typeof r=="function"?r(s,a):r),!1))}_refinement(e){return new te({schema:this,typeName:S.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ae.create(this,this._def)}nullable(){return Re.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ee.create(this,this._def)}promise(){return it.create(this,this._def)}or(e){return Ct.create([this,e],this._def)}and(e){return jt.create(this,e,this._def)}transform(e){return new te({...A(this._def),schema:this,typeName:S.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Lt({...A(this._def),innerType:this,defaultValue:r,typeName:S.ZodDefault})}brand(){return new Sn({typeName:S.ZodBranded,type:this,...A(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Kt({...A(this._def),innerType:this,catchValue:r,typeName:S.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Wt.create(this,e)}readonly(){return Vt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const To=/^c[^\s-]{8,}$/i,Ro=/^[0-9a-z]+$/,So=/^[0-9A-HJKMNP-TV-Z]{26}$/,wo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Ao=/^[a-z0-9_-]{21}$/i,Io=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ko=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Oo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Tn;const xo=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,No=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,Po=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Bs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Co=new RegExp(`^${Bs}$`);function Fs(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function jo(t){return new RegExp(`^${Fs(t)}$`)}function Hs(t){let e=`${Bs}T${Fs(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function Mo(t,e){return!!((e==="v4"||!e)&&xo.test(t)||(e==="v6"||!e)&&No.test(t))}class Q extends I{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==m.string){const i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:m.string,received:i.parsedType}),w}const s=new H;let a;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),y(a,{code:h.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),y(a,{code:h.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,c=e.data.length<i.value;(o||c)&&(a=this._getOrReturnCtx(e,a),o?y(a,{code:h.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&y(a,{code:h.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")ko.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"email",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Tn||(Tn=new RegExp(Oo,"u")),Tn.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"emoji",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")wo.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"uuid",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Ao.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"nanoid",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")To.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"cuid",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Ro.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"cuid2",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")So.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"ulid",code:h.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),y(a,{validation:"url",code:h.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"regex",code:h.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Hs(i).test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Co.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?jo(i).test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{code:h.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?Io.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"duration",code:h.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Mo(e.data,i.version)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"ip",code:h.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Po.test(e.data)||(a=this._getOrReturnCtx(e,a),y(a,{validation:"base64",code:h.invalid_string,message:i.message}),s.dirty()):T.assertNever(i);return{status:s.value,value:e.data}}_regex(e,r,s){return this.refinement(a=>e.test(a),{validation:r,code:h.invalid_string,...R.errToObj(s)})}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}datetime(e){var r,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...R.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...R.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...R.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new Q({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Q({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Q({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Q.create=t=>{var e;return new Q({checks:[],typeName:S.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...A(t)})};function Uo(t,e){const r=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,a=r>s?r:s,i=parseInt(t.toFixed(a).replace(".","")),o=parseInt(e.toFixed(a).replace(".",""));return i%o/Math.pow(10,a)}class be extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==m.number){const i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:m.number,received:i.parsedType}),w}let s;const a=new H;for(const i of this._def.checks)i.kind==="int"?T.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Uo(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:h.not_finite,message:i.message}),a.dirty()):T.assertNever(i);return{status:a.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,s,a){return new be({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:R.toString(a)}]})}_addCheck(e){return new be({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&T.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(r===null||s.value>r)&&(r=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(r)&&Number.isFinite(e)}}be.create=t=>new be({checks:[],typeName:S.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...A(t)});class Ee extends I{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==m.bigint){const i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:m.bigint,received:i.parsedType}),w}let s;const a=new H;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),y(s,{code:h.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):T.assertNever(i);return{status:a.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,s,a){return new Ee({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:R.toString(a)}]})}_addCheck(e){return new Ee({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Ee.create=t=>{var e;return new Ee({checks:[],typeName:S.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...A(t)})};class xt extends I{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==m.boolean){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.boolean,received:s.parsedType}),w}return Z(e.data)}}xt.create=t=>new xt({typeName:S.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...A(t)});class Ue extends I{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==m.date){const i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_type,expected:m.date,received:i.parsedType}),w}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return y(i,{code:h.invalid_date}),w}const s=new H;let a;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),y(a,{code:h.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),y(a,{code:h.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):T.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ue({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Ue.create=t=>new Ue({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:S.ZodDate,...A(t)});class wr extends I{_parse(e){if(this._getType(e)!==m.symbol){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.symbol,received:s.parsedType}),w}return Z(e.data)}}wr.create=t=>new wr({typeName:S.ZodSymbol,...A(t)});class Nt extends I{_parse(e){if(this._getType(e)!==m.undefined){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.undefined,received:s.parsedType}),w}return Z(e.data)}}Nt.create=t=>new Nt({typeName:S.ZodUndefined,...A(t)});class Pt extends I{_parse(e){if(this._getType(e)!==m.null){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.null,received:s.parsedType}),w}return Z(e.data)}}Pt.create=t=>new Pt({typeName:S.ZodNull,...A(t)});class nt extends I{constructor(){super(...arguments),this._any=!0}_parse(e){return Z(e.data)}}nt.create=t=>new nt({typeName:S.ZodAny,...A(t)});class De extends I{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Z(e.data)}}De.create=t=>new De({typeName:S.ZodUnknown,...A(t)});class fe extends I{_parse(e){const r=this._getOrReturnCtx(e);return y(r,{code:h.invalid_type,expected:m.never,received:r.parsedType}),w}}fe.create=t=>new fe({typeName:S.ZodNever,...A(t)});class Ar extends I{_parse(e){if(this._getType(e)!==m.undefined){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.void,received:s.parsedType}),w}return Z(e.data)}}Ar.create=t=>new Ar({typeName:S.ZodVoid,...A(t)});class ee extends I{_parse(e){const{ctx:r,status:s}=this._processInputParams(e),a=this._def;if(r.parsedType!==m.array)return y(r,{code:h.invalid_type,expected:m.array,received:r.parsedType}),w;if(a.exactLength!==null){const o=r.data.length>a.exactLength.value,c=r.data.length<a.exactLength.value;(o||c)&&(y(r,{code:o?h.too_big:h.too_small,minimum:c?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(y(r,{code:h.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(y(r,{code:h.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),r.common.async)return Promise.all([...r.data].map((o,c)=>a.type._parseAsync(new ne(r,o,r.path,c)))).then(o=>H.mergeArray(s,o));const i=[...r.data].map((o,c)=>a.type._parseSync(new ne(r,o,r.path,c)));return H.mergeArray(s,i)}get element(){return this._def.type}min(e,r){return new ee({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new ee({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new ee({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}}ee.create=(t,e)=>new ee({type:t,minLength:null,maxLength:null,exactLength:null,typeName:S.ZodArray,...A(e)});function st(t){if(t instanceof $){const e={};for(const r in t.shape){const s=t.shape[r];e[r]=ae.create(st(s))}return new $({...t._def,shape:()=>e})}else return t instanceof ee?new ee({...t._def,type:st(t.element)}):t instanceof ae?ae.create(st(t.unwrap())):t instanceof Re?Re.create(st(t.unwrap())):t instanceof se?se.create(t.items.map(e=>st(e))):t}class $ extends I{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=T.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==m.object){const l=this._getOrReturnCtx(e);return y(l,{code:h.invalid_type,expected:m.object,received:l.parsedType}),w}const{status:s,ctx:a}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof fe&&this._def.unknownKeys==="strip"))for(const l in a.data)o.includes(l)||c.push(l);const u=[];for(const l of o){const d=i[l],b=a.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new ne(a,b,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof fe){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of c)u.push({key:{status:"valid",value:d},value:{status:"valid",value:a.data[d]}});else if(l==="strict")c.length>0&&(y(a,{code:h.unrecognized_keys,keys:c}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of c){const b=a.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new ne(a,b,a.path,d)),alwaysSet:d in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const b=await d.key,g=await d.value;l.push({key:b,value:g,alwaysSet:d.alwaysSet})}return l}).then(l=>H.mergeObjectSync(s,l)):H.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new $({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,s)=>{var a,i,o,c;const u=(o=(i=(a=this._def).errorMap)===null||i===void 0?void 0:i.call(a,r,s).message)!==null&&o!==void 0?o:s.defaultError;return r.code==="unrecognized_keys"?{message:(c=R.errToObj(e).message)!==null&&c!==void 0?c:u}:{message:u}}}:{}})}strip(){return new $({...this._def,unknownKeys:"strip"})}passthrough(){return new $({...this._def,unknownKeys:"passthrough"})}extend(e){return new $({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:S.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new $({...this._def,catchall:e})}pick(e){const r={};return T.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(r[s]=this.shape[s])}),new $({...this._def,shape:()=>r})}omit(e){const r={};return T.objectKeys(this.shape).forEach(s=>{e[s]||(r[s]=this.shape[s])}),new $({...this._def,shape:()=>r})}deepPartial(){return st(this)}partial(e){const r={};return T.objectKeys(this.shape).forEach(s=>{const a=this.shape[s];e&&!e[s]?r[s]=a:r[s]=a.optional()}),new $({...this._def,shape:()=>r})}required(e){const r={};return T.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])r[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof ae;)i=i._def.innerType;r[s]=i}}),new $({...this._def,shape:()=>r})}keyof(){return Zs(T.objectKeys(this.shape))}}$.create=(t,e)=>new $({shape:()=>t,unknownKeys:"strip",catchall:fe.create(),typeName:S.ZodObject,...A(e)}),$.strictCreate=(t,e)=>new $({shape:()=>t,unknownKeys:"strict",catchall:fe.create(),typeName:S.ZodObject,...A(e)}),$.lazycreate=(t,e)=>new $({shape:t,unknownKeys:"strip",catchall:fe.create(),typeName:S.ZodObject,...A(e)});class Ct extends I{_parse(e){const{ctx:r}=this._processInputParams(e),s=this._def.options;function a(i){for(const c of i)if(c.result.status==="valid")return c.result;for(const c of i)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;const o=i.map(c=>new J(c.ctx.common.issues));return y(r,{code:h.invalid_union,unionErrors:o}),w}if(r.common.async)return Promise.all(s.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(a);{let i;const o=[];for(const u of s){const l={...r,common:{...r.common,issues:[]},parent:null},d=u._parseSync({data:r.data,path:r.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const c=o.map(u=>new J(u));return y(r,{code:h.invalid_union,unionErrors:c}),w}}get options(){return this._def.options}}Ct.create=(t,e)=>new Ct({options:t,typeName:S.ZodUnion,...A(e)});const he=t=>t instanceof Ut?he(t.schema):t instanceof te?he(t.innerType()):t instanceof Dt?[t.value]:t instanceof Te?t.options:t instanceof $t?T.objectValues(t.enum):t instanceof Lt?he(t._def.innerType):t instanceof Nt?[void 0]:t instanceof Pt?[null]:t instanceof ae?[void 0,...he(t.unwrap())]:t instanceof Re?[null,...he(t.unwrap())]:t instanceof Sn||t instanceof Vt?he(t.unwrap()):t instanceof Kt?he(t._def.innerType):[];class Ir extends I{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==m.object)return y(r,{code:h.invalid_type,expected:m.object,received:r.parsedType}),w;const s=this.discriminator,a=r.data[s],i=this.optionsMap.get(a);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(y(r,{code:h.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),w)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,s){const a=new Map;for(const i of r){const o=he(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of o){if(a.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);a.set(c,i)}}return new Ir({typeName:S.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:a,...A(s)})}}function Rn(t,e){const r=ve(t),s=ve(e);if(t===e)return{valid:!0,data:t};if(r===m.object&&s===m.object){const a=T.objectKeys(e),i=T.objectKeys(t).filter(c=>a.indexOf(c)!==-1),o={...t,...e};for(const c of i){const u=Rn(t[c],e[c]);if(!u.valid)return{valid:!1};o[c]=u.data}return{valid:!0,data:o}}else if(r===m.array&&s===m.array){if(t.length!==e.length)return{valid:!1};const a=[];for(let i=0;i<t.length;i++){const o=t[i],c=e[i],u=Rn(o,c);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return r===m.date&&s===m.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class jt extends I{_parse(e){const{status:r,ctx:s}=this._processInputParams(e),a=(i,o)=>{if(bn(i)||bn(o))return w;const c=Rn(i.value,o.value);return c.valid?((En(i)||En(o))&&r.dirty(),{status:r.value,value:c.data}):(y(s,{code:h.invalid_intersection_types}),w)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}jt.create=(t,e,r)=>new jt({left:t,right:e,typeName:S.ZodIntersection,...A(r)});class se extends I{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.array)return y(s,{code:h.invalid_type,expected:m.array,received:s.parsedType}),w;if(s.data.length<this._def.items.length)return y(s,{code:h.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),w;!this._def.rest&&s.data.length>this._def.items.length&&(y(s,{code:h.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...s.data].map((o,c)=>{const u=this._def.items[c]||this._def.rest;return u?u._parse(new ne(s,o,s.path,c)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>H.mergeArray(r,o)):H.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new se({...this._def,rest:e})}}se.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new se({items:t,typeName:S.ZodTuple,rest:null,...A(e)})};class Mt extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.object)return y(s,{code:h.invalid_type,expected:m.object,received:s.parsedType}),w;const a=[],i=this._def.keyType,o=this._def.valueType;for(const c in s.data)a.push({key:i._parse(new ne(s,c,s.path,c)),value:o._parse(new ne(s,s.data[c],s.path,c)),alwaysSet:c in s.data});return s.common.async?H.mergeObjectAsync(r,a):H.mergeObjectSync(r,a)}get element(){return this._def.valueType}static create(e,r,s){return r instanceof I?new Mt({keyType:e,valueType:r,typeName:S.ZodRecord,...A(s)}):new Mt({keyType:Q.create(),valueType:e,typeName:S.ZodRecord,...A(r)})}}class kr extends I{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.map)return y(s,{code:h.invalid_type,expected:m.map,received:s.parsedType}),w;const a=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([c,u],l)=>({key:a._parse(new ne(s,c,s.path,[l,"key"])),value:i._parse(new ne(s,u,s.path,[l,"value"]))}));if(s.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return w;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}})}else{const c=new Map;for(const u of o){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return w;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}}}}kr.create=(t,e,r)=>new kr({valueType:e,keyType:t,typeName:S.ZodMap,...A(r)});class $e extends I{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.set)return y(s,{code:h.invalid_type,expected:m.set,received:s.parsedType}),w;const a=this._def;a.minSize!==null&&s.data.size<a.minSize.value&&(y(s,{code:h.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&s.data.size>a.maxSize.value&&(y(s,{code:h.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const i=this._def.valueType;function o(u){const l=new Set;for(const d of u){if(d.status==="aborted")return w;d.status==="dirty"&&r.dirty(),l.add(d.value)}return{status:r.value,value:l}}const c=[...s.data.values()].map((u,l)=>i._parse(new ne(s,u,s.path,l)));return s.common.async?Promise.all(c).then(u=>o(u)):o(c)}min(e,r){return new $e({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new $e({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}$e.create=(t,e)=>new $e({valueType:t,minSize:null,maxSize:null,typeName:S.ZodSet,...A(e)});class at extends I{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==m.function)return y(r,{code:h.invalid_type,expected:m.function,received:r.parsedType}),w;function s(c,u){return Rr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Tr(),tt].filter(l=>!!l),issueData:{code:h.invalid_arguments,argumentsError:u}})}function a(c,u){return Rr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Tr(),tt].filter(l=>!!l),issueData:{code:h.invalid_return_type,returnTypeError:u}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof it){const c=this;return Z(async function(...u){const l=new J([]),d=await c._def.args.parseAsync(u,i).catch(f=>{throw l.addIssue(s(u,f)),l}),b=await Reflect.apply(o,this,d);return await c._def.returns._def.type.parseAsync(b,i).catch(f=>{throw l.addIssue(a(b,f)),l})})}else{const c=this;return Z(function(...u){const l=c._def.args.safeParse(u,i);if(!l.success)throw new J([s(u,l.error)]);const d=Reflect.apply(o,this,l.data),b=c._def.returns.safeParse(d,i);if(!b.success)throw new J([a(d,b.error)]);return b.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new at({...this._def,args:se.create(e).rest(De.create())})}returns(e){return new at({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,s){return new at({args:e||se.create([]).rest(De.create()),returns:r||De.create(),typeName:S.ZodFunction,...A(s)})}}class Ut extends I{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Ut.create=(t,e)=>new Ut({getter:t,typeName:S.ZodLazy,...A(e)});class Dt extends I{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return y(r,{received:r.data,code:h.invalid_literal,expected:this._def.value}),w}return{status:"valid",value:e.data}}get value(){return this._def.value}}Dt.create=(t,e)=>new Dt({value:t,typeName:S.ZodLiteral,...A(e)});function Zs(t,e){return new Te({values:t,typeName:S.ZodEnum,...A(e)})}class Te extends I{constructor(){super(...arguments),kt.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),s=this._def.values;return y(r,{expected:T.joinValues(s),received:r.parsedType,code:h.invalid_type}),w}if(Sr(this,kt)||Vs(this,kt,new Set(this._def.values)),!Sr(this,kt).has(e.data)){const r=this._getOrReturnCtx(e),s=this._def.values;return y(r,{received:r.data,code:h.invalid_enum_value,options:s}),w}return Z(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return Te.create(e,{...this._def,...r})}exclude(e,r=this._def){return Te.create(this.options.filter(s=>!e.includes(s)),{...this._def,...r})}}kt=new WeakMap,Te.create=Zs;class $t extends I{constructor(){super(...arguments),Ot.set(this,void 0)}_parse(e){const r=T.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==m.string&&s.parsedType!==m.number){const a=T.objectValues(r);return y(s,{expected:T.joinValues(a),received:s.parsedType,code:h.invalid_type}),w}if(Sr(this,Ot)||Vs(this,Ot,new Set(T.getValidEnumValues(this._def.values))),!Sr(this,Ot).has(e.data)){const a=T.objectValues(r);return y(s,{received:s.data,code:h.invalid_enum_value,options:a}),w}return Z(e.data)}get enum(){return this._def.values}}Ot=new WeakMap,$t.create=(t,e)=>new $t({values:t,typeName:S.ZodNativeEnum,...A(e)});class it extends I{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==m.promise&&r.common.async===!1)return y(r,{code:h.invalid_type,expected:m.promise,received:r.parsedType}),w;const s=r.parsedType===m.promise?r.data:Promise.resolve(r.data);return Z(s.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}it.create=(t,e)=>new it({type:t,typeName:S.ZodPromise,...A(e)});class te extends I{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===S.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:s}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:o=>{y(s,o),o.fatal?r.abort():r.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const o=a.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async c=>{if(r.value==="aborted")return w;const u=await this._def.schema._parseAsync({data:c,path:s.path,parent:s});return u.status==="aborted"?w:u.status==="dirty"||r.value==="dirty"?rt(u.value):u});{if(r.value==="aborted")return w;const c=this._def.schema._parseSync({data:o,path:s.path,parent:s});return c.status==="aborted"?w:c.status==="dirty"||r.value==="dirty"?rt(c.value):c}}if(a.type==="refinement"){const o=c=>{const u=a.refinement(c,i);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(s.common.async===!1){const c=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return c.status==="aborted"?w:(c.status==="dirty"&&r.dirty(),o(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(c=>c.status==="aborted"?w:(c.status==="dirty"&&r.dirty(),o(c.value).then(()=>({status:r.value,value:c.value}))))}if(a.type==="transform")if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!At(o))return o;const c=a.transform(o.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>At(o)?Promise.resolve(a.transform(o.value,i)).then(c=>({status:r.value,value:c})):o);T.assertNever(a)}}te.create=(t,e,r)=>new te({schema:t,typeName:S.ZodEffects,effect:e,...A(r)}),te.createWithPreprocess=(t,e,r)=>new te({schema:e,effect:{type:"preprocess",transform:t},typeName:S.ZodEffects,...A(r)});class ae extends I{_parse(e){return this._getType(e)===m.undefined?Z(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ae.create=(t,e)=>new ae({innerType:t,typeName:S.ZodOptional,...A(e)});class Re extends I{_parse(e){return this._getType(e)===m.null?Z(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Re.create=(t,e)=>new Re({innerType:t,typeName:S.ZodNullable,...A(e)});class Lt extends I{_parse(e){const{ctx:r}=this._processInputParams(e);let s=r.data;return r.parsedType===m.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Lt.create=(t,e)=>new Lt({innerType:t,typeName:S.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...A(e)});class Kt extends I{_parse(e){const{ctx:r}=this._processInputParams(e),s={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return It(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new J(s.common.issues)},input:s.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new J(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Kt.create=(t,e)=>new Kt({innerType:t,typeName:S.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...A(e)});class Or extends I{_parse(e){if(this._getType(e)!==m.nan){const s=this._getOrReturnCtx(e);return y(s,{code:h.invalid_type,expected:m.nan,received:s.parsedType}),w}return{status:"valid",value:e.data}}}Or.create=t=>new Or({typeName:S.ZodNaN,...A(t)});const Do=Symbol("zod_brand");class Sn extends I{_parse(e){const{ctx:r}=this._processInputParams(e),s=r.data;return this._def.type._parse({data:s,path:r.path,parent:r})}unwrap(){return this._def.type}}class Wt extends I{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?w:i.status==="dirty"?(r.dirty(),rt(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const a=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?w:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:s.path,parent:s})}}static create(e,r){return new Wt({in:e,out:r,typeName:S.ZodPipeline})}}class Vt extends I{_parse(e){const r=this._def.innerType._parse(e),s=a=>(At(a)&&(a.value=Object.freeze(a.value)),a);return It(r)?r.then(a=>s(a)):s(r)}unwrap(){return this._def.innerType}}Vt.create=(t,e)=>new Vt({innerType:t,typeName:S.ZodReadonly,...A(e)});function zs(t,e={},r){return t?nt.create().superRefine((s,a)=>{var i,o;if(!t(s)){const c=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,u=(o=(i=c.fatal)!==null&&i!==void 0?i:r)!==null&&o!==void 0?o:!0,l=typeof c=="string"?{message:c}:c;a.addIssue({code:"custom",...l,fatal:u})}}):nt.create()}const $o={object:$.lazycreate};var S;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(S||(S={}));const Lo=(t,e={message:`Input not instance of ${t.name}`})=>zs(r=>r instanceof t,e),Js=Q.create,Ys=be.create,Ko=Or.create,Wo=Ee.create,qs=xt.create,Vo=Ue.create,Go=wr.create,Bo=Nt.create,Fo=Pt.create,Ho=nt.create,Zo=De.create,zo=fe.create,Jo=Ar.create,Yo=ee.create,qo=$.create,Xo=$.strictCreate,Qo=Ct.create,ec=Ir.create,tc=jt.create,rc=se.create,nc=Mt.create,sc=kr.create,ac=$e.create,ic=at.create,oc=Ut.create,cc=Dt.create,uc=Te.create,lc=$t.create,dc=it.create,Xs=te.create,fc=ae.create,hc=Re.create,pc=te.createWithPreprocess,gc=Wt.create;var n=Object.freeze({__proto__:null,defaultErrorMap:tt,setErrorMap:bo,getErrorMap:Tr,makeIssue:Rr,EMPTY_PATH:Eo,addIssueToContext:y,ParseStatus:H,INVALID:w,DIRTY:rt,OK:Z,isAborted:bn,isDirty:En,isValid:At,isAsync:It,get util(){return T},get objectUtil(){return W},ZodParsedType:m,getParsedType:ve,ZodType:I,datetimeRegex:Hs,ZodString:Q,ZodNumber:be,ZodBigInt:Ee,ZodBoolean:xt,ZodDate:Ue,ZodSymbol:wr,ZodUndefined:Nt,ZodNull:Pt,ZodAny:nt,ZodUnknown:De,ZodNever:fe,ZodVoid:Ar,ZodArray:ee,ZodObject:$,ZodUnion:Ct,ZodDiscriminatedUnion:Ir,ZodIntersection:jt,ZodTuple:se,ZodRecord:Mt,ZodMap:kr,ZodSet:$e,ZodFunction:at,ZodLazy:Ut,ZodLiteral:Dt,ZodEnum:Te,ZodNativeEnum:$t,ZodPromise:it,ZodEffects:te,ZodTransformer:te,ZodOptional:ae,ZodNullable:Re,ZodDefault:Lt,ZodCatch:Kt,ZodNaN:Or,BRAND:Do,ZodBranded:Sn,ZodPipeline:Wt,ZodReadonly:Vt,custom:zs,Schema:I,ZodSchema:I,late:$o,get ZodFirstPartyTypeKind(){return S},coerce:{string:t=>Q.create({...t,coerce:!0}),number:t=>be.create({...t,coerce:!0}),boolean:t=>xt.create({...t,coerce:!0}),bigint:t=>Ee.create({...t,coerce:!0}),date:t=>Ue.create({...t,coerce:!0})},any:Ho,array:Yo,bigint:Wo,boolean:qs,date:Vo,discriminatedUnion:ec,effect:Xs,enum:uc,function:ic,instanceof:Lo,intersection:tc,lazy:oc,literal:cc,map:sc,nan:Ko,nativeEnum:lc,never:zo,null:Fo,nullable:hc,number:Ys,object:qo,oboolean:()=>qs().optional(),onumber:()=>Ys().optional(),optional:fc,ostring:()=>Js().optional(),pipeline:gc,preprocess:pc,promise:dc,record:nc,set:ac,strictObject:Xo,string:Js,symbol:Go,transformer:Xs,tuple:rc,undefined:Bo,union:Qo,unknown:Zo,void:Jo,NEVER:w,ZodIssueCode:h,quotelessJson:vo,ZodError:J});const Qs="3.3.7",mc="HS256",yc="https://id.trigger.dev",_c="https://api.trigger.dev";async function ea(t){const{SignJWT:e}=await Promise.resolve().then(()=>ep),r=new TextEncoder().encode(t.secretKey);return new e(t.payload).setIssuer(yc).setAudience(_c).setProtectedHeader({alg:mc}).setIssuedAt().setExpirationTime(t.expirationTime??"15m").sign(r)}n.object({url:n.string().url(),authorizationCode:n.string()}),n.object({authorizationCode:n.string()}),n.object({token:n.object({token:n.string(),obfuscatedToken:n.string()}).nullable()});const vc=n.union([n.string(),n.number(),n.boolean(),n.null()]),Gt=n.lazy(()=>n.union([vc,n.array(Gt),n.record(Gt)])),bc=n.union([n.string(),n.number(),n.boolean(),n.null(),n.date(),n.undefined(),n.symbol()]),ta=n.lazy(()=>n.union([bc,n.array(ta),n.record(ta)])),Ec=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4)]),Tc=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4),n.literal(8)]),ra=n.enum(["micro","small-1x","small-2x","medium-1x","medium-2x","large-1x","large-2x"]),na=n.object({cpu:Ec.optional(),memory:Tc.optional(),preset:ra.optional()}),Bt=n.object({name:ra,cpu:n.number(),memory:n.number(),centsPerMs:n.number()}),Rc=n.object({type:n.literal("BUILT_IN_ERROR"),name:n.string(),message:n.string(),stackTrace:n.string()}),Sc=n.object({type:n.literal("CUSTOM_ERROR"),raw:n.string()}),wc=n.object({type:n.literal("STRING_ERROR"),raw:n.string()}),wn=n.object({type:n.literal("INTERNAL_ERROR"),code:n.enum(["COULD_NOT_FIND_EXECUTOR","COULD_NOT_FIND_TASK","COULD_NOT_IMPORT_TASK","CONFIGURED_INCORRECTLY","TASK_ALREADY_RUNNING","TASK_EXECUTION_FAILED","TASK_EXECUTION_ABORTED","TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE","TASK_PROCESS_SIGKILL_TIMEOUT","TASK_PROCESS_SIGSEGV","TASK_PROCESS_SIGTERM","TASK_PROCESS_OOM_KILLED","TASK_PROCESS_MAYBE_OOM_KILLED","TASK_RUN_CANCELLED","TASK_INPUT_ERROR","TASK_OUTPUT_ERROR","HANDLE_ERROR_ERROR","GRACEFUL_EXIT_TIMEOUT","TASK_RUN_HEARTBEAT_TIMEOUT","TASK_RUN_CRASHED","MAX_DURATION_EXCEEDED","DISK_SPACE_EXCEEDED","POD_EVICTED","POD_UNKNOWN_ERROR","OUTDATED_SDK_VERSION"]),message:n.string().optional(),stackTrace:n.string().optional()}),sa=wn.shape.code.enum,aa=n.discriminatedUnion("type",[Rc,Sc,wc,wn]),ia=n.object({id:n.string(),payload:n.string(),payloadType:n.string(),context:n.any(),tags:n.array(n.string()),isTest:n.boolean().default(!1),createdAt:n.coerce.date(),startedAt:n.coerce.date().default(()=>new Date),idempotencyKey:n.string().optional(),maxAttempts:n.number().optional(),durationMs:n.number().default(0),costInCents:n.number().default(0),baseCostInCents:n.number().default(0),version:n.string().optional(),metadata:n.record(Gt).optional(),maxDuration:n.number().optional()}),oa=n.object({id:n.string(),filePath:n.string(),exportName:n.string()}),ca=n.object({id:n.string(),number:n.number(),startedAt:n.coerce.date(),backgroundWorkerId:n.string(),backgroundWorkerTaskId:n.string(),status:n.string()}),ua=n.object({id:n.string(),slug:n.string(),type:n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"])}),la=n.object({id:n.string(),slug:n.string(),name:n.string()}),da=n.object({id:n.string(),ref:n.string(),slug:n.string(),name:n.string()}),fa=n.object({id:n.string(),name:n.string()}),ha=n.object({id:n.string()}),pe=n.object({task:oa,attempt:ca,run:ia,queue:fa,environment:ua,organization:la,project:da,batch:ha.optional(),machine:Bt.optional()});n.object({task:oa,attempt:ca.omit({backgroundWorkerId:!0,backgroundWorkerTaskId:!0}),run:ia.omit({payload:!0,payloadType:!0,metadata:!0}),queue:fa,environment:ua,organization:la,project:da,batch:ha.optional(),machine:Bt.optional()});const Ac=n.object({timestamp:n.number(),delay:n.number(),error:n.unknown().optional()}),pa=n.object({durationMs:n.number()}),xr=n.object({ok:n.literal(!1),id:n.string(),error:aa,retry:Ac.optional(),skippedRetrying:n.boolean().optional(),usage:pa.optional(),taskIdentifier:n.string().optional()}),Ic=n.object({ok:n.literal(!0),id:n.string(),output:n.string().optional(),outputType:n.string(),usage:pa.optional(),taskIdentifier:n.string().optional()}),re=n.discriminatedUnion("ok",[Ic,xr]),kc=n.object({id:n.string(),items:re.array()}),ga=n.object({message:n.string(),name:n.string().optional(),stackTrace:n.string().optional()}),Nr=n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"]);n.object({execution:pe,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()});const An=pe.extend({worker:n.object({id:n.string(),contentHash:n.string(),version:n.string()}),machine:Bt.default({name:"small-1x",cpu:1,memory:1,centsPerMs:0})}),Pr=n.object({execution:An,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),Oc=n.object({type:n.literal("fixed-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])}),xc=n.object({type:n.literal("sliding-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])});n.discriminatedUnion("type",[Oc,xc]);const Le=n.object({maxAttempts:n.number().int().optional(),factor:n.number().optional(),minTimeoutInMs:n.number().int().optional(),maxTimeoutInMs:n.number().int().optional(),randomize:n.boolean().optional()}),Cr=n.object({name:n.string().optional(),concurrencyLimit:n.number().int().min(0).max(1e3).optional()}),ma=n.object({cron:n.string(),timezone:n.string()}),ya={id:n.string(),description:n.string().optional(),queue:Cr.optional(),retry:Le.optional(),machine:na.optional(),triggerSource:n.string().optional(),schedule:ma.optional(),maxDuration:n.number().optional()};n.object(ya);const Nc=n.object({entry:n.string(),out:n.string()}),_a={filePath:n.string(),exportName:n.string(),entryPoint:n.string()};n.object(_a);const Pc=n.object({...ya,..._a});n.enum(["index","create","restore"]),n.enum(["terminate"]);const Cc=n.custom(t=>{try{return typeof t.test=="function"}catch{return!1}});n.object({project:n.string(),triggerDirectories:n.string().array().optional(),triggerUrl:n.string().optional(),projectDir:n.string().optional(),tsconfigPath:n.string().optional(),retries:n.object({enabledInDev:n.boolean().default(!0),default:Le.optional()}).optional(),additionalPackages:n.string().array().optional(),additionalFiles:n.string().array().optional(),dependenciesToBundle:n.array(n.union([n.string(),Cc])).optional(),logLevel:n.string().optional(),enableConsoleLogging:n.boolean().optional(),postInstall:n.string().optional(),extraCACerts:n.string().optional()});const Ft=n.enum(["WAIT_FOR_DURATION","WAIT_FOR_TASK","WAIT_FOR_BATCH"]),In=n.object({runId:n.string(),attemptCount:n.number().optional(),messageId:n.string(),isTest:n.boolean(),traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),kn=n.object({id:n.string(),description:n.string().optional(),filePath:n.string(),exportName:n.string(),queue:Cr.optional(),retry:Le.optional(),machine:na.optional(),triggerSource:n.string().optional(),schedule:ma.optional(),maxDuration:n.number().optional()}),jc=n.object({filePath:n.string(),contents:n.string(),contentHash:n.string(),taskIds:n.array(n.string())}),Mc=n.object({packageVersion:n.string(),contentHash:n.string(),cliPackageVersion:n.string().optional(),tasks:n.array(kn),sourceFiles:n.array(jc).optional()});n.object({contentHash:n.string(),imageTag:n.string()}),n.object({userId:n.string(),email:n.string().email(),dashboardUrl:n.string()});const Uc=n.object({id:n.string(),externalRef:n.string(),name:n.string(),slug:n.string(),createdAt:n.coerce.date(),organization:n.object({id:n.string(),title:n.string(),slug:n.string(),createdAt:n.coerce.date()})});n.array(Uc),n.object({apiKey:n.string(),name:n.string(),apiUrl:n.string(),projectId:n.string()}),n.object({localOnly:n.boolean(),metadata:Mc,supportsLazyAttempts:n.boolean().optional()}),n.object({id:n.string(),version:n.string(),contentHash:n.string()});const va=n.string().max(128,"Tags must be less than 128 characters"),On=n.union([va,va.array()]),Dc=n.object({payload:n.any(),context:n.any(),options:n.object({dependentAttempt:n.string().optional(),parentAttempt:n.string().optional(),dependentBatch:n.string().optional(),parentBatch:n.string().optional(),lockToVersion:n.string().optional(),queue:Cr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:On.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional()}).optional()}),$c=n.object({id:n.string()});n.object({items:Dc.array(),dependentAttempt:n.string().optional()});const Lc=n.object({task:n.string(),payload:n.any(),context:n.any(),options:n.object({lockToVersion:n.string().optional(),queue:Cr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:On.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional(),parentAttempt:n.string().optional()}).optional()});n.object({items:Lc.array(),dependentAttempt:n.string().optional()});const Kc=n.object({id:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional(),runs:n.array(n.object({id:n.string(),taskIdentifier:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional()}))});n.object({batchId:n.string(),runs:n.string().array()}),n.object({id:n.string(),items:n.array(n.object({id:n.string(),taskRunId:n.string(),status:n.enum(["PENDING","CANCELED","COMPLETED","FAILED"])}))}),n.object({tags:On}),n.object({delay:n.string().or(n.coerce.date())}),n.object({variables:n.record(n.string())}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional()}),n.object({id:n.string(),contentHash:n.string()}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional()});const Wc=n.object({buildId:n.string(),buildToken:n.string(),projectId:n.string()});n.object({id:n.string(),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageTag:n.string(),externalBuildData:Wc.optional().nullable(),registryHost:n.string().optional()}),n.object({contentHash:n.string(),userId:n.string().optional(),registryHost:n.string().optional(),selfHosted:n.boolean().optional(),namespace:n.string().optional()});const ba=n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()});n.object({error:ba}),n.object({id:n.string()}),n.object({id:n.string(),status:n.enum(["PENDING","BUILDING","DEPLOYING","DEPLOYED","FAILED","CANCELED","TIMED_OUT"]),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageReference:n.string().nullish(),errorData:ba.nullish(),worker:n.object({id:n.string(),version:n.string(),tasks:n.array(n.object({id:n.string(),slug:n.string(),filePath:n.string(),exportName:n.string()}))}).optional()});const Ea=n.object({presignedUrl:n.string()}),Vc=n.object({id:n.string()}),Gc=n.object({id:n.string()}),Ta=n.union([n.literal("DECLARATIVE"),n.literal("IMPERATIVE")]);n.object({scheduleId:n.string(),type:Ta,timestamp:n.date(),lastTimestamp:n.date().optional(),externalId:n.string().optional(),timezone:n.string(),upcoming:n.array(n.date())}),n.object({task:n.string(),cron:n.string(),deduplicationKey:n.string(),externalId:n.string().optional(),timezone:n.string().optional()}).omit({deduplicationKey:!0});const Ra=n.object({type:n.literal("CRON"),expression:n.string(),description:n.string()}),Ke=n.object({id:n.string(),type:Ta,task:n.string(),active:n.boolean(),deduplicationKey:n.string().nullish(),externalId:n.string().nullish(),generator:Ra,timezone:n.string(),nextRun:n.coerce.date().nullish(),environments:n.array(n.object({id:n.string(),type:n.string(),userName:n.string().nullish()}))}),Bc=n.object({id:n.string()});n.object({data:n.array(Ke),pagination:n.object({currentPage:n.number(),totalPages:n.number(),count:n.number()})}),n.object({page:n.number().optional(),perPage:n.number().optional()}),n.object({timezones:n.array(n.string())});const Fc=n.enum(["WAITING_FOR_DEPLOY","QUEUED","EXECUTING","REATTEMPTING","FROZEN","COMPLETED","CANCELED","FAILED","CRASHED","INTERRUPTED","SYSTEM_FAILURE","DELAYED","EXPIRED","TIMED_OUT"]),Hc=n.enum(["PENDING","EXECUTING","PAUSED","COMPLETED","FAILED","CANCELED"]),Zc=n.object({id:n.string(),name:n.string(),user:n.string().optional()}),zc=n.object({id:n.string(),externalId:n.string().optional(),deduplicationKey:n.string().optional(),generator:Ra});n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]);const Sa={id:n.string(),status:Fc,taskIdentifier:n.string(),idempotencyKey:n.string().optional(),version:n.string().optional(),isQueued:n.boolean(),isExecuting:n.boolean(),isCompleted:n.boolean(),isSuccess:n.boolean(),isFailed:n.boolean(),isCancelled:n.boolean(),isTest:n.boolean(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),finishedAt:n.coerce.date().optional(),delayedUntil:n.coerce.date().optional(),ttl:n.string().optional(),expiredAt:n.coerce.date().optional(),tags:n.string().array(),costInCents:n.number(),baseCostInCents:n.number(),durationMs:n.number(),metadata:n.record(n.any()).optional()},wa={...Sa,depth:n.number(),triggerFunction:n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]),batchId:n.string().optional()},xn=n.object(wa),Aa=n.object({...wa,payload:n.any().optional(),payloadPresignedUrl:n.string().optional(),output:n.any().optional(),outputPresignedUrl:n.string().optional(),error:ga.optional(),schedule:zc.optional(),relatedRuns:n.object({root:xn.optional(),parent:xn.optional(),children:n.array(xn).optional()}),attempts:n.array(n.object({id:n.string(),status:Hc,createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),completedAt:n.coerce.date().optional(),error:ga.optional()}).optional()),attemptCount:n.number().default(0)}),Nn=n.object({...Sa,env:Zc});n.object({data:n.array(Nn),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),n.object({name:n.string(),value:n.string()}),n.object({value:n.string()}),n.object({variables:n.record(n.string()),override:n.boolean().optional()});const jr=n.object({success:n.boolean()}),Jc=n.object({value:n.string()}),Yc=n.object({name:n.string(),value:n.string()}),qc=n.array(Yc);n.object({metadata:n.record(Gt),metadataType:n.string().optional()});const Xc=n.object({metadata:n.record(Gt)}),Qc=n.object({id:n.string(),idempotencyKey:n.string().nullish(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().nullish(),delayUntil:n.coerce.date().nullish(),queuedAt:n.coerce.date().nullish(),expiredAt:n.coerce.date().nullish(),completedAt:n.coerce.date().nullish(),taskIdentifier:n.string(),friendlyId:n.string(),number:n.number(),isTest:n.boolean(),status:n.string(),usageDurationMs:n.number(),costInCents:n.number(),baseCostInCents:n.number(),ttl:n.string().nullish(),payload:n.string().nullish(),payloadType:n.string().nullish(),metadata:n.string().nullish(),metadataType:n.string().nullish(),output:n.string().nullish(),outputType:n.string().nullish(),runTags:n.array(n.string()).nullish().default([]),error:aa.nullish()}),eu=n.enum(["PENDING","COMPLETED"]),tu=n.object({id:n.string(),status:eu,idempotencyKey:n.string().optional(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),runCount:n.number()}),ru=n.object({id:n.string(),runId:n.string(),sequence:n.number(),key:n.string(),value:n.string(),createdAt:n.coerce.date()}),nu=n.object({project:n.string(),dirs:n.string().array()}),su=n.object({name:n.string(),version:n.string()}),au=n.enum(["dev","deploy"]),Ia=n.enum(["node","bun"]),iu=n.object({target:au,packageVersion:n.string(),cliPackageVersion:n.string(),contentHash:n.string(),runtime:Ia,environment:n.string(),config:nu,files:n.array(Nc),sources:n.record(n.object({contents:n.string(),contentHash:n.string()})),outputPath:n.string(),runWorkerEntryPoint:n.string(),runControllerEntryPoint:n.string().optional(),indexWorkerEntryPoint:n.string(),indexControllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),configPath:n.string(),externals:su.array().optional(),build:n.object({env:n.record(n.string()).optional(),commands:n.array(n.string()).optional()}),customConditions:n.array(n.string()).optional(),deploy:n.object({env:n.record(n.string()).optional(),sync:n.object({env:n.record(n.string()).optional()}).optional()}),image:n.object({pkgs:n.array(n.string()).optional(),instructions:n.array(n.string()).optional()}).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("index"),data:n.object({build:iu})});const ka=n.object({configPath:n.string(),tasks:Pc.array(),workerEntryPoint:n.string(),controllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),runtime:Ia,customConditions:n.array(n.string()).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("worker-manifest"),data:n.object({manifest:ka})});const ou=n.object({message:n.string(),file:n.string(),stack:n.string().optional(),name:n.string().optional()}),cu=n.array(ou),Oa=n.discriminatedUnion("success",[n.object({success:n.literal(!1),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({success:n.literal(!0)})]),xa=n.discriminatedUnion("type",[n.object({type:n.literal("CANCEL_ATTEMPT"),taskAttemptId:n.string(),taskRunId:n.string()}),n.object({type:n.literal("SCHEDULE_ATTEMPT"),image:n.string(),version:n.string(),machine:Bt,nextAttemptNumber:n.number().optional(),id:n.string().optional(),envId:n.string(),envType:Nr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({type:n.literal("EXECUTE_RUN_LAZY_ATTEMPT"),payload:In})]);n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:xa});const Na=n.discriminatedUnion("type",[n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_COMPLETED"),completion:re,execution:pe}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_FAILED_TO_RUN"),completion:xr}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_HEARTBEAT"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_HEARTBEAT"),id:n.string()})]),uu=n.object({id:n.string(),version:n.string(),contentHash:n.string()});n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),inProgressRuns:n.string().array().optional()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Na});const Pa=n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()}),origin:n.enum(["uncaughtException","unhandledRejection"])}),lu=n.object({version:n.literal("v1").default("v1"),tasks:n.unknown(),zodIssues:n.custom(t=>Array.isArray(t)&&t.every(e=>typeof e=="object"&&"message"in e))});n.object({version:n.literal("v1").default("v1"),manifest:ka,importErrors:cu}),n.object({version:n.literal("v1").default("v1"),execution:pe,result:re}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.undefined(),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),waitThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),friendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({version:n.literal("v1").default("v1"),execution:pe,traceContext:n.record(n.unknown()),metadata:uu}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),completion:re,execution:pe}),n.object({version:n.literal("v2"),completion:re})]),n.object({version:n.literal("v1").default("v1")}),n.object({timeoutInMs:n.number()}),n.void(),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({status:n.literal("ok")}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),reason:n.string().optional(),exitCode:n.number().optional(),message:n.string().optional(),logs:n.string().optional(),overrideCompletion:n.boolean().optional(),errorCode:wn.shape.code.optional()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()}),overrideCompletion:n.boolean().optional()}),n.object({version:n.literal("v1").default("v1"),imageTag:n.string(),shortCode:n.string(),apiKey:n.string(),apiUrl:n.string(),envId:n.string(),envType:Nr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.enum(["DOCKER","KUBERNETES"]),location:n.string(),reason:n.string().optional(),imageRef:n.string(),attemptNumber:n.number().optional(),machine:Bt,checkpointId:n.string(),envId:n.string(),envType:Nr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),imageRef:n.string(),shortCode:n.string(),envId:n.string(),envType:Nr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()});const Ca=n.object({projectRef:n.string(),envId:n.string(),deploymentId:n.string(),metadata:n.object({cliPackageVersion:n.string().optional(),contentHash:n.string(),packageVersion:n.string(),tasks:kn.array()})});n.object({version:n.literal("v1").default("v1"),metadata:n.any(),text:n.string()}),n.discriminatedUnion("version",[Ca.extend({version:n.literal("v1")}),Ca.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Pr})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0),payload:Pr})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),lazyPayload:In})]),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string(),type:Ft}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:An,completion:re,checkpoint:n.object({docker:n.boolean(),location:n.string()}).optional()}),n.object({version:n.literal("v1").default("v1"),completion:xr}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string().optional(),attemptFriendlyId:n.string(),docker:n.boolean(),location:n.string(),reason:n.discriminatedUnion("type",[n.object({type:n.literal("WAIT_FOR_DURATION"),ms:n.number(),now:n.number()}),n.object({type:n.literal("WAIT_FOR_BATCH"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({type:n.literal("WAIT_FOR_TASK"),friendlyId:n.string()}),n.object({type:n.literal("RETRYING_AFTER_FAILURE"),attemptNumber:n.number()})])}),n.object({version:n.literal("v1").default("v1"),keepRunAlive:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:re.array(),executions:pe.array()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:re.array(),executions:pe.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),delayInMs:n.number().optional()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),checkpointThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Na}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:xa});const ja=n.object({version:n.literal("v1"),deploymentId:n.string(),tasks:kn.array(),packageVersion:n.string()});n.object({version:n.literal("v1").default("v1")}),n.void(),n.discriminatedUnion("version",[ja.extend({version:n.literal("v1")}),ja.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),attemptFriendlyId:n.string(),type:Ft}),n.object({version:n.literal("v2"),attemptFriendlyId:n.string(),attemptNumber:n.number(),type:Ft})]),n.object({version:n.literal("v1").default("v1")}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),reason:Ft.optional()})]).default({version:"v1"}),n.object({version:n.literal("v2").default("v2"),checkpointCanceled:n.boolean(),reason:Ft.optional()}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:An,completion:re}),n.object({willCheckpointAndRestore:n.boolean(),shouldExit:n.boolean()}),n.object({version:n.literal("v1").default("v1"),completion:xr}),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),friendlyId:n.string(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Pr})]),n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),completions:re.array(),executions:pe.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.object({version:n.literal("v1").default("v1"),executionPayload:Pr}),n.object({version:n.literal("v1").default("v1"),lazyPayload:In}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),delayInMs:n.number().optional()})]),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({contentHash:n.string(),projectRef:n.string(),envId:n.string(),runId:n.string(),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional(),podName:n.string(),deploymentId:n.string(),deploymentVersion:n.string(),requiresCheckpointResumeWithMessage:n.string().optional()}),n.object({supportsDynamicConfig:n.string().optional()});const du=n.enum(["primary"]),fu=n.object({text:n.string(),variant:n.string().optional(),url:n.string().optional()}),hu=n.object({items:n.array(fu),style:n.enum(["codepath"]).optional()});n.object({icon:n.string().optional(),variant:du.optional(),accessory:hu.optional()}).default({icon:void 0,variant:void 0});const pu=[n.object({$endsWith:n.string()}),n.object({$startsWith:n.string()}),n.object({$ignoreCaseEquals:n.string()})],gu=n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean()),n.array(n.union([...pu,n.object({$exists:n.boolean()}),n.object({$isNull:n.boolean()}),n.object({$anythingBut:n.union([n.string(),n.number(),n.boolean()])}),n.object({$anythingBut:n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean())])}),n.object({$gt:n.number()}),n.object({$lt:n.number()}),n.object({$gte:n.number()}),n.object({$lte:n.number()}),n.object({$between:n.tuple([n.number(),n.number()])}),n.object({$includes:n.union([n.string(),n.number(),n.boolean()])}),n.object({$not:n.union([n.string(),n.number(),n.boolean()])})]))]),Pn=n.lazy(()=>n.record(n.union([gu,Pn]))),mu=n.object({strategy:n.literal("headers"),limitHeader:n.string(),remainingHeader:n.string(),resetHeader:n.string(),bodyFilter:Pn.optional(),resetFormat:n.enum(["unix_timestamp","unix_timestamp_in_ms","iso_8601","iso_8601_duration_openai_variant"]).default("unix_timestamp").optional()}),yu=Le.extend({strategy:n.literal("backoff"),bodyFilter:Pn.optional()}),_u=n.discriminatedUnion("strategy",[mu,yu]),vu=n.record(n.string(),_u);n.object({durationInMs:n.number().optional(),retry:Le.optional()}),n.object({byStatus:vu.optional(),timeout:Le.optional(),connectionError:Le.optional()});const bu=n.object({type:n.string().optional(),message:n.string().optional(),stacktrace:n.string().optional()}),Eu=n.object({name:n.literal("exception"),time:n.coerce.date(),properties:n.object({exception:bu})}),Tu=n.object({name:n.literal("cancellation"),time:n.coerce.date(),properties:n.object({reason:n.string()})}),Ru=n.object({name:n.string(),time:n.coerce.date(),properties:n.record(n.unknown())}),Su=n.union([Eu,Tu,Ru]);n.array(Su),n.object({system:n.string().optional(),client_id:n.string().optional(),operation:n.enum(["publish","create","receive","deliver"]),message:n.any(),destination:n.string().optional()});const wu=typeof globalThis=="object"?globalThis:global,Mr=Symbol.for("dev.trigger.ts.api"),Ur=wu;function ie(t,e,r=!1){const s=Ur[Mr]=Ur[Mr]??{};return!r&&s[t]?!1:(s[t]=e,!0)}function Se(t){var e;return(e=Ur[Mr])==null?void 0:e[t]}function We(t){const e=Ur[Mr];e&&delete e[t]}const k={ENVIRONMENT_ID:"ctx.environment.id",ENVIRONMENT_TYPE:"ctx.environment.type",ORGANIZATION_ID:"ctx.organization.id",ORGANIZATION_SLUG:"ctx.organization.slug",ORGANIZATION_NAME:"ctx.organization.name",PROJECT_ID:"ctx.project.id",PROJECT_REF:"ctx.project.ref",PROJECT_NAME:"ctx.project.title",PROJECT_DIR:"project.dir",ATTEMPT_ID:"ctx.attempt.id",ATTEMPT_NUMBER:"ctx.attempt.number",RUN_ID:"ctx.run.id",RUN_IS_TEST:"ctx.run.isTest",BATCH_ID:"ctx.batch.id",TASK_SLUG:"ctx.task.id",TASK_PATH:"ctx.task.filePath",TASK_EXPORT_NAME:"ctx.task.exportName",QUEUE_NAME:"ctx.queue.name",QUEUE_ID:"ctx.queue.id",MACHINE_PRESET_NAME:"ctx.machine.name",MACHINE_PRESET_CPU:"ctx.machine.cpu",MACHINE_PRESET_MEMORY:"ctx.machine.memory",MACHINE_PRESET_CENTS_PER_MS:"ctx.machine.centsPerMs",SPAN_PARTIAL:"$span.partial",SPAN_ID:"$span.span_id",OUTPUT:"$output",OUTPUT_TYPE:"$mime_type_output",STYLE:"$style",STYLE_ICON:"$style.icon",STYLE_VARIANT:"$style.variant",STYLE_ACCESSORY:"$style.accessory",METADATA:"$metadata",TRIGGER:"$trigger",PAYLOAD:"$payload",PAYLOAD_TYPE:"$mime_type_payload",SHOW:"$show",SHOW_ACTIONS:"$show.actions",WORKER_ID:"worker.id",WORKER_VERSION:"worker.version",CLI_VERSION:"cli.version",SDK_VERSION:"sdk.version",SDK_LANGUAGE:"sdk.language",RETRY_AT:"retry.at",RETRY_DELAY:"retry.delay",RETRY_COUNT:"retry.count",LINK_TITLE:"$link.title",IDEMPOTENCY_KEY:"ctx.run.idempotencyKey",USAGE_DURATION_MS:"$usage.durationMs",USAGE_COST_IN_CENTS:"$usage.costInCents",RATE_LIMIT_LIMIT:"response.rateLimit.limit",RATE_LIMIT_REMAINING:"response.rateLimit.remaining",RATE_LIMIT_RESET:"response.rateLimit.reset"},Cn="task-context",an=class an{constructor(){G(this,bt)}static getInstance(){return this._instance||(this._instance=new an),this._instance}get isInsideTask(){return _(this,bt,yn).call(this)!==void 0}get ctx(){var e;return(e=_(this,bt,yn).call(this))==null?void 0:e.ctx}get worker(){var e;return(e=_(this,bt,yn).call(this))==null?void 0:e.worker}get attributes(){return this.ctx?{...this.contextAttributes,...this.workerAttributes}:{}}get workerAttributes(){return this.worker?{[k.WORKER_ID]:this.worker.id,[k.WORKER_VERSION]:this.worker.version}:{}}get contextAttributes(){var e,r,s,a,i;return this.ctx?{[k.ATTEMPT_ID]:this.ctx.attempt.id,[k.ATTEMPT_NUMBER]:this.ctx.attempt.number,[k.TASK_SLUG]:this.ctx.task.id,[k.TASK_PATH]:this.ctx.task.filePath,[k.TASK_EXPORT_NAME]:this.ctx.task.exportName,[k.QUEUE_NAME]:this.ctx.queue.name,[k.QUEUE_ID]:this.ctx.queue.id,[k.ENVIRONMENT_ID]:this.ctx.environment.id,[k.ENVIRONMENT_TYPE]:this.ctx.environment.type,[k.ORGANIZATION_ID]:this.ctx.organization.id,[k.PROJECT_ID]:this.ctx.project.id,[k.PROJECT_REF]:this.ctx.project.ref,[k.PROJECT_NAME]:this.ctx.project.name,[k.RUN_ID]:this.ctx.run.id,[k.RUN_IS_TEST]:this.ctx.run.isTest,[k.ORGANIZATION_SLUG]:this.ctx.organization.slug,[k.ORGANIZATION_NAME]:this.ctx.organization.name,[k.BATCH_ID]:(e=this.ctx.batch)==null?void 0:e.id,[k.IDEMPOTENCY_KEY]:this.ctx.run.idempotencyKey,[k.MACHINE_PRESET_NAME]:(r=this.ctx.machine)==null?void 0:r.name,[k.MACHINE_PRESET_CPU]:(s=this.ctx.machine)==null?void 0:s.cpu,[k.MACHINE_PRESET_MEMORY]:(a=this.ctx.machine)==null?void 0:a.memory,[k.MACHINE_PRESET_CENTS_PER_MS]:(i=this.ctx.machine)==null?void 0:i.centsPerMs}:{}}disable(){We(Cn)}setGlobalTaskContext(e){return ie(Cn,e)}};bt=new WeakSet,yn=function(){return Se(Cn)},v(an,"_instance");let jn=an;const L=jn.getInstance(),Au=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function Iu(t){return t.length===1?t[0].toString():t.reduce((e,r)=>{if(typeof r=="number")return e+"["+r.toString()+"]";if(r.includes('"'))return e+'["'+ku(r)+'"]';if(!Au.test(r))return e+'["'+r+'"]';const s=e.length===0?"":".";return e+s+r},"")}function ku(t){return t.replace(/"/g,'\\"')}function Ou(t){return t.length!==0}const xu=99,Nu="; ",Pu=", or ",Ma="Validation error",Cu=": ";class ju extends Error{constructor(r,s=[]){super(r);v(this,"details");v(this,"name");this.details=s,this.name="ZodValidationError"}toString(){return this.message}}function Ua(t,e,r){if(t.code==="invalid_union")return t.unionErrors.reduce((s,a)=>{const i=a.issues.map(o=>Ua(o,e,r)).join(e);return s.includes(i)||s.push(i),s},[]).join(r);if(Ou(t.path)){if(t.path.length===1){const s=t.path[0];if(typeof s=="number")return`${t.message} at index ${s}`}return`${t.message} at "${Iu(t.path)}"`}return t.message}function Mu(t,e,r){return e!==null?t.length>0?[e,t].join(r):e:t.length>0?t:Ma}function Uu(t,e={}){const{maxIssuesInMessage:r=xu,issueSeparator:s=Nu,unionSeparator:a=Pu,prefixSeparator:i=Cu,prefix:o=Ma}=e,c=t.errors.slice(0,r).map(l=>Ua(l,s,a)).join(s),u=Mu(c,o,i);return new ju(u,t.errors)}const Da={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!0};function $a(t,e){const r={...Da,...t};if(e>=r.maxAttempts)return;const{factor:s,minTimeoutInMs:a,maxTimeoutInMs:i,randomize:o}=r,c=o?Math.random()+1:1,u=Math.min(i,c*a*Math.pow(s,e-1));return Math.round(u)}class B extends Error{constructor(r,s,a,i){super(`${B.makeMessage(r,s,a)}`);v(this,"status");v(this,"headers");v(this,"error");v(this,"code");v(this,"param");v(this,"type");this.name="TriggerApiError",this.status=r,this.headers=i;const o=s;this.error=o,this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(r,s,a){const i=s!=null&&s.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):a;return r&&i?`${r} ${i}`:r?`${r} status code (no body)`:i||"(no status code or body)"}static generate(r,s,a,i){if(!r)return new La({cause:Hu(s)});const o=s==null?void 0:s.error;return r===400?new Du(r,o,a,i):r===401?new $u(r,o,a,i):r===403?new Lu(r,o,a,i):r===404?new Ku(r,o,a,i):r===409?new Wu(r,o,a,i):r===422?new Vu(r,o,a,i):r===429?new Gu(r,o,a,i):r>=500?new Bu(r,o,a,i):new B(r,o,a,i)}}class La extends B{constructor({message:r,cause:s}){super(void 0,void 0,r||"Connection error.",void 0);v(this,"status");s&&(this.cause=s)}}class Du extends B{constructor(){super(...arguments);v(this,"status",400)}}class $u extends B{constructor(){super(...arguments);v(this,"status",401)}}class Lu extends B{constructor(){super(...arguments);v(this,"status",403)}}class Ku extends B{constructor(){super(...arguments);v(this,"status",404)}}class Wu extends B{constructor(){super(...arguments);v(this,"status",409)}}class Vu extends B{constructor(){super(...arguments);v(this,"status",422)}}class Gu extends B{constructor(){super(...arguments);v(this,"status",429)}get millisecondsUntilReset(){const r=(this.headers??{})["x-ratelimit-reset"];if(typeof r=="string"){const s=parseInt(r,10);return isNaN(s)?void 0:Math.max(s-Date.now()+Math.floor(Math.random()*2e3),0)}}}class Bu extends B{}class Fu extends B{constructor({message:r,cause:s,status:a,rawBody:i,headers:o}){super(a,void 0,r||"Validation error.",o);v(this,"status",200);v(this,"rawBody");s&&(this.cause=s),this.rawBody=i}}function Hu(t){return t instanceof Error?t:new Error(t)}var Zu=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Ve="1.9.0",Ka=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function zu(t){var e=new Set([t]),r=new Set,s=t.match(Ka);if(!s)return function(){return!1};var a={major:+s[1],minor:+s[2],patch:+s[3],prerelease:s[4]};if(a.prerelease!=null)return function(u){return u===t};function i(c){return r.add(c),!1}function o(c){return e.add(c),!0}return function(u){if(e.has(u))return!0;if(r.has(u))return!1;var l=u.match(Ka);if(!l)return i(u);var d={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return d.prerelease!=null||a.major!==d.major?i(u):a.major===0?a.minor===d.minor&&a.patch<=d.patch?o(u):i(u):a.minor<=d.minor?o(u):i(u)}}var Ju=zu(Ve),Yu=Ve.split(".")[0],Ht=Symbol.for("opentelemetry.js.api."+Yu),Zt=Zu;function zt(t,e,r,s){var a;s===void 0&&(s=!1);var i=Zt[Ht]=(a=Zt[Ht])!==null&&a!==void 0?a:{version:Ve};if(!s&&i[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(o.stack||o.message),!1}if(i.version!==Ve){var o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+t+" does not match previously registered API v"+Ve);return r.error(o.stack||o.message),!1}return i[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+Ve+"."),!0}function Ge(t){var e,r,s=(e=Zt[Ht])===null||e===void 0?void 0:e.version;if(!(!s||!Ju(s)))return(r=Zt[Ht])===null||r===void 0?void 0:r[t]}function Jt(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+Ve+".");var r=Zt[Ht];r&&delete r[t]}var qu=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},Xu=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},Qu=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yt("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yt("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yt("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yt("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yt("verbose",this._namespace,e)},t}();function Yt(t,e,r){var s=Ge("diag");if(s)return r.unshift(e),s[t].apply(s,Xu([],qu(r),!1))}var Y;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(Y||(Y={}));function el(t,e){t<Y.NONE?t=Y.NONE:t>Y.ALL&&(t=Y.ALL),e=e||{};function r(s,a){var i=e[s];return typeof i=="function"&&t>=a?i.bind(e):function(){}}return{error:r("error",Y.ERROR),warn:r("warn",Y.WARN),info:r("info",Y.INFO),debug:r("debug",Y.DEBUG),verbose:r("verbose",Y.VERBOSE)}}var tl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},rl=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},nl="diag",oe=function(){function t(){function e(a){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var c=Ge("diag");if(c)return c[a].apply(c,rl([],tl(i),!1))}}var r=this,s=function(a,i){var o,c,u;if(i===void 0&&(i={logLevel:Y.INFO}),a===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof i=="number"&&(i={logLevel:i});var d=Ge("diag"),b=el((c=i.logLevel)!==null&&c!==void 0?c:Y.INFO,a);if(d&&!i.suppressOverrideMessage){var g=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+g),b.warn("Current logger will overwrite one already registered from "+g)}return zt("diag",b,r,!0)};r.setLogger=s,r.disable=function(){Jt(nl,r)},r.createComponentLogger=function(a){return new Qu(a)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),sl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},al=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},il=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var r=this._entries.get(e);if(r)return Object.assign({},r)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var r=sl(e,2),s=r[0],a=r[1];return[s,a]})},t.prototype.setEntry=function(e,r){var s=new t(this._entries);return s._entries.set(e,r),s},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var i=new t(this._entries);try{for(var o=al(s),c=o.next();!c.done;c=o.next()){var u=c.value;i._entries.delete(u)}}catch(l){e={error:l}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},t.prototype.clear=function(){return new t},t}();oe.instance();function ol(t){return t===void 0&&(t={}),new il(new Map(Object.entries(t)))}function Wa(t){return Symbol.for(t)}var cl=function(){function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(s){return r._currentContext.get(s)},r.setValue=function(s,a){var i=new t(r._currentContext);return i._currentContext.set(s,a),i},r.deleteValue=function(s){var a=new t(r._currentContext);return a._currentContext.delete(s),a}}return t}(),ul=new cl,Be=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(s[i]=a[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function s(){this.constructor=e}e.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}}(),ll=function(){function t(){}return t.prototype.createGauge=function(e,r){return bl},t.prototype.createHistogram=function(e,r){return El},t.prototype.createCounter=function(e,r){return vl},t.prototype.createUpDownCounter=function(e,r){return Tl},t.prototype.createObservableGauge=function(e,r){return Sl},t.prototype.createObservableCounter=function(e,r){return Rl},t.prototype.createObservableUpDownCounter=function(e,r){return wl},t.prototype.addBatchObservableCallback=function(e,r){},t.prototype.removeBatchObservableCallback=function(e){},t}(),Dr=function(){function t(){}return t}(),dl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,s){},e}(Dr),fl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,s){},e}(Dr),hl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,s){},e}(Dr),pl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,s){},e}(Dr),Mn=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),gl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Mn),ml=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Mn),yl=function(t){Be(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Mn),_l=new ll,vl=new dl,bl=new hl,El=new pl,Tl=new fl,Rl=new gl,Sl=new ml,wl=new yl,Al={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},Il={set:function(t,e,r){t!=null&&(t[e]=r)}},kl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},Ol=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},xl=function(){function t(){}return t.prototype.active=function(){return ul},t.prototype.with=function(e,r,s){for(var a=[],i=3;i<arguments.length;i++)a[i-3]=arguments[i];return r.call.apply(r,Ol([s],kl(a),!1))},t.prototype.bind=function(e,r){return r},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),Nl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},Pl=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},Un="context",Cl=new xl,$r=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return zt(Un,e,oe.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,r,s){for(var a,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(a=this._getContextManager()).with.apply(a,Pl([e,r,s],Nl(i),!1))},t.prototype.bind=function(e,r){return this._getContextManager().bind(e,r)},t.prototype._getContextManager=function(){return Ge(Un)||Cl},t.prototype.disable=function(){this._getContextManager().disable(),Jt(Un,oe.instance())},t}(),Dn;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(Dn||(Dn={}));var Va="0000000000000000",Ga="00000000000000000000000000000000",jl={traceId:Ga,spanId:Va,traceFlags:Dn.NONE},qt=function(){function t(e){e===void 0&&(e=jl),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,r){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,r){},t}(),$n=Wa("OpenTelemetry Context Key SPAN");function Ln(t){return t.getValue($n)||void 0}function Ml(){return Ln($r.getInstance().active())}function Kn(t,e){return t.setValue($n,e)}function Ul(t){return t.deleteValue($n)}function Dl(t,e){return Kn(t,new qt(e))}function Ba(t){var e;return(e=Ln(t))===null||e===void 0?void 0:e.spanContext()}var $l=/^([0-9a-f]{32})$/i,Ll=/^[0-9a-f]{16}$/i;function Kl(t){return $l.test(t)&&t!==Ga}function Wl(t){return Ll.test(t)&&t!==Va}function Fa(t){return Kl(t.traceId)&&Wl(t.spanId)}function Vl(t){return new qt(t)}var Wn=$r.getInstance(),Ha=function(){function t(){}return t.prototype.startSpan=function(e,r,s){s===void 0&&(s=Wn.active());var a=!!(r!=null&&r.root);if(a)return new qt;var i=s&&Ba(s);return Gl(i)&&Fa(i)?new qt(i):new qt},t.prototype.startActiveSpan=function(e,r,s,a){var i,o,c;if(!(arguments.length<2)){arguments.length===2?c=r:arguments.length===3?(i=r,c=s):(i=r,o=s,c=a);var u=o??Wn.active(),l=this.startSpan(e,i,u),d=Kn(u,l);return Wn.with(d,c,void 0,l)}},t}();function Gl(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var Bl=new Ha,Fl=function(){function t(e,r,s,a){this._provider=e,this.name=r,this.version=s,this.options=a}return t.prototype.startSpan=function(e,r,s){return this._getTracer().startSpan(e,r,s)},t.prototype.startActiveSpan=function(e,r,s,a){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Bl},t}(),Hl=function(){function t(){}return t.prototype.getTracer=function(e,r,s){return new Ha},t}(),Zl=new Hl,Za=function(){function t(){}return t.prototype.getTracer=function(e,r,s){var a;return(a=this.getDelegateTracer(e,r,s))!==null&&a!==void 0?a:new Fl(this,e,r,s)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:Zl},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,r,s){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(e,r,s)},t}(),Xt;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(Xt||(Xt={}));var Lr;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(Lr||(Lr={}));var Kr=$r.getInstance();oe.instance();var zl=function(){function t(){}return t.prototype.getMeter=function(e,r,s){return _l},t}(),Jl=new zl,Vn="metrics",Yl=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return zt(Vn,e,oe.instance())},t.prototype.getMeterProvider=function(){return Ge(Vn)||Jl},t.prototype.getMeter=function(e,r,s){return this.getMeterProvider().getMeter(e,r,s)},t.prototype.disable=function(){Jt(Vn,oe.instance())},t}();Yl.getInstance();var ql=function(){function t(){}return t.prototype.inject=function(e,r){},t.prototype.extract=function(e,r){return e},t.prototype.fields=function(){return[]},t}(),Gn=Wa("OpenTelemetry Baggage Key");function za(t){return t.getValue(Gn)||void 0}function Xl(){return za($r.getInstance().active())}function Ql(t,e){return t.setValue(Gn,e)}function ed(t){return t.deleteValue(Gn)}var Bn="propagation",td=new ql,rd=function(){function t(){this.createBaggage=ol,this.getBaggage=za,this.getActiveBaggage=Xl,this.setBaggage=Ql,this.deleteBaggage=ed}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return zt(Bn,e,oe.instance())},t.prototype.inject=function(e,r,s){return s===void 0&&(s=Il),this._getGlobalPropagator().inject(e,r,s)},t.prototype.extract=function(e,r,s){return s===void 0&&(s=Al),this._getGlobalPropagator().extract(e,r,s)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){Jt(Bn,oe.instance())},t.prototype._getGlobalPropagator=function(){return Ge(Bn)||td},t}(),Ja=rd.getInstance(),Fn="trace",nd=function(){function t(){this._proxyTracerProvider=new Za,this.wrapSpanContext=Vl,this.isSpanContextValid=Fa,this.deleteSpan=Ul,this.getSpan=Ln,this.getActiveSpan=Ml,this.getSpanContext=Ba,this.setSpan=Kn,this.setSpanContext=Dl}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var r=zt(Fn,this._proxyTracerProvider,oe.instance());return r&&this._proxyTracerProvider.setDelegate(e),r},t.prototype.getTracerProvider=function(){return Ge(Fn)||this._proxyTracerProvider},t.prototype.getTracer=function(e,r){return this.getTracerProvider().getTracer(e,r)},t.prototype.disable=function(){Jt(Fn,oe.instance()),this._proxyTracerProvider=new Za},t}(),sd=nd.getInstance();const Hn="$@null((",ad="$@circular((";function Zn(t,e,r=new WeakSet){const s={};if(t===void 0)return s;if(t===null)return s[e||""]=Hn,s;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return s[e||""]=t,s;if(t instanceof Date)return s[e||""]=t.toISOString(),s;if(t!==null&&typeof t=="object"&&r.has(t))return s[e||""]=ad,s;t!==null&&typeof t=="object"&&r.add(t);for(const[a,i]of Object.entries(t)){const o=`${e?`${e}.`:""}${Array.isArray(t)?`[${a}]`:a}`;if(Array.isArray(i))for(let c=0;c<i.length;c++)typeof i[c]=="object"&&i[c]!==null?Object.assign(s,Zn(i[c],`${o}.[${c}]`,r)):i[c]===null?s[`${o}.[${c}]`]=Hn:s[`${o}.[${c}]`]=i[c];else id(i)?Object.assign(s,Zn(i,o,r)):typeof i=="number"||typeof i=="string"||typeof i=="boolean"?s[o]=i:i===null&&(s[o]=Hn)}return s}function id(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Qt(t){return Zn(t,k.STYLE_ACCESSORY)}class od{constructor(e,r,s){v(this,"pageFetcher");v(this,"data");v(this,"pagination");this.pageFetcher=s,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return!!this.pagination.next}hasPreviousPage(){return!!this.pagination.previous}getNextPage(){if(!this.pagination.next)throw new Error("No next page available");return this.pageFetcher({after:this.pagination.next})}getPreviousPage(){if(!this.pagination.previous)throw new Error("No previous page available");return this.pageFetcher({before:this.pagination.previous})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class cd{constructor(e,r,s){v(this,"pageFetcher");v(this,"data");v(this,"pagination");this.pageFetcher=s,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.pagination.currentPage<this.pagination.totalPages}hasPreviousPage(){return this.pagination.currentPage>1}getNextPage(){if(!this.hasNextPage())throw new Error("No next page available");return this.pageFetcher({page:this.pagination.currentPage+1})}getPreviousPage(){if(!this.hasPreviousPage())throw new Error("No previous page available");return this.pageFetcher({page:this.pagination.currentPage-1})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}const Ya={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!1};function D(t,e,r,s){return new qn(Jn(t,e,r,s))}function zn(t,e,r,s,a){const i=new URLSearchParams(r.query);r.limit&&i.set("page[size]",String(r.limit)),r.after&&i.set("page[after]",r.after),r.before&&i.set("page[before]",r.before);const o=n.object({data:n.array(t),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),c=new URL(e);c.search=i.toString();const u=Jn(o,c.href,s,a);return new gd(u,t,e,r,s,a)}function qa(t,e,r,s,a){const i=new URLSearchParams(r.query);r.limit&&i.set("perPage",String(r.limit)),r.page&&i.set("page",String(r.page));const o=n.object({data:n.array(t),pagination:n.object({currentPage:n.coerce.number(),totalPages:n.coerce.number(),count:n.coerce.number()})}),c=new URL(e);c.search=i.toString();const u=Jn(o,c.href,s,a);return new md(u,t,e,r,s,a)}async function ud(t,e){var i,o,c;if(!((i=t.options)!=null&&i.tracer))return e();const r=new URL(t.url),s=((o=t.requestInit)==null?void 0:o.method)??"GET",a=t.options.name??`${s} ${r.pathname}`;return await t.options.tracer.startActiveSpan(a,async u=>await e(u),{attributes:{[k.STYLE_ICON]:((c=t.options)==null?void 0:c.icon)??"api",...t.options.attributes}})}async function Jn(t,e,r,s){let a=await r;return ud({url:e,requestInit:a,options:s},async i=>{a=yd(a);const o=await Yn(t,e,a,s);return s!=null&&s.onResponseBody&&i&&s.onResponseBody(o.data,i),o})}async function Yn(t,e,r,s,a=1){try{const i=await fetch(e,pd(r)),o=hd(i.headers);if(!i.ok){const d=dd(i,a,s==null?void 0:s.retry);if(d.retry)return await Qa(e,a+1,d.delay,s,r,i),await Yn(t,e,r,s,a+1);{const b=await i.text().catch(p=>Xa(p).message),g=fd(b),f=g?void 0:b;throw B.generate(i.status,g,f,o)}}const c=await ld(i),u=t.safeParse(c);if(u.success)return{data:u.data,response:i};const l=Uu(u.error);throw new Fu({status:i.status,cause:l,message:l.message,rawBody:c,headers:o})}catch(i){if(i instanceof B)throw i;if(s!=null&&s.retry){const o={...Ya,...s.retry},c=$a(o,a);if(c)return await Qa(e,a+1,c,s,r),await Yn(t,e,r,s,a+1)}throw new La({cause:Xa(i)})}}async function ld(t){try{return await t.clone().json()}catch{return}}function Xa(t){return t instanceof Error?t:new Error(t)}function dd(t,e,r){function s(){const i={...Ya,...r},o=$a(i,e);return o?{retry:!0,delay:o}:{retry:!1}}const a=t.headers.get("x-should-retry");if(a==="true")return s();if(a==="false")return{retry:!1};if(t.status===408||t.status===409)return s();if(t.status===429){if(e>=(typeof(r==null?void 0:r.maxAttempts)=="number"?r==null?void 0:r.maxAttempts:3))return{retry:!1};const i=t.headers.get("x-ratelimit-reset");if(i){const c=parseInt(i,10)-Date.now()+Math.floor(Math.random()*1e3);if(c>0)return{retry:!0,delay:c}}return s()}return t.status>=500?s():{retry:!1}}function fd(t){try{return JSON.parse(t)}catch{return}}function hd(t){return new Proxy(Object.fromEntries(t.entries()),{get(e,r){const s=r.toString();return e[s.toLowerCase()]||e[s]}})}function pd(t){try{const e={...t,cache:"no-cache"},r=new Request("http://localhost",e);return e}catch{return t??{}}}class qn extends Promise{constructor(r){super(s=>{s(null)});v(this,"responsePromise");this.responsePromise=r}asResponse(){return this.responsePromise.then(r=>r.response)}async withResponse(){const[r,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:r,response:s}}parse(){return this.responsePromise.then(r=>r.data)}then(r,s){return this.parse().then(r,s)}catch(r){return this.parse().catch(r)}finally(r){return this.parse().finally(r)}}class gd extends qn{constructor(r,s,a,i,o,c){super(r.then(u=>({data:new od(u.data.data,u.data.pagination,_(this,on,go).bind(this)),response:u.response})));G(this,on);v(this,"schema");v(this,"url");v(this,"params");v(this,"requestInit");v(this,"options");this.schema=s,this.url=a,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const s of r)yield s}}on=new WeakSet,go=function(r){return zn(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};class md extends qn{constructor(r,s,a,i,o,c){super(r.then(u=>({data:new cd(u.data.data,u.data.pagination,_(this,cn,mo).bind(this)),response:u.response})));G(this,cn);v(this,"schema");v(this,"url");v(this,"params");v(this,"requestInit");v(this,"options");this.schema=s,this.url=a,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const s of r)yield s}}cn=new WeakSet,mo=function(r){return qa(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};async function Qa(t,e,r,s,a,i){if(s!=null&&s.tracer){const o=(a==null?void 0:a.method)??"GET";return s.tracer.startActiveSpan(i?`wait after ${i.status}`:"wait after error",async c=>{await new Promise(u=>setTimeout(u,r))},{attributes:{[k.STYLE_ICON]:"wait",...Qt({items:[{text:`retrying ${(s==null?void 0:s.name)??o.toUpperCase()} in ${r}ms`,variant:"normal"}],style:"codepath"})}})}await new Promise(o=>setTimeout(o,r))}function yd(t){const e=new Headers(t==null?void 0:t.headers);if(e.get("x-trigger-worker")!=="true")return t;const r=Object.fromEntries(e.entries());return Ja.inject(Kr.active(),r),{...t,headers:new Headers(r)}}var _d=Object.defineProperty,vd=(t,e,r)=>e in t?_d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wr=(t,e,r)=>vd(t,typeof e!="symbol"?e+"":e,r);class ei extends Error{constructor(e,r){super(e),Wr(this,"type"),Wr(this,"field"),Wr(this,"value"),Wr(this,"line"),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function Xn(t){}function bd(t){const{onEvent:e=Xn,onError:r=Xn,onRetry:s=Xn,onComment:a}=t;let i="",o=!0,c,u="",l="";function d(E){const x=o?E.replace(/^\xEF\xBB\xBF/,""):E,[K,q]=Ed(`${i}${x}`);for(const _e of K)b(_e);i=q,o=!1}function b(E){if(E===""){f();return}if(E.startsWith(":")){a&&a(E.slice(E.startsWith(": ")?2:1));return}const x=E.indexOf(":");if(x!==-1){const K=E.slice(0,x),q=E[x+1]===" "?2:1,_e=E.slice(x+q);g(K,_e,E);return}g(E,"",E)}function g(E,x,K){switch(E){case"event":l=x;break;case"data":u=`${u}${x}
`;break;case"id":c=x.includes("\0")?void 0:x;break;case"retry":/^\d+$/.test(x)?s(parseInt(x,10)):r(new ei(`Invalid \`retry\` value: "${x}"`,{type:"invalid-retry",value:x,line:K}));break;default:r(new ei(`Unknown field "${E.length>20?`${E.slice(0,20)}`:E}"`,{type:"unknown-field",field:E,value:x,line:K}));break}}function f(){u.length>0&&e({id:c,event:l||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),c=void 0,u="",l=""}function p(E={}){i&&E.consume&&b(i),c=void 0,u="",l="",i=""}return{feed:d,reset:p}}function Ed(t){const e=[];let r="";const s=t.length;for(let a=0;a<s;a++){const i=t[a];i==="\r"&&t[a+1]===`
`?(e.push(r),r="",a++):i==="\r"||i===`
`?(e.push(r),r=""):r+=i}return[e,r]}class Td extends TransformStream{constructor({onError:e,onRetry:r,onComment:s}={}){let a;super({start(i){a=bd({onEvent:o=>{i.enqueue(o)},onError(o){e==="terminate"?i.error(o):typeof e=="function"&&e(o)},onRetry:r,onComment:s})},transform(i){a.feed(i)}})}}const er={docs:{config:{home:"https://trigger.dev/docs/config/config-file",additionalPackages:"https://trigger.dev/docs/config/config-file#additionalpackages",extensions:"https://trigger.dev/docs/config/config-file#extensions",prisma:"https://trigger.dev/docs/config/config-file#prisma"},machines:{home:"https://trigger.dev/docs/v3/machines"},upgrade:{beta:"https://trigger.dev/docs/upgrading-beta"}},site:{home:"https://trigger.dev",contact:"https://trigger.dev/contact"}};function Rd(t){switch(t.type){case"BUILT_IN_ERROR":{const e=new Error(t.message);return e.name=t.name,e.stack=t.stackTrace,e}case"STRING_ERROR":return t.raw;case"CUSTOM_ERROR":return JSON.parse(t.raw);case"INTERNAL_ERROR":{const e=new Error(t.message??`Internal error (${t.code})`);return e.name=t.code,e.stack=t.stackTrace,e}}}function Sd(t){const e=Ad(t);switch(e.type){case"BUILT_IN_ERROR":return{name:e.name,message:e.message,stackTrace:e.stackTrace};case"STRING_ERROR":return{message:e.raw};case"CUSTOM_ERROR":return{message:e.raw};case"INTERNAL_ERROR":return{message:`trigger.dev internal error (${e.code})`}}}const wd={TASK_PROCESS_OOM_KILLED:{message:"Your task ran out of memory. Try increasing the machine specs. If this doesn't fix it there might be a memory leak.",link:{name:"Machines",href:er.docs.machines.home}},TASK_PROCESS_MAYBE_OOM_KILLED:{message:"We think your task ran out of memory, but we can't be certain. If this keeps happening, try increasing the machine specs.",link:{name:"Machines",href:er.docs.machines.home}},TASK_PROCESS_SIGSEGV:{message:"Your task crashed with a segmentation fault (SIGSEGV). Most likely there's a bug in a package or binary you're using. If this keeps happening and you're unsure why, please get in touch.",link:{name:"Contact us",href:er.site.contact,magic:"CONTACT_FORM"}},TASK_PROCESS_SIGTERM:{message:"Your task exited after receiving SIGTERM but we don't know why. If this keeps happening, please get in touch so we can investigate.",link:{name:"Contact us",href:er.site.contact,magic:"CONTACT_FORM"}},OUTDATED_SDK_VERSION:{message:"Your task is using an outdated version of the SDK. Please upgrade to the latest version.",link:{name:"Beta upgrade guide",href:er.docs.upgrade.beta}}},ce=t=>({type:"INTERNAL_ERROR",code:t,...wd[t]}),ti=(t,e=100)=>{if(!t)return;const r=e?t.slice(0,e):t;return r.includes("SIGTERM")?"SIGTERM":r.includes("SIGSEGV")?"SIGSEGV":r.includes("SIGKILL")?"SIGKILL":void 0};function Ad(t){switch(t.type){case"BUILT_IN_ERROR":{if(t.name==="UnexpectedExitError"&&t.message.startsWith("Unexpected exit with code -1"))switch(ti(t.stackTrace)){case"SIGTERM":return{...ce("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...ce("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...ce("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...ce("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}if(t.name==="Error"&&t.message==="ffmpeg was killed with signal SIGKILL")return{...ce("TASK_PROCESS_OOM_KILLED")};break}case"STRING_ERROR":break;case"CUSTOM_ERROR":break;case"INTERNAL_ERROR":{if(t.code===sa.TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE)switch(ti(t.message)){case"SIGTERM":return{...ce("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...ce("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...ce("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...ce("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}return{...t,...ce(t.code)}}}return t}function Fe(t,e){return typeof process<"u"&&typeof process.env=="object"&&process.env!==null?process.env[t]??e:e}const tr="api-client";class Id extends Error{constructor(e){super(e),this.name="ApiClientMissingError"}}const un=class un{constructor(){G(this,Et)}static getInstance(){return this._instance||(this._instance=new un),this._instance}disable(){We(tr)}get baseURL(){const e=_(this,Et,_n).call(this);return(e==null?void 0:e.baseURL)??Fe("TRIGGER_API_URL")??"https://api.trigger.dev"}get accessToken(){const e=_(this,Et,_n).call(this);return(e==null?void 0:e.secretKey)??(e==null?void 0:e.accessToken)??Fe("TRIGGER_SECRET_KEY")??Fe("TRIGGER_ACCESS_TOKEN")}get client(){if(!(!this.baseURL||!this.accessToken))return new Si(this.baseURL,this.accessToken)}clientOrThrow(){if(!this.baseURL||!this.accessToken)throw new Id(this.apiClientMissingError());return new Si(this.baseURL,this.accessToken)}runWithConfig(e,r){const s=_(this,Et,_n).call(this),a={...s,...e};return ie(tr,a,!0),r().finally(()=>{ie(tr,s,!0)})}setGlobalAPIClientConfiguration(e){return ie(tr,e)}apiClientMissingError(){const e=!!this.baseURL,r=!!this.accessToken;if(!e&&!r)return"You need to set the TRIGGER_API_URL and TRIGGER_SECRET_KEY environment variables. See https://trigger.dev/docs/management/overview#authentication";if(e){if(!r)return"You need to set the TRIGGER_SECRET_KEY environment variable. See https://trigger.dev/docs/management/overview#authentication"}else return"You need to set the TRIGGER_API_URL environment variable. See https://trigger.dev/docs/management/overview#authentication";return"Unknown error"}};Et=new WeakSet,_n=function(){return Se(tr)},v(un,"_instance");let Qn=un;const rr=Qn.getInstance();async function es(t,e){if(t.data)switch(t.dataType){case"application/json":return JSON.parse(t.data,void 0);case"application/super+json":const{parse:r}=await si();return r(t.data);case"text/plain":return t.data;case"application/store":throw new Error(`Cannot parse an application/store packet (${t.data}). Needs to be imported first.`);default:return t.data}}async function kd(t,e){const r=await ri(t,void 0,e);return await es(r)}async function Vr(t){if(t===void 0)return{dataType:"application/json"};if(typeof t=="string")return{data:t,dataType:"text/plain"};try{const{stringify:e}=await si();return{data:e(t),dataType:"application/super+json"}}catch{return{data:t,dataType:"application/json"}}}const Od={minTimeoutInMs:500,maxTimeoutInMs:5e3,maxAttempts:5,factor:2,randomize:!0};async function ri(t,e,r){return t.dataType!=="application/store"?t:e?await e.startActiveSpan("store.downloadPayload",async a=>await ni(t,a,r),{attributes:{[k.STYLE_ICON]:"cloud-download"}})??t:await ni(t,void 0,r)}async function ni(t,e,r){if(!t.data)return t;const s=r??rr.client;if(!s)return t;const a=await s.getPayloadUrl(t.data),i=await D(n.any(),a.presignedUrl,void 0,{retry:Od}).asResponse();if(!i.ok)throw new Error(`Failed to import packet ${a.presignedUrl}: ${i.statusText}`);const o=await i.text();return e==null||e.setAttribute("size",Buffer.byteLength(o,"utf8")),{data:o,dataType:i.headers.get("content-type")??"application/json"}}function zp(t){}async function si(){const t=await Promise.resolve().then(()=>$p);return t.registerCustom({isApplicable:e=>typeof Buffer=="function"&&Buffer.isBuffer(e),serialize:e=>[...e],deserialize:e=>Buffer.from(e)},"buffer"),t}var xd=Object.defineProperty,Nd=Object.defineProperties,Pd=Object.getOwnPropertyDescriptors,Gr=Object.getOwnPropertySymbols,ai=Object.prototype.hasOwnProperty,ii=Object.prototype.propertyIsEnumerable,oi=t=>{throw TypeError(t)},ci=(t,e,r)=>e in t?xd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ot=(t,e)=>{for(var r in e||(e={}))ai.call(e,r)&&ci(t,r,e[r]);if(Gr)for(var r of Gr(e))ii.call(e,r)&&ci(t,r,e[r]);return t},ui=(t,e)=>Nd(t,Pd(e)),Cd=(t,e)=>{var r={};for(var s in t)ai.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&Gr)for(var s of Gr(t))e.indexOf(s)<0&&ii.call(t,s)&&(r[s]=t[s]);return r},ts=(t,e,r)=>e.has(t)||oi("Cannot "+r),O=(t,e,r)=>(ts(t,e,"read from private field"),r?r.call(t):e.get(t)),V=(t,e,r)=>e.has(t)?oi("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),M=(t,e,r,s)=>(ts(t,e,"write to private field"),e.set(t,r),r),ue=(t,e,r)=>(ts(t,e,"access private method"),r),He=(t,e,r)=>new Promise((s,a)=>{var i=u=>{try{c(r.next(u))}catch(l){a(l)}},o=u=>{try{c(r.throw(u))}catch(l){a(l)}},c=u=>u.done?s(u.value):Promise.resolve(u.value).then(i,o);c((r=r.apply(t,e)).next())}),Br=class yo extends Error{constructor(e,r,s,a,i,o){super(o||`HTTP Error ${e} at ${i}: ${r??JSON.stringify(s)}`),this.url=i,this.name="FetchError",this.status=e,this.text=r,this.json=s,this.headers=a}static fromResponse(e,r){return He(this,null,function*(){const s=e.status,a=Object.fromEntries([...e.headers.entries()]);let i,o;const c=e.headers.get("content-type");return c&&c.includes("application/json")?o=yield e.json():i=yield e.text(),new yo(s,i,o,a,r)})}},li=class extends Error{constructor(){super("Fetch with backoff aborted"),this.name="FetchBackoffAbortError"}},jd=class extends Error{constructor(){super("Invalid shape options: missing required url parameter"),this.name="MissingShapeUrlError"}},Md=class extends Error{constructor(){super("Invalid signal option. It must be an instance of AbortSignal."),this.name="InvalidSignalError"}},Ud=class extends Error{constructor(){super("shapeHandle is required if this isn't an initial fetch (i.e. offset > -1)"),this.name="MissingShapeHandleError"}},Dd=class extends Error{constructor(t){super(`Cannot use reserved Electric parameter names in custom params: ${t.join(", ")}`),this.name="ReservedParamError"}},$d=class extends Error{constructor(t){super(`Column "${t??"unknown"}" does not allow NULL values`),this.name="ParserNullValueError"}},Ld=class extends Error{constructor(t,e){let r=`The response for the shape request to ${t} didn't include the following required headers:
`;e.forEach(s=>{r+=`- ${s}
`}),r+=`
This is often due to a proxy not setting CORS correctly so that all Electric headers can be read by the client.`,r+=`
For more information visit the troubleshooting guide: /docs/guides/troubleshooting/missing-headers`,super(r)}},Fr=t=>Number(t),Kd=t=>t==="true"||t==="t",Wd=t=>BigInt(t),di=t=>JSON.parse(t),Vd=t=>t,Gd={int2:Fr,int4:Fr,int8:Wd,bool:Kd,float4:Fr,float8:Fr,json:di,jsonb:di};function Bd(t,e){let r=0,s=null,a="",i=!1,o=0,c;function u(l){const d=[];for(;r<l.length;r++){if(s=l[r],i)s==="\\"?a+=l[++r]:s==='"'?(d.push(e(a)),a="",i=l[r+1]==='"',o=r+2):a+=s;else if(s==='"')i=!0;else if(s==="{")o=++r,d.push(u(l));else if(s==="}"){i=!1,o<r&&d.push(e(l.slice(o,r))),o=r+1;break}else s===","&&c!=="}"&&c!=='"'&&(d.push(e(l.slice(o,r))),o=r+1);c=s}return o<r&&d.push(e(l.slice(o,r+1))),d}return u(t)[0]}var Fd=class{constructor(t){this.parser=ot(ot({},Gd),t)}parse(t,e){return JSON.parse(t,(r,s)=>{if(r==="value"&&typeof s=="object"&&s!==null){const a=s;Object.keys(a).forEach(i=>{a[i]=this.parseRow(i,a[i],e)})}return s})}parseRow(t,e,r){var s;const a=r[t];if(!a)return e;const i=a,{type:o,dims:c}=i,u=Cd(i,["type","dims"]),l=(s=this.parser[o])!=null?s:Vd,d=fi(l,a,t);return c&&c>0?fi((g,f)=>Bd(g,d),a,t)(e):d(e,u)}};function fi(t,e,r){var s;const a=!((s=e.not_null)!=null&&s);return i=>{if(Hd(i)){if(!a)throw new $d(r??"unknown");return null}return t(i,e)}}function Hd(t){return t===null||t==="NULL"}function hi(t){return"key"in t}function pi(t){return!hi(t)}function Zd(t){return pi(t)&&t.headers.control==="up-to-date"}var zd="electric-cursor",rs="electric-handle",gi="electric-offset",Jd="electric-schema",Yd="electric-up-to-date",qd="columns",mi="cursor",ns="handle",ct="live",ss="offset",Xd="table",Qd="where",ef="replica",tf=[429],yi={initialDelay:100,maxDelay:1e4,multiplier:1.3};function rf(t,e=yi){const{initialDelay:r,maxDelay:s,multiplier:a,debug:i=!1,onFailedAttempt:o}=e;return(...c)=>He(this,null,function*(){var u;const l=c[0],d=c[1];let b=r,g=0;for(;;)try{const f=yield t(...c);if(f.ok)return f;throw yield Br.fromResponse(f,l.toString())}catch(f){if(o==null||o(),(u=d==null?void 0:d.signal)!=null&&u.aborted)throw new li;if(f instanceof Br&&!tf.includes(f.status)&&f.status>=400&&f.status<500)throw f;yield new Promise(p=>setTimeout(p,b)),b=Math.min(b*a,s),i&&(g++,console.log(`Retry attempt #${g} after ${b}ms`))}})}var nf={maxChunksToPrefetch:2};function sf(t,e=nf){const{maxChunksToPrefetch:r}=e;let s;return(...i)=>He(this,null,function*(){const o=i[0].toString(),c=s==null?void 0:s.consume(...i);if(c)return c;s==null||s.abort();const u=yield t(...i),l=as(o,u);return l&&(s=new lf({fetchClient:t,maxPrefetchedRequests:r,url:l,requestInit:i[1]})),u})}var af=["electric-offset","electric-handle"],of=["electric-cursor"],cf=["electric-schema"];function uf(t){return(...e)=>He(this,null,function*(){const r=yield t(...e);if(r.ok){const s=r.headers,a=[],i=l=>a.push(...l.filter(d=>!s.has(d)));i(af);const c=e[0].toString(),u=new URL(c);if(u.searchParams.get(ct)==="true"&&i(of),(!u.searchParams.has(ct)||u.searchParams.get(ct)==="false")&&i(cf),a.length>0)throw new Ld(c,a)}return r})}var Hr,Zr,we,ut,Ae,nr,zr,lf=class{constructor(t){V(this,nr),V(this,Hr),V(this,Zr),V(this,we,new Map),V(this,ut),V(this,Ae);var e;M(this,Hr,(e=t.fetchClient)!=null?e:(...r)=>fetch(...r)),M(this,Zr,t.maxPrefetchedRequests),M(this,ut,t.url.toString()),M(this,Ae,O(this,ut)),ue(this,nr,zr).call(this,t.url,t.requestInit)}abort(){O(this,we).forEach(([t,e])=>e.abort())}consume(...t){var e;const r=t[0].toString(),s=(e=O(this,we).get(r))==null?void 0:e[0];if(!(!s||r!==O(this,ut)))return O(this,we).delete(r),s.then(a=>{const i=as(r,a);M(this,ut,i),O(this,Ae)&&!O(this,we).has(O(this,Ae))&&ue(this,nr,zr).call(this,O(this,Ae),t[1])}).catch(()=>{}),s}};Hr=new WeakMap,Zr=new WeakMap,we=new WeakMap,ut=new WeakMap,Ae=new WeakMap,nr=new WeakSet,zr=function(...t){var e,r;const s=t[0].toString();if(O(this,we).size>=O(this,Zr))return;const a=new AbortController;try{const i=O(this,Hr).call(this,s,ui(ot({},(e=t[1])!=null?e:{}),{signal:df(a,(r=t[1])==null?void 0:r.signal)}));O(this,we).set(s,[i,a]),i.then(o=>{if(!o.ok||a.signal.aborted)return;const c=as(s,o);if(!c||c===s){M(this,Ae,void 0);return}return M(this,Ae,c),ue(this,nr,zr).call(this,c,t[1])}).catch(()=>{})}catch{}};function as(t,e){const r=e.headers.get(rs),s=e.headers.get(gi),a=e.headers.has(Yd);if(!r||!s||a)return;const i=new URL(t);if(!i.searchParams.has(ct))return i.searchParams.set(ns,r),i.searchParams.set(ss,s),i.searchParams.sort(),i.toString()}function df(t,e){return e&&(e.aborted?t.abort():e.addEventListener("abort",()=>t.abort(),{once:!0})),t.signal}var _i=new Set([mi,ns,ct,ss]);function ff(t){const e={};for(const[r,s]of Object.entries(t))e[r]=Array.isArray(s)?s.join(","):s;return e}var Jr,Yr,qr,Ze,ze,lt,Je,Ie,Ye,ke,dt,sr,ge,is,os,vi,cs,bi=class{constructor(t){V(this,ge),V(this,Jr,null),V(this,Yr),V(this,qr),V(this,Ze,new Map),V(this,ze),V(this,lt),V(this,Je),V(this,Ie,!1),V(this,Ye,!1),V(this,ke),V(this,dt),V(this,sr);var e,r,s;this.options=ot({subscribe:!0},t),hf(this.options),M(this,ze,(e=this.options.offset)!=null?e:"-1"),M(this,lt,""),M(this,ke,this.options.handle),M(this,qr,new Fd(t.parser)),M(this,sr,this.options.onError);const a=(r=t.fetchClient)!=null?r:(...o)=>fetch(...o),i=rf(a,ui(ot({},(s=t.backoffOptions)!=null?s:yi),{onFailedAttempt:()=>{var o,c;M(this,Ye,!1),(c=(o=t.backoffOptions)==null?void 0:o.onFailedAttempt)==null||c.call(o)}}));M(this,Yr,uf(sf(i))),ue(this,ge,is).call(this)}get shapeHandle(){return O(this,ke)}get error(){return O(this,Jr)}get isUpToDate(){return O(this,Ie)}get lastOffset(){return O(this,ze)}subscribe(t,e=()=>{}){const r=Math.random();return O(this,Ze).set(r,[t,e]),()=>{O(this,Ze).delete(r)}}unsubscribeAll(){O(this,Ze).clear()}lastSyncedAt(){return O(this,Je)}lastSynced(){return O(this,Je)===void 0?1/0:Date.now()-O(this,Je)}isConnected(){return O(this,Ye)}isLoading(){return!O(this,Ie)}};Jr=new WeakMap,Yr=new WeakMap,qr=new WeakMap,Ze=new WeakMap,ze=new WeakMap,lt=new WeakMap,Je=new WeakMap,Ie=new WeakMap,Ye=new WeakMap,ke=new WeakMap,dt=new WeakMap,sr=new WeakMap,ge=new WeakSet,is=function(){return He(this,null,function*(){var t,e;try{for(;!((t=this.options.signal)!=null&&t.aborted)&&!O(this,Ie)||this.options.subscribe;){const{url:r,signal:s}=this.options,a=new URL(r);if(this.options.params){const p=Object.keys(this.options.params).filter(K=>_i.has(K));if(p.length>0)throw new Error(`Cannot use reserved Electric parameter names in custom params: ${p.join(", ")}`);const E=ff(this.options.params);E.table&&a.searchParams.set(Xd,E.table),E.where&&a.searchParams.set(Qd,E.where),E.columns&&a.searchParams.set(qd,E.columns),E.replica&&a.searchParams.set(ef,E.replica);const x=ot({},E);delete x.table,delete x.where,delete x.columns,delete x.replica;for(const[K,q]of Object.entries(x))a.searchParams.set(K,q)}a.searchParams.set(ss,O(this,ze)),O(this,Ie)&&(a.searchParams.set(ct,"true"),a.searchParams.set(mi,O(this,lt))),O(this,ke)&&a.searchParams.set(ns,O(this,ke)),a.searchParams.sort();let i;try{i=yield O(this,Yr).call(this,a.toString(),{signal:s,headers:this.options.headers}),M(this,Ye,!0)}catch(p){if(p instanceof li)break;if(!(p instanceof Br))throw p;if(p.status==409){const E=p.headers[rs];ue(this,ge,cs).call(this,E),yield ue(this,ge,os).call(this,p.json);continue}else if(p.status>=400&&p.status<500)throw ue(this,ge,vi).call(this,p),p}const{headers:o,status:c}=i,u=o.get(rs);u&&M(this,ke,u);const l=o.get(gi);l&&M(this,ze,l);const d=o.get(zd);d&&M(this,lt,d);const b=()=>{const p=o.get(Jd);return p?JSON.parse(p):{}};M(this,dt,(e=O(this,dt))!=null?e:b());const g=c===204?"[]":yield i.text();c===204&&M(this,Je,Date.now());const f=O(this,qr).parse(g,O(this,dt));if(f.length>0){const p=f[f.length-1];Zd(p)&&(M(this,Je,Date.now()),M(this,Ie,!0)),yield ue(this,ge,os).call(this,f)}}}catch(r){if(M(this,Jr,r),O(this,sr)){const s=yield O(this,sr).call(this,r);typeof s=="object"&&(ue(this,ge,cs).call(this),"params"in s&&(this.options.params=s.params),"headers"in s&&(this.options.headers=s.headers),ue(this,ge,is).call(this));return}throw r}finally{M(this,Ye,!1)}})},os=function(t){return He(this,null,function*(){yield Promise.all(Array.from(O(this,Ze).values()).map(e=>He(this,[e],function*([r,s]){try{yield r(t)}catch(a){queueMicrotask(()=>{throw a})}})))})},vi=function(t){O(this,Ze).forEach(([e,r])=>{r==null||r(t)})},cs=function(t){M(this,ze,"-1"),M(this,lt,""),M(this,ke,t),M(this,Ie,!1),M(this,Ye,!1),M(this,dt,void 0)},bi.Replica={FULL:"full",DEFAULT:"default"};function hf(t){if(!t.url)throw new jd;if(t.signal&&!(t.signal instanceof AbortSignal))throw new Md;if(t.offset!==void 0&&t.offset!=="-1"&&!t.handle)throw new Ud;if(t.params){const e=Object.keys(t.params).filter(r=>_i.has(r));if(e.length>0)throw new Dd(e)}}function Ei(t,e,r){var c;const s=new AbortController;(c=r==null?void 0:r.signal)==null||c.addEventListener("abort",()=>{s.abort()},{once:!0});const a=new bi({url:e,headers:{...r==null?void 0:r.headers,"x-trigger-electric-version":"1.0.0-beta.1"},fetchClient:r==null?void 0:r.fetchClient,signal:s.signal});return{stream:new gf(a).stream.pipeThrough(new TransformStream({async transform(u,l){const d=t.safeParse(u);d.success?l.enqueue(d.data):l.error(new Error(`Unable to parse shape: ${d.error.message}`))}})),stop:()=>{s.abort()}}}function pf(t,e){const r=t.pipeThrough(new TransformStream(e));return r[Symbol.asyncIterator]=()=>{const s=r.getReader();return{async next(){const{done:a,value:i}=await s.read();return a?{done:!0,value:void 0}:{done:!1,value:i}}}},r}function Ti(t,e,r){return new ReadableStream({async start(s){const i=t.pipeThrough(new TransformStream(e)).getReader();for(r.addEventListener("abort",()=>{queueMicrotask(()=>{i.cancel(),s.close()})});;){const{done:o,value:c}=await i.read();if(o){s.close();break}s.enqueue(c)}}})}class gf{constructor(e){G(this,ln);G(this,X);G(this,Pe,new Map);G(this,hr);G(this,Tt,!1);G(this,pr);Rt(this,X,e);const r=new ReadableStream({start:s=>{Rt(this,pr,F(this,X).subscribe(a=>s.enqueue(a),_(this,ln,_o).bind(this)))}});Rt(this,hr,pf(r,{transform:(s,a)=>{const i=new Set;for(const o of s)if(hi(o)){const c=o.key;switch(o.headers.operation){case"insert":{F(this,Pe).set(c,o.value),i.add(c);break}case"update":{const u=F(this,Pe).get(c),l=u?{...u,...o.value}:o.value;F(this,Pe).set(c,l),i.add(c);break}}}else pi(o)&&o.headers.control==="must-refetch"&&(F(this,Pe).clear(),Rt(this,Tt,!1));for(const o of i){const c=F(this,Pe).get(o);c&&a.enqueue(c)}}}))}stop(){var e;(e=F(this,pr))==null||e.call(this)}get stream(){return F(this,hr)}get isUpToDate(){return F(this,X).isUpToDate}get lastOffset(){return F(this,X).lastOffset}get handle(){return F(this,X).shapeHandle}get error(){return F(this,Tt)}lastSyncedAt(){return F(this,X).lastSyncedAt()}lastSynced(){return F(this,X).lastSynced()}isLoading(){return F(this,X).isLoading()}isConnected(){return F(this,X).isConnected()}}X=new WeakMap,Pe=new WeakMap,hr=new WeakMap,Tt=new WeakMap,pr=new WeakMap,ln=new WeakSet,_o=function(e){e instanceof Br&&Rt(this,Tt,e)};class mf extends TransformStream{constructor(){super({transform:(r,s)=>{this.buffer+=r;const a=this.buffer.split(`
`);this.buffer=a.pop()||"";const i=a.filter(o=>o.trim().length>0);i.length>0&&s.enqueue(i)},flush:r=>{const s=this.buffer.trim();s.length>0&&r.enqueue([s])}});v(this,"buffer","")}}function us(t,e){var c;const r=new AbortController,s=new _f(Fe("TRIGGER_STREAM_URL",Fe("TRIGGER_API_URL"))??"https://api.trigger.dev",{headers:e==null?void 0:e.headers,signal:r.signal}),a=new bf(Fe("TRIGGER_STREAM_URL",Fe("TRIGGER_API_URL"))??"https://api.trigger.dev",{headers:e==null?void 0:e.headers,signal:r.signal});(c=e==null?void 0:e.signal)==null||c.addEventListener("abort",()=>{r.signal.aborted||r.abort()},{once:!0});const i=Ei(Qc,t,{...e,signal:r.signal}),o={runShapeStream:i.stream,stopRunShapeStream:i.stop,streamFactory:new Ef(s,a),abortController:r,...e};return new Tf(o)}class yf{constructor(e,r){v(this,"url");v(this,"options");this.url=e,this.options=r}async subscribe(){return fetch(this.url,{headers:{Accept:"text/event-stream",...this.options.headers},signal:this.options.signal}).then(e=>{if(!e.ok)throw B.generate(e.status,{},"Could not subscribe to stream",Object.fromEntries(e.headers));if(!e.body)throw new Error("No response body");return e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Td).pipeThrough(new TransformStream({transform(r,s){s.enqueue(Ri(r.data))}}))})}}class _f{constructor(e,r){v(this,"baseUrl");v(this,"options");this.baseUrl=e,this.options=r}createSubscription(e,r,s,a){if(!r||!s)throw new Error("runId and streamKey are required");const i=`${a??this.baseUrl}/realtime/v1/streams/${r}/${s}`;return new yf(i,this.options)}}class vf{constructor(e,r){v(this,"url");v(this,"options");this.url=e,this.options=r}async subscribe(){return Ei(ru,this.url,this.options).stream.pipeThrough(new TransformStream({transform(e,r){r.enqueue(e.value)}})).pipeThrough(new mf).pipeThrough(new TransformStream({transform(e,r){for(const s of e)r.enqueue(Ri(s))}}))}}class bf{constructor(e,r){v(this,"baseUrl");v(this,"options");this.baseUrl=e,this.options=r}createSubscription(e,r,s,a){if(!r||!s)throw new Error("runId and streamKey are required");return new vf(`${a??this.baseUrl}/realtime/v2/streams/${r}/${s}`,this.options)}}class Ef{constructor(e,r){v(this,"version1");v(this,"version2");this.version1=e,this.version2=r}createSubscription(e,r,s,a){if(!r||!s)throw new Error("runId and streamKey are required");const i=typeof e.$$streamsVersion=="string"?e.$$streamsVersion:"v1",o=typeof e.$$streamsBaseUrl=="string"?e.$$streamsBaseUrl:a;if(i==="v1")return this.version1.createSubscription(e,r,s,o);if(i==="v2")return this.version2.createSubscription(e,r,s,o);throw new Error(`Unknown stream version: ${i}`)}}class Tf{constructor(e){v(this,"options");v(this,"stream");v(this,"packetCache",new Map);v(this,"_closeOnComplete");v(this,"_isRunComplete",!1);this.options=e,this._closeOnComplete=typeof e.closeOnComplete>"u"?!0:e.closeOnComplete,this.stream=Ti(this.options.runShapeStream,{transform:async(r,s)=>{const a=await this.transformRunShape(r);s.enqueue(a),this._isRunComplete=!!a.finishedAt,this._closeOnComplete&&this._isRunComplete&&!this.options.abortController.signal.aborted&&this.options.stopRunShapeStream()}},this.options.abortController.signal)}unsubscribe(){this.options.abortController.signal.aborted||this.options.abortController.abort(),this.options.stopRunShapeStream()}[Symbol.asyncIterator](){return this.stream[Symbol.asyncIterator]()}getReader(){return this.stream.getReader()}withStreams(){const e=new Set;return Ti(this.stream,{transform:async(r,s)=>{var a;if(s.enqueue({type:"run",run:r}),r.metadata&&"$$streams"in r.metadata&&Array.isArray(r.metadata.$$streams))for(const i of r.metadata.$$streams)typeof i=="string"&&(e.has(i)||(e.add(i),(await this.options.streamFactory.createSubscription(r.metadata,r.id,i,(a=this.options.client)==null?void 0:a.baseUrl).subscribe()).pipeThrough(new TransformStream({transform(u,l){l.enqueue({type:i,chunk:u,run:r})}})).pipeTo(new WritableStream({write(u){s.enqueue(u)}})).catch(u=>{console.error(`Error in stream ${i}:`,u)})))}},this.options.abortController.signal)}async transformRunShape(e){const r=e.payloadType?{data:e.payload??void 0,dataType:e.payloadType}:void 0,s=e.outputType?{data:e.output??void 0,dataType:e.outputType}:void 0,[a,i]=await Promise.all([{packet:r,key:"payload"},{packet:s,key:"output"}].map(async({packet:c,key:u})=>{if(!c)return;const l=this.packetCache.get(`${e.friendlyId}/${u}`);if(typeof l<"u")return l;const d=await kd(c,this.options.client);return this.packetCache.set(`${e.friendlyId}/${u}`,d),d})),o=e.metadata&&e.metadataType?await es({data:e.metadata,dataType:e.metadataType}):void 0;return{id:e.friendlyId,payload:a,output:i,createdAt:e.createdAt,updatedAt:e.updatedAt,taskIdentifier:e.taskIdentifier,number:e.number,status:Rf(e.status),durationMs:e.usageDurationMs,costInCents:e.costInCents,baseCostInCents:e.baseCostInCents,tags:e.runTags??[],idempotencyKey:e.idempotencyKey??void 0,expiredAt:e.expiredAt??void 0,finishedAt:e.completedAt??void 0,startedAt:e.startedAt??void 0,delayedUntil:e.delayUntil??void 0,queuedAt:e.queuedAt??void 0,error:e.error?Sd(e.error):void 0,isTest:e.isTest,metadata:o}}}function Rf(t){switch(t){case"DELAYED":return"DELAYED";case"WAITING_FOR_DEPLOY":return"WAITING_FOR_DEPLOY";case"PENDING":return"QUEUED";case"PAUSED":case"WAITING_TO_RESUME":return"FROZEN";case"RETRYING_AFTER_FAILURE":return"REATTEMPTING";case"EXECUTING":return"EXECUTING";case"CANCELED":return"CANCELED";case"COMPLETED_SUCCESSFULLY":return"COMPLETED";case"SYSTEM_FAILURE":return"SYSTEM_FAILURE";case"INTERRUPTED":return"INTERRUPTED";case"CRASHED":return"CRASHED";case"COMPLETED_WITH_ERRORS":return"FAILED";case"EXPIRED":return"EXPIRED";default:throw new Error(`Unknown status: ${t}`)}}function Ri(t){try{return JSON.parse(t)}catch{return t}}const Sf={retry:{maxAttempts:5,minTimeoutInMs:1e3,maxTimeoutInMs:3e4,factor:1.6,randomize:!1}};class Si{constructor(e,r,s={}){G(this,N);v(this,"baseUrl");v(this,"accessToken");v(this,"defaultRequestOptions");this.accessToken=r,this.baseUrl=e.replace(/\/$/,""),this.defaultRequestOptions=U(Sf,s)}get fetchClient(){const e=_(this,N,C).call(this,!1);return(s,a)=>{const i={...a,headers:{...a==null?void 0:a.headers,...e}};return fetch(s,i)}}getHeaders(){return _(this,N,C).call(this,!1)}async getRunResult(e,r){try{return await D(re,`${this.baseUrl}/api/v1/runs/${e}/result`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}catch(s){if(s instanceof B&&s.status===404)return;throw s}}async getBatchResults(e,r){return await D(kc,`${this.baseUrl}/api/v1/batches/${e}/results`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}triggerTask(e,r,s,a){const i=encodeURIComponent(e);return D($c,`${this.baseUrl}/api/v1/tasks/${i}/trigger`,{method:"POST",headers:_(this,N,C).call(this,(s==null?void 0:s.spanParentAsLink)??!1),body:JSON.stringify(r)},U(this.defaultRequestOptions,a)).withResponse().then(async({response:o,data:c})=>{var g;const u=o.headers.get("x-trigger-jwt");if(typeof u=="string")return{...c,publicAccessToken:u};const l=o.headers.get("x-trigger-jwt-claims"),d=l?JSON.parse(l):void 0,b=await ea({secretKey:this.accessToken,payload:{...d,scopes:[`read:runs:${c.id}`]},expirationTime:((g=a==null?void 0:a.publicAccessToken)==null?void 0:g.expirationTime)??"1h"});return{...c,publicAccessToken:b}})}batchTriggerV2(e,r,s){return D(Kc,`${this.baseUrl}/api/v1/tasks/batch`,{method:"POST",headers:_(this,N,C).call(this,(r==null?void 0:r.spanParentAsLink)??!1,{"idempotency-key":r==null?void 0:r.idempotencyKey,"idempotency-key-ttl":r==null?void 0:r.idempotencyKeyTTL,"batch-processing-strategy":r==null?void 0:r.processingStrategy}),body:JSON.stringify(e)},U(this.defaultRequestOptions,s)).withResponse().then(async({response:a,data:i})=>{var l;const o=a.headers.get("x-trigger-jwt-claims"),c=o?JSON.parse(o):void 0,u=await ea({secretKey:this.accessToken,payload:{...c,scopes:[`read:batch:${i.id}`]},expirationTime:((l=s==null?void 0:s.publicAccessToken)==null?void 0:l.expirationTime)??"1h"});return{...i,publicAccessToken:u}})}createUploadPayloadUrl(e,r){return D(Ea,`${this.baseUrl}/api/v1/packets/${e}`,{method:"PUT",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}getPayloadUrl(e,r){return D(Ea,`${this.baseUrl}/api/v1/packets/${e}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}retrieveRun(e,r){return D(Aa,`${this.baseUrl}/api/v3/runs/${e}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}listRuns(e,r){const s=wi(e);return zn(Nn,`${this.baseUrl}/api/v1/runs`,{query:s,limit:e==null?void 0:e.limit,after:e==null?void 0:e.after,before:e==null?void 0:e.before},{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}listProjectRuns(e,r,s){const a=wi(r);return r!=null&&r.env&&a.append("filter[env]",Array.isArray(r.env)?r.env.join(","):r.env),zn(Nn,`${this.baseUrl}/api/v1/projects/${e}/runs`,{query:a,limit:r==null?void 0:r.limit,after:r==null?void 0:r.after,before:r==null?void 0:r.before},{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,s))}replayRun(e,r){return D(Vc,`${this.baseUrl}/api/v1/runs/${e}/replay`,{method:"POST",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}cancelRun(e,r){return D(Gc,`${this.baseUrl}/api/v2/runs/${e}/cancel`,{method:"POST",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}rescheduleRun(e,r,s){return D(Aa,`${this.baseUrl}/api/v1/runs/${e}/reschedule`,{method:"POST",headers:_(this,N,C).call(this,!1),body:JSON.stringify(r)},U(this.defaultRequestOptions,s))}addTags(e,r,s){return D(n.object({message:n.string()}),`${this.baseUrl}/api/v1/runs/${e}/tags`,{method:"POST",headers:_(this,N,C).call(this,!1),body:JSON.stringify(r)},U(this.defaultRequestOptions,s))}createSchedule(e,r){return D(Ke,`${this.baseUrl}/api/v1/schedules`,{method:"POST",headers:_(this,N,C).call(this,!1),body:JSON.stringify(e)},U(this.defaultRequestOptions,r))}listSchedules(e,r){const s=new URLSearchParams;return e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.perPage&&s.append("perPage",e.perPage.toString()),qa(Ke,`${this.baseUrl}/api/v1/schedules`,{page:e==null?void 0:e.page,limit:e==null?void 0:e.perPage},{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}retrieveSchedule(e,r){return D(Ke,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}updateSchedule(e,r,s){return D(Ke,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"PUT",headers:_(this,N,C).call(this,!1),body:JSON.stringify(r)},U(this.defaultRequestOptions,s))}deactivateSchedule(e,r){return D(Ke,`${this.baseUrl}/api/v1/schedules/${e}/deactivate`,{method:"POST",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}activateSchedule(e,r){return D(Ke,`${this.baseUrl}/api/v1/schedules/${e}/activate`,{method:"POST",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}deleteSchedule(e,r){return D(Bc,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"DELETE",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}listEnvVars(e,r,s){return D(qc,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,s))}importEnvVars(e,r,s,a){return D(jr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/import`,{method:"POST",headers:_(this,N,C).call(this,!1),body:JSON.stringify(s)},U(this.defaultRequestOptions,a))}retrieveEnvVar(e,r,s,a){return D(Jc,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,a))}createEnvVar(e,r,s,a){return D(jr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"POST",headers:_(this,N,C).call(this,!1),body:JSON.stringify(s)},U(this.defaultRequestOptions,a))}updateEnvVar(e,r,s,a,i){return D(jr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"PUT",headers:_(this,N,C).call(this,!1),body:JSON.stringify(a)},U(this.defaultRequestOptions,i))}deleteEnvVar(e,r,s,a){return D(jr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"DELETE",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,a))}updateRunMetadata(e,r,s){return D(Xc,`${this.baseUrl}/api/v1/runs/${e}/metadata`,{method:"PUT",headers:_(this,N,C).call(this,!1),body:JSON.stringify(r)},U(this.defaultRequestOptions,s))}subscribeToRun(e,r){return us(`${this.baseUrl}/realtime/v1/runs/${e}`,{closeOnComplete:!0,headers:_(this,N,vn).call(this),client:this,signal:r==null?void 0:r.signal})}subscribeToRunsWithTag(e,r){const s=wf({tags:e});return us(`${this.baseUrl}/realtime/v1/runs${s?`?${s}`:""}`,{closeOnComplete:!1,headers:_(this,N,vn).call(this),client:this,signal:r==null?void 0:r.signal})}subscribeToBatch(e,r){return us(`${this.baseUrl}/realtime/v1/batches/${e}`,{closeOnComplete:!1,headers:_(this,N,vn).call(this),client:this,signal:r==null?void 0:r.signal})}async generateJWTClaims(e){return D(n.record(n.any()),`${this.baseUrl}/api/v1/auth/jwt/claims`,{method:"POST",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,e))}retrieveBatch(e,r){return D(tu,`${this.baseUrl}/api/v1/batches/${e}`,{method:"GET",headers:_(this,N,C).call(this,!1)},U(this.defaultRequestOptions,r))}}N=new WeakSet,C=function(e,r){const s={"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`,"trigger-version":Qs,...Object.entries(r??{}).reduce((a,[i,o])=>(o!==void 0&&(a[i]=o),a),{})};return L.isInsideTask&&(s["x-trigger-worker"]="true",e&&(s["x-trigger-span-parent-as-link"]="1")),typeof window<"u"&&typeof window.document<"u"&&(s["x-trigger-client"]="browser"),s},vn=function(){return{Authorization:`Bearer ${this.accessToken}`,"trigger-version":Qs}};function wf(t){const e=new URLSearchParams;return t.tasks&&e.append("tasks",Array.isArray(t.tasks)?t.tasks.join(","):t.tasks),t.tags&&e.append("tags",Array.isArray(t.tags)?t.tags.join(","):t.tags),e}function wi(t){const e=new URLSearchParams;return t&&(t.status&&e.append("filter[status]",Array.isArray(t.status)?t.status.join(","):t.status),t.taskIdentifier&&e.append("filter[taskIdentifier]",Array.isArray(t.taskIdentifier)?t.taskIdentifier.join(","):t.taskIdentifier),t.version&&e.append("filter[version]",Array.isArray(t.version)?t.version.join(","):t.version),t.bulkAction&&e.append("filter[bulkAction]",t.bulkAction),t.tag&&e.append("filter[tag]",Array.isArray(t.tag)?t.tag.join(","):t.tag),t.schedule&&e.append("filter[schedule]",t.schedule),typeof t.isTest=="boolean"&&e.append("filter[isTest]",String(t.isTest)),t.from&&e.append("filter[createdAt][from]",t.from instanceof Date?t.from.getTime().toString():t.from.toString()),t.to&&e.append("filter[createdAt][to]",t.to instanceof Date?t.to.getTime().toString():t.to.toString()),t.period&&e.append("filter[createdAt][period]",t.period),t.batch&&e.append("filter[batch]",t.batch)),e}function U(t,e){return e?{...t,...e,retry:{...t.retry,...e.retry}}:t}var ar={},Ai;function Af(){if(Ai)return ar;Ai=1;/*!
 * Copyright 2019 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Object.defineProperty(ar,"__esModule",{value:!0}),ar.PreciseDate=void 0;const t=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d{4,9}Z/,e="BigInt only available in Node >= v10.7. Consider using getFullTimeString instead.";var r;(function(g){g[g.NEGATIVE=-1]="NEGATIVE",g[g.POSITIVE=1]="POSITIVE",g[g.ZERO=0]="ZERO"})(r||(r={}));class s extends Date{constructor(f){if(super(),this._micros=0,this._nanos=0,f&&typeof f!="number"&&!(f instanceof Date)){this.setFullTime(s.parseFull(f));return}const p=Array.from(arguments),E=p.slice(0,7),x=new Date(...E),K=p.length===9?p.pop():0,q=p.length===8?p.pop():0;this.setTime(x.getTime()),this.setMicroseconds(q),this.setNanoseconds(K)}getFullTime(){if(typeof BigInt!="function")throw new Error(e);return BigInt(this.getFullTimeString())}getFullTimeString(){const f=this._getSeconds();let p=this._getNanos();return p&&Math.sign(f)===r.NEGATIVE&&(p=1e9-p),`${f}${l(p,9)}`}getMicroseconds(){return this._micros}getNanoseconds(){return this._nanos}setMicroseconds(f){const p=Math.abs(f);let E=this.getUTCMilliseconds();return p>=1e3&&(E+=Math.floor(p/1e3)*Math.sign(f),f%=1e3),Math.sign(f)===r.NEGATIVE&&(E-=1,f+=1e3),this._micros=f,this.setUTCMilliseconds(E),this.getFullTimeString()}setNanoseconds(f){const p=Math.abs(f);let E=this._micros;return p>=1e3&&(E+=Math.floor(p/1e3)*Math.sign(f),f%=1e3),Math.sign(f)===r.NEGATIVE&&(E-=1,f+=1e3),this._nanos=f,this.setMicroseconds(E)}setFullTime(f){typeof f!="string"&&(f=f.toString());const p=Math.sign(Number(f));f=f.replace(/^-/,"");const E=Number(f.substr(0,f.length-9))*p,x=Number(f.substr(-9))*p;return this.setTime(E*1e3),this.setNanoseconds(x)}setTime(f){return this._micros=0,this._nanos=0,super.setTime(f)}toISOString(){const f=l(this._micros,3),p=l(this._nanos,3);return super.toISOString().replace(/z$/i,`${f}${p}Z`)}toStruct(){let f=this._getSeconds();const p=this._getNanos();return Math.sign(f)===r.NEGATIVE&&p&&(f-=1),{seconds:f,nanos:p}}toTuple(){const{seconds:f,nanos:p}=this.toStruct();return[f,p]}_getSeconds(){const f=this.getTime(),p=Math.sign(f);return Math.floor(Math.abs(f)/1e3)*p}_getNanos(){const f=this.getUTCMilliseconds()*1e6,p=this._micros*1e3;return this._nanos+f+p}static parseFull(f){const p=new s;if(Array.isArray(f)){const[E,x]=f;f={seconds:E,nanos:x}}if(o(f))p.setFullTime(f);else if(c(f)){const{seconds:E,nanos:x}=i(f);p.setTime(E*1e3),p.setNanoseconds(x)}else u(f)?p.setFullTime(a(f)):p.setTime(new Date(f).getTime());return p.getFullTimeString()}static fullUTC(...f){if(typeof BigInt!="function")throw new Error(e);return BigInt(s.fullUTCString(...f))}static fullUTCString(...f){const p=Date.UTC(...f.slice(0,7)),E=new s(p);return f.length===9&&E.setNanoseconds(f.pop()),f.length===8&&E.setMicroseconds(f.pop()),E.getFullTimeString()}}ar.PreciseDate=s;function a(g){let f="0";g=g.replace(/\.(\d+)/,(x,K)=>(f=K,".000"));const p=Number(d(f,9));return new s(g).setNanoseconds(p)}function i({seconds:g=0,nanos:f=0}){return typeof g.toNumber=="function"&&(g=g.toNumber()),g=Number(g),f=Number(f),{seconds:g,nanos:f}}function o(g){return typeof g=="bigint"||typeof g=="string"&&/^\d+$/.test(g)}function c(g){return typeof g=="object"&&typeof g.seconds<"u"||typeof g.nanos=="number"}function u(g){return typeof g=="string"&&t.test(g)}function l(g,f){return`${b(g,f)}${g}`}function d(g,f){const p=b(g,f);return`${g}${p}`}function b(g,f){const p=Math.max(f-g.toString().length,0);return"0".repeat(p)}return ar}var If=Af();class kf{preciseNow(){const r=new If.PreciseDate().toStruct();return[r.seconds,r.nanos]}reset(){}}const Ii="clock",Of=new kf,dn=class dn{constructor(){G(this,gr)}static getInstance(){return this._instance||(this._instance=new dn),this._instance}setGlobalClock(e){return ie(Ii,e)}preciseNow(){return _(this,gr,Ls).call(this).preciseNow()}reset(){_(this,gr,Ls).call(this).reset()}};gr=new WeakSet,Ls=function(){return Se(Ii)??Of},v(dn,"_instance");let ls=dn;const ki=ls.getInstance();var xf=function(){function t(){}return t.prototype.emit=function(e){},t}(),Nf=function(){function t(){}return t.prototype.getLogger=function(e,r,s){return new xf},t}(),Oi=new Nf,Pf=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Xr=Symbol.for("io.opentelemetry.js.api.logs"),ir=Pf;function Cf(t,e,r){return function(s){return s===t?e:r}}var xi=1,jf=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalLoggerProvider=function(e){return ir[Xr]?this.getLoggerProvider():(ir[Xr]=Cf(xi,e,Oi),e)},t.prototype.getLoggerProvider=function(){var e,r;return(r=(e=ir[Xr])===null||e===void 0?void 0:e.call(ir,xi))!==null&&r!==void 0?r:Oi},t.prototype.getLogger=function(e,r,s){return this.getLoggerProvider().getLogger(e,r,s)},t.prototype.disable=function(){delete ir[Xr]},t}(),Mf=jf.getInstance();class Uf{debug(){}log(){}info(){}warn(){}error(){}trace(e,r){return r({})}}const ds="logger",Df=new Uf,fn=class fn{constructor(){G(this,ye)}static getInstance(){return this._instance||(this._instance=new fn),this._instance}disable(){We(ds)}setGlobalTaskLogger(e){return ie(ds,e)}debug(e,r){_(this,ye,et).call(this).debug(e,r)}log(e,r){_(this,ye,et).call(this).log(e,r)}info(e,r){_(this,ye,et).call(this).info(e,r)}warn(e,r){_(this,ye,et).call(this).warn(e,r)}error(e,r){_(this,ye,et).call(this).error(e,r)}trace(e,r){return _(this,ye,et).call(this).trace(e,r)}};ye=new WeakSet,et=function(){return Se(ds)??Df},v(fn,"_instance");let fs=fn;const Oe=fs.getInstance();class $f{disable(){}waitForDuration(e){return Promise.resolve()}waitUntil(e){return Promise.resolve()}waitForTask(e){return Promise.resolve({ok:!1,id:e.id,error:{type:"INTERNAL_ERROR",code:sa.CONFIGURED_INCORRECTLY}})}waitForBatch(e){return Promise.resolve({id:e.id,items:[]})}}class Lf{disable(){}start(){return{sample:()=>({cpuTime:0,wallTime:0})}}stop(e){return e.sample()}pauseAsync(e){return e()}sample(){}}const hs="usage",Kf=new Lf,hn=class hn{constructor(){G(this,Ce)}static getInstance(){return this._instance||(this._instance=new hn),this._instance}setGlobalUsageManager(e){return ie(hs,e)}disable(){_(this,Ce,St).call(this).disable(),We(hs)}start(){return _(this,Ce,St).call(this).start()}stop(e){return _(this,Ce,St).call(this).stop(e)}pauseAsync(e){return _(this,Ce,St).call(this).pauseAsync(e)}sample(){return _(this,Ce,St).call(this).sample()}};Ce=new WeakSet,St=function(){return Se(hs)??Kf},v(hn,"_instance");let ps=hn;const ft=ps.getInstance(),gs="runtime",Wf=new $f,pn=class pn{constructor(){G(this,je)}static getInstance(){return this._instance||(this._instance=new pn),this._instance}waitForDuration(e){return ft.pauseAsync(()=>_(this,je,wt).call(this).waitForDuration(e))}waitUntil(e){return ft.pauseAsync(()=>_(this,je,wt).call(this).waitUntil(e))}waitForTask(e){return ft.pauseAsync(()=>_(this,je,wt).call(this).waitForTask(e))}waitForBatch(e){return ft.pauseAsync(()=>_(this,je,wt).call(this).waitForBatch(e))}setGlobalRuntimeManager(e){return ie(gs,e)}disable(){_(this,je,wt).call(this).disable(),We(gs)}};je=new WeakSet,wt=function(){return Se(gs)??Wf},v(pn,"_instance");let ms=pn;const Qr=ms.getInstance(),ys="timeout";class Vf{abortAfterTimeout(e){return new AbortController().signal}}const Gf=new Vf,gn=class gn{constructor(){G(this,mr)}static getInstance(){return this._instance||(this._instance=new gn),this._instance}get signal(){return _(this,mr,Ks).call(this).signal}abortAfterTimeout(e){return _(this,mr,Ks).call(this).abortAfterTimeout(e)}setGlobalManager(e){return ie(ys,e)}disable(){We(ys)}};mr=new WeakSet,Ks=function(){return Se(ys)??Gf},v(gn,"_instance");let _s=gn;const Bf=_s.getInstance();class Ff{registerTaskMetadata(e){}registerTaskFileMetadata(e,r){}updateTaskMetadata(e,r){}listTaskManifests(){return[]}getTaskManifest(e){}getTask(e){}taskExists(e){return!1}disable(){}}const vs="task-catalog",Hf=new Ff,mn=class mn{constructor(){G(this,de)}static getInstance(){return this._instance||(this._instance=new mn),this._instance}setGlobalTaskCatalog(e){return ie(vs,e)}disable(){We(vs)}registerTaskMetadata(e){_(this,de,Me).call(this).registerTaskMetadata(e)}updateTaskMetadata(e,r){_(this,de,Me).call(this).updateTaskMetadata(e,r)}registerTaskFileMetadata(e,r){_(this,de,Me).call(this).registerTaskFileMetadata(e,r)}listTaskManifests(){return _(this,de,Me).call(this).listTaskManifests()}getTaskManifest(e){return _(this,de,Me).call(this).getTaskManifest(e)}getTask(e){return _(this,de,Me).call(this).getTask(e)}taskExists(e){return _(this,de,Me).call(this).taskExists(e)}};de=new WeakSet,Me=function(){return Se(vs)??Hf},v(mn,"_instance");let bs=mn;const or=bs.getInstance();class Zf extends Error{constructor(r,s,a){var e=(...Xp)=>(super(...Xp),v(this,"taskId"),v(this,"runId"),v(this,"cause"),this);a instanceof Error?(e(`Error in ${r}: ${a.message}`),this.cause=a,this.name="SubtaskUnwrapError"):(e(`Error in ${r}`),this.name="SubtaskUnwrapError",this.cause=a),this.taskId=r,this.runId=s}}class zf extends Promise{constructor(r,s){super(r);v(this,"taskId");this.taskId=s}unwrap(){return this.then(r=>{if(r.ok)return r.output;throw new Zf(this.taskId,r.id,r.error)})}}function Jf(t){return typeof t=="string"&&t.length===64}async function Es(t){if(t)return Jf(t)?t:await Yf(t,{scope:"global"})}async function Yf(t,e){return await Xf([...Array.isArray(t)?t:[t]].concat(qf((e==null?void 0:e.scope)??"run")))}function qf(t){switch(t){case"run":{if(L!=null&&L.ctx)return[L.ctx.run.id];break}case"attempt":{if(L!=null&&L.ctx)return[L.ctx.attempt.id];break}}return[]}async function Xf(t){const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t.join("-")));return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function Qf(t,e){e instanceof Error?t.recordException(eh(e)):typeof e=="string"?t.recordException(e.replace(/\0/g,"")):t.recordException(JSON.stringify(e).replace(/\0/g,"")),t.setStatus({code:Lr.ERROR})}function eh(t){var r;const e=new Error(t.message.replace(/\0/g,""));return e.name=t.name.replace(/\0/g,""),e.stack=(r=t.stack)==null?void 0:r.replace(/\0/g,""),e}class th{constructor(e){v(this,"_config");v(this,"_tracer");v(this,"_logger");this._config=e}get tracer(){if(!this._tracer){if("tracer"in this._config)return this._config.tracer;this._tracer=sd.getTracer(this._config.name,this._config.version)}return this._tracer}get logger(){if(!this._logger){if("logger"in this._config)return this._config.logger;this._logger=Mf.getLogger(this._config.name,this._config.version)}return this._logger}extractContext(e){return Ja.extract(Kr.active(),e??{})}startActiveSpan(e,r,s,a,i){const o=a??Kr.active(),c=(s==null?void 0:s.attributes)??{};let u=!1;return this.tracer.startActiveSpan(e,{...s,attributes:c,startTime:ki.preciseNow()},o,async l=>{i==null||i.addEventListener("abort",()=>{u||(u=!0,Qf(l,i.reason),l.end())}),L.ctx&&this.tracer.startSpan(e,{...s,attributes:{...c,[k.SPAN_PARTIAL]:!0,[k.SPAN_ID]:l.spanContext().spanId}},o).end();const d=ft.start();try{return await r(l)}catch(b){throw u||((typeof b=="string"||b instanceof Error)&&l.recordException(b),l.setStatus({code:Lr.ERROR})),b}finally{if(!u){if(u=!0,L.ctx){const b=ft.stop(d),g=L.ctx.machine;l.setAttributes({[k.USAGE_DURATION_MS]:b.cpuTime,[k.USAGE_COST_IN_CENTS]:g!=null&&g.centsPerMs?b.cpuTime*g.centsPerMs:0})}l.end(ki.preciseNow())}}})}startSpan(e,r,s){const a=s??Kr.active(),i=(r==null?void 0:r.attributes)??{},o=this.tracer.startSpan(e,r,s);return this.tracer.startSpan(e,{...r,attributes:{...i,[k.SPAN_PARTIAL]:!0,[k.SPAN_ID]:o.spanContext().spanId}},a).end(),o}}const rh="3.3.7",xe=new th({name:"@trigger.dev/sdk",version:rh});function Jp(t){return t}function nh(t){var s;const e=t.queue?{name:((s=t.queue)==null?void 0:s.name)??`task/${t.id}`,...t.queue}:void 0,r={id:t.id,description:t.description,trigger:async(a,i)=>{const o=or.getTaskManifest(t.id);return await sh(o&&o.exportName?`${o.exportName}.trigger()`:"trigger()",t.id,a,void 0,{queue:e,...i})},batchTrigger:async(a,i)=>{const o=or.getTaskManifest(t.id);return await ah(o&&o.exportName?`${o.exportName}.batchTrigger()`:"batchTrigger()",t.id,a,i,void 0,void 0,e)},triggerAndWait:(a,i)=>{const o=or.getTaskManifest(t.id);return new zf((c,u)=>{ih(o&&o.exportName?`${o.exportName}.triggerAndWait()`:"triggerAndWait()",t.id,a,void 0,{queue:e,...i}).then(l=>{c(l)}).catch(l=>{u(l)})},t.id)},batchTriggerAndWait:async(a,i)=>{const o=or.getTaskManifest(t.id);return await oh(o&&o.exportName?`${o.exportName}.batchTriggerAndWait()`:"batchTriggerAndWait()",t.id,a,void 0,i,void 0,e)}};return or.registerTaskMetadata({id:t.id,description:t.description,queue:t.queue,retry:t.retry?{...Da,...t.retry}:void 0,machine:t.machine,maxDuration:t.maxDuration,fns:{run:t.run,init:t.init,cleanup:t.cleanup,middleware:t.middleware,handleError:t.handleError,onSuccess:t.onSuccess,onFailure:t.onFailure,onStart:t.onStart}}),r[Symbol.for("trigger.dev/task")]=!0,r}async function sh(t,e,r,s,a,i){var d,b;const o=rr.clientOrThrow(),u=await Vr(r);return await o.triggerTask(e,{payload:u.data,options:{queue:a==null?void 0:a.queue,concurrencyKey:a==null?void 0:a.concurrencyKey,test:(d=L.ctx)==null?void 0:d.run.isTest,payloadType:u.dataType,idempotencyKey:await Es(a==null?void 0:a.idempotencyKey),idempotencyKeyTTL:a==null?void 0:a.idempotencyKeyTTL,delay:a==null?void 0:a.delay,ttl:a==null?void 0:a.ttl,tags:a==null?void 0:a.tags,maxAttempts:a==null?void 0:a.maxAttempts,parentAttempt:(b=L.ctx)==null?void 0:b.attempt.id,metadata:a==null?void 0:a.metadata,maxDuration:a==null?void 0:a.maxDuration}},{spanParentAsLink:!0},{name:t,tracer:xe,icon:"trigger",onResponseBody:(g,f)=>{g&&typeof g=="object"&&!Array.isArray(g)&&"id"in g&&typeof g.id=="string"&&f.setAttribute("runId",g.id)},...i})}async function ah(t,e,r,s,a,i,o){const u=await rr.clientOrThrow().batchTriggerV2({items:await Promise.all(r.map(async d=>{var f,p,E,x,K,q,_e,yr,_r,vr,br,Er;const b=d.payload,g=await Vr(b);return{task:e,payload:g.data,options:{queue:((f=d.options)==null?void 0:f.queue)??o,concurrencyKey:(p=d.options)==null?void 0:p.concurrencyKey,test:(E=L.ctx)==null?void 0:E.run.isTest,payloadType:g.dataType,idempotencyKey:await Es((x=d.options)==null?void 0:x.idempotencyKey),idempotencyKeyTTL:(K=d.options)==null?void 0:K.idempotencyKeyTTL,delay:(q=d.options)==null?void 0:q.delay,ttl:(_e=d.options)==null?void 0:_e.ttl,tags:(yr=d.options)==null?void 0:yr.tags,maxAttempts:(_r=d.options)==null?void 0:_r.maxAttempts,parentAttempt:(vr=L.ctx)==null?void 0:vr.attempt.id,metadata:(br=d.options)==null?void 0:br.metadata,maxDuration:(Er=d.options)==null?void 0:Er.maxDuration}}}))},{spanParentAsLink:!0,idempotencyKey:await Es(s==null?void 0:s.idempotencyKey),idempotencyKeyTTL:s==null?void 0:s.idempotencyKeyTTL,processingStrategy:s!=null&&s.triggerSequentially?"sequential":void 0},{name:t,tracer:xe,icon:"trigger",onResponseBody(d,b){d&&typeof d=="object"&&!Array.isArray(d)&&("id"in d&&typeof d.id=="string"&&b.setAttribute("batchId",d.id),"runs"in d&&Array.isArray(d.runs)&&b.setAttribute("runCount",d.runs.length),"isCached"in d&&typeof d.isCached=="boolean"&&(d.isCached&&console.warn("Result is a cached response because the request was idempotent."),b.setAttribute("isCached",d.isCached)),"idempotencyKey"in d&&typeof d.idempotencyKey=="string"&&b.setAttribute("idempotencyKey",d.idempotencyKey))},...i});return{batchId:u.id,isCached:u.isCached,idempotencyKey:u.idempotencyKey,runs:u.runs,publicAccessToken:u.publicAccessToken}}async function ih(t,e,r,s,a,i){const o=L.ctx;if(!o)throw new Error("triggerAndWait can only be used from inside a task.run()");const c=rr.clientOrThrow(),l=await Vr(r);return await xe.startActiveSpan(t,async d=>{var f,p;const b=await c.triggerTask(e,{payload:l.data,options:{dependentAttempt:o.attempt.id,lockToVersion:(f=L.worker)==null?void 0:f.version,queue:a==null?void 0:a.queue,concurrencyKey:a==null?void 0:a.concurrencyKey,test:(p=L.ctx)==null?void 0:p.run.isTest,payloadType:l.dataType,delay:a==null?void 0:a.delay,ttl:a==null?void 0:a.ttl,tags:a==null?void 0:a.tags,maxAttempts:a==null?void 0:a.maxAttempts,metadata:a==null?void 0:a.metadata,maxDuration:a==null?void 0:a.maxDuration}},{},i);d.setAttribute("runId",b.id);const g=await Qr.waitForTask({id:b.id,ctx:o});return await Ts(g,e)},{kind:Xt.PRODUCER,attributes:{[k.STYLE_ICON]:"trigger",...Qt({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function oh(t,e,r,s,a,i,o){const c=L.ctx;if(!c)throw new Error("batchTriggerAndWait can only be used from inside a task.run()");const u=rr.clientOrThrow();return await xe.startActiveSpan(t,async l=>{const d=await u.batchTriggerV2({items:await Promise.all(r.map(async f=>{var x,K,q,_e,yr,_r,vr,br,Er,ho;const p=f.payload,E=await Vr(p);return{task:e,payload:E.data,options:{lockToVersion:(x=L.worker)==null?void 0:x.version,queue:((K=f.options)==null?void 0:K.queue)??o,concurrencyKey:(q=f.options)==null?void 0:q.concurrencyKey,test:(_e=L.ctx)==null?void 0:_e.run.isTest,payloadType:E.dataType,delay:(yr=f.options)==null?void 0:yr.delay,ttl:(_r=f.options)==null?void 0:_r.ttl,tags:(vr=f.options)==null?void 0:vr.tags,maxAttempts:(br=f.options)==null?void 0:br.maxAttempts,metadata:(Er=f.options)==null?void 0:Er.metadata,maxDuration:(ho=f.options)==null?void 0:ho.maxDuration}}})),dependentAttempt:c.attempt.id},{processingStrategy:a!=null&&a.triggerSequentially?"sequential":void 0},i);l.setAttribute("batchId",d.id),l.setAttribute("runCount",d.runs.length),l.setAttribute("isCached",d.isCached),d.isCached&&console.warn("Result is a cached response because the request was idempotent."),d.idempotencyKey&&l.setAttribute("idempotencyKey",d.idempotencyKey);const b=await Qr.waitForBatch({id:d.id,runs:d.runs.map(f=>f.id),ctx:c}),g=await ch(b.items,e);return{id:b.id,runs:g}},{kind:Xt.PRODUCER,attributes:{[k.STYLE_ICON]:"trigger",...Qt({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function ch(t,e){return t.some(s=>s.ok&&s.outputType==="application/store")?await xe.startActiveSpan("store.downloadPayloads",async s=>await Promise.all(t.map(async i=>await Ts(i,e))),{kind:Xt.INTERNAL,[k.STYLE_ICON]:"cloud-download"}):await Promise.all(t.map(async a=>await Ts(a,e)))}async function Ts(t,e){if(t.ok){const r={data:t.output,dataType:t.outputType},s=await ri(r,xe);return{ok:!0,id:t.id,taskIdentifier:t.taskIdentifier??e,output:await es(s)}}else return{ok:!1,id:t.id,taskIdentifier:t.taskIdentifier??e,error:Rd(t.error)}}const Ni=nh,uh={for:async t=>xe.startActiveSpan("wait.for()",async e=>{const r=dh(t);await Qr.waitForDuration(r)},{attributes:{[k.STYLE_ICON]:"wait",...Qt({items:[{text:lh(t),variant:"normal"}],style:"codepath"})}}),until:async t=>xe.startActiveSpan("wait.until()",async e=>{const r=Date.now();if(t.throwIfInThePast&&t.date<new Date)throw new Error("Date is in the past");const s=t.date.getTime()-r;await Qr.waitForDuration(s)},{attributes:{[k.STYLE_ICON]:"wait",...Qt({items:[{text:t.date.toISOString(),variant:"normal"}],style:"codepath"})}})};function lh(t){return"seconds"in t?t.seconds===1?"1 second":`${t.seconds} seconds`:"minutes"in t?t.minutes===1?"1 minute":`${t.minutes} minutes`:"hours"in t?t.hours===1?"1 hour":`${t.hours} hours`:"days"in t?t.days===1?"1 day":`${t.days} days`:"weeks"in t?t.weeks===1?"1 week":`${t.weeks} weeks`:"months"in t?t.months===1?"1 month":`${t.months} months`:"years"in t?t.years===1?"1 year":`${t.years} years`:"NaN"}function dh(t){if("seconds"in t)return t.seconds*1e3;if("minutes"in t)return t.minutes*1e3*60;if("hours"in t)return t.hours*1e3*60*60;if("days"in t)return t.days*1e3*60*60*24;if("weeks"in t)return t.weeks*1e3*60*60*24*7;if("months"in t)return t.months*1e3*60*60*24*30;if("years"in t)return t.years*1e3*60*60*24*365;throw new Error("Invalid options")}const fh=2147483647;Bf.signal;const Rs=process.env.TINYBIRD_TOKEN??void 0,hh=Ni({id:"copy_job",run:async t=>{if(!(Rs??t.token))throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.pipeId)throw new Error("Pipe ID not found");try{let r=`https://api.tinybird.co/v0/pipes/${t.pipeId}/copy`;if(t.params){const u=new URLSearchParams;for(const[l,d]of Object.entries(t.params))u.append(l,d.toString());r+=`?${u.toString()}`}const s=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${Rs}`}}).then(u=>u.json());if(!s||!("job"in s))throw Oe.error(s),new Error("Invalid response from Tinybird API");const a=s.job.job_id;Oe.log("Copy job started",{jobId:a});let i="";const o=30;let c=0;for(;c<o;){if(i=(await fetch(`https://api.tinybird.co/v0/jobs/${a}`,{headers:{Authorization:`Bearer ${Rs}`}}).then(l=>l.json())).status,Oe.log("Job status check",{jobId:a,status:i,attempt:c+1}),i==="done")return Oe.log("Copy job completed successfully",{jobId:a}),{success:!0,jobId:a};if(i==="error"||i==="failed")throw new Error(`Copy job failed with status: ${i}`);await uh.for({seconds:5}),c++}throw new Error(`Job timed out after ${o} attempts`)}catch(r){throw Oe.error("Error in Tinybird copy job",{error:r}),r}}}),Pi=process.env.TINYBIRD_TOKEN??void 0;var Ss=(t=>(t.CSV="CSV",t.CSVWithNames="CSVWithNames",t.JSON="JSON",t.TSV="TSV",t.TSVWithNames="TSVWithNames",t.PrettyCompact="PrettyCompact",t.JSONEachRow="JSONEachRow",t.Parquet="Parquet",t))(Ss||{});function Ci(t){return Object.values(Ss).includes(t)}function ph(t){const e=t.trim().match(/FORMAT\s+(\w+)$/i);if(!e)return null;const r=e[1].toUpperCase();return Ci(r)?r:null}const gh=Ni({id:"tinybird-query",run:async t=>{var i;if(!(Pi??t.token))throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.sql)throw new Error("SQL query is required");let r=t.sql;const s=ph(r);if(t.format&&!Ci(t.format.toUpperCase()))throw new Error(`Invalid format: ${t.format}. Valid formats are: ${Object.values(Ss).join(", ")}`);const a=((i=t.format)==null?void 0:i.toUpperCase())??s??"JSON";s||(r+=` FORMAT ${a}`);try{const o=await fetch("https://api.tinybird.co/v0/sql",{method:"POST",headers:{Authorization:`Bearer ${Pi}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({q:r,...t.params})}),c=await o.json();if(console.log(c),o.status!==200){let l={error:"error"};throw"error"in c&&(l=c,Oe.error("Tinybird query failed",{error:l.error,detail:l.detail})),new Error(`Tinybird query failed: ${l.error}`)}const u=c;return Oe.info("Query executed successfully",u),u}catch(o){throw Oe.error("Failed to execute Tinybird query",{error:o instanceof Error?o.message:"Unknown error",sql:t.sql}),o}}}),ws=crypto,ji=t=>t instanceof CryptoKey,ht=new TextEncoder,As=new TextDecoder;function mh(...t){const e=t.reduce((a,{length:i})=>a+i,0),r=new Uint8Array(e);let s=0;for(const a of t)r.set(a,s),s+=a.length;return r}const yh=t=>{let e=t;typeof e=="string"&&(e=ht.encode(e));const r=32768,s=[];for(let a=0;a<e.length;a+=r)s.push(String.fromCharCode.apply(null,e.subarray(a,a+r)));return btoa(s.join(""))},Is=t=>yh(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),_h=t=>{const e=atob(t),r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r},ks=t=>{let e=t;e instanceof Uint8Array&&(e=As.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return _h(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class z extends Error{constructor(e,r){var s;super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}}z.code="ERR_JOSE_GENERIC";class vh extends z{constructor(e,r,s="unspecified",a="unspecified"){super(e,{cause:{claim:s,reason:a,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=s,this.reason=a,this.payload=r}}vh.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class bh extends z{constructor(e,r,s="unspecified",a="unspecified"){super(e,{cause:{claim:s,reason:a,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=s,this.reason=a,this.payload=r}}bh.code="ERR_JWT_EXPIRED";class Eh extends z{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}Eh.code="ERR_JOSE_ALG_NOT_ALLOWED";class qe extends z{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}qe.code="ERR_JOSE_NOT_SUPPORTED";class Th extends z{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}Th.code="ERR_JWE_DECRYPTION_FAILED";class Rh extends z{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}Rh.code="ERR_JWE_INVALID";class pt extends z{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}pt.code="ERR_JWS_INVALID";class Mi extends z{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}Mi.code="ERR_JWT_INVALID";class Sh extends z{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Sh.code="ERR_JWK_INVALID";class wh extends z{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}wh.code="ERR_JWKS_INVALID";class Ah extends z{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}Ah.code="ERR_JWKS_NO_MATCHING_KEY";class Ih extends z{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Ih.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class kh extends z{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}}kh.code="ERR_JWKS_TIMEOUT";class Oh extends z{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}Oh.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function me(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function en(t,e){return t.name===e}function Os(t){return parseInt(t.name.slice(4),10)}function xh(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Nh(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const s=e.pop();r+=`one of ${e.join(", ")}, or ${s}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Ph(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!en(t.algorithm,"HMAC"))throw me("HMAC");const s=parseInt(e.slice(2),10);if(Os(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!en(t.algorithm,"RSASSA-PKCS1-v1_5"))throw me("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(Os(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!en(t.algorithm,"RSA-PSS"))throw me("RSA-PSS");const s=parseInt(e.slice(2),10);if(Os(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw me("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!en(t.algorithm,"ECDSA"))throw me("ECDSA");const s=xh(e);if(t.algorithm.namedCurve!==s)throw me(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Nh(t,r)}function Ui(t,e,...r){var s;if(r=r.filter(Boolean),r.length>2){const a=r.pop();t+=`one of type ${r.join(", ")}, or ${a}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const Di=(t,...e)=>Ui("Key must be ",t,...e);function $i(t,e,...r){return Ui(`Key for the ${t} algorithm must be `,e,...r)}const Li=t=>ji(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",tn=["CryptoKey"],Ch=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(const s of e){const a=Object.keys(s);if(!r||r.size===0){r=new Set(a);continue}for(const i of a){if(r.has(i))return!1;r.add(i)}}return!0};function jh(t){return typeof t=="object"&&t!==null}function Ki(t){if(!jh(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const Mh=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function cr(t){return Ki(t)&&typeof t.kty=="string"}function Uh(t){return t.kty!=="oct"&&typeof t.d=="string"}function Dh(t){return t.kty!=="oct"&&typeof t.d>"u"}function $h(t){return cr(t)&&t.kty==="oct"&&typeof t.k=="string"}function Lh(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new qe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new qe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new qe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new qe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const Kh=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=Lh(t),s=[e,t.ext??!1,t.key_ops??r],a={...t};return delete a.alg,delete a.use,ws.subtle.importKey("jwk",a,...s)},Wi=t=>ks(t);let gt,mt;const Vi=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",rn=async(t,e,r,s,a=!1)=>{let i=t.get(e);if(i!=null&&i[s])return i[s];const o=await Kh({...r,alg:s});return a&&Object.freeze(e),i?i[s]=o:t.set(e,{[s]:o}),o},Wh={normalizePublicKey:(t,e)=>{if(Vi(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?Wi(r.k):(mt||(mt=new WeakMap),rn(mt,t,r,e))}return cr(t)?t.k?ks(t.k):(mt||(mt=new WeakMap),rn(mt,t,t,e,!0)):t},normalizePrivateKey:(t,e)=>{if(Vi(t)){let r=t.export({format:"jwk"});return r.k?Wi(r.k):(gt||(gt=new WeakMap),rn(gt,t,r,e))}return cr(t)?t.k?ks(t.k):(gt||(gt=new WeakMap),rn(gt,t,t,e,!0)):t}},yt=t=>t==null?void 0:t[Symbol.toStringTag],xs=(t,e,r)=>{var s,a;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((a=(s=e.key_ops).includes)==null?void 0:a.call(s,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},Vh=(t,e,r,s)=>{if(!(e instanceof Uint8Array)){if(s&&cr(e)){if($h(e)&&xs(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Li(e))throw new TypeError($i(t,e,...tn,"Uint8Array",s?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${yt(e)} instances for symmetric algorithms must be of type "secret"`)}},Gh=(t,e,r,s)=>{if(s&&cr(e))switch(r){case"sign":if(Uh(e)&&xs(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Dh(e)&&xs(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Li(e))throw new TypeError($i(t,e,...tn,s?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${yt(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${yt(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${yt(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${yt(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${yt(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function Gi(t,e,r,s){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Vh(e,r,s,t):Gh(e,r,s,t)}Gi.bind(void 0,!1);const Bh=Gi.bind(void 0,!0);function Fh(t,e,r,s,a){if(a.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...e.entries()]):i=e;for(const o of s.crit){if(!i.has(o))throw new qe(`Extension Header Parameter "${o}" is not recognized`);if(a[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&s[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(s.crit)}function Hh(t,e){const r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new qe(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function Zh(t,e,r){if(e=await Wh.normalizePrivateKey(e,t),ji(e))return Ph(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(Di(e,...tn));return ws.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(Di(e,...tn,"Uint8Array","JSON Web Key"))}const Xe=t=>Math.floor(t.getTime()/1e3),Bi=60,Fi=Bi*60,Ns=Fi*24,zh=Ns*7,Jh=Ns*365.25,Yh=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Ps=t=>{const e=Yh.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const r=parseFloat(e[2]),s=e[3].toLowerCase();let a;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":a=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":a=Math.round(r*Bi);break;case"hour":case"hours":case"hr":case"hrs":case"h":a=Math.round(r*Fi);break;case"day":case"days":case"d":a=Math.round(r*Ns);break;case"week":case"weeks":case"w":a=Math.round(r*zh);break;default:a=Math.round(r*Jh);break}return e[1]==="-"||e[4]==="ago"?-a:a},qh=async(t,e,r)=>{const s=await Zh(t,e,"sign");Mh(t,s);const a=await ws.subtle.sign(Hh(t,s.algorithm),s,r);return new Uint8Array(a)};class Hi{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new pt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Ch(this._protectedHeader,this._unprotectedHeader))throw new pt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},a=Fh(pt,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,s);let i=!0;if(a.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new pt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=s;if(typeof o!="string"||!o)throw new pt('JWS "alg" (Algorithm) Header Parameter missing or invalid');Bh(o,e,"sign");let c=this._payload;i&&(c=ht.encode(Is(c)));let u;this._protectedHeader?u=ht.encode(Is(JSON.stringify(this._protectedHeader))):u=ht.encode("");const l=mh(u,ht.encode("."),c),d=await qh(o,e,l),b={signature:Is(d),payload:""};return i&&(b.payload=As.decode(c)),this._unprotectedHeader&&(b.header=this._unprotectedHeader),this._protectedHeader&&(b.protected=As.decode(u)),b}}class Zi{constructor(e){this._flattened=new Hi(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){const s=await this._flattened.sign(e,r);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function Qe(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}class Xh{constructor(e={}){if(!Ki(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Qe("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Qe("setNotBefore",Xe(e))}:this._payload={...this._payload,nbf:Xe(new Date)+Ps(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Qe("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Qe("setExpirationTime",Xe(e))}:this._payload={...this._payload,exp:Xe(new Date)+Ps(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:Xe(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Qe("setIssuedAt",Xe(e))}:typeof e=="string"?this._payload={...this._payload,iat:Qe("setIssuedAt",Xe(new Date)+Ps(e))}:this._payload={...this._payload,iat:Qe("setIssuedAt",e)},this}}class Qh extends Xh{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var a;const s=new Zi(ht.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((a=this._protectedHeader)==null?void 0:a.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Mi("JWTs MUST NOT use unencoded payload");return s.sign(e,r)}}const ep=Object.freeze(Object.defineProperty({__proto__:null,CompactSign:Zi,FlattenedSign:Hi,SignJWT:Qh},Symbol.toStringTag,{value:"Module"}));class tp{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,r){this.keyToValue.set(e,r),this.valueToKey.set(r,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class zi{constructor(e){this.generateIdentifier=e,this.kv=new tp}register(e,r){this.kv.getByValue(e)||(r||(r=this.generateIdentifier(e)),this.kv.set(r,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}}class rp extends zi{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(e,r.allowProps),super.register(e,r.identifier)):super.register(e,r)}getAllowedProps(e){return this.classToAllowedProps.get(e)}}function np(t){if("values"in Object)return Object.values(t);const e=[];for(const r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e}function sp(t,e){const r=np(t);if("find"in r)return r.find(e);const s=r;for(let a=0;a<s.length;a++){const i=s[a];if(e(i))return i}}function _t(t,e){Object.entries(t).forEach(([r,s])=>e(s,r))}function nn(t,e){return t.indexOf(e)!==-1}function Ji(t,e){for(let r=0;r<t.length;r++){const s=t[r];if(e(s))return s}}class ap{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return sp(this.transfomers,r=>r.isApplicable(e))}findByName(e){return this.transfomers[e]}}const ip=t=>Object.prototype.toString.call(t).slice(8,-1),Yi=t=>typeof t>"u",op=t=>t===null,ur=t=>typeof t!="object"||t===null||t===Object.prototype?!1:Object.getPrototypeOf(t)===null?!0:Object.getPrototypeOf(t)===Object.prototype,Cs=t=>ur(t)&&Object.keys(t).length===0,Ne=t=>Array.isArray(t),cp=t=>typeof t=="string",up=t=>typeof t=="number"&&!isNaN(t),lp=t=>typeof t=="boolean",dp=t=>t instanceof RegExp,lr=t=>t instanceof Map,dr=t=>t instanceof Set,qi=t=>ip(t)==="Symbol",fp=t=>t instanceof Date&&!isNaN(t.valueOf()),hp=t=>t instanceof Error,Xi=t=>typeof t=="number"&&isNaN(t),pp=t=>lp(t)||op(t)||Yi(t)||up(t)||cp(t)||qi(t),gp=t=>typeof t=="bigint",mp=t=>t===1/0||t===-1/0,yp=t=>ArrayBuffer.isView(t)&&!(t instanceof DataView),_p=t=>t instanceof URL,Qi=t=>t.replace(/\./g,"\\."),js=t=>t.map(String).map(Qi).join("."),fr=t=>{const e=[];let r="";for(let a=0;a<t.length;a++){let i=t.charAt(a);if(i==="\\"&&t.charAt(a+1)==="."){r+=".",a++;continue}if(i==="."){e.push(r),r="";continue}r+=i}const s=r;return e.push(s),e};function le(t,e,r,s){return{isApplicable:t,annotation:e,transform:r,untransform:s}}const eo=[le(Yi,"undefined",()=>null,()=>{}),le(gp,"bigint",t=>t.toString(),t=>typeof BigInt<"u"?BigInt(t):(console.error("Please add a BigInt polyfill."),t)),le(fp,"Date",t=>t.toISOString(),t=>new Date(t)),le(hp,"Error",(t,e)=>{const r={name:t.name,message:t.message};return e.allowedErrorProps.forEach(s=>{r[s]=t[s]}),r},(t,e)=>{const r=new Error(t.message);return r.name=t.name,r.stack=t.stack,e.allowedErrorProps.forEach(s=>{r[s]=t[s]}),r}),le(dp,"regexp",t=>""+t,t=>{const e=t.slice(1,t.lastIndexOf("/")),r=t.slice(t.lastIndexOf("/")+1);return new RegExp(e,r)}),le(dr,"set",t=>[...t.values()],t=>new Set(t)),le(lr,"map",t=>[...t.entries()],t=>new Map(t)),le(t=>Xi(t)||mp(t),"number",t=>Xi(t)?"NaN":t>0?"Infinity":"-Infinity",Number),le(t=>t===0&&1/t===-1/0,"number",()=>"-0",Number),le(_p,"URL",t=>t.toString(),t=>new URL(t))];function sn(t,e,r,s){return{isApplicable:t,annotation:e,transform:r,untransform:s}}const to=sn((t,e)=>qi(t)?!!e.symbolRegistry.getIdentifier(t):!1,(t,e)=>["symbol",e.symbolRegistry.getIdentifier(t)],t=>t.description,(t,e,r)=>{const s=r.symbolRegistry.getValue(e[1]);if(!s)throw new Error("Trying to deserialize unknown symbol");return s}),vp=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((t,e)=>(t[e.name]=e,t),{}),ro=sn(yp,t=>["typed-array",t.constructor.name],t=>[...t],(t,e)=>{const r=vp[e[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(t)});function no(t,e){return t!=null&&t.constructor?!!e.classRegistry.getIdentifier(t.constructor):!1}const so=sn(no,(t,e)=>["class",e.classRegistry.getIdentifier(t.constructor)],(t,e)=>{const r=e.classRegistry.getAllowedProps(t.constructor);if(!r)return{...t};const s={};return r.forEach(a=>{s[a]=t[a]}),s},(t,e,r)=>{const s=r.classRegistry.getValue(e[1]);if(!s)throw new Error(`Trying to deserialize unknown class '${e[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(s.prototype),t)}),ao=sn((t,e)=>!!e.customTransformerRegistry.findApplicable(t),(t,e)=>["custom",e.customTransformerRegistry.findApplicable(t).name],(t,e)=>e.customTransformerRegistry.findApplicable(t).serialize(t),(t,e,r)=>{const s=r.customTransformerRegistry.findByName(e[1]);if(!s)throw new Error("Trying to deserialize unknown custom value");return s.deserialize(t)}),bp=[so,to,ao,ro],io=(t,e)=>{const r=Ji(bp,a=>a.isApplicable(t,e));if(r)return{value:r.transform(t,e),type:r.annotation(t,e)};const s=Ji(eo,a=>a.isApplicable(t,e));if(s)return{value:s.transform(t,e),type:s.annotation}},oo={};eo.forEach(t=>{oo[t.annotation]=t});const Ep=(t,e,r)=>{if(Ne(e))switch(e[0]){case"symbol":return to.untransform(t,e,r);case"class":return so.untransform(t,e,r);case"custom":return ao.untransform(t,e,r);case"typed-array":return ro.untransform(t,e,r);default:throw new Error("Unknown transformation: "+e)}else{const s=oo[e];if(!s)throw new Error("Unknown transformation: "+e);return s.untransform(t,r)}},vt=(t,e)=>{if(e>t.size)throw new Error("index out of bounds");const r=t.keys();for(;e>0;)r.next(),e--;return r.next().value};function co(t){if(nn(t,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(nn(t,"prototype"))throw new Error("prototype is not allowed as a property");if(nn(t,"constructor"))throw new Error("constructor is not allowed as a property")}const Tp=(t,e)=>{co(e);for(let r=0;r<e.length;r++){const s=e[r];if(dr(t))t=vt(t,+s);else if(lr(t)){const a=+s,i=+e[++r]==0?"key":"value",o=vt(t,a);switch(i){case"key":t=o;break;case"value":t=t.get(o);break}}else t=t[s]}return t},Ms=(t,e,r)=>{if(co(e),e.length===0)return r(t);let s=t;for(let i=0;i<e.length-1;i++){const o=e[i];if(Ne(s)){const c=+o;s=s[c]}else if(ur(s))s=s[o];else if(dr(s)){const c=+o;s=vt(s,c)}else if(lr(s)){if(i===e.length-2)break;const u=+o,l=+e[++i]==0?"key":"value",d=vt(s,u);switch(l){case"key":s=d;break;case"value":s=s.get(d);break}}}const a=e[e.length-1];if(Ne(s)?s[+a]=r(s[+a]):ur(s)&&(s[a]=r(s[a])),dr(s)){const i=vt(s,+a),o=r(i);i!==o&&(s.delete(i),s.add(o))}if(lr(s)){const i=+e[e.length-2],o=vt(s,i);switch(+a==0?"key":"value"){case"key":{const u=r(o);s.set(u,s.get(o)),u!==o&&s.delete(o);break}case"value":{s.set(o,r(s.get(o)));break}}}return t};function Us(t,e,r=[]){if(!t)return;if(!Ne(t)){_t(t,(i,o)=>Us(i,e,[...r,...fr(o)]));return}const[s,a]=t;a&&_t(a,(i,o)=>{Us(i,e,[...r,...fr(o)])}),e(s,r)}function Rp(t,e,r){return Us(e,(s,a)=>{t=Ms(t,a,i=>Ep(i,s,r))}),t}function Sp(t,e){function r(s,a){const i=Tp(t,fr(a));s.map(fr).forEach(o=>{t=Ms(t,o,()=>i)})}if(Ne(e)){const[s,a]=e;s.forEach(i=>{t=Ms(t,fr(i),()=>t)}),a&&_t(a,r)}else _t(e,r);return t}const wp=(t,e)=>ur(t)||Ne(t)||lr(t)||dr(t)||no(t,e);function Ap(t,e,r){const s=r.get(t);s?s.push(e):r.set(t,[e])}function Ip(t,e){const r={};let s;return t.forEach(a=>{if(a.length<=1)return;e||(a=a.map(c=>c.map(String)).sort((c,u)=>c.length-u.length));const[i,...o]=a;i.length===0?s=o.map(js):r[js(i)]=o.map(js)}),s?Cs(r)?[s]:[s,r]:Cs(r)?void 0:r}const uo=(t,e,r,s,a=[],i=[],o=new Map)=>{const c=pp(t);if(!c){Ap(t,a,e);const f=o.get(t);if(f)return s?{transformedValue:null}:f}if(!wp(t,r)){const f=io(t,r),p=f?{transformedValue:f.value,annotations:[f.type]}:{transformedValue:t};return c||o.set(t,p),p}if(nn(i,t))return{transformedValue:null};const u=io(t,r),l=(u==null?void 0:u.value)??t,d=Ne(l)?[]:{},b={};_t(l,(f,p)=>{if(p==="__proto__"||p==="constructor"||p==="prototype")throw new Error(`Detected property ${p}. This is a prototype pollution risk, please remove it from your object.`);const E=uo(f,e,r,s,[...a,p],[...i,t],o);d[p]=E.transformedValue,Ne(E.annotations)?b[p]=E.annotations:ur(E.annotations)&&_t(E.annotations,(x,K)=>{b[Qi(p)+"."+K]=x})});const g=Cs(b)?{transformedValue:d,annotations:u?[u.type]:void 0}:{transformedValue:d,annotations:u?[u.type,b]:b};return c||o.set(t,g),g};function lo(t){return Object.prototype.toString.call(t).slice(8,-1)}function fo(t){return lo(t)==="Array"}function kp(t){if(lo(t)!=="Object")return!1;const e=Object.getPrototypeOf(t);return!!e&&e.constructor===Object&&e===Object.prototype}function Op(t,e,r,s,a){const i={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";i==="enumerable"&&(t[e]=r),a&&i==="nonenumerable"&&Object.defineProperty(t,e,{value:r,enumerable:!1,writable:!0,configurable:!0})}function Ds(t,e={}){if(fo(t))return t.map(a=>Ds(a,e));if(!kp(t))return t;const r=Object.getOwnPropertyNames(t),s=Object.getOwnPropertySymbols(t);return[...r,...s].reduce((a,i)=>{if(fo(e.props)&&!e.props.includes(i))return a;const o=t[i],c=Ds(o,e);return Op(a,i,c,t,e.nonenumerable),a},{})}class P{constructor({dedupe:e=!1}={}){this.classRegistry=new rp,this.symbolRegistry=new zi(r=>r.description??""),this.customTransformerRegistry=new ap,this.allowedErrorProps=[],this.dedupe=e}serialize(e){const r=new Map,s=uo(e,r,this,this.dedupe),a={json:s.transformedValue};s.annotations&&(a.meta={...a.meta,values:s.annotations});const i=Ip(r,this.dedupe);return i&&(a.meta={...a.meta,referentialEqualities:i}),a}deserialize(e){const{json:r,meta:s}=e;let a=Ds(r);return s!=null&&s.values&&(a=Rp(a,s.values,this)),s!=null&&s.referentialEqualities&&(a=Sp(a,s.referentialEqualities)),a}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,r){this.classRegistry.register(e,r)}registerSymbol(e,r){this.symbolRegistry.register(e,r)}registerCustom(e,r){this.customTransformerRegistry.register({name:r,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}}P.defaultInstance=new P,P.serialize=P.defaultInstance.serialize.bind(P.defaultInstance),P.deserialize=P.defaultInstance.deserialize.bind(P.defaultInstance),P.stringify=P.defaultInstance.stringify.bind(P.defaultInstance),P.parse=P.defaultInstance.parse.bind(P.defaultInstance),P.registerClass=P.defaultInstance.registerClass.bind(P.defaultInstance),P.registerSymbol=P.defaultInstance.registerSymbol.bind(P.defaultInstance),P.registerCustom=P.defaultInstance.registerCustom.bind(P.defaultInstance),P.allowErrorProps=P.defaultInstance.allowErrorProps.bind(P.defaultInstance);const xp=P.serialize,Np=P.deserialize,Pp=P.stringify,Cp=P.parse,jp=P.registerClass,Mp=P.registerCustom,Up=P.registerSymbol,Dp=P.allowErrorProps,$p=Object.freeze(Object.defineProperty({__proto__:null,SuperJSON:P,allowErrorProps:Dp,default:P,deserialize:Np,parse:Cp,registerClass:jp,registerCustom:Mp,registerSymbol:Up,serialize:xp,stringify:Pp},Symbol.toStringTag,{value:"Module"}));j.tinybirdCopyTask=hh,j.tinybirdQueryTask=gh,Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
