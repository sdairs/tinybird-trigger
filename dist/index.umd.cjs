(function(j,T){typeof exports=="object"&&typeof module<"u"?T(exports):typeof define=="function"&&define.amd?define(["exports"],T):(j=typeof globalThis<"u"?globalThis:j||self,T(j.TinybirdTriggerTasks={}))})(this,function(j){"use strict";var xg=Object.defineProperty;var Bo=j=>{throw TypeError(j)};var Og=(j,T,W)=>T in j?xg(j,T,{enumerable:!0,configurable:!0,writable:!0,value:W}):j[T]=W;var E=(j,T,W)=>Og(j,typeof T!="symbol"?T+"":T,W),rs=(j,T,W)=>T.has(j)||Bo("Cannot "+W);var H=(j,T,W)=>(rs(j,T,"read from private field"),W?W.call(j):T.get(j)),V=(j,T,W)=>T.has(j)?Bo("Cannot add the same private member more than once"):T instanceof WeakSet?T.add(j):T.set(j,W),xt=(j,T,W,_)=>(rs(j,T,"write to private field"),_?_.call(j,W):T.set(j,W),W),m=(j,T,W)=>(rs(j,T,"access private method"),W);var At,Nn,En,Fo,Tn,Vo,It,Cn,te,Ue,Er,kt,Tr,wn,Ho,$o,Lo,Ko,P,C,jn,Rr,ns,Te,st,De,Ot,$e,Pt,F,Z,wr,as,pe,Le;var T;(function(t){t.assertEqual=s=>s;function e(s){}t.assertIs=e;function r(s){throw new Error}t.assertNever=r,t.arrayToEnum=s=>{const i={};for(const o of s)i[o]=o;return i},t.getValidEnumValues=s=>{const i=t.objectKeys(s).filter(c=>typeof s[s[c]]!="number"),o={};for(const c of i)o[c]=s[c];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(i){return s[i]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},t.find=(s,i)=>{for(const o of s)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function a(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=a,t.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(T||(T={}));var W;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(W||(W={}));const _=T.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),we=t=>{switch(typeof t){case"undefined":return _.undefined;case"string":return _.string;case"number":return isNaN(t)?_.nan:_.number;case"boolean":return _.boolean;case"function":return _.function;case"bigint":return _.bigint;case"symbol":return _.symbol;case"object":return Array.isArray(t)?_.array:t===null?_.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?_.promise:typeof Map<"u"&&t instanceof Map?_.map:typeof Set<"u"&&t instanceof Set?_.set:typeof Date<"u"&&t instanceof Date?_.date:_.object;default:return _.unknown}},p=T.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Zo=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class X extends Error{constructor(e){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(i){return i.message},a={_errors:[]},s=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)a._errors.push(r(o));else{let c=a,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(r(o))):c[l]=c[l]||{_errors:[]},c=c[l],u++}}};return s(this),a}static assert(e){if(!(e instanceof X))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,T.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},a=[];for(const s of this.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(e(s))):a.push(e(s));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}X.create=t=>new X(t);const it=(t,e)=>{let r;switch(t.code){case p.invalid_type:t.received===_.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case p.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,T.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:r=`Unrecognized key(s) in object: ${T.joinValues(t.keys,", ")}`;break;case p.invalid_union:r="Invalid input";break;case p.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${T.joinValues(t.options)}`;break;case p.invalid_enum_value:r=`Invalid enum value. Expected ${T.joinValues(t.options)}, received '${t.received}'`;break;case p.invalid_arguments:r="Invalid function arguments";break;case p.invalid_return_type:r="Invalid function return type";break;case p.invalid_date:r="Invalid date";break;case p.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:T.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case p.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case p.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case p.custom:r="Invalid input";break;case p.invalid_intersection_types:r="Intersection results could not be merged";break;case p.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case p.not_finite:r="Number must be finite";break;default:r=e.defaultError,T.assertNever(t)}return{message:r}};let ss=it;function Jo(t){ss=t}function Pr(){return ss}const Nr=t=>{const{data:e,path:r,errorMaps:a,issueData:s}=t,i=[...r,...s.path||[]],o={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let c="";const u=a.filter(l=>!!l).slice().reverse();for(const l of u)c=l(o,{data:e,defaultError:c}).message;return{...s,path:i,message:c}},zo=[];function v(t,e){const r=Pr(),a=Nr({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===it?void 0:it].filter(s=>!!s)});t.common.issues.push(a)}class J{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const a=[];for(const s of r){if(s.status==="aborted")return S;s.status==="dirty"&&e.dirty(),a.push(s.value)}return{status:e.value,value:a}}static async mergeObjectAsync(e,r){const a=[];for(const s of r){const i=await s.key,o=await s.value;a.push({key:i,value:o})}return J.mergeObjectSync(e,a)}static mergeObjectSync(e,r){const a={};for(const s of r){const{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return S;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(a[i.value]=o.value)}return{status:e.value,value:a}}}const S=Object.freeze({status:"aborted"}),ot=t=>({status:"dirty",value:t}),z=t=>({status:"valid",value:t}),Mn=t=>t.status==="aborted",Un=t=>t.status==="dirty",Nt=t=>t.status==="valid",Ct=t=>typeof Promise<"u"&&t instanceof Promise;function Cr(t,e,r,a){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function is(t,e,r,a,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}typeof SuppressedError=="function"&&SuppressedError;var R;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(R||(R={}));var jt,Mt;class oe{constructor(e,r,a,s){this._cachedPath=[],this.parent=e,this.data=r,this._path=a,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const os=(t,e)=>{if(Nt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new X(t.common.issues);return this._error=r,this._error}}};function I(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:a,description:s}=t;if(e&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,c)=>{var u,l;const{message:d}=t;return o.code==="invalid_enum_value"?{message:d??c.defaultError}:typeof c.data>"u"?{message:(u=d??a)!==null&&u!==void 0?u:c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:(l=d??r)!==null&&l!==void 0?l:c.defaultError}},description:s}}class k{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return we(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new J,ctx:{common:e.parent.common,data:e.data,parsedType:we(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(Ct(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const a=this.safeParse(e,r);if(a.success)return a.data;throw a.error}safeParse(e,r){var a;const s={common:{issues:[],async:(a=r==null?void 0:r.async)!==null&&a!==void 0?a:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},i=this._parseSync({data:e,path:s.path,parent:s});return os(s,i)}async parseAsync(e,r){const a=await this.safeParseAsync(e,r);if(a.success)return a.data;throw a.error}async safeParseAsync(e,r){const a={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:we(e)},s=this._parse({data:e,path:a.path,parent:a}),i=await(Ct(s)?s:Promise.resolve(s));return os(a,i)}refine(e,r){const a=s=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(s):r;return this._refinement((s,i)=>{const o=e(s),c=()=>i.addIssue({code:p.custom,...a(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(c(),!1)):o?!0:(c(),!1)})}refinement(e,r){return this._refinement((a,s)=>e(a)?!0:(s.addIssue(typeof r=="function"?r(a,s):r),!1))}_refinement(e){return new ae({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ue.create(this,this._def)}nullable(){return ke.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ne.create(this,this._def)}promise(){return dt.create(this,this._def)}or(e){return Lt.create([this,e],this._def)}and(e){return Kt.create(this,e,this._def)}transform(e){return new ae({...I(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Gt({...I(this._def),innerType:this,defaultValue:r,typeName:w.ZodDefault})}brand(){return new Ln({typeName:w.ZodBranded,type:this,...I(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Ht({...I(this._def),innerType:this,catchValue:r,typeName:w.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Zt.create(this,e)}readonly(){return Jt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Yo=/^c[^\s-]{8,}$/i,qo=/^[0-9a-z]+$/,Xo=/^[0-9A-HJKMNP-TV-Z]{26}$/,Qo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ec=/^[a-z0-9_-]{21}$/i,tc=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rc=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,nc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Dn;const ac=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,sc=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ic=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",oc=new RegExp(`^${cs}$`);function us(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function cc(t){return new RegExp(`^${us(t)}$`)}function ls(t){let e=`${cs}T${us(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function uc(t,e){return!!((e==="v4"||!e)&&ac.test(t)||(e==="v6"||!e)&&sc.test(t))}class re extends k{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==_.string){const i=this._getOrReturnCtx(e);return v(i,{code:p.invalid_type,expected:_.string,received:i.parsedType}),S}const a=new J;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,c=e.data.length<i.value;(o||c)&&(s=this._getOrReturnCtx(e,s),o?v(s,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&v(s,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),a.dirty())}else if(i.kind==="email")rc.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"email",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="emoji")Dn||(Dn=new RegExp(nc,"u")),Dn.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"emoji",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="uuid")Qo.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"uuid",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="nanoid")ec.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"nanoid",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid")Yo.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid2")qo.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"cuid2",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="ulid")Xo.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ulid",code:p.invalid_string,message:i.message}),a.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),v(s,{validation:"url",code:p.invalid_string,message:i.message}),a.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"regex",code:p.invalid_string,message:i.message}),a.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),a.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:{startsWith:i.value},message:i.message}),a.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:{endsWith:i.value},message:i.message}),a.dirty()):i.kind==="datetime"?ls(i).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:"datetime",message:i.message}),a.dirty()):i.kind==="date"?oc.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:"date",message:i.message}),a.dirty()):i.kind==="time"?cc(i).test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{code:p.invalid_string,validation:"time",message:i.message}),a.dirty()):i.kind==="duration"?tc.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"duration",code:p.invalid_string,message:i.message}),a.dirty()):i.kind==="ip"?uc(e.data,i.version)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"ip",code:p.invalid_string,message:i.message}),a.dirty()):i.kind==="base64"?ic.test(e.data)||(s=this._getOrReturnCtx(e,s),v(s,{validation:"base64",code:p.invalid_string,message:i.message}),a.dirty()):T.assertNever(i);return{status:a.value,value:e.data}}_regex(e,r,a){return this.refinement(s=>e.test(s),{validation:r,code:p.invalid_string,...R.errToObj(a)})}_addCheck(e){return new re({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...R.errToObj(e)})}url(e){return this._addCheck({kind:"url",...R.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...R.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...R.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...R.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...R.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...R.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...R.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...R.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...R.errToObj(e)})}datetime(e){var r,a;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(a=e==null?void 0:e.local)!==null&&a!==void 0?a:!1,...R.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...R.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...R.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...R.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...R.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...R.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...R.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...R.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...R.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...R.errToObj(r)})}nonempty(e){return this.min(1,R.errToObj(e))}trim(){return new re({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new re({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new re({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}re.create=t=>{var e;return new re({checks:[],typeName:w.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...I(t)})};function lc(t,e){const r=(t.toString().split(".")[1]||"").length,a=(e.toString().split(".")[1]||"").length,s=r>a?r:a,i=parseInt(t.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}class Se extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==_.number){const i=this._getOrReturnCtx(e);return v(i,{code:p.invalid_type,expected:_.number,received:i.parsedType}),S}let a;const s=new J;for(const i of this._def.checks)i.kind==="int"?T.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),v(a,{code:p.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?lc(e.data,i.value)!==0&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),v(a,{code:p.not_finite,message:i.message}),s.dirty()):T.assertNever(i);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,a,s){return new Se({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:R.toString(s)}]})}_addCheck(e){return new Se({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:R.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:R.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:R.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:R.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&T.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(e===null||a.value<e)&&(e=a.value)}return Number.isFinite(r)&&Number.isFinite(e)}}Se.create=t=>new Se({checks:[],typeName:w.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...I(t)});class Ae extends k{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==_.bigint){const i=this._getOrReturnCtx(e);return v(i,{code:p.invalid_type,expected:_.bigint,received:i.parsedType}),S}let a;const s=new J;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),v(a,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):T.assertNever(i);return{status:s.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,R.toString(r))}gt(e,r){return this.setLimit("min",e,!1,R.toString(r))}lte(e,r){return this.setLimit("max",e,!0,R.toString(r))}lt(e,r){return this.setLimit("max",e,!1,R.toString(r))}setLimit(e,r,a,s){return new Ae({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:a,message:R.toString(s)}]})}_addCheck(e){return new Ae({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:R.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:R.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:R.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:R.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:R.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Ae.create=t=>{var e;return new Ae({checks:[],typeName:w.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...I(t)})};class Ut extends k{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==_.boolean){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.boolean,received:a.parsedType}),S}return z(e.data)}}Ut.create=t=>new Ut({typeName:w.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...I(t)});class Ke extends k{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==_.date){const i=this._getOrReturnCtx(e);return v(i,{code:p.invalid_type,expected:_.date,received:i.parsedType}),S}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return v(i,{code:p.invalid_date}),S}const a=new J;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:p.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),a.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),v(s,{code:p.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),a.dirty()):T.assertNever(i);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ke({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:R.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:R.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}Ke.create=t=>new Ke({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:w.ZodDate,...I(t)});class jr extends k{_parse(e){if(this._getType(e)!==_.symbol){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.symbol,received:a.parsedType}),S}return z(e.data)}}jr.create=t=>new jr({typeName:w.ZodSymbol,...I(t)});class Dt extends k{_parse(e){if(this._getType(e)!==_.undefined){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.undefined,received:a.parsedType}),S}return z(e.data)}}Dt.create=t=>new Dt({typeName:w.ZodUndefined,...I(t)});class $t extends k{_parse(e){if(this._getType(e)!==_.null){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.null,received:a.parsedType}),S}return z(e.data)}}$t.create=t=>new $t({typeName:w.ZodNull,...I(t)});class ct extends k{constructor(){super(...arguments),this._any=!0}_parse(e){return z(e.data)}}ct.create=t=>new ct({typeName:w.ZodAny,...I(t)});class We extends k{constructor(){super(...arguments),this._unknown=!0}_parse(e){return z(e.data)}}We.create=t=>new We({typeName:w.ZodUnknown,...I(t)});class ge extends k{_parse(e){const r=this._getOrReturnCtx(e);return v(r,{code:p.invalid_type,expected:_.never,received:r.parsedType}),S}}ge.create=t=>new ge({typeName:w.ZodNever,...I(t)});class Mr extends k{_parse(e){if(this._getType(e)!==_.undefined){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.void,received:a.parsedType}),S}return z(e.data)}}Mr.create=t=>new Mr({typeName:w.ZodVoid,...I(t)});class ne extends k{_parse(e){const{ctx:r,status:a}=this._processInputParams(e),s=this._def;if(r.parsedType!==_.array)return v(r,{code:p.invalid_type,expected:_.array,received:r.parsedType}),S;if(s.exactLength!==null){const o=r.data.length>s.exactLength.value,c=r.data.length<s.exactLength.value;(o||c)&&(v(r,{code:o?p.too_big:p.too_small,minimum:c?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),a.dirty())}if(s.minLength!==null&&r.data.length<s.minLength.value&&(v(r,{code:p.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),a.dirty()),s.maxLength!==null&&r.data.length>s.maxLength.value&&(v(r,{code:p.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((o,c)=>s.type._parseAsync(new oe(r,o,r.path,c)))).then(o=>J.mergeArray(a,o));const i=[...r.data].map((o,c)=>s.type._parseSync(new oe(r,o,r.path,c)));return J.mergeArray(a,i)}get element(){return this._def.type}min(e,r){return new ne({...this._def,minLength:{value:e,message:R.toString(r)}})}max(e,r){return new ne({...this._def,maxLength:{value:e,message:R.toString(r)}})}length(e,r){return new ne({...this._def,exactLength:{value:e,message:R.toString(r)}})}nonempty(e){return this.min(1,e)}}ne.create=(t,e)=>new ne({type:t,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...I(e)});function ut(t){if(t instanceof $){const e={};for(const r in t.shape){const a=t.shape[r];e[r]=ue.create(ut(a))}return new $({...t._def,shape:()=>e})}else return t instanceof ne?new ne({...t._def,type:ut(t.element)}):t instanceof ue?ue.create(ut(t.unwrap())):t instanceof ke?ke.create(ut(t.unwrap())):t instanceof ce?ce.create(t.items.map(e=>ut(e))):t}class $ extends k{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=T.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==_.object){const l=this._getOrReturnCtx(e);return v(l,{code:p.invalid_type,expected:_.object,received:l.parsedType}),S}const{status:a,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof ge&&this._def.unknownKeys==="strip"))for(const l in s.data)o.includes(l)||c.push(l);const u=[];for(const l of o){const d=i[l],y=s.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new oe(s,y,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof ge){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of c)u.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")c.length>0&&(v(s,{code:p.unrecognized_keys,keys:c}),a.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of c){const y=s.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new oe(s,y,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const y=await d.key,g=await d.value;l.push({key:y,value:g,alwaysSet:d.alwaysSet})}return l}).then(l=>J.mergeObjectSync(a,l)):J.mergeObjectSync(a,u)}get shape(){return this._def.shape()}strict(e){return R.errToObj,new $({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,a)=>{var s,i,o,c;const u=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,r,a).message)!==null&&o!==void 0?o:a.defaultError;return r.code==="unrecognized_keys"?{message:(c=R.errToObj(e).message)!==null&&c!==void 0?c:u}:{message:u}}}:{}})}strip(){return new $({...this._def,unknownKeys:"strip"})}passthrough(){return new $({...this._def,unknownKeys:"passthrough"})}extend(e){return new $({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new $({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new $({...this._def,catchall:e})}pick(e){const r={};return T.objectKeys(e).forEach(a=>{e[a]&&this.shape[a]&&(r[a]=this.shape[a])}),new $({...this._def,shape:()=>r})}omit(e){const r={};return T.objectKeys(this.shape).forEach(a=>{e[a]||(r[a]=this.shape[a])}),new $({...this._def,shape:()=>r})}deepPartial(){return ut(this)}partial(e){const r={};return T.objectKeys(this.shape).forEach(a=>{const s=this.shape[a];e&&!e[a]?r[a]=s:r[a]=s.optional()}),new $({...this._def,shape:()=>r})}required(e){const r={};return T.objectKeys(this.shape).forEach(a=>{if(e&&!e[a])r[a]=this.shape[a];else{let i=this.shape[a];for(;i instanceof ue;)i=i._def.innerType;r[a]=i}}),new $({...this._def,shape:()=>r})}keyof(){return ds(T.objectKeys(this.shape))}}$.create=(t,e)=>new $({shape:()=>t,unknownKeys:"strip",catchall:ge.create(),typeName:w.ZodObject,...I(e)}),$.strictCreate=(t,e)=>new $({shape:()=>t,unknownKeys:"strict",catchall:ge.create(),typeName:w.ZodObject,...I(e)}),$.lazycreate=(t,e)=>new $({shape:t,unknownKeys:"strip",catchall:ge.create(),typeName:w.ZodObject,...I(e)});class Lt extends k{_parse(e){const{ctx:r}=this._processInputParams(e),a=this._def.options;function s(i){for(const c of i)if(c.result.status==="valid")return c.result;for(const c of i)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;const o=i.map(c=>new X(c.ctx.common.issues));return v(r,{code:p.invalid_union,unionErrors:o}),S}if(r.common.async)return Promise.all(a.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(s);{let i;const o=[];for(const u of a){const l={...r,common:{...r.common,issues:[]},parent:null},d=u._parseSync({data:r.data,path:r.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const c=o.map(u=>new X(u));return v(r,{code:p.invalid_union,unionErrors:c}),S}}get options(){return this._def.options}}Lt.create=(t,e)=>new Lt({options:t,typeName:w.ZodUnion,...I(e)});const me=t=>t instanceof Bt?me(t.schema):t instanceof ae?me(t.innerType()):t instanceof Ft?[t.value]:t instanceof Ie?t.options:t instanceof Vt?T.objectValues(t.enum):t instanceof Gt?me(t._def.innerType):t instanceof Dt?[void 0]:t instanceof $t?[null]:t instanceof ue?[void 0,...me(t.unwrap())]:t instanceof ke?[null,...me(t.unwrap())]:t instanceof Ln||t instanceof Jt?me(t.unwrap()):t instanceof Ht?me(t._def.innerType):[];class Ur extends k{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==_.object)return v(r,{code:p.invalid_type,expected:_.object,received:r.parsedType}),S;const a=this.discriminator,s=r.data[a],i=this.optionsMap.get(s);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(v(r,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[a]}),S)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,a){const s=new Map;for(const i of r){const o=me(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of o){if(s.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);s.set(c,i)}}return new Ur({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:s,...I(a)})}}function $n(t,e){const r=we(t),a=we(e);if(t===e)return{valid:!0,data:t};if(r===_.object&&a===_.object){const s=T.objectKeys(e),i=T.objectKeys(t).filter(c=>s.indexOf(c)!==-1),o={...t,...e};for(const c of i){const u=$n(t[c],e[c]);if(!u.valid)return{valid:!1};o[c]=u.data}return{valid:!0,data:o}}else if(r===_.array&&a===_.array){if(t.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<t.length;i++){const o=t[i],c=e[i],u=$n(o,c);if(!u.valid)return{valid:!1};s.push(u.data)}return{valid:!0,data:s}}else return r===_.date&&a===_.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class Kt extends k{_parse(e){const{status:r,ctx:a}=this._processInputParams(e),s=(i,o)=>{if(Mn(i)||Mn(o))return S;const c=$n(i.value,o.value);return c.valid?((Un(i)||Un(o))&&r.dirty(),{status:r.value,value:c.data}):(v(a,{code:p.invalid_intersection_types}),S)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}Kt.create=(t,e,r)=>new Kt({left:t,right:e,typeName:w.ZodIntersection,...I(r)});class ce extends k{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==_.array)return v(a,{code:p.invalid_type,expected:_.array,received:a.parsedType}),S;if(a.data.length<this._def.items.length)return v(a,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),S;!this._def.rest&&a.data.length>this._def.items.length&&(v(a,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...a.data].map((o,c)=>{const u=this._def.items[c]||this._def.rest;return u?u._parse(new oe(a,o,a.path,c)):null}).filter(o=>!!o);return a.common.async?Promise.all(i).then(o=>J.mergeArray(r,o)):J.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new ce({...this._def,rest:e})}}ce.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ce({items:t,typeName:w.ZodTuple,rest:null,...I(e)})};class Wt extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==_.object)return v(a,{code:p.invalid_type,expected:_.object,received:a.parsedType}),S;const s=[],i=this._def.keyType,o=this._def.valueType;for(const c in a.data)s.push({key:i._parse(new oe(a,c,a.path,c)),value:o._parse(new oe(a,a.data[c],a.path,c)),alwaysSet:c in a.data});return a.common.async?J.mergeObjectAsync(r,s):J.mergeObjectSync(r,s)}get element(){return this._def.valueType}static create(e,r,a){return r instanceof k?new Wt({keyType:e,valueType:r,typeName:w.ZodRecord,...I(a)}):new Wt({keyType:re.create(),valueType:e,typeName:w.ZodRecord,...I(r)})}}class Dr extends k{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==_.map)return v(a,{code:p.invalid_type,expected:_.map,received:a.parsedType}),S;const s=this._def.keyType,i=this._def.valueType,o=[...a.data.entries()].map(([c,u],l)=>({key:s._parse(new oe(a,c,a.path,[l,"key"])),value:i._parse(new oe(a,u,a.path,[l,"value"]))}));if(a.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return S;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}})}else{const c=new Map;for(const u of o){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return S;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}}}}Dr.create=(t,e,r)=>new Dr({valueType:e,keyType:t,typeName:w.ZodMap,...I(r)});class Be extends k{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.parsedType!==_.set)return v(a,{code:p.invalid_type,expected:_.set,received:a.parsedType}),S;const s=this._def;s.minSize!==null&&a.data.size<s.minSize.value&&(v(a,{code:p.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),r.dirty()),s.maxSize!==null&&a.data.size>s.maxSize.value&&(v(a,{code:p.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),r.dirty());const i=this._def.valueType;function o(u){const l=new Set;for(const d of u){if(d.status==="aborted")return S;d.status==="dirty"&&r.dirty(),l.add(d.value)}return{status:r.value,value:l}}const c=[...a.data.values()].map((u,l)=>i._parse(new oe(a,u,a.path,l)));return a.common.async?Promise.all(c).then(u=>o(u)):o(c)}min(e,r){return new Be({...this._def,minSize:{value:e,message:R.toString(r)}})}max(e,r){return new Be({...this._def,maxSize:{value:e,message:R.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Be.create=(t,e)=>new Be({valueType:t,minSize:null,maxSize:null,typeName:w.ZodSet,...I(e)});class lt extends k{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==_.function)return v(r,{code:p.invalid_type,expected:_.function,received:r.parsedType}),S;function a(c,u){return Nr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Pr(),it].filter(l=>!!l),issueData:{code:p.invalid_arguments,argumentsError:u}})}function s(c,u){return Nr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,Pr(),it].filter(l=>!!l),issueData:{code:p.invalid_return_type,returnTypeError:u}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof dt){const c=this;return z(async function(...u){const l=new X([]),d=await c._def.args.parseAsync(u,i).catch(f=>{throw l.addIssue(a(u,f)),l}),y=await Reflect.apply(o,this,d);return await c._def.returns._def.type.parseAsync(y,i).catch(f=>{throw l.addIssue(s(y,f)),l})})}else{const c=this;return z(function(...u){const l=c._def.args.safeParse(u,i);if(!l.success)throw new X([a(u,l.error)]);const d=Reflect.apply(o,this,l.data),y=c._def.returns.safeParse(d,i);if(!y.success)throw new X([s(d,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new lt({...this._def,args:ce.create(e).rest(We.create())})}returns(e){return new lt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,a){return new lt({args:e||ce.create([]).rest(We.create()),returns:r||We.create(),typeName:w.ZodFunction,...I(a)})}}class Bt extends k{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Bt.create=(t,e)=>new Bt({getter:t,typeName:w.ZodLazy,...I(e)});class Ft extends k{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return v(r,{received:r.data,code:p.invalid_literal,expected:this._def.value}),S}return{status:"valid",value:e.data}}get value(){return this._def.value}}Ft.create=(t,e)=>new Ft({value:t,typeName:w.ZodLiteral,...I(e)});function ds(t,e){return new Ie({values:t,typeName:w.ZodEnum,...I(e)})}class Ie extends k{constructor(){super(...arguments),jt.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),a=this._def.values;return v(r,{expected:T.joinValues(a),received:r.parsedType,code:p.invalid_type}),S}if(Cr(this,jt)||is(this,jt,new Set(this._def.values)),!Cr(this,jt).has(e.data)){const r=this._getOrReturnCtx(e),a=this._def.values;return v(r,{received:r.data,code:p.invalid_enum_value,options:a}),S}return z(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return Ie.create(e,{...this._def,...r})}exclude(e,r=this._def){return Ie.create(this.options.filter(a=>!e.includes(a)),{...this._def,...r})}}jt=new WeakMap,Ie.create=ds;class Vt extends k{constructor(){super(...arguments),Mt.set(this,void 0)}_parse(e){const r=T.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(e);if(a.parsedType!==_.string&&a.parsedType!==_.number){const s=T.objectValues(r);return v(a,{expected:T.joinValues(s),received:a.parsedType,code:p.invalid_type}),S}if(Cr(this,Mt)||is(this,Mt,new Set(T.getValidEnumValues(this._def.values))),!Cr(this,Mt).has(e.data)){const s=T.objectValues(r);return v(a,{received:a.data,code:p.invalid_enum_value,options:s}),S}return z(e.data)}get enum(){return this._def.values}}Mt=new WeakMap,Vt.create=(t,e)=>new Vt({values:t,typeName:w.ZodNativeEnum,...I(e)});class dt extends k{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==_.promise&&r.common.async===!1)return v(r,{code:p.invalid_type,expected:_.promise,received:r.parsedType}),S;const a=r.parsedType===_.promise?r.data:Promise.resolve(r.data);return z(a.then(s=>this._def.type.parseAsync(s,{path:r.path,errorMap:r.common.contextualErrorMap})))}}dt.create=(t,e)=>new dt({type:t,typeName:w.ZodPromise,...I(e)});class ae extends k{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:a}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{v(a,o),o.fatal?r.abort():r.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const o=s.transform(a.data,i);if(a.common.async)return Promise.resolve(o).then(async c=>{if(r.value==="aborted")return S;const u=await this._def.schema._parseAsync({data:c,path:a.path,parent:a});return u.status==="aborted"?S:u.status==="dirty"||r.value==="dirty"?ot(u.value):u});{if(r.value==="aborted")return S;const c=this._def.schema._parseSync({data:o,path:a.path,parent:a});return c.status==="aborted"?S:c.status==="dirty"||r.value==="dirty"?ot(c.value):c}}if(s.type==="refinement"){const o=c=>{const u=s.refinement(c,i);if(a.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(a.common.async===!1){const c=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return c.status==="aborted"?S:(c.status==="dirty"&&r.dirty(),o(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(c=>c.status==="aborted"?S:(c.status==="dirty"&&r.dirty(),o(c.value).then(()=>({status:r.value,value:c.value}))))}if(s.type==="transform")if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Nt(o))return o;const c=s.transform(o.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>Nt(o)?Promise.resolve(s.transform(o.value,i)).then(c=>({status:r.value,value:c})):o);T.assertNever(s)}}ae.create=(t,e,r)=>new ae({schema:t,typeName:w.ZodEffects,effect:e,...I(r)}),ae.createWithPreprocess=(t,e,r)=>new ae({schema:e,effect:{type:"preprocess",transform:t},typeName:w.ZodEffects,...I(r)});class ue extends k{_parse(e){return this._getType(e)===_.undefined?z(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ue.create=(t,e)=>new ue({innerType:t,typeName:w.ZodOptional,...I(e)});class ke extends k{_parse(e){return this._getType(e)===_.null?z(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ke.create=(t,e)=>new ke({innerType:t,typeName:w.ZodNullable,...I(e)});class Gt extends k{_parse(e){const{ctx:r}=this._processInputParams(e);let a=r.data;return r.parsedType===_.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Gt.create=(t,e)=>new Gt({innerType:t,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...I(e)});class Ht extends k{_parse(e){const{ctx:r}=this._processInputParams(e),a={...r,common:{...r.common,issues:[]}},s=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Ct(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new X(a.common.issues)},input:a.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new X(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}Ht.create=(t,e)=>new Ht({innerType:t,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...I(e)});class $r extends k{_parse(e){if(this._getType(e)!==_.nan){const a=this._getOrReturnCtx(e);return v(a,{code:p.invalid_type,expected:_.nan,received:a.parsedType}),S}return{status:"valid",value:e.data}}}$r.create=t=>new $r({typeName:w.ZodNaN,...I(t)});const dc=Symbol("zod_brand");class Ln extends k{_parse(e){const{ctx:r}=this._processInputParams(e),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class Zt extends k{_parse(e){const{status:r,ctx:a}=this._processInputParams(e);if(a.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?S:i.status==="dirty"?(r.dirty(),ot(i.value)):this._def.out._parseAsync({data:i.value,path:a.path,parent:a})})();{const s=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return s.status==="aborted"?S:s.status==="dirty"?(r.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:a.path,parent:a})}}static create(e,r){return new Zt({in:e,out:r,typeName:w.ZodPipeline})}}class Jt extends k{_parse(e){const r=this._def.innerType._parse(e),a=s=>(Nt(s)&&(s.value=Object.freeze(s.value)),s);return Ct(r)?r.then(s=>a(s)):a(r)}unwrap(){return this._def.innerType}}Jt.create=(t,e)=>new Jt({innerType:t,typeName:w.ZodReadonly,...I(e)});function fs(t,e={},r){return t?ct.create().superRefine((a,s)=>{var i,o;if(!t(a)){const c=typeof e=="function"?e(a):typeof e=="string"?{message:e}:e,u=(o=(i=c.fatal)!==null&&i!==void 0?i:r)!==null&&o!==void 0?o:!0,l=typeof c=="string"?{message:c}:c;s.addIssue({code:"custom",...l,fatal:u})}}):ct.create()}const fc={object:$.lazycreate};var w;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(w||(w={}));const hc=(t,e={message:`Input not instance of ${t.name}`})=>fs(r=>r instanceof t,e),hs=re.create,ps=Se.create,pc=$r.create,gc=Ae.create,gs=Ut.create,mc=Ke.create,yc=jr.create,_c=Dt.create,vc=$t.create,bc=ct.create,Ec=We.create,Tc=ge.create,Rc=Mr.create,wc=ne.create,Sc=$.create,Ac=$.strictCreate,Ic=Lt.create,kc=Ur.create,xc=Kt.create,Oc=ce.create,Pc=Wt.create,Nc=Dr.create,Cc=Be.create,jc=lt.create,Mc=Bt.create,Uc=Ft.create,Dc=Ie.create,$c=Vt.create,Lc=dt.create,ms=ae.create,Kc=ue.create,Wc=ke.create,Bc=ae.createWithPreprocess,Fc=Zt.create;var n=Object.freeze({__proto__:null,defaultErrorMap:it,setErrorMap:Jo,getErrorMap:Pr,makeIssue:Nr,EMPTY_PATH:zo,addIssueToContext:v,ParseStatus:J,INVALID:S,DIRTY:ot,OK:z,isAborted:Mn,isDirty:Un,isValid:Nt,isAsync:Ct,get util(){return T},get objectUtil(){return W},ZodParsedType:_,getParsedType:we,ZodType:k,datetimeRegex:ls,ZodString:re,ZodNumber:Se,ZodBigInt:Ae,ZodBoolean:Ut,ZodDate:Ke,ZodSymbol:jr,ZodUndefined:Dt,ZodNull:$t,ZodAny:ct,ZodUnknown:We,ZodNever:ge,ZodVoid:Mr,ZodArray:ne,ZodObject:$,ZodUnion:Lt,ZodDiscriminatedUnion:Ur,ZodIntersection:Kt,ZodTuple:ce,ZodRecord:Wt,ZodMap:Dr,ZodSet:Be,ZodFunction:lt,ZodLazy:Bt,ZodLiteral:Ft,ZodEnum:Ie,ZodNativeEnum:Vt,ZodPromise:dt,ZodEffects:ae,ZodTransformer:ae,ZodOptional:ue,ZodNullable:ke,ZodDefault:Gt,ZodCatch:Ht,ZodNaN:$r,BRAND:dc,ZodBranded:Ln,ZodPipeline:Zt,ZodReadonly:Jt,custom:fs,Schema:k,ZodSchema:k,late:fc,get ZodFirstPartyTypeKind(){return w},coerce:{string:t=>re.create({...t,coerce:!0}),number:t=>Se.create({...t,coerce:!0}),boolean:t=>Ut.create({...t,coerce:!0}),bigint:t=>Ae.create({...t,coerce:!0}),date:t=>Ke.create({...t,coerce:!0})},any:bc,array:wc,bigint:gc,boolean:gs,date:mc,discriminatedUnion:kc,effect:ms,enum:Dc,function:jc,instanceof:hc,intersection:xc,lazy:Mc,literal:Uc,map:Nc,nan:pc,nativeEnum:$c,never:Tc,null:vc,nullable:Wc,number:ps,object:Sc,oboolean:()=>gs().optional(),onumber:()=>ps().optional(),optional:Kc,ostring:()=>hs().optional(),pipeline:Fc,preprocess:Bc,promise:Lc,record:Pc,set:Cc,strictObject:Ac,string:hs,symbol:yc,transformer:ms,tuple:Oc,undefined:_c,union:Ic,unknown:Ec,void:Rc,NEVER:S,ZodIssueCode:p,quotelessJson:Zo,ZodError:X});const ys="3.3.13",Vc="HS256",Gc="https://id.trigger.dev",Hc="https://api.trigger.dev";async function _s(t){const{SignJWT:e}=await Promise.resolve().then(()=>Vp),r=new TextEncoder().encode(t.secretKey);return new e(t.payload).setIssuer(Gc).setAudience(Hc).setProtectedHeader({alg:Vc}).setIssuedAt().setExpirationTime(t.expirationTime??"15m").sign(r)}n.object({url:n.string().url(),authorizationCode:n.string()}),n.object({authorizationCode:n.string()}),n.object({token:n.object({token:n.string(),obfuscatedToken:n.string()}).nullable()});const Zc=n.union([n.string(),n.number(),n.boolean(),n.null()]),xe=n.lazy(()=>n.union([Zc,n.array(xe),n.record(xe)])),Jc=n.union([n.string(),n.number(),n.boolean(),n.null(),n.date(),n.undefined(),n.symbol()]),vs=n.lazy(()=>n.union([Jc,n.array(vs),n.record(vs)])),zc=n.object({type:n.literal("update"),value:n.record(n.unknown())}),Yc=n.object({type:n.literal("set"),key:n.string(),value:xe}),qc=n.object({type:n.literal("delete"),key:n.string()}),Xc=n.object({type:n.literal("append"),key:n.string(),value:xe}),Qc=n.object({type:n.literal("remove"),key:n.string(),value:xe}),eu=n.object({type:n.literal("increment"),key:n.string(),value:n.number()}),Kn=n.discriminatedUnion("type",[zc,Yc,qc,Xc,Qc,eu]),bs=n.object({metadata:n.record(xe).optional(),operations:n.array(Kn).optional(),parentOperations:n.array(Kn).optional(),rootOperations:n.array(Kn).optional()}),tu=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4)]),ru=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4),n.literal(8)]),Lr=n.enum(["micro","small-1x","small-2x","medium-1x","medium-2x","large-1x","large-2x"]),Es=n.object({cpu:tu.optional(),memory:ru.optional(),preset:Lr.optional()}),zt=n.object({name:Lr,cpu:n.number(),memory:n.number(),centsPerMs:n.number()}),nu=n.object({type:n.literal("BUILT_IN_ERROR"),name:n.string(),message:n.string(),stackTrace:n.string()}),au=n.object({type:n.literal("CUSTOM_ERROR"),raw:n.string()}),su=n.object({type:n.literal("STRING_ERROR"),raw:n.string()}),Wn=n.object({type:n.literal("INTERNAL_ERROR"),code:n.enum(["COULD_NOT_FIND_EXECUTOR","COULD_NOT_FIND_TASK","COULD_NOT_IMPORT_TASK","CONFIGURED_INCORRECTLY","TASK_ALREADY_RUNNING","TASK_EXECUTION_FAILED","TASK_EXECUTION_ABORTED","TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE","TASK_PROCESS_SIGKILL_TIMEOUT","TASK_PROCESS_SIGSEGV","TASK_PROCESS_SIGTERM","TASK_PROCESS_OOM_KILLED","TASK_PROCESS_MAYBE_OOM_KILLED","TASK_RUN_CANCELLED","TASK_INPUT_ERROR","TASK_OUTPUT_ERROR","HANDLE_ERROR_ERROR","GRACEFUL_EXIT_TIMEOUT","TASK_RUN_HEARTBEAT_TIMEOUT","TASK_RUN_CRASHED","MAX_DURATION_EXCEEDED","DISK_SPACE_EXCEEDED","POD_EVICTED","POD_UNKNOWN_ERROR","OUTDATED_SDK_VERSION","TASK_DID_CONCURRENT_WAIT"]),message:n.string().optional(),stackTrace:n.string().optional()}),Ts=Wn.shape.code.enum,Rs=n.discriminatedUnion("type",[nu,au,su,Wn]),ws=n.object({id:n.string(),payload:n.string(),payloadType:n.string(),context:n.any(),tags:n.array(n.string()),isTest:n.boolean().default(!1),createdAt:n.coerce.date(),startedAt:n.coerce.date().default(()=>new Date),idempotencyKey:n.string().optional(),maxAttempts:n.number().optional(),durationMs:n.number().default(0),costInCents:n.number().default(0),baseCostInCents:n.number().default(0),version:n.string().optional(),metadata:n.record(xe).optional(),maxDuration:n.number().optional()}),Ss=n.object({id:n.string(),filePath:n.string(),exportName:n.string()}),As=n.object({id:n.string(),number:n.number(),startedAt:n.coerce.date(),backgroundWorkerId:n.string(),backgroundWorkerTaskId:n.string(),status:n.string()}),Is=n.object({id:n.string(),slug:n.string(),type:n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"])}),ks=n.object({id:n.string(),slug:n.string(),name:n.string()}),xs=n.object({id:n.string(),ref:n.string(),slug:n.string(),name:n.string()}),Os=n.object({id:n.string(),name:n.string()}),Ps=n.object({id:n.string()}),ye=n.object({task:Ss,attempt:As,run:ws,queue:Os,environment:Is,organization:ks,project:xs,batch:Ps.optional(),machine:zt.optional()});n.object({task:Ss,attempt:As.omit({backgroundWorkerId:!0,backgroundWorkerTaskId:!0}),run:ws.omit({payload:!0,payloadType:!0,metadata:!0}),queue:Os,environment:Is,organization:ks,project:xs,batch:Ps.optional(),machine:zt.optional()});const iu=n.object({timestamp:n.number(),delay:n.number(),error:n.unknown().optional()}),Ns=n.object({durationMs:n.number()}),Kr=n.object({ok:n.literal(!1),id:n.string(),error:Rs,retry:iu.optional(),skippedRetrying:n.boolean().optional(),usage:Ns.optional(),taskIdentifier:n.string().optional(),metadata:bs.optional()}),ou=n.object({ok:n.literal(!0),id:n.string(),output:n.string().optional(),outputType:n.string(),usage:Ns.optional(),taskIdentifier:n.string().optional(),metadata:bs.optional()}),se=n.discriminatedUnion("ok",[ou,Kr]),cu=n.object({id:n.string(),items:se.array()}),Cs=n.object({message:n.string(),name:n.string().optional(),stackTrace:n.string().optional()}),Wr=n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"]);n.object({execution:ye,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()});const Bn=ye.extend({worker:n.object({id:n.string(),contentHash:n.string(),version:n.string()}),machine:zt.default({name:"small-1x",cpu:1,memory:1,centsPerMs:0})}),Br=n.object({execution:Bn,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),uu=n.object({type:n.literal("fixed-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])}),lu=n.object({type:n.literal("sliding-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])});n.discriminatedUnion("type",[uu,lu]);const Fe=n.object({maxAttempts:n.number().int().optional(),factor:n.number().optional(),minTimeoutInMs:n.number().int().optional(),maxTimeoutInMs:n.number().int().optional(),randomize:n.boolean().optional()}),Fr=n.object({name:n.string().optional(),concurrencyLimit:n.number().int().min(0).max(1e3).optional().nullable()}),js=n.object({cron:n.string(),timezone:n.string()}),Ms={id:n.string(),description:n.string().optional(),queue:Fr.optional(),retry:Fe.optional(),machine:Es.optional(),triggerSource:n.string().optional(),schedule:js.optional(),maxDuration:n.number().optional()};n.object(Ms);const du=n.object({entry:n.string(),out:n.string()}),Us={filePath:n.string(),exportName:n.string(),entryPoint:n.string()};n.object(Us);const fu=n.object({...Ms,...Us});n.enum(["index","create","restore"]),n.enum(["terminate"]);const hu=n.custom(t=>{try{return typeof t.test=="function"}catch{return!1}});n.object({project:n.string(),triggerDirectories:n.string().array().optional(),triggerUrl:n.string().optional(),projectDir:n.string().optional(),tsconfigPath:n.string().optional(),retries:n.object({enabledInDev:n.boolean().default(!0),default:Fe.optional()}).optional(),additionalPackages:n.string().array().optional(),additionalFiles:n.string().array().optional(),dependenciesToBundle:n.array(n.union([n.string(),hu])).optional(),logLevel:n.string().optional(),enableConsoleLogging:n.boolean().optional(),postInstall:n.string().optional(),extraCACerts:n.string().optional()});const Yt=n.enum(["WAIT_FOR_DURATION","WAIT_FOR_TASK","WAIT_FOR_BATCH"]),Fn=n.object({runId:n.string(),attemptCount:n.number().optional(),messageId:n.string(),isTest:n.boolean(),traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),Vn=n.object({id:n.string(),description:n.string().optional(),filePath:n.string(),exportName:n.string(),queue:Fr.optional(),retry:Fe.optional(),machine:Es.optional(),triggerSource:n.string().optional(),schedule:js.optional(),maxDuration:n.number().optional()}),pu=n.object({filePath:n.string(),contents:n.string(),contentHash:n.string(),taskIds:n.array(n.string())}),gu=n.object({packageVersion:n.string(),contentHash:n.string(),cliPackageVersion:n.string().optional(),tasks:n.array(Vn),sourceFiles:n.array(pu).optional()});n.object({contentHash:n.string(),imageTag:n.string()}),n.object({userId:n.string(),email:n.string().email(),dashboardUrl:n.string()});const mu=n.object({id:n.string(),externalRef:n.string(),name:n.string(),slug:n.string(),createdAt:n.coerce.date(),organization:n.object({id:n.string(),title:n.string(),slug:n.string(),createdAt:n.coerce.date()})});n.array(mu),n.object({apiKey:n.string(),name:n.string(),apiUrl:n.string(),projectId:n.string()}),n.object({localOnly:n.boolean(),metadata:gu,supportsLazyAttempts:n.boolean().optional()}),n.object({id:n.string(),version:n.string(),contentHash:n.string()});const Ds=n.string().max(128,"Tags must be less than 128 characters"),Gn=n.union([Ds,Ds.array()]),yu=n.object({payload:n.any(),context:n.any(),options:n.object({dependentAttempt:n.string().optional(),parentAttempt:n.string().optional(),dependentBatch:n.string().optional(),parentBatch:n.string().optional(),lockToVersion:n.string().optional(),queue:Fr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:Gn.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional(),machine:Lr.optional()}).optional()}),_u=n.object({id:n.string()});n.object({items:yu.array(),dependentAttempt:n.string().optional()});const vu=n.object({task:n.string(),payload:n.any(),context:n.any(),options:n.object({lockToVersion:n.string().optional(),queue:Fr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:Gn.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional(),parentAttempt:n.string().optional(),machine:Lr.optional()}).optional()});n.object({items:vu.array(),dependentAttempt:n.string().optional()});const bu=n.object({id:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional(),runs:n.array(n.object({id:n.string(),taskIdentifier:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional()}))});n.object({batchId:n.string(),runs:n.string().array()}),n.object({id:n.string(),items:n.array(n.object({id:n.string(),taskRunId:n.string(),status:n.enum(["PENDING","CANCELED","COMPLETED","FAILED"])}))}),n.object({tags:Gn}),n.object({delay:n.string().or(n.coerce.date())}),n.object({variables:n.record(n.string())}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional()}),n.object({id:n.string(),contentHash:n.string()}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional(),skipRegistryProxy:n.boolean().optional()});const Eu=n.object({buildId:n.string(),buildToken:n.string(),projectId:n.string()});n.object({id:n.string(),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageTag:n.string(),externalBuildData:Eu.optional().nullable(),registryHost:n.string().optional()}),n.object({contentHash:n.string(),userId:n.string().optional(),registryHost:n.string().optional(),selfHosted:n.boolean().optional(),namespace:n.string().optional()});const $s=n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()});n.object({error:$s}),n.object({id:n.string()}),n.object({id:n.string(),status:n.enum(["PENDING","BUILDING","DEPLOYING","DEPLOYED","FAILED","CANCELED","TIMED_OUT"]),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageReference:n.string().nullish(),errorData:$s.nullish(),worker:n.object({id:n.string(),version:n.string(),tasks:n.array(n.object({id:n.string(),slug:n.string(),filePath:n.string(),exportName:n.string()}))}).optional()});const Ls=n.object({presignedUrl:n.string()}),Tu=n.object({id:n.string()}),Ru=n.object({id:n.string()}),Ks=n.union([n.literal("DECLARATIVE"),n.literal("IMPERATIVE")]);n.object({scheduleId:n.string(),type:Ks,timestamp:n.date(),lastTimestamp:n.date().optional(),externalId:n.string().optional(),timezone:n.string(),upcoming:n.array(n.date())}),n.object({task:n.string(),cron:n.string(),deduplicationKey:n.string(),externalId:n.string().optional(),timezone:n.string().optional()}).omit({deduplicationKey:!0});const Ws=n.object({type:n.literal("CRON"),expression:n.string(),description:n.string()}),Ve=n.object({id:n.string(),type:Ks,task:n.string(),active:n.boolean(),deduplicationKey:n.string().nullish(),externalId:n.string().nullish(),generator:Ws,timezone:n.string(),nextRun:n.coerce.date().nullish(),environments:n.array(n.object({id:n.string(),type:n.string(),userName:n.string().nullish()}))}),wu=n.object({id:n.string()});n.object({data:n.array(Ve),pagination:n.object({currentPage:n.number(),totalPages:n.number(),count:n.number()})}),n.object({page:n.number().optional(),perPage:n.number().optional()}),n.object({timezones:n.array(n.string())});const Su=n.enum(["WAITING_FOR_DEPLOY","QUEUED","EXECUTING","REATTEMPTING","FROZEN","COMPLETED","CANCELED","FAILED","CRASHED","INTERRUPTED","SYSTEM_FAILURE","DELAYED","EXPIRED","TIMED_OUT"]),Au=n.enum(["PENDING","EXECUTING","PAUSED","COMPLETED","FAILED","CANCELED"]),Iu=n.object({id:n.string(),name:n.string(),user:n.string().optional()}),ku=n.object({id:n.string(),externalId:n.string().optional(),deduplicationKey:n.string().optional(),generator:Ws});n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]);const Bs={id:n.string(),status:Su,taskIdentifier:n.string(),idempotencyKey:n.string().optional(),version:n.string().optional(),isQueued:n.boolean(),isExecuting:n.boolean(),isCompleted:n.boolean(),isSuccess:n.boolean(),isFailed:n.boolean(),isCancelled:n.boolean(),isTest:n.boolean(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),finishedAt:n.coerce.date().optional(),delayedUntil:n.coerce.date().optional(),ttl:n.string().optional(),expiredAt:n.coerce.date().optional(),tags:n.string().array(),costInCents:n.number(),baseCostInCents:n.number(),durationMs:n.number(),metadata:n.record(n.any()).optional()},Fs={...Bs,depth:n.number(),triggerFunction:n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]),batchId:n.string().optional()},Hn=n.object(Fs),Vs=n.object({...Fs,payload:n.any().optional(),payloadPresignedUrl:n.string().optional(),output:n.any().optional(),outputPresignedUrl:n.string().optional(),error:Cs.optional(),schedule:ku.optional(),relatedRuns:n.object({root:Hn.optional(),parent:Hn.optional(),children:n.array(Hn).optional()}),attempts:n.array(n.object({id:n.string(),status:Au,createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),completedAt:n.coerce.date().optional(),error:Cs.optional()}).optional()),attemptCount:n.number().default(0)}),Zn=n.object({...Bs,env:Iu});n.object({data:n.array(Zn),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),n.object({name:n.string(),value:n.string()}),n.object({value:n.string()}),n.object({variables:n.record(n.string()),override:n.boolean().optional()});const Vr=n.object({success:n.boolean()}),xu=n.object({value:n.string()}),Ou=n.object({name:n.string(),value:n.string()}),Pu=n.array(Ou),Gs=n.object({metadata:n.record(xe)}),Hs=n.string().transform(t=>`${t}Z`).pipe(n.coerce.date()),qt=n.string().nullish().transform(t=>t&&new Date(`${t}Z`)),Nu=n.object({id:n.string(),idempotencyKey:n.string().nullish(),createdAt:Hs,updatedAt:Hs,startedAt:qt,delayUntil:qt,queuedAt:qt,expiredAt:qt,completedAt:qt,taskIdentifier:n.string(),friendlyId:n.string(),number:n.number(),isTest:n.boolean(),status:n.string(),usageDurationMs:n.number(),costInCents:n.number(),baseCostInCents:n.number(),ttl:n.string().nullish(),payload:n.string().nullish(),payloadType:n.string().nullish(),metadata:n.string().nullish(),metadataType:n.string().nullish(),output:n.string().nullish(),outputType:n.string().nullish(),runTags:n.array(n.string()).nullish().default([]),error:Rs.nullish()}),Cu=n.enum(["PENDING","COMPLETED"]),ju=n.object({id:n.string(),status:Cu,idempotencyKey:n.string().optional(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),runCount:n.number()});n.object({id:n.string(),runId:n.string(),sequence:n.number(),key:n.string(),value:n.string(),createdAt:n.coerce.date()});const Mu=n.object({project:n.string(),dirs:n.string().array()}),Uu=n.object({name:n.string(),version:n.string()}),Du=n.enum(["dev","deploy"]),Zs=n.enum(["node","bun"]),$u=n.object({target:Du,packageVersion:n.string(),cliPackageVersion:n.string(),contentHash:n.string(),runtime:Zs,environment:n.string(),config:Mu,files:n.array(du),sources:n.record(n.object({contents:n.string(),contentHash:n.string()})),outputPath:n.string(),runWorkerEntryPoint:n.string(),runControllerEntryPoint:n.string().optional(),indexWorkerEntryPoint:n.string(),indexControllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),configPath:n.string(),externals:Uu.array().optional(),build:n.object({env:n.record(n.string()).optional(),commands:n.array(n.string()).optional()}),customConditions:n.array(n.string()).optional(),deploy:n.object({env:n.record(n.string()).optional(),sync:n.object({env:n.record(n.string()).optional()}).optional()}),image:n.object({pkgs:n.array(n.string()).optional(),instructions:n.array(n.string()).optional()}).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("index"),data:n.object({build:$u})});const Js=n.object({configPath:n.string(),tasks:fu.array(),workerEntryPoint:n.string(),controllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),runtime:Zs,customConditions:n.array(n.string()).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("worker-manifest"),data:n.object({manifest:Js})});const Lu=n.object({message:n.string(),file:n.string(),stack:n.string().optional(),name:n.string().optional()}),Ku=n.array(Lu);n.discriminatedUnion("success",[n.object({success:n.literal(!1),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({success:n.literal(!0)})]);const zs=n.discriminatedUnion("type",[n.object({type:n.literal("CANCEL_ATTEMPT"),taskAttemptId:n.string(),taskRunId:n.string()}),n.object({type:n.literal("SCHEDULE_ATTEMPT"),image:n.string(),version:n.string(),machine:zt,nextAttemptNumber:n.number().optional(),id:n.string().optional(),envId:n.string(),envType:Wr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({type:n.literal("EXECUTE_RUN_LAZY_ATTEMPT"),payload:Fn})]);n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:zs});const Ys=n.discriminatedUnion("type",[n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_COMPLETED"),completion:se,execution:ye}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_FAILED_TO_RUN"),completion:Kr}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_HEARTBEAT"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_HEARTBEAT"),id:n.string()})]),Wu=n.object({id:n.string(),version:n.string(),contentHash:n.string()});n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),inProgressRuns:n.string().array().optional()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ys}),n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()}),origin:n.enum(["uncaughtException","unhandledRejection"])}),n.object({version:n.literal("v1").default("v1"),tasks:n.unknown(),zodIssues:n.custom(t=>Array.isArray(t)&&t.every(e=>typeof e=="object"&&"message"in e))}),n.object({version:n.literal("v1").default("v1"),manifest:Js,importErrors:Ku}),n.object({version:n.literal("v1").default("v1"),execution:ye,result:se}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.undefined(),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),waitThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),friendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({version:n.literal("v1").default("v1"),execution:ye,traceContext:n.record(n.unknown()),metadata:Wu}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),completion:se,execution:ye}),n.object({version:n.literal("v2"),completion:se})]),n.object({version:n.literal("v1").default("v1")}),n.object({timeoutInMs:n.number()}),n.void(),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({status:n.literal("ok")}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),reason:n.string().optional(),exitCode:n.number().optional(),message:n.string().optional(),logs:n.string().optional(),overrideCompletion:n.boolean().optional(),errorCode:Wn.shape.code.optional()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()}),overrideCompletion:n.boolean().optional()}),n.object({version:n.literal("v1").default("v1"),imageTag:n.string(),shortCode:n.string(),apiKey:n.string(),apiUrl:n.string(),envId:n.string(),envType:Wr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.enum(["DOCKER","KUBERNETES"]),location:n.string(),reason:n.string().optional(),imageRef:n.string(),attemptNumber:n.number().optional(),machine:zt,checkpointId:n.string(),envId:n.string(),envType:Wr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),imageRef:n.string(),shortCode:n.string(),envId:n.string(),envType:Wr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()});const qs=n.object({projectRef:n.string(),envId:n.string(),deploymentId:n.string(),metadata:n.object({cliPackageVersion:n.string().optional(),contentHash:n.string(),packageVersion:n.string(),tasks:Vn.array()})});n.object({version:n.literal("v1").default("v1"),metadata:n.any(),text:n.string()}),n.discriminatedUnion("version",[qs.extend({version:n.literal("v1")}),qs.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Br})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0),payload:Br})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),lazyPayload:Fn})]),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string(),type:Yt}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:Bn,completion:se,checkpoint:n.object({docker:n.boolean(),location:n.string()}).optional()}),n.object({version:n.literal("v1").default("v1"),completion:Kr}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string().optional(),attemptFriendlyId:n.string(),docker:n.boolean(),location:n.string(),reason:n.discriminatedUnion("type",[n.object({type:n.literal("WAIT_FOR_DURATION"),ms:n.number(),now:n.number()}),n.object({type:n.literal("WAIT_FOR_BATCH"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({type:n.literal("WAIT_FOR_TASK"),friendlyId:n.string()}),n.object({type:n.literal("RETRYING_AFTER_FAILURE"),attemptNumber:n.number()})])}),n.object({version:n.literal("v1").default("v1"),keepRunAlive:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:se.array(),executions:ye.array()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:se.array(),executions:ye.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),delayInMs:n.number().optional()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),checkpointThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ys}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:zs});const Xs=n.object({version:n.literal("v1"),deploymentId:n.string(),tasks:Vn.array(),packageVersion:n.string()});n.object({version:n.literal("v1").default("v1")}),n.void(),n.discriminatedUnion("version",[Xs.extend({version:n.literal("v1")}),Xs.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),attemptFriendlyId:n.string(),type:Yt}),n.object({version:n.literal("v2"),attemptFriendlyId:n.string(),attemptNumber:n.number(),type:Yt})]),n.object({version:n.literal("v1").default("v1")}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),reason:Yt.optional()})]).default({version:"v1"}),n.object({version:n.literal("v2").default("v2"),checkpointCanceled:n.boolean(),reason:Yt.optional()}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:Bn,completion:se}),n.object({willCheckpointAndRestore:n.boolean(),shouldExit:n.boolean()}),n.object({version:n.literal("v1").default("v1"),completion:Kr}),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),friendlyId:n.string(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Br})]),n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),completions:se.array(),executions:ye.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.object({version:n.literal("v1").default("v1"),executionPayload:Br}),n.object({version:n.literal("v1").default("v1"),lazyPayload:Fn}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),delayInMs:n.number().optional()})]),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({contentHash:n.string(),projectRef:n.string(),envId:n.string(),runId:n.string(),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional(),podName:n.string(),deploymentId:n.string(),deploymentVersion:n.string(),requiresCheckpointResumeWithMessage:n.string().optional()}),n.object({supportsDynamicConfig:n.string().optional()});const Bu=n.enum(["primary"]),Fu=n.object({text:n.string(),variant:n.string().optional(),url:n.string().optional()}),Vu=n.object({items:n.array(Fu),style:n.enum(["codepath"]).optional()});n.object({icon:n.string().optional(),variant:Bu.optional(),accessory:Vu.optional()}).default({icon:void 0,variant:void 0});const Gu=[n.object({$endsWith:n.string()}),n.object({$startsWith:n.string()}),n.object({$ignoreCaseEquals:n.string()})],Hu=n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean()),n.array(n.union([...Gu,n.object({$exists:n.boolean()}),n.object({$isNull:n.boolean()}),n.object({$anythingBut:n.union([n.string(),n.number(),n.boolean()])}),n.object({$anythingBut:n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean())])}),n.object({$gt:n.number()}),n.object({$lt:n.number()}),n.object({$gte:n.number()}),n.object({$lte:n.number()}),n.object({$between:n.tuple([n.number(),n.number()])}),n.object({$includes:n.union([n.string(),n.number(),n.boolean()])}),n.object({$not:n.union([n.string(),n.number(),n.boolean()])})]))]),Jn=n.lazy(()=>n.record(n.union([Hu,Jn]))),Zu=n.object({strategy:n.literal("headers"),limitHeader:n.string(),remainingHeader:n.string(),resetHeader:n.string(),bodyFilter:Jn.optional(),resetFormat:n.enum(["unix_timestamp","unix_timestamp_in_ms","iso_8601","iso_8601_duration_openai_variant"]).default("unix_timestamp").optional()}),Ju=Fe.extend({strategy:n.literal("backoff"),bodyFilter:Jn.optional()}),zu=n.discriminatedUnion("strategy",[Zu,Ju]),Yu=n.record(n.string(),zu);n.object({durationInMs:n.number().optional(),retry:Fe.optional()}),n.object({byStatus:Yu.optional(),timeout:Fe.optional(),connectionError:Fe.optional()});const qu=n.object({type:n.string().optional(),message:n.string().optional(),stacktrace:n.string().optional()}),Xu=n.object({name:n.literal("exception"),time:n.coerce.date(),properties:n.object({exception:qu})}),Qu=n.object({name:n.literal("cancellation"),time:n.coerce.date(),properties:n.object({reason:n.string()})}),el=n.object({name:n.string(),time:n.coerce.date(),properties:n.record(n.unknown())}),tl=n.union([Xu,Qu,el]);n.array(tl),n.object({system:n.string().optional(),client_id:n.string().optional(),operation:n.enum(["publish","create","receive","deliver"]),message:n.any(),destination:n.string().optional()});const rl=typeof globalThis=="object"?globalThis:global,Gr=Symbol.for("dev.trigger.ts.api"),Hr=rl;function ie(t,e,r=!1){const a=Hr[Gr]=Hr[Gr]??{};return!r&&a[t]?!1:(a[t]=e,!0)}function _e(t){var e;return(e=Hr[Gr])==null?void 0:e[t]}function Ge(t){const e=Hr[Gr];e&&delete e[t]}const x={ENVIRONMENT_ID:"ctx.environment.id",ENVIRONMENT_TYPE:"ctx.environment.type",ORGANIZATION_ID:"ctx.organization.id",ORGANIZATION_SLUG:"ctx.organization.slug",ORGANIZATION_NAME:"ctx.organization.name",PROJECT_ID:"ctx.project.id",PROJECT_REF:"ctx.project.ref",PROJECT_NAME:"ctx.project.title",ATTEMPT_ID:"ctx.attempt.id",ATTEMPT_NUMBER:"ctx.attempt.number",RUN_ID:"ctx.run.id",RUN_IS_TEST:"ctx.run.isTest",BATCH_ID:"ctx.batch.id",TASK_SLUG:"ctx.task.id",TASK_PATH:"ctx.task.filePath",TASK_EXPORT_NAME:"ctx.task.exportName",QUEUE_NAME:"ctx.queue.name",QUEUE_ID:"ctx.queue.id",MACHINE_PRESET_NAME:"ctx.machine.name",MACHINE_PRESET_CPU:"ctx.machine.cpu",MACHINE_PRESET_MEMORY:"ctx.machine.memory",MACHINE_PRESET_CENTS_PER_MS:"ctx.machine.centsPerMs",SPAN_PARTIAL:"$span.partial",SPAN_ID:"$span.span_id",STYLE_ICON:"$style.icon",STYLE_ACCESSORY:"$style.accessory",WORKER_ID:"worker.id",WORKER_VERSION:"worker.version",IDEMPOTENCY_KEY:"ctx.run.idempotencyKey",USAGE_DURATION_MS:"$usage.durationMs",USAGE_COST_IN_CENTS:"$usage.costInCents"},zn="task-context",bn=class bn{constructor(){V(this,At)}static getInstance(){return this._instance||(this._instance=new bn),this._instance}get isInsideTask(){return m(this,At,Nn).call(this)!==void 0}get ctx(){var e;return(e=m(this,At,Nn).call(this))==null?void 0:e.ctx}get worker(){var e;return(e=m(this,At,Nn).call(this))==null?void 0:e.worker}get attributes(){return this.ctx?{...this.contextAttributes,...this.workerAttributes}:{}}get workerAttributes(){return this.worker?{[x.WORKER_ID]:this.worker.id,[x.WORKER_VERSION]:this.worker.version}:{}}get contextAttributes(){var e,r,a,s,i;return this.ctx?{[x.ATTEMPT_ID]:this.ctx.attempt.id,[x.ATTEMPT_NUMBER]:this.ctx.attempt.number,[x.TASK_SLUG]:this.ctx.task.id,[x.TASK_PATH]:this.ctx.task.filePath,[x.TASK_EXPORT_NAME]:this.ctx.task.exportName,[x.QUEUE_NAME]:this.ctx.queue.name,[x.QUEUE_ID]:this.ctx.queue.id,[x.ENVIRONMENT_ID]:this.ctx.environment.id,[x.ENVIRONMENT_TYPE]:this.ctx.environment.type,[x.ORGANIZATION_ID]:this.ctx.organization.id,[x.PROJECT_ID]:this.ctx.project.id,[x.PROJECT_REF]:this.ctx.project.ref,[x.PROJECT_NAME]:this.ctx.project.name,[x.RUN_ID]:this.ctx.run.id,[x.RUN_IS_TEST]:this.ctx.run.isTest,[x.ORGANIZATION_SLUG]:this.ctx.organization.slug,[x.ORGANIZATION_NAME]:this.ctx.organization.name,[x.BATCH_ID]:(e=this.ctx.batch)==null?void 0:e.id,[x.IDEMPOTENCY_KEY]:this.ctx.run.idempotencyKey,[x.MACHINE_PRESET_NAME]:(r=this.ctx.machine)==null?void 0:r.name,[x.MACHINE_PRESET_CPU]:(a=this.ctx.machine)==null?void 0:a.cpu,[x.MACHINE_PRESET_MEMORY]:(s=this.ctx.machine)==null?void 0:s.memory,[x.MACHINE_PRESET_CENTS_PER_MS]:(i=this.ctx.machine)==null?void 0:i.centsPerMs}:{}}disable(){Ge(zn)}setGlobalTaskContext(e){return ie(zn,e)}};At=new WeakSet,Nn=function(){return _e(zn)},E(bn,"_instance");let Yn=bn;const L=Yn.getInstance(),nl=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function al(t){return t.length===1?t[0].toString():t.reduce((e,r)=>{if(typeof r=="number")return e+"["+r.toString()+"]";if(r.includes('"'))return e+'["'+sl(r)+'"]';if(!nl.test(r))return e+'["'+r+'"]';const a=e.length===0?"":".";return e+a+r},"")}function sl(t){return t.replace(/"/g,'\\"')}function il(t){return t.length!==0}const ol=99,cl="; ",ul=", or ",Qs="Validation error",ll=": ";class dl extends Error{constructor(r,a=[]){super(r);E(this,"details");E(this,"name");this.details=a,this.name="ZodValidationError"}toString(){return this.message}}function ei(t,e,r){if(t.code==="invalid_union")return t.unionErrors.reduce((a,s)=>{const i=s.issues.map(o=>ei(o,e,r)).join(e);return a.includes(i)||a.push(i),a},[]).join(r);if(il(t.path)){if(t.path.length===1){const a=t.path[0];if(typeof a=="number")return`${t.message} at index ${a}`}return`${t.message} at "${al(t.path)}"`}return t.message}function fl(t,e,r){return e!==null?t.length>0?[e,t].join(r):e:t.length>0?t:Qs}function hl(t,e={}){const{maxIssuesInMessage:r=ol,issueSeparator:a=cl,unionSeparator:s=ul,prefixSeparator:i=ll,prefix:o=Qs}=e,c=t.errors.slice(0,r).map(l=>ei(l,a,s)).join(a),u=fl(c,o,i);return new dl(u,t.errors)}const ti={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!0};function ri(t,e){const r={...ti,...t};if(e>=r.maxAttempts)return;const{factor:a,minTimeoutInMs:s,maxTimeoutInMs:i,randomize:o}=r,c=o?Math.random()+1:1,u=Math.min(i,c*s*Math.pow(a,e-1));return Math.round(u)}class G extends Error{constructor(r,a,s,i){super(`${G.makeMessage(r,a,s)}`);E(this,"status");E(this,"headers");E(this,"error");E(this,"code");E(this,"param");E(this,"type");this.name="TriggerApiError",this.status=r,this.headers=i;const o=a;this.error=o,this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(r,a,s){const i=a!=null&&a.message?typeof a.message=="string"?a.message:JSON.stringify(a.message):a?JSON.stringify(a):s;return r&&i?`${r} ${i}`:r?`${r} status code (no body)`:i||"(no status code or body)"}static generate(r,a,s,i){if(!r)return new ni({cause:Rl(a)});const o=a==null?void 0:a.error;return r===400?new pl(r,o,s,i):r===401?new gl(r,o,s,i):r===403?new ml(r,o,s,i):r===404?new yl(r,o,s,i):r===409?new _l(r,o,s,i):r===422?new vl(r,o,s,i):r===429?new bl(r,o,s,i):r>=500?new El(r,o,s,i):new G(r,o,s,i)}}class ni extends G{constructor({message:r,cause:a}){super(void 0,void 0,r||"Connection error.",void 0);E(this,"status");a&&(this.cause=a)}}class pl extends G{constructor(){super(...arguments);E(this,"status",400)}}class gl extends G{constructor(){super(...arguments);E(this,"status",401)}}class ml extends G{constructor(){super(...arguments);E(this,"status",403)}}class yl extends G{constructor(){super(...arguments);E(this,"status",404)}}class _l extends G{constructor(){super(...arguments);E(this,"status",409)}}class vl extends G{constructor(){super(...arguments);E(this,"status",422)}}class bl extends G{constructor(){super(...arguments);E(this,"status",429)}get millisecondsUntilReset(){const r=(this.headers??{})["x-ratelimit-reset"];if(typeof r=="string"){const a=parseInt(r,10);return isNaN(a)?void 0:Math.max(a-Date.now()+Math.floor(Math.random()*2e3),0)}}}class El extends G{}class Tl extends G{constructor({message:r,cause:a,status:s,rawBody:i,headers:o}){super(s,void 0,r||"Validation error.",o);E(this,"status",200);E(this,"rawBody");a&&(this.cause=a),this.rawBody=i}}function Rl(t){return t instanceof Error?t:new Error(t)}var wl=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},He="1.9.0",ai=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Sl(t){var e=new Set([t]),r=new Set,a=t.match(ai);if(!a)return function(){return!1};var s={major:+a[1],minor:+a[2],patch:+a[3],prerelease:a[4]};if(s.prerelease!=null)return function(u){return u===t};function i(c){return r.add(c),!1}function o(c){return e.add(c),!0}return function(u){if(e.has(u))return!0;if(r.has(u))return!1;var l=u.match(ai);if(!l)return i(u);var d={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return d.prerelease!=null||s.major!==d.major?i(u):s.major===0?s.minor===d.minor&&s.patch<=d.patch?o(u):i(u):s.minor<=d.minor?o(u):i(u)}}var Al=Sl(He),Il=He.split(".")[0],Xt=Symbol.for("opentelemetry.js.api."+Il),Qt=wl;function er(t,e,r,a){var s;a===void 0&&(a=!1);var i=Qt[Xt]=(s=Qt[Xt])!==null&&s!==void 0?s:{version:He};if(!a&&i[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(o.stack||o.message),!1}if(i.version!==He){var o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+t+" does not match previously registered API v"+He);return r.error(o.stack||o.message),!1}return i[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+He+"."),!0}function Ze(t){var e,r,a=(e=Qt[Xt])===null||e===void 0?void 0:e.version;if(!(!a||!Al(a)))return(r=Qt[Xt])===null||r===void 0?void 0:r[t]}function tr(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+He+".");var r=Qt[Xt];r&&delete r[t]}var kl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var a=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)i.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},xl=function(t,e,r){if(r||arguments.length===2)for(var a=0,s=e.length,i;a<s;a++)(i||!(a in e))&&(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))},Ol=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return rr("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return rr("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return rr("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return rr("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return rr("verbose",this._namespace,e)},t}();function rr(t,e,r){var a=Ze("diag");if(a)return r.unshift(e),a[t].apply(a,xl([],kl(r),!1))}var Q;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(Q||(Q={}));function Pl(t,e){t<Q.NONE?t=Q.NONE:t>Q.ALL&&(t=Q.ALL),e=e||{};function r(a,s){var i=e[a];return typeof i=="function"&&t>=s?i.bind(e):function(){}}return{error:r("error",Q.ERROR),warn:r("warn",Q.WARN),info:r("info",Q.INFO),debug:r("debug",Q.DEBUG),verbose:r("verbose",Q.VERBOSE)}}var Nl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var a=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)i.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},Cl=function(t,e,r){if(r||arguments.length===2)for(var a=0,s=e.length,i;a<s;a++)(i||!(a in e))&&(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))},jl="diag",le=function(){function t(){function e(s){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var c=Ze("diag");if(c)return c[s].apply(c,Cl([],Nl(i),!1))}}var r=this,a=function(s,i){var o,c,u;if(i===void 0&&(i={logLevel:Q.INFO}),s===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof i=="number"&&(i={logLevel:i});var d=Ze("diag"),y=Pl((c=i.logLevel)!==null&&c!==void 0?c:Q.INFO,s);if(d&&!i.suppressOverrideMessage){var g=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+g),y.warn("Current logger will overwrite one already registered from "+g)}return er("diag",y,r,!0)};r.setLogger=a,r.disable=function(){tr(jl,r)},r.createComponentLogger=function(s){return new Ol(s)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),Ml=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var a=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)i.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},Ul=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],a=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dl=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var r=this._entries.get(e);if(r)return Object.assign({},r)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var r=Ml(e,2),a=r[0],s=r[1];return[a,s]})},t.prototype.setEntry=function(e,r){var a=new t(this._entries);return a._entries.set(e,r),a},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,a=[],s=0;s<arguments.length;s++)a[s]=arguments[s];var i=new t(this._entries);try{for(var o=Ul(a),c=o.next();!c.done;c=o.next()){var u=c.value;i._entries.delete(u)}}catch(l){e={error:l}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},t.prototype.clear=function(){return new t},t}();le.instance();function $l(t){return t===void 0&&(t={}),new Dl(new Map(Object.entries(t)))}function si(t){return Symbol.for(t)}var Ll=function(){function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(a){return r._currentContext.get(a)},r.setValue=function(a,s){var i=new t(r._currentContext);return i._currentContext.set(a,s),i},r.deleteValue=function(a){var s=new t(r._currentContext);return s._currentContext.delete(a),s}}return t}(),Kl=new Ll,Je=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,s){a.__proto__=s}||function(a,s){for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(a[i]=s[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function a(){this.constructor=e}e.prototype=r===null?Object.create(r):(a.prototype=r.prototype,new a)}}(),Wl=function(){function t(){}return t.prototype.createGauge=function(e,r){return ql},t.prototype.createHistogram=function(e,r){return Xl},t.prototype.createCounter=function(e,r){return Yl},t.prototype.createUpDownCounter=function(e,r){return Ql},t.prototype.createObservableGauge=function(e,r){return td},t.prototype.createObservableCounter=function(e,r){return ed},t.prototype.createObservableUpDownCounter=function(e,r){return rd},t.prototype.addBatchObservableCallback=function(e,r){},t.prototype.removeBatchObservableCallback=function(e){},t}(),Zr=function(){function t(){}return t}(),Bl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,a){},e}(Zr),Fl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,a){},e}(Zr),Vl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,a){},e}(Zr),Gl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,a){},e}(Zr),qn=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),Hl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(qn),Zl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(qn),Jl=function(t){Je(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(qn),zl=new Wl,Yl=new Bl,ql=new Vl,Xl=new Gl,Ql=new Fl,ed=new Hl,td=new Zl,rd=new Jl,nd={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},ad={set:function(t,e,r){t!=null&&(t[e]=r)}},sd=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var a=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)i.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},id=function(t,e,r){if(r||arguments.length===2)for(var a=0,s=e.length,i;a<s;a++)(i||!(a in e))&&(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))},od=function(){function t(){}return t.prototype.active=function(){return Kl},t.prototype.with=function(e,r,a){for(var s=[],i=3;i<arguments.length;i++)s[i-3]=arguments[i];return r.call.apply(r,id([a],sd(s),!1))},t.prototype.bind=function(e,r){return r},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),cd=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var a=r.call(t),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=a.next()).done;)i.push(s.value)}catch(c){o={error:c}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i},ud=function(t,e,r){if(r||arguments.length===2)for(var a=0,s=e.length,i;a<s;a++)(i||!(a in e))&&(i||(i=Array.prototype.slice.call(e,0,a)),i[a]=e[a]);return t.concat(i||Array.prototype.slice.call(e))},Xn="context",ld=new od,Jr=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return er(Xn,e,le.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,r,a){for(var s,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(s=this._getContextManager()).with.apply(s,ud([e,r,a],cd(i),!1))},t.prototype.bind=function(e,r){return this._getContextManager().bind(e,r)},t.prototype._getContextManager=function(){return Ze(Xn)||ld},t.prototype.disable=function(){this._getContextManager().disable(),tr(Xn,le.instance())},t}(),Qn;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(Qn||(Qn={}));var ii="0000000000000000",oi="00000000000000000000000000000000",dd={traceId:oi,spanId:ii,traceFlags:Qn.NONE},nr=function(){function t(e){e===void 0&&(e=dd),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,r){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,r){},t}(),ea=si("OpenTelemetry Context Key SPAN");function ta(t){return t.getValue(ea)||void 0}function fd(){return ta(Jr.getInstance().active())}function ra(t,e){return t.setValue(ea,e)}function hd(t){return t.deleteValue(ea)}function pd(t,e){return ra(t,new nr(e))}function ci(t){var e;return(e=ta(t))===null||e===void 0?void 0:e.spanContext()}var gd=/^([0-9a-f]{32})$/i,md=/^[0-9a-f]{16}$/i;function yd(t){return gd.test(t)&&t!==oi}function _d(t){return md.test(t)&&t!==ii}function ui(t){return yd(t.traceId)&&_d(t.spanId)}function vd(t){return new nr(t)}var na=Jr.getInstance(),li=function(){function t(){}return t.prototype.startSpan=function(e,r,a){a===void 0&&(a=na.active());var s=!!(r!=null&&r.root);if(s)return new nr;var i=a&&ci(a);return bd(i)&&ui(i)?new nr(i):new nr},t.prototype.startActiveSpan=function(e,r,a,s){var i,o,c;if(!(arguments.length<2)){arguments.length===2?c=r:arguments.length===3?(i=r,c=a):(i=r,o=a,c=s);var u=o??na.active(),l=this.startSpan(e,i,u),d=ra(u,l);return na.with(d,c,void 0,l)}},t}();function bd(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var Ed=new li,Td=function(){function t(e,r,a,s){this._provider=e,this.name=r,this.version=a,this.options=s}return t.prototype.startSpan=function(e,r,a){return this._getTracer().startSpan(e,r,a)},t.prototype.startActiveSpan=function(e,r,a,s){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Ed},t}(),Rd=function(){function t(){}return t.prototype.getTracer=function(e,r,a){return new li},t}(),wd=new Rd,di=function(){function t(){}return t.prototype.getTracer=function(e,r,a){var s;return(s=this.getDelegateTracer(e,r,a))!==null&&s!==void 0?s:new Td(this,e,r,a)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:wd},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,r,a){var s;return(s=this._delegate)===null||s===void 0?void 0:s.getTracer(e,r,a)},t}(),ar;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(ar||(ar={}));var zr;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(zr||(zr={}));var Yr=Jr.getInstance();le.instance();var Sd=function(){function t(){}return t.prototype.getMeter=function(e,r,a){return zl},t}(),Ad=new Sd,aa="metrics",Id=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return er(aa,e,le.instance())},t.prototype.getMeterProvider=function(){return Ze(aa)||Ad},t.prototype.getMeter=function(e,r,a){return this.getMeterProvider().getMeter(e,r,a)},t.prototype.disable=function(){tr(aa,le.instance())},t}();Id.getInstance();var kd=function(){function t(){}return t.prototype.inject=function(e,r){},t.prototype.extract=function(e,r){return e},t.prototype.fields=function(){return[]},t}(),sa=si("OpenTelemetry Baggage Key");function fi(t){return t.getValue(sa)||void 0}function xd(){return fi(Jr.getInstance().active())}function Od(t,e){return t.setValue(sa,e)}function Pd(t){return t.deleteValue(sa)}var ia="propagation",Nd=new kd,Cd=function(){function t(){this.createBaggage=$l,this.getBaggage=fi,this.getActiveBaggage=xd,this.setBaggage=Od,this.deleteBaggage=Pd}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return er(ia,e,le.instance())},t.prototype.inject=function(e,r,a){return a===void 0&&(a=ad),this._getGlobalPropagator().inject(e,r,a)},t.prototype.extract=function(e,r,a){return a===void 0&&(a=nd),this._getGlobalPropagator().extract(e,r,a)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){tr(ia,le.instance())},t.prototype._getGlobalPropagator=function(){return Ze(ia)||Nd},t}(),hi=Cd.getInstance(),oa="trace",jd=function(){function t(){this._proxyTracerProvider=new di,this.wrapSpanContext=vd,this.isSpanContextValid=ui,this.deleteSpan=hd,this.getSpan=ta,this.getActiveSpan=fd,this.getSpanContext=ci,this.setSpan=ra,this.setSpanContext=pd}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var r=er(oa,this._proxyTracerProvider,le.instance());return r&&this._proxyTracerProvider.setDelegate(e),r},t.prototype.getTracerProvider=function(){return Ze(oa)||this._proxyTracerProvider},t.prototype.getTracer=function(e,r){return this.getTracerProvider().getTracer(e,r)},t.prototype.disable=function(){tr(oa,le.instance()),this._proxyTracerProvider=new di},t}(),Md=jd.getInstance();const ca="$@null((",Ud="$@circular((";function ua(t,e,r=new WeakSet){const a={};if(t===void 0)return a;if(t===null)return a[e||""]=ca,a;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return a[e||""]=t,a;if(t instanceof Date)return a[e||""]=t.toISOString(),a;if(t!==null&&typeof t=="object"&&r.has(t))return a[e||""]=Ud,a;t!==null&&typeof t=="object"&&r.add(t);for(const[s,i]of Object.entries(t)){const o=`${e?`${e}.`:""}${Array.isArray(t)?`[${s}]`:s}`;if(Array.isArray(i))for(let c=0;c<i.length;c++)typeof i[c]=="object"&&i[c]!==null?Object.assign(a,ua(i[c],`${o}.[${c}]`,r)):i[c]===null?a[`${o}.[${c}]`]=ca:a[`${o}.[${c}]`]=i[c];else Dd(i)?Object.assign(a,ua(i,o,r)):typeof i=="number"||typeof i=="string"||typeof i=="boolean"?a[o]=i:i===null&&(a[o]=ca)}return a}function Dd(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function qr(t){return ua(t,x.STYLE_ACCESSORY)}class $d{constructor(e,r,a){E(this,"pageFetcher");E(this,"data");E(this,"pagination");this.pageFetcher=a,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return!!this.pagination.next}hasPreviousPage(){return!!this.pagination.previous}getNextPage(){if(!this.pagination.next)throw new Error("No next page available");return this.pageFetcher({after:this.pagination.next})}getPreviousPage(){if(!this.pagination.previous)throw new Error("No previous page available");return this.pageFetcher({before:this.pagination.previous})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class Ld{constructor(e,r,a){E(this,"pageFetcher");E(this,"data");E(this,"pagination");this.pageFetcher=a,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.pagination.currentPage<this.pagination.totalPages}hasPreviousPage(){return this.pagination.currentPage>1}getNextPage(){if(!this.hasNextPage())throw new Error("No next page available");return this.pageFetcher({page:this.pagination.currentPage+1})}getPreviousPage(){if(!this.hasPreviousPage())throw new Error("No previous page available");return this.pageFetcher({page:this.pagination.currentPage-1})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}var Kd=Object.defineProperty,Wd=(t,e,r)=>e in t?Kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xr=(t,e,r)=>Wd(t,typeof e!="symbol"?e+"":e,r);class pi extends Error{constructor(e,r){super(e),Xr(this,"type"),Xr(this,"field"),Xr(this,"value"),Xr(this,"line"),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function la(t){}function Bd(t){const{onEvent:e=la,onError:r=la,onRetry:a=la,onComment:s}=t;let i="",o=!0,c,u="",l="";function d(b){const A=o?b.replace(/^\xEF\xBB\xBF/,""):b,[K,ee]=Fd(`${i}${A}`);for(const Re of K)y(Re);i=ee,o=!1}function y(b){if(b===""){f();return}if(b.startsWith(":")){s&&s(b.slice(b.startsWith(": ")?2:1));return}const A=b.indexOf(":");if(A!==-1){const K=b.slice(0,A),ee=b[A+1]===" "?2:1,Re=b.slice(A+ee);g(K,Re,b);return}g(b,"",b)}function g(b,A,K){switch(b){case"event":l=A;break;case"data":u=`${u}${A}
`;break;case"id":c=A.includes("\0")?void 0:A;break;case"retry":/^\d+$/.test(A)?a(parseInt(A,10)):r(new pi(`Invalid \`retry\` value: "${A}"`,{type:"invalid-retry",value:A,line:K}));break;default:r(new pi(`Unknown field "${b.length>20?`${b.slice(0,20)}`:b}"`,{type:"unknown-field",field:b,value:A,line:K}));break}}function f(){u.length>0&&e({id:c,event:l||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),c=void 0,u="",l=""}function h(b={}){i&&b.consume&&y(i),c=void 0,u="",l="",i=""}return{feed:d,reset:h}}function Fd(t){const e=[];let r="";const a=t.length;for(let s=0;s<a;s++){const i=t[s];i==="\r"&&t[s+1]===`
`?(e.push(r),r="",s++):i==="\r"||i===`
`?(e.push(r),r=""):r+=i}return[e,r]}const gi={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!1};function D(t,e,r,a){return new pa(fa(t,e,r,a))}function da(t,e,r,a,s){const i=new URLSearchParams(r.query);r.limit&&i.set("page[size]",String(r.limit)),r.after&&i.set("page[after]",r.after),r.before&&i.set("page[before]",r.before);const o=n.object({data:n.array(t),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),c=new URL(e);c.search=i.toString();const u=fa(o,c.href,a,s);return new Yd(u,t,e,r,a,s)}function mi(t,e,r,a,s){const i=new URLSearchParams(r.query);r.limit&&i.set("perPage",String(r.limit)),r.page&&i.set("page",String(r.page));const o=n.object({data:n.array(t),pagination:n.object({currentPage:n.coerce.number(),totalPages:n.coerce.number(),count:n.coerce.number()})}),c=new URL(e);c.search=i.toString();const u=fa(o,c.href,a,s);return new qd(u,t,e,r,a,s)}async function Vd(t,e){var i,o,c;if(!((i=t.options)!=null&&i.tracer))return e();const r=new URL(t.url),a=((o=t.requestInit)==null?void 0:o.method)??"GET",s=t.options.name??`${a} ${r.pathname}`;return await t.options.tracer.startActiveSpan(s,async u=>await e(u),{attributes:{[x.STYLE_ICON]:((c=t.options)==null?void 0:c.icon)??"api",...t.options.attributes}})}async function fa(t,e,r,a){let s=await r;return Vd({url:e,requestInit:s,options:a},async i=>{s=Xd(s);const o=await ha(t,e,s,a);return a!=null&&a.onResponseBody&&i&&a.onResponseBody(o.data,i),a!=null&&a.prepareData&&(o.data=await a.prepareData(o.data)),o})}async function ha(t,e,r,a,s=1){try{const i=await fetch(e,zd(r)),o=Jd(i.headers);if(!i.ok){const d=Hd(i,s,a==null?void 0:a.retry);if(d.retry)return await _i(e,s+1,d.delay,a,r,i),await ha(t,e,r,a,s+1);{const y=await i.text().catch(h=>yi(h).message),g=Zd(y),f=g?void 0:y;throw G.generate(i.status,g,f,o)}}const c=await Gd(i),u=t.safeParse(c);if(u.success)return{data:u.data,response:i};const l=hl(u.error);throw new Tl({status:i.status,cause:l,message:l.message,rawBody:c,headers:o})}catch(i){if(i instanceof G)throw i;if(a!=null&&a.retry){const o={...gi,...a.retry},c=ri(o,s);if(c)return await _i(e,s+1,c,a,r),await ha(t,e,r,a,s+1)}throw new ni({cause:yi(i)})}}async function Gd(t){try{return await t.clone().json()}catch{return}}function yi(t){return t instanceof Error?t:new Error(t)}function Hd(t,e,r){function a(){const i={...gi,...r},o=ri(i,e);return o?{retry:!0,delay:o}:{retry:!1}}const s=t.headers.get("x-should-retry");if(s==="true")return a();if(s==="false")return{retry:!1};if(t.status===408||t.status===409)return a();if(t.status===429){if(e>=(typeof(r==null?void 0:r.maxAttempts)=="number"?r==null?void 0:r.maxAttempts:3))return{retry:!1};const i=t.headers.get("x-ratelimit-reset");if(i){const c=parseInt(i,10)-Date.now()+Math.floor(Math.random()*1e3);if(c>0)return{retry:!0,delay:c}}return a()}return t.status>=500?a():{retry:!1}}function Zd(t){try{return JSON.parse(t)}catch{return}}function Jd(t){return new Proxy(Object.fromEntries(t.entries()),{get(e,r){const a=r.toString();return e[a.toLowerCase()]||e[a]}})}function zd(t){try{const e={...t,cache:"no-cache"},r=new Request("http://localhost",e);return e}catch{return t??{}}}class pa extends Promise{constructor(r){super(a=>{a(null)});E(this,"responsePromise");this.responsePromise=r}asResponse(){return this.responsePromise.then(r=>r.response)}async withResponse(){const[r,a]=await Promise.all([this.parse(),this.asResponse()]);return{data:r,response:a}}parse(){return this.responsePromise.then(r=>r.data)}then(r,a){return this.parse().then(r,a)}catch(r){return this.parse().catch(r)}finally(r){return this.parse().finally(r)}}class Yd extends pa{constructor(r,a,s,i,o,c){super(r.then(u=>({data:new $d(u.data.data,u.data.pagination,m(this,En,Fo).bind(this)),response:u.response})));V(this,En);E(this,"schema");E(this,"url");E(this,"params");E(this,"requestInit");E(this,"options");this.schema=a,this.url=s,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const a of r)yield a}}En=new WeakSet,Fo=function(r){return da(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};class qd extends pa{constructor(r,a,s,i,o,c){super(r.then(u=>({data:new Ld(u.data.data,u.data.pagination,m(this,Tn,Vo).bind(this)),response:u.response})));V(this,Tn);E(this,"schema");E(this,"url");E(this,"params");E(this,"requestInit");E(this,"options");this.schema=a,this.url=s,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const a of r)yield a}}Tn=new WeakSet,Vo=function(r){return mi(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};async function _i(t,e,r,a,s,i){if(a!=null&&a.tracer){const o=(s==null?void 0:s.method)??"GET";return a.tracer.startActiveSpan(i?`wait after ${i.status}`:"wait after error",async c=>{await new Promise(u=>setTimeout(u,r))},{attributes:{[x.STYLE_ICON]:"wait",...qr({items:[{text:`retrying ${(a==null?void 0:a.name)??o.toUpperCase()} in ${r}ms`,variant:"normal"}],style:"codepath"})}})}await new Promise(o=>setTimeout(o,r))}function Xd(t){const e=new Headers(t==null?void 0:t.headers);if(e.get("x-trigger-worker")!=="true")return t;const r=Object.fromEntries(e.entries());return hi.inject(Yr.active(),r),{...t,headers:new Headers(r)}}class Qd extends TransformStream{constructor({onError:e,onRetry:r,onComment:a}={}){let s;super({start(i){s=Bd({onEvent:o=>{i.enqueue(o)},onError(o){e==="terminate"?i.error(o):typeof e=="function"&&e(o)},onRetry:r,onComment:a})},transform(i){s.feed(i)}})}}const ft={docs:{machines:{home:"https://trigger.dev/docs/v3/machines"},upgrade:{beta:"https://trigger.dev/docs/upgrading-beta"},troubleshooting:{concurrentWaits:"https://trigger.dev/docs/troubleshooting#parallel-waits-are-not-supported"}},site:{contact:"https://trigger.dev/contact"}};function ef(t){switch(t.type){case"BUILT_IN_ERROR":{const e=new Error(t.message);return e.name=t.name,e.stack=t.stackTrace,e}case"STRING_ERROR":return t.raw;case"CUSTOM_ERROR":return JSON.parse(t.raw);case"INTERNAL_ERROR":{const e=new Error(t.message??`Internal error (${t.code})`);return e.name=t.code,e.stack=t.stackTrace,e}}}function tf(t){const e=nf(t);switch(e.type){case"BUILT_IN_ERROR":return{name:e.name,message:e.message,stackTrace:e.stackTrace};case"STRING_ERROR":return{message:e.raw};case"CUSTOM_ERROR":return{message:e.raw};case"INTERNAL_ERROR":return{message:`trigger.dev internal error (${e.code})`}}}const rf={TASK_PROCESS_OOM_KILLED:{message:"Your task ran out of memory. Try increasing the machine specs. If this doesn't fix it there might be a memory leak.",link:{name:"Machines",href:ft.docs.machines.home}},TASK_PROCESS_MAYBE_OOM_KILLED:{message:"We think your task ran out of memory, but we can't be certain. If this keeps happening, try increasing the machine specs.",link:{name:"Machines",href:ft.docs.machines.home}},TASK_PROCESS_SIGSEGV:{message:"Your task crashed with a segmentation fault (SIGSEGV). Most likely there's a bug in a package or binary you're using. If this keeps happening and you're unsure why, please get in touch.",link:{name:"Contact us",href:ft.site.contact,magic:"CONTACT_FORM"}},TASK_PROCESS_SIGTERM:{message:"Your task exited after receiving SIGTERM but we don't know why. If this keeps happening, please get in touch so we can investigate.",link:{name:"Contact us",href:ft.site.contact,magic:"CONTACT_FORM"}},OUTDATED_SDK_VERSION:{message:"Your task is using an outdated version of the SDK. Please upgrade to the latest version.",link:{name:"Beta upgrade guide",href:ft.docs.upgrade.beta}},TASK_DID_CONCURRENT_WAIT:{message:"Parallel waits are not supported, e.g. using Promise.all() around our wait functions.",link:{name:"Read the docs for solutions",href:ft.docs.troubleshooting.concurrentWaits}}},de=t=>({type:"INTERNAL_ERROR",code:t,...rf[t]}),vi=(t,e=100)=>{if(!t)return;const r=e?t.slice(0,e):t;return r.includes("SIGTERM")?"SIGTERM":r.includes("SIGSEGV")?"SIGSEGV":r.includes("SIGKILL")?"SIGKILL":void 0};function nf(t){switch(t.type){case"BUILT_IN_ERROR":{if(t.name==="UnexpectedExitError"&&t.message.startsWith("Unexpected exit with code -1"))switch(vi(t.stackTrace)){case"SIGTERM":return{...de("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...de("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...de("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...de("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}if(t.name==="Error"&&t.message==="ffmpeg was killed with signal SIGKILL")return{...de("TASK_PROCESS_OOM_KILLED")};break}case"STRING_ERROR":break;case"CUSTOM_ERROR":break;case"INTERNAL_ERROR":{if(t.code===Ts.TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE)switch(vi(t.message)){case"SIGTERM":return{...de("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...de("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...de("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...de("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}return{...t,...de(t.code)}}}return t}function sr(t,e){return typeof process<"u"&&typeof process.env=="object"&&process.env!==null?process.env[t]??e:e}const ir="api-client";class af extends Error{constructor(e){super(e),this.name="ApiClientMissingError"}}const Rn=class Rn{constructor(){V(this,It)}static getInstance(){return this._instance||(this._instance=new Rn),this._instance}disable(){Ge(ir)}get baseURL(){const e=m(this,It,Cn).call(this);return(e==null?void 0:e.baseURL)??sr("TRIGGER_API_URL")??"https://api.trigger.dev"}get accessToken(){const e=m(this,It,Cn).call(this);return(e==null?void 0:e.secretKey)??(e==null?void 0:e.accessToken)??sr("TRIGGER_SECRET_KEY")??sr("TRIGGER_ACCESS_TOKEN")}get client(){if(!(!this.baseURL||!this.accessToken))return new Wi(this.baseURL,this.accessToken)}clientOrThrow(){if(!this.baseURL||!this.accessToken)throw new af(this.apiClientMissingError());return new Wi(this.baseURL,this.accessToken)}runWithConfig(e,r){const a=m(this,It,Cn).call(this),s={...a,...e};return ie(ir,s,!0),r().finally(()=>{ie(ir,a,!0)})}setGlobalAPIClientConfiguration(e){return ie(ir,e)}apiClientMissingError(){const e=!!this.baseURL,r=!!this.accessToken;if(!e&&!r)return"You need to set the TRIGGER_API_URL and TRIGGER_SECRET_KEY environment variables. See https://trigger.dev/docs/management/overview#authentication";if(e){if(!r)return"You need to set the TRIGGER_SECRET_KEY environment variable. See https://trigger.dev/docs/management/overview#authentication"}else return"You need to set the TRIGGER_API_URL environment variable. See https://trigger.dev/docs/management/overview#authentication";return"Unknown error"}};It=new WeakSet,Cn=function(){return _e(ir)},E(Rn,"_instance");let ga=Rn;const or=ga.getInstance();async function ma(t,e){if(t.data)switch(t.dataType){case"application/json":return JSON.parse(t.data,void 0);case"application/super+json":const{parse:r}=await Ti();return r(t.data);case"text/plain":return t.data;case"application/store":throw new Error(`Cannot parse an application/store packet (${t.data}). Needs to be imported first.`);default:return t.data}}async function sf(t,e){const r=await bi(t,void 0,e);return await ma(r)}async function Qr(t){if(t===void 0)return{dataType:"application/json"};if(typeof t=="string")return{data:t,dataType:"text/plain"};try{const{stringify:e}=await Ti();return{data:e(t),dataType:"application/super+json"}}catch{return{data:t,dataType:"application/json"}}}const of={minTimeoutInMs:500,maxTimeoutInMs:5e3,maxAttempts:5,factor:2,randomize:!0};async function bi(t,e,r){return t.dataType!=="application/store"?t:e?await e.startActiveSpan("store.downloadPayload",async s=>await Ei(t,s,r),{attributes:{[x.STYLE_ICON]:"cloud-download"}})??t:await Ei(t,void 0,r)}async function Ei(t,e,r){if(!t.data)return t;const a=r??or.client;if(!a)return t;const s=await a.getPayloadUrl(t.data),i=await D(n.any(),s.presignedUrl,void 0,{retry:of}).asResponse();if(!i.ok)throw new Error(`Failed to import packet ${s.presignedUrl}: ${i.statusText}`);const o=await i.text();return e==null||e.setAttribute("size",Buffer.byteLength(o,"utf8")),{data:o,dataType:i.headers.get("content-type")??"application/json"}}function $g(t){}async function Ti(){const t=await Promise.resolve().then(()=>kg);return t.registerCustom({isApplicable:e=>typeof Buffer=="function"&&Buffer.isBuffer(e),serialize:e=>[...e],deserialize:e=>Buffer.from(e)},"buffer"),t}var cf=Object.defineProperty,uf=Object.defineProperties,lf=Object.getOwnPropertyDescriptors,en=Object.getOwnPropertySymbols,Ri=Object.prototype.hasOwnProperty,wi=Object.prototype.propertyIsEnumerable,Si=t=>{throw TypeError(t)},Ai=(t,e,r)=>e in t?cf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ht=(t,e)=>{for(var r in e||(e={}))Ri.call(e,r)&&Ai(t,r,e[r]);if(en)for(var r of en(e))wi.call(e,r)&&Ai(t,r,e[r]);return t},Ii=(t,e)=>uf(t,lf(e)),df=(t,e)=>{var r={};for(var a in t)Ri.call(t,a)&&e.indexOf(a)<0&&(r[a]=t[a]);if(t!=null&&en)for(var a of en(t))e.indexOf(a)<0&&wi.call(t,a)&&(r[a]=t[a]);return r},ya=(t,e,r)=>e.has(t)||Si("Cannot "+r),O=(t,e,r)=>(ya(t,e,"read from private field"),r?r.call(t):e.get(t)),B=(t,e,r)=>e.has(t)?Si("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),U=(t,e,r,a)=>(ya(t,e,"write to private field"),e.set(t,r),r),fe=(t,e,r)=>(ya(t,e,"access private method"),r),ze=(t,e,r)=>new Promise((a,s)=>{var i=u=>{try{c(r.next(u))}catch(l){s(l)}},o=u=>{try{c(r.throw(u))}catch(l){s(l)}},c=u=>u.done?a(u.value):Promise.resolve(u.value).then(i,o);c((r=r.apply(t,e)).next())}),tn=class Go extends Error{constructor(e,r,a,s,i,o){super(o||`HTTP Error ${e} at ${i}: ${r??JSON.stringify(a)}`),this.url=i,this.name="FetchError",this.status=e,this.text=r,this.json=a,this.headers=s}static fromResponse(e,r){return ze(this,null,function*(){const a=e.status,s=Object.fromEntries([...e.headers.entries()]);let i,o;const c=e.headers.get("content-type");return c&&c.includes("application/json")?o=yield e.json():i=yield e.text(),new Go(a,i,o,s,r)})}},ki=class extends Error{constructor(){super("Fetch with backoff aborted"),this.name="FetchBackoffAbortError"}},ff=class extends Error{constructor(){super("Invalid shape options: missing required url parameter"),this.name="MissingShapeUrlError"}},hf=class extends Error{constructor(){super("Invalid signal option. It must be an instance of AbortSignal."),this.name="InvalidSignalError"}},pf=class extends Error{constructor(){super("shapeHandle is required if this isn't an initial fetch (i.e. offset > -1)"),this.name="MissingShapeHandleError"}},gf=class extends Error{constructor(t){super(`Cannot use reserved Electric parameter names in custom params: ${t.join(", ")}`),this.name="ReservedParamError"}},mf=class extends Error{constructor(t){super(`Column "${t??"unknown"}" does not allow NULL values`),this.name="ParserNullValueError"}},yf=class extends Error{constructor(t,e){let r=`The response for the shape request to ${t} didn't include the following required headers:
`;e.forEach(a=>{r+=`- ${a}
`}),r+=`
This is often due to a proxy not setting CORS correctly so that all Electric headers can be read by the client.`,r+=`
For more information visit the troubleshooting guide: /docs/guides/troubleshooting/missing-headers`,super(r)}},rn=t=>Number(t),_f=t=>t==="true"||t==="t",vf=t=>BigInt(t),xi=t=>JSON.parse(t),bf=t=>t,Ef={int2:rn,int4:rn,int8:vf,bool:_f,float4:rn,float8:rn,json:xi,jsonb:xi};function Tf(t,e){let r=0,a=null,s="",i=!1,o=0,c;function u(l){const d=[];for(;r<l.length;r++){if(a=l[r],i)a==="\\"?s+=l[++r]:a==='"'?(d.push(e?e(s):s),s="",i=l[r+1]==='"',o=r+2):s+=a;else if(a==='"')i=!0;else if(a==="{")o=++r,d.push(u(l));else if(a==="}"){i=!1,o<r&&d.push(e?e(l.slice(o,r)):l.slice(o,r)),o=r+1;break}else a===","&&c!=="}"&&c!=='"'&&(d.push(e?e(l.slice(o,r)):l.slice(o,r)),o=r+1);c=a}return o<r&&d.push(e?e(l.slice(o,r+1)):l.slice(o,r+1)),d}return u(t)[0]}var Rf=class{constructor(t){this.parser=ht(ht({},Ef),t)}parse(t,e){return JSON.parse(t,(r,a)=>{if(r==="value"&&typeof a=="object"&&a!==null){const s=a;Object.keys(s).forEach(i=>{s[i]=this.parseRow(i,s[i],e)})}return a})}parseRow(t,e,r){var a;const s=r[t];if(!s)return e;const i=s,{type:o,dims:c}=i,u=df(i,["type","dims"]),l=(a=this.parser[o])!=null?a:bf,d=Oi(l,s,t);return c&&c>0?Oi((g,f)=>Tf(g,d),s,t)(e):d(e,u)}};function Oi(t,e,r){var a;const s=!((a=e.not_null)!=null&&a);return i=>{if(wf(i)){if(!s)throw new mf(r??"unknown");return null}return t(i,e)}}function wf(t){return t===null||t==="NULL"}function Pi(t){return"key"in t}function Ni(t){return!Pi(t)}function Sf(t){return Ni(t)&&t.headers.control==="up-to-date"}var Af="electric-cursor",_a="electric-handle",Ci="electric-offset",If="electric-schema",kf="electric-up-to-date",xf="columns",ji="cursor",va="handle",pt="live",ba="offset",Of="table",Pf="where",Nf="replica",Cf=[429],Mi={initialDelay:100,maxDelay:1e4,multiplier:1.3};function jf(t,e=Mi){const{initialDelay:r,maxDelay:a,multiplier:s,debug:i=!1,onFailedAttempt:o}=e;return(...c)=>ze(this,null,function*(){var u;const l=c[0],d=c[1];let y=r,g=0;for(;;)try{const f=yield t(...c);if(f.ok)return f;throw yield tn.fromResponse(f,l.toString())}catch(f){if(o==null||o(),(u=d==null?void 0:d.signal)!=null&&u.aborted)throw new ki;if(f instanceof tn&&!Cf.includes(f.status)&&f.status>=400&&f.status<500)throw f;yield new Promise(h=>setTimeout(h,y)),y=Math.min(y*s,a),i&&(g++,console.log(`Retry attempt #${g} after ${y}ms`))}})}var Mf={maxChunksToPrefetch:2};function Uf(t,e=Mf){const{maxChunksToPrefetch:r}=e;let a;return(...i)=>ze(this,null,function*(){const o=i[0].toString(),c=a==null?void 0:a.consume(...i);if(c)return c;a==null||a.abort();const u=yield t(...i),l=Ea(o,u);return l&&(a=new Wf({fetchClient:t,maxPrefetchedRequests:r,url:l,requestInit:i[1]})),u})}var Df=["electric-offset","electric-handle"],$f=["electric-cursor"],Lf=["electric-schema"];function Kf(t){return(...e)=>ze(this,null,function*(){const r=yield t(...e);if(r.ok){const a=r.headers,s=[],i=l=>s.push(...l.filter(d=>!a.has(d)));i(Df);const c=e[0].toString(),u=new URL(c);if(u.searchParams.get(pt)==="true"&&i($f),(!u.searchParams.has(pt)||u.searchParams.get(pt)==="false")&&i(Lf),s.length>0)throw new yf(c,s)}return r})}var nn,an,Oe,gt,Pe,cr,sn,Wf=class{constructor(t){B(this,cr),B(this,nn),B(this,an),B(this,Oe,new Map),B(this,gt),B(this,Pe);var e;U(this,nn,(e=t.fetchClient)!=null?e:(...r)=>fetch(...r)),U(this,an,t.maxPrefetchedRequests),U(this,gt,t.url.toString()),U(this,Pe,O(this,gt)),fe(this,cr,sn).call(this,t.url,t.requestInit)}abort(){O(this,Oe).forEach(([t,e])=>e.abort())}consume(...t){var e;const r=t[0].toString(),a=(e=O(this,Oe).get(r))==null?void 0:e[0];if(!(!a||r!==O(this,gt)))return O(this,Oe).delete(r),a.then(s=>{const i=Ea(r,s);U(this,gt,i),O(this,Pe)&&!O(this,Oe).has(O(this,Pe))&&fe(this,cr,sn).call(this,O(this,Pe),t[1])}).catch(()=>{}),a}};nn=new WeakMap,an=new WeakMap,Oe=new WeakMap,gt=new WeakMap,Pe=new WeakMap,cr=new WeakSet,sn=function(...t){var e,r;const a=t[0].toString();if(O(this,Oe).size>=O(this,an))return;const s=new AbortController;try{const i=O(this,nn).call(this,a,Ii(ht({},(e=t[1])!=null?e:{}),{signal:Bf(s,(r=t[1])==null?void 0:r.signal)}));O(this,Oe).set(a,[i,s]),i.then(o=>{if(!o.ok||s.signal.aborted)return;const c=Ea(a,o);if(!c||c===a){U(this,Pe,void 0);return}return U(this,Pe,c),fe(this,cr,sn).call(this,c,t[1])}).catch(()=>{})}catch{}};function Ea(t,e){const r=e.headers.get(_a),a=e.headers.get(Ci),s=e.headers.has(kf);if(!r||!a||s)return;const i=new URL(t);if(!i.searchParams.has(pt))return i.searchParams.set(va,r),i.searchParams.set(ba,a),i.searchParams.sort(),i.toString()}function Bf(t,e){return e&&(e.aborted?t.abort():e.addEventListener("abort",()=>t.abort(),{once:!0})),t.signal}var Ui=new Set([ji,va,pt,ba]);function Ff(t){const e={};for(const[r,a]of Object.entries(t))e[r]=Array.isArray(a)?a.join(","):a;return e}var on,cn,un,Ye,qe,mt,Xe,Ne,Qe,Ce,yt,ur,ve,Ta,Ra,Di,wa,$i=class{constructor(t){B(this,ve),B(this,on,null),B(this,cn),B(this,un),B(this,Ye,new Map),B(this,qe),B(this,mt),B(this,Xe),B(this,Ne,!1),B(this,Qe,!1),B(this,Ce),B(this,yt),B(this,ur);var e,r,a;this.options=ht({subscribe:!0},t),Vf(this.options),U(this,qe,(e=this.options.offset)!=null?e:"-1"),U(this,mt,""),U(this,Ce,this.options.handle),U(this,un,new Rf(t.parser)),U(this,ur,this.options.onError);const s=(r=t.fetchClient)!=null?r:(...o)=>fetch(...o),i=jf(s,Ii(ht({},(a=t.backoffOptions)!=null?a:Mi),{onFailedAttempt:()=>{var o,c;U(this,Qe,!1),(c=(o=t.backoffOptions)==null?void 0:o.onFailedAttempt)==null||c.call(o)}}));U(this,cn,Kf(Uf(i))),fe(this,ve,Ta).call(this)}get shapeHandle(){return O(this,Ce)}get error(){return O(this,on)}get isUpToDate(){return O(this,Ne)}get lastOffset(){return O(this,qe)}subscribe(t,e=()=>{}){const r=Math.random();return O(this,Ye).set(r,[t,e]),()=>{O(this,Ye).delete(r)}}unsubscribeAll(){O(this,Ye).clear()}lastSyncedAt(){return O(this,Xe)}lastSynced(){return O(this,Xe)===void 0?1/0:Date.now()-O(this,Xe)}isConnected(){return O(this,Qe)}isLoading(){return!O(this,Ne)}};on=new WeakMap,cn=new WeakMap,un=new WeakMap,Ye=new WeakMap,qe=new WeakMap,mt=new WeakMap,Xe=new WeakMap,Ne=new WeakMap,Qe=new WeakMap,Ce=new WeakMap,yt=new WeakMap,ur=new WeakMap,ve=new WeakSet,Ta=function(){return ze(this,null,function*(){var t,e;try{for(;!((t=this.options.signal)!=null&&t.aborted)&&!O(this,Ne)||this.options.subscribe;){const{url:r,signal:a}=this.options,s=new URL(r);if(this.options.params){const h=Object.keys(this.options.params).filter(K=>Ui.has(K));if(h.length>0)throw new Error(`Cannot use reserved Electric parameter names in custom params: ${h.join(", ")}`);const b=Ff(this.options.params);b.table&&s.searchParams.set(Of,b.table),b.where&&s.searchParams.set(Pf,b.where),b.columns&&s.searchParams.set(xf,b.columns),b.replica&&s.searchParams.set(Nf,b.replica);const A=ht({},b);delete A.table,delete A.where,delete A.columns,delete A.replica;for(const[K,ee]of Object.entries(A))s.searchParams.set(K,ee)}s.searchParams.set(ba,O(this,qe)),O(this,Ne)&&(s.searchParams.set(pt,"true"),s.searchParams.set(ji,O(this,mt))),O(this,Ce)&&s.searchParams.set(va,O(this,Ce)),s.searchParams.sort();let i;try{i=yield O(this,cn).call(this,s.toString(),{signal:a,headers:this.options.headers}),U(this,Qe,!0)}catch(h){if(h instanceof ki)break;if(!(h instanceof tn))throw h;if(h.status==409){const b=h.headers[_a];fe(this,ve,wa).call(this,b),yield fe(this,ve,Ra).call(this,h.json);continue}else if(h.status>=400&&h.status<500)throw fe(this,ve,Di).call(this,h),h}const{headers:o,status:c}=i,u=o.get(_a);u&&U(this,Ce,u);const l=o.get(Ci);l&&U(this,qe,l);const d=o.get(Af);d&&U(this,mt,d);const y=()=>{const h=o.get(If);return h?JSON.parse(h):{}};U(this,yt,(e=O(this,yt))!=null?e:y());const g=c===204?"[]":yield i.text();c===204&&U(this,Xe,Date.now());const f=O(this,un).parse(g,O(this,yt));if(f.length>0){const h=f[f.length-1];Sf(h)&&(U(this,Xe,Date.now()),U(this,Ne,!0)),yield fe(this,ve,Ra).call(this,f)}}}catch(r){if(U(this,on,r),O(this,ur)){const a=yield O(this,ur).call(this,r);typeof a=="object"&&(fe(this,ve,wa).call(this),"params"in a&&(this.options.params=a.params),"headers"in a&&(this.options.headers=a.headers),fe(this,ve,Ta).call(this));return}throw r}finally{U(this,Qe,!1)}})},Ra=function(t){return ze(this,null,function*(){yield Promise.all(Array.from(O(this,Ye).values()).map(e=>ze(this,[e],function*([r,a]){try{yield r(t)}catch(s){queueMicrotask(()=>{throw s})}})))})},Di=function(t){O(this,Ye).forEach(([e,r])=>{r==null||r(t)})},wa=function(t){U(this,qe,"-1"),U(this,mt,""),U(this,Ce,t),U(this,Ne,!1),U(this,Qe,!1),U(this,yt,void 0)},$i.Replica={FULL:"full",DEFAULT:"default"};function Vf(t){if(!t.url)throw new ff;if(t.signal&&!(t.signal instanceof AbortSignal))throw new hf;if(t.offset!==void 0&&t.offset!=="-1"&&!t.handle)throw new pf;if(t.params){const e=Object.keys(t.params).filter(r=>Ui.has(r));if(e.length>0)throw new gf(e)}}function Gf(t,e,r){var c;const a=new AbortController;(c=r==null?void 0:r.signal)==null||c.addEventListener("abort",()=>{a.abort()},{once:!0});const s=new $i({url:e,headers:{...r==null?void 0:r.headers,"x-trigger-electric-version":"1.0.0-beta.1"},fetchClient:r==null?void 0:r.fetchClient,signal:a.signal,onError:u=>{var l;(l=r==null?void 0:r.onError)==null||l.call(r,u)}});return{stream:new Zf(s).stream.pipeThrough(new TransformStream({async transform(u,l){const d=t.safeParse(u);d.success?l.enqueue(d.data):l.error(new Error(`Unable to parse shape: ${d.error.message}`))}})),stop:u=>{u?setTimeout(()=>{a.signal.aborted||a.abort()},u):a.abort()}}}function Hf(t,e){const r=t.pipeThrough(new TransformStream(e));return r[Symbol.asyncIterator]=()=>{const a=r.getReader();return{async next(){const{done:s,value:i}=await a.read();return s?{done:!0,value:void 0}:{done:!1,value:i}}}},r}function Li(t,e,r){return new ReadableStream({async start(a){const i=t.pipeThrough(new TransformStream(e)).getReader();for(r.addEventListener("abort",()=>{queueMicrotask(()=>{i.cancel(),a.close()})});;){const{done:o,value:c}=await i.read();if(o){a.close();break}a.enqueue(c)}}})}class Zf{constructor(e){V(this,wn);V(this,te);V(this,Ue,new Map);V(this,Er);V(this,kt,!1);V(this,Tr);xt(this,te,e);const r=new ReadableStream({start:a=>{xt(this,Tr,H(this,te).subscribe(s=>a.enqueue(s),m(this,wn,Ho).bind(this)))}});xt(this,Er,Hf(r,{transform:(a,s)=>{const i=new Set;for(const o of a)if(Pi(o)){const c=o.key;switch(o.headers.operation){case"insert":{H(this,Ue).set(c,o.value),i.add(c);break}case"update":{const u=H(this,Ue).get(c),l=u?{...u,...o.value}:o.value;H(this,Ue).set(c,l),i.add(c);break}}}else Ni(o)&&o.headers.control==="must-refetch"&&(H(this,Ue).clear(),xt(this,kt,!1));for(const o of i){const c=H(this,Ue).get(o);c&&s.enqueue(c)}}}))}stop(){var e;(e=H(this,Tr))==null||e.call(this)}get stream(){return H(this,Er)}get isUpToDate(){return H(this,te).isUpToDate}get lastOffset(){return H(this,te).lastOffset}get handle(){return H(this,te).shapeHandle}get error(){return H(this,kt)}lastSyncedAt(){return H(this,te).lastSyncedAt()}lastSynced(){return H(this,te).lastSynced()}isLoading(){return H(this,te).isLoading()}isConnected(){return H(this,te).isConnected()}}te=new WeakMap,Ue=new WeakMap,Er=new WeakMap,kt=new WeakMap,Tr=new WeakMap,wn=new WeakSet,Ho=function(e){e instanceof tn&&xt(this,kt,e)};class Lg extends TransformStream{constructor(){super({transform:(r,a)=>{this.buffer+=r;const s=this.buffer.split(`
`);this.buffer=s.pop()||"";const i=s.filter(o=>o.trim().length>0);i.length>0&&a.enqueue(i)},flush:r=>{const a=this.buffer.trim();a.length>0&&r.enqueue([a])}});E(this,"buffer","")}}function Sa(t,e){var o;const r=new AbortController,a=new Ki(sr("TRIGGER_STREAM_URL",sr("TRIGGER_API_URL"))??"https://api.trigger.dev",{headers:e==null?void 0:e.headers,signal:r.signal});(o=e==null?void 0:e.signal)==null||o.addEventListener("abort",()=>{r.signal.aborted||r.abort()},{once:!0});const s=Gf(Nu,t,{...e,signal:r.signal,onError:c=>{var u;(u=e==null?void 0:e.onFetchError)==null||u.call(e,c)}}),i={runShapeStream:s.stream,stopRunShapeStream:()=>s.stop(30*1e3),streamFactory:a,abortController:r,...e};return new zf(i)}class Jf{constructor(e,r){E(this,"url");E(this,"options");this.url=e,this.options=r}async subscribe(){return fetch(this.url,{headers:{Accept:"text/event-stream",...this.options.headers},signal:this.options.signal}).then(e=>{if(!e.ok)throw G.generate(e.status,{},"Could not subscribe to stream",Object.fromEntries(e.headers));if(!e.body)throw new Error("No response body");return e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Qd).pipeThrough(new TransformStream({transform(r,a){a.enqueue(qf(r.data))}}))})}}class Ki{constructor(e,r){E(this,"baseUrl");E(this,"options");this.baseUrl=e,this.options=r}createSubscription(e,r,a){if(!e||!r)throw new Error("runId and streamKey are required");const s=`${a??this.baseUrl}/realtime/v1/streams/${e}/${r}`;return new Jf(s,this.options)}}class zf{constructor(e){E(this,"options");E(this,"stream");E(this,"packetCache",new Map);E(this,"_closeOnComplete");E(this,"_isRunComplete",!1);this.options=e,this._closeOnComplete=typeof e.closeOnComplete>"u"?!0:e.closeOnComplete,this.stream=Li(this.options.runShapeStream,{transform:async(r,a)=>{const s=await this.transformRunShape(r);a.enqueue(s),this._isRunComplete=!!s.finishedAt,this._closeOnComplete&&this._isRunComplete&&!this.options.abortController.signal.aborted&&this.options.stopRunShapeStream()}},this.options.abortController.signal)}unsubscribe(){this.options.abortController.signal.aborted||this.options.abortController.abort(),this.options.stopRunShapeStream()}[Symbol.asyncIterator](){return this.stream[Symbol.asyncIterator]()}getReader(){return this.stream.getReader()}withStreams(){const e=new Set;return Li(this.stream,{transform:async(r,a)=>{var s;if(a.enqueue({type:"run",run:r}),r.metadata&&"$$streams"in r.metadata&&Array.isArray(r.metadata.$$streams))for(const i of r.metadata.$$streams)typeof i=="string"&&(e.has(i)||(e.add(i),this.options.streamFactory.createSubscription(r.id,i,(s=this.options.client)==null?void 0:s.baseUrl).subscribe().then(c=>{c.pipeThrough(new TransformStream({transform(u,l){l.enqueue({type:i,chunk:u,run:r})}})).pipeTo(new WritableStream({write(u){a.enqueue(u)}})).catch(u=>{console.error(`Error in stream ${i}:`,u)})}).catch(c=>{console.error(`Error subscribing to stream ${i}:`,c)})))}},this.options.abortController.signal)}async transformRunShape(e){const r=e.payloadType?{data:e.payload??void 0,dataType:e.payloadType}:void 0,a=e.outputType?{data:e.output??void 0,dataType:e.outputType}:void 0,[s,i]=await Promise.all([{packet:r,key:"payload"},{packet:a,key:"output"}].map(async({packet:c,key:u})=>{if(!c)return;const l=this.packetCache.get(`${e.friendlyId}/${u}`);if(typeof l<"u")return l;const d=await sf(c,this.options.client);return this.packetCache.set(`${e.friendlyId}/${u}`,d),d})),o=e.metadata&&e.metadataType?await ma({data:e.metadata,dataType:e.metadataType}):void 0;return{id:e.friendlyId,payload:s,output:i,createdAt:e.createdAt,updatedAt:e.updatedAt,taskIdentifier:e.taskIdentifier,number:e.number,status:Yf(e.status),durationMs:e.usageDurationMs,costInCents:e.costInCents,baseCostInCents:e.baseCostInCents,tags:e.runTags??[],idempotencyKey:e.idempotencyKey??void 0,expiredAt:e.expiredAt??void 0,finishedAt:e.completedAt??void 0,startedAt:e.startedAt??void 0,delayedUntil:e.delayUntil??void 0,queuedAt:e.queuedAt??void 0,error:e.error?tf(e.error):void 0,isTest:e.isTest,metadata:o}}}function Yf(t){switch(t){case"DELAYED":return"DELAYED";case"WAITING_FOR_DEPLOY":return"WAITING_FOR_DEPLOY";case"PENDING":return"QUEUED";case"PAUSED":case"WAITING_TO_RESUME":return"FROZEN";case"RETRYING_AFTER_FAILURE":return"REATTEMPTING";case"EXECUTING":return"EXECUTING";case"CANCELED":return"CANCELED";case"COMPLETED_SUCCESSFULLY":return"COMPLETED";case"SYSTEM_FAILURE":return"SYSTEM_FAILURE";case"INTERRUPTED":return"INTERRUPTED";case"CRASHED":return"CRASHED";case"COMPLETED_WITH_ERRORS":return"FAILED";case"EXPIRED":return"EXPIRED";case"TIMED_OUT":return"TIMED_OUT";default:throw new Error(`Unknown status: ${t}`)}}function qf(t){try{return JSON.parse(t)}catch{return t}}(typeof window<"u"&&typeof navigator<"u"&&typeof navigator.userAgent=="string"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/iPad|iPhone|iPod/.test(navigator.userAgent):!1)&&(($o=ReadableStream.prototype).values??($o.values=function({preventCancel:t=!1}={}){const e=this.getReader();return{async next(){try{const r=await e.read();return r.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(r){if(t)e.releaseLock();else{const a=e.cancel(r);e.releaseLock(),await a}return{done:!0,value:r}},[Symbol.asyncIterator](){return this}}}),(Lo=ReadableStream.prototype)[Ko=Symbol.asyncIterator]??(Lo[Ko]=ReadableStream.prototype.values));const Xf={retry:{maxAttempts:5,minTimeoutInMs:1e3,maxTimeoutInMs:3e4,factor:1.6,randomize:!1}};class Wi{constructor(e,r,a={}){V(this,P);E(this,"baseUrl");E(this,"accessToken");E(this,"defaultRequestOptions");this.accessToken=r,this.baseUrl=e.replace(/\/$/,""),this.defaultRequestOptions=M(Xf,a)}get fetchClient(){const e=m(this,P,C).call(this,!1);return(a,s)=>{const i={...s,headers:{...s==null?void 0:s.headers,...e}};return fetch(a,i)}}getHeaders(){return m(this,P,C).call(this,!1)}async getRunResult(e,r){try{return await D(se,`${this.baseUrl}/api/v1/runs/${e}/result`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}catch(a){if(a instanceof G&&a.status===404)return;throw a}}async getBatchResults(e,r){return await D(cu,`${this.baseUrl}/api/v1/batches/${e}/results`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}triggerTask(e,r,a,s){const i=encodeURIComponent(e);return D(_u,`${this.baseUrl}/api/v1/tasks/${i}/trigger`,{method:"POST",headers:m(this,P,C).call(this,(a==null?void 0:a.spanParentAsLink)??!1),body:JSON.stringify(r)},M(this.defaultRequestOptions,s)).withResponse().then(async({response:o,data:c})=>{var g;const u=o.headers.get("x-trigger-jwt");if(typeof u=="string")return{...c,publicAccessToken:u};const l=o.headers.get("x-trigger-jwt-claims"),d=l?JSON.parse(l):void 0,y=await _s({secretKey:this.accessToken,payload:{...d,scopes:[`read:runs:${c.id}`]},expirationTime:((g=s==null?void 0:s.publicAccessToken)==null?void 0:g.expirationTime)??"1h"});return{...c,publicAccessToken:y}})}batchTriggerV2(e,r,a){return D(bu,`${this.baseUrl}/api/v1/tasks/batch`,{method:"POST",headers:m(this,P,C).call(this,(r==null?void 0:r.spanParentAsLink)??!1,{"idempotency-key":r==null?void 0:r.idempotencyKey,"idempotency-key-ttl":r==null?void 0:r.idempotencyKeyTTL,"batch-processing-strategy":r==null?void 0:r.processingStrategy}),body:JSON.stringify(e)},M(this.defaultRequestOptions,a)).withResponse().then(async({response:s,data:i})=>{var l;const o=s.headers.get("x-trigger-jwt-claims"),c=o?JSON.parse(o):void 0,u=await _s({secretKey:this.accessToken,payload:{...c,scopes:[`read:batch:${i.id}`]},expirationTime:((l=a==null?void 0:a.publicAccessToken)==null?void 0:l.expirationTime)??"1h"});return{...i,publicAccessToken:u}})}createUploadPayloadUrl(e,r){return D(Ls,`${this.baseUrl}/api/v1/packets/${e}`,{method:"PUT",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}getPayloadUrl(e,r){return D(Ls,`${this.baseUrl}/api/v1/packets/${e}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}retrieveRun(e,r){return D(Vs,`${this.baseUrl}/api/v3/runs/${e}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}listRuns(e,r){const a=Bi(e);return da(Zn,`${this.baseUrl}/api/v1/runs`,{query:a,limit:e==null?void 0:e.limit,after:e==null?void 0:e.after,before:e==null?void 0:e.before},{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}listProjectRuns(e,r,a){const s=Bi(r);return r!=null&&r.env&&s.append("filter[env]",Array.isArray(r.env)?r.env.join(","):r.env),da(Zn,`${this.baseUrl}/api/v1/projects/${e}/runs`,{query:s,limit:r==null?void 0:r.limit,after:r==null?void 0:r.after,before:r==null?void 0:r.before},{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,a))}replayRun(e,r){return D(Tu,`${this.baseUrl}/api/v1/runs/${e}/replay`,{method:"POST",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}cancelRun(e,r){return D(Ru,`${this.baseUrl}/api/v2/runs/${e}/cancel`,{method:"POST",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}rescheduleRun(e,r,a){return D(Vs,`${this.baseUrl}/api/v1/runs/${e}/reschedule`,{method:"POST",headers:m(this,P,C).call(this,!1),body:JSON.stringify(r)},M(this.defaultRequestOptions,a))}addTags(e,r,a){return D(n.object({message:n.string()}),`${this.baseUrl}/api/v1/runs/${e}/tags`,{method:"POST",headers:m(this,P,C).call(this,!1),body:JSON.stringify(r)},M(this.defaultRequestOptions,a))}createSchedule(e,r){return D(Ve,`${this.baseUrl}/api/v1/schedules`,{method:"POST",headers:m(this,P,C).call(this,!1),body:JSON.stringify(e)},M(this.defaultRequestOptions,r))}listSchedules(e,r){const a=new URLSearchParams;return e!=null&&e.page&&a.append("page",e.page.toString()),e!=null&&e.perPage&&a.append("perPage",e.perPage.toString()),mi(Ve,`${this.baseUrl}/api/v1/schedules`,{page:e==null?void 0:e.page,limit:e==null?void 0:e.perPage},{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}retrieveSchedule(e,r){return D(Ve,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}updateSchedule(e,r,a){return D(Ve,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"PUT",headers:m(this,P,C).call(this,!1),body:JSON.stringify(r)},M(this.defaultRequestOptions,a))}deactivateSchedule(e,r){return D(Ve,`${this.baseUrl}/api/v1/schedules/${e}/deactivate`,{method:"POST",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}activateSchedule(e,r){return D(Ve,`${this.baseUrl}/api/v1/schedules/${e}/activate`,{method:"POST",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}deleteSchedule(e,r){return D(wu,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"DELETE",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}listEnvVars(e,r,a){return D(Pu,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,a))}importEnvVars(e,r,a,s){return D(Vr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/import`,{method:"POST",headers:m(this,P,C).call(this,!1),body:JSON.stringify(a)},M(this.defaultRequestOptions,s))}retrieveEnvVar(e,r,a,s){return D(xu,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${a}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,s))}createEnvVar(e,r,a,s){return D(Vr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"POST",headers:m(this,P,C).call(this,!1),body:JSON.stringify(a)},M(this.defaultRequestOptions,s))}updateEnvVar(e,r,a,s,i){return D(Vr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${a}`,{method:"PUT",headers:m(this,P,C).call(this,!1),body:JSON.stringify(s)},M(this.defaultRequestOptions,i))}deleteEnvVar(e,r,a,s){return D(Vr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${a}`,{method:"DELETE",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,s))}updateRunMetadata(e,r,a){return D(Gs,`${this.baseUrl}/api/v1/runs/${e}/metadata`,{method:"PUT",headers:m(this,P,C).call(this,!1),body:JSON.stringify(r)},M(this.defaultRequestOptions,a))}getRunMetadata(e,r){return D(Gs,`${this.baseUrl}/api/v1/runs/${e}/metadata`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}subscribeToRun(e,r){return Sa(`${this.baseUrl}/realtime/v1/runs/${e}`,{closeOnComplete:typeof(r==null?void 0:r.closeOnComplete)=="boolean"?r.closeOnComplete:!0,headers:m(this,P,jn).call(this),client:this,signal:r==null?void 0:r.signal,onFetchError:r==null?void 0:r.onFetchError})}subscribeToRunsWithTag(e,r){const a=Qf({tags:e});return Sa(`${this.baseUrl}/realtime/v1/runs${a?`?${a}`:""}`,{closeOnComplete:!1,headers:m(this,P,jn).call(this),client:this,signal:r==null?void 0:r.signal,onFetchError:r==null?void 0:r.onFetchError})}subscribeToBatch(e,r){return Sa(`${this.baseUrl}/realtime/v1/batches/${e}`,{closeOnComplete:!1,headers:m(this,P,jn).call(this),client:this,signal:r==null?void 0:r.signal,onFetchError:r==null?void 0:r.onFetchError})}async fetchStream(e,r,a){return await new Ki((a==null?void 0:a.baseUrl)??this.baseUrl,{headers:this.getHeaders(),signal:a==null?void 0:a.signal}).createSubscription(e,r).subscribe()}async generateJWTClaims(e){return D(n.record(n.any()),`${this.baseUrl}/api/v1/auth/jwt/claims`,{method:"POST",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,e))}retrieveBatch(e,r){return D(ju,`${this.baseUrl}/api/v1/batches/${e}`,{method:"GET",headers:m(this,P,C).call(this,!1)},M(this.defaultRequestOptions,r))}}P=new WeakSet,C=function(e,r){const a={"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`,"trigger-version":ys,...Object.entries(r??{}).reduce((s,[i,o])=>(o!==void 0&&(s[i]=o),s),{})};return L.isInsideTask&&(a["x-trigger-worker"]="true",e&&(a["x-trigger-span-parent-as-link"]="1")),typeof window<"u"&&typeof window.document<"u"&&(a["x-trigger-client"]="browser"),a},jn=function(){return{Authorization:`Bearer ${this.accessToken}`,"trigger-version":ys}};function Qf(t){const e=new URLSearchParams;return t&&(t.tasks&&e.append("tasks",Array.isArray(t.tasks)?t.tasks.join(","):t.tasks),t.tags&&e.append("tags",Array.isArray(t.tags)?t.tags.join(","):t.tags)),e}function Bi(t){const e=new URLSearchParams;return t&&(t.status&&e.append("filter[status]",Array.isArray(t.status)?t.status.join(","):t.status),t.taskIdentifier&&e.append("filter[taskIdentifier]",Array.isArray(t.taskIdentifier)?t.taskIdentifier.join(","):t.taskIdentifier),t.version&&e.append("filter[version]",Array.isArray(t.version)?t.version.join(","):t.version),t.bulkAction&&e.append("filter[bulkAction]",t.bulkAction),t.tag&&e.append("filter[tag]",Array.isArray(t.tag)?t.tag.join(","):t.tag),t.schedule&&e.append("filter[schedule]",t.schedule),typeof t.isTest=="boolean"&&e.append("filter[isTest]",String(t.isTest)),t.from&&e.append("filter[createdAt][from]",t.from instanceof Date?t.from.getTime().toString():t.from.toString()),t.to&&e.append("filter[createdAt][to]",t.to instanceof Date?t.to.getTime().toString():t.to.toString()),t.period&&e.append("filter[createdAt][period]",t.period),t.batch&&e.append("filter[batch]",t.batch)),e}function M(t,e){return e?{...t,...e,retry:{...t.retry,...e.retry}}:t}var lr={},Fi;function eh(){if(Fi)return lr;Fi=1;/*!
 * Copyright 2019 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Object.defineProperty(lr,"__esModule",{value:!0}),lr.PreciseDate=void 0;const t=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d{4,9}Z/,e="BigInt only available in Node >= v10.7. Consider using getFullTimeString instead.";var r;(function(g){g[g.NEGATIVE=-1]="NEGATIVE",g[g.POSITIVE=1]="POSITIVE",g[g.ZERO=0]="ZERO"})(r||(r={}));class a extends Date{constructor(f){if(super(),this._micros=0,this._nanos=0,f&&typeof f!="number"&&!(f instanceof Date)){this.setFullTime(a.parseFull(f));return}const h=Array.from(arguments),b=h.slice(0,7),A=new Date(...b),K=h.length===9?h.pop():0,ee=h.length===8?h.pop():0;this.setTime(A.getTime()),this.setMicroseconds(ee),this.setNanoseconds(K)}getFullTime(){if(typeof BigInt!="function")throw new Error(e);return BigInt(this.getFullTimeString())}getFullTimeString(){const f=this._getSeconds();let h=this._getNanos();return h&&Math.sign(f)===r.NEGATIVE&&(h=1e9-h),`${f}${l(h,9)}`}getMicroseconds(){return this._micros}getNanoseconds(){return this._nanos}setMicroseconds(f){const h=Math.abs(f);let b=this.getUTCMilliseconds();return h>=1e3&&(b+=Math.floor(h/1e3)*Math.sign(f),f%=1e3),Math.sign(f)===r.NEGATIVE&&(b-=1,f+=1e3),this._micros=f,this.setUTCMilliseconds(b),this.getFullTimeString()}setNanoseconds(f){const h=Math.abs(f);let b=this._micros;return h>=1e3&&(b+=Math.floor(h/1e3)*Math.sign(f),f%=1e3),Math.sign(f)===r.NEGATIVE&&(b-=1,f+=1e3),this._nanos=f,this.setMicroseconds(b)}setFullTime(f){typeof f!="string"&&(f=f.toString());const h=Math.sign(Number(f));f=f.replace(/^-/,"");const b=Number(f.substr(0,f.length-9))*h,A=Number(f.substr(-9))*h;return this.setTime(b*1e3),this.setNanoseconds(A)}setTime(f){return this._micros=0,this._nanos=0,super.setTime(f)}toISOString(){const f=l(this._micros,3),h=l(this._nanos,3);return super.toISOString().replace(/z$/i,`${f}${h}Z`)}toStruct(){let f=this._getSeconds();const h=this._getNanos();return Math.sign(f)===r.NEGATIVE&&h&&(f-=1),{seconds:f,nanos:h}}toTuple(){const{seconds:f,nanos:h}=this.toStruct();return[f,h]}_getSeconds(){const f=this.getTime(),h=Math.sign(f);return Math.floor(Math.abs(f)/1e3)*h}_getNanos(){const f=this.getUTCMilliseconds()*1e6,h=this._micros*1e3;return this._nanos+f+h}static parseFull(f){const h=new a;if(Array.isArray(f)){const[b,A]=f;f={seconds:b,nanos:A}}if(o(f))h.setFullTime(f);else if(c(f)){const{seconds:b,nanos:A}=i(f);h.setTime(b*1e3),h.setNanoseconds(A)}else u(f)?h.setFullTime(s(f)):h.setTime(new Date(f).getTime());return h.getFullTimeString()}static fullUTC(...f){if(typeof BigInt!="function")throw new Error(e);return BigInt(a.fullUTCString(...f))}static fullUTCString(...f){const h=Date.UTC(...f.slice(0,7)),b=new a(h);return f.length===9&&b.setNanoseconds(f.pop()),f.length===8&&b.setMicroseconds(f.pop()),b.getFullTimeString()}}lr.PreciseDate=a;function s(g){let f="0";g=g.replace(/\.(\d+)/,(A,K)=>(f=K,".000"));const h=Number(d(f,9));return new a(g).setNanoseconds(h)}function i({seconds:g=0,nanos:f=0}){return typeof g.toNumber=="function"&&(g=g.toNumber()),g=Number(g),f=Number(f),{seconds:g,nanos:f}}function o(g){return typeof g=="bigint"||typeof g=="string"&&/^\d+$/.test(g)}function c(g){return typeof g=="object"&&typeof g.seconds<"u"||typeof g.nanos=="number"}function u(g){return typeof g=="string"&&t.test(g)}function l(g,f){return`${y(g,f)}${g}`}function d(g,f){const h=y(g,f);return`${g}${h}`}function y(g,f){const h=Math.max(f-g.toString().length,0);return"0".repeat(h)}return lr}var th=eh();class rh{preciseNow(){const r=new th.PreciseDate().toStruct();return[r.seconds,r.nanos]}reset(){}}const Vi="clock",nh=new rh,Sn=class Sn{constructor(){V(this,Rr)}static getInstance(){return this._instance||(this._instance=new Sn),this._instance}setGlobalClock(e){return ie(Vi,e)}preciseNow(){return m(this,Rr,ns).call(this).preciseNow()}reset(){m(this,Rr,ns).call(this).reset()}};Rr=new WeakSet,ns=function(){return _e(Vi)??nh},E(Sn,"_instance");let Aa=Sn;const Gi=Aa.getInstance();var ah=function(){function t(){}return t.prototype.emit=function(e){},t}(),sh=function(){function t(){}return t.prototype.getLogger=function(e,r,a){return new ah},t}(),Hi=new sh,ih=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},ln=Symbol.for("io.opentelemetry.js.api.logs"),dr=ih;function oh(t,e,r){return function(a){return a===t?e:r}}var Zi=1,ch=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalLoggerProvider=function(e){return dr[ln]?this.getLoggerProvider():(dr[ln]=oh(Zi,e,Hi),e)},t.prototype.getLoggerProvider=function(){var e,r;return(r=(e=dr[ln])===null||e===void 0?void 0:e.call(dr,Zi))!==null&&r!==void 0?r:Hi},t.prototype.getLogger=function(e,r,a){return this.getLoggerProvider().getLogger(e,r,a)},t.prototype.disable=function(){delete dr[ln]},t}(),uh=ch.getInstance();class lh{debug(){}log(){}info(){}warn(){}error(){}trace(e,r){return r({})}}const Ia="logger",dh=new lh,An=class An{constructor(){V(this,Te)}static getInstance(){return this._instance||(this._instance=new An),this._instance}disable(){Ge(Ia)}setGlobalTaskLogger(e){return ie(Ia,e)}debug(e,r){m(this,Te,st).call(this).debug(e,r)}log(e,r){m(this,Te,st).call(this).log(e,r)}info(e,r){m(this,Te,st).call(this).info(e,r)}warn(e,r){m(this,Te,st).call(this).warn(e,r)}error(e,r){m(this,Te,st).call(this).error(e,r)}trace(e,r){return m(this,Te,st).call(this).trace(e,r)}};Te=new WeakSet,st=function(){return _e(Ia)??dh},E(An,"_instance");let ka=An;const q=ka.getInstance();class fh{disable(){}waitForDuration(e){return Promise.resolve()}waitUntil(e){return Promise.resolve()}waitForTask(e){return Promise.resolve({ok:!1,id:e.id,error:{type:"INTERNAL_ERROR",code:Ts.CONFIGURED_INCORRECTLY}})}waitForBatch(e){return Promise.resolve({id:e.id,items:[]})}}class hh{disable(){}start(){return{sample:()=>({cpuTime:0,wallTime:0})}}stop(e){return e.sample()}pauseAsync(e){return e()}sample(){}}const xa="usage",ph=new hh,In=class In{constructor(){V(this,De)}static getInstance(){return this._instance||(this._instance=new In),this._instance}setGlobalUsageManager(e){return ie(xa,e)}disable(){m(this,De,Ot).call(this).disable(),Ge(xa)}start(){return m(this,De,Ot).call(this).start()}stop(e){return m(this,De,Ot).call(this).stop(e)}pauseAsync(e){return m(this,De,Ot).call(this).pauseAsync(e)}sample(){return m(this,De,Ot).call(this).sample()}};De=new WeakSet,Ot=function(){return _e(xa)??ph},E(In,"_instance");let Oa=In;const _t=Oa.getInstance(),Pa="runtime",gh=new fh,kn=class kn{constructor(){V(this,$e)}static getInstance(){return this._instance||(this._instance=new kn),this._instance}waitForDuration(e){return _t.pauseAsync(()=>m(this,$e,Pt).call(this).waitForDuration(e))}waitUntil(e){return _t.pauseAsync(()=>m(this,$e,Pt).call(this).waitUntil(e))}waitForTask(e){return _t.pauseAsync(()=>m(this,$e,Pt).call(this).waitForTask(e))}waitForBatch(e){return _t.pauseAsync(()=>m(this,$e,Pt).call(this).waitForBatch(e))}setGlobalRuntimeManager(e){return ie(Pa,e)}disable(){m(this,$e,Pt).call(this).disable(),Ge(Pa)}};$e=new WeakSet,Pt=function(){return _e(Pa)??gh},E(kn,"_instance");let Na=kn;const Ca=Na.getInstance();class mh{append(e,r){throw new Error("Method not implemented.")}remove(e,r){throw new Error("Method not implemented.")}increment(e,r){throw new Error("Method not implemented.")}decrement(e,r){throw new Error("Method not implemented.")}stream(e,r){throw new Error("Method not implemented.")}fetchStream(e,r){throw new Error("Method not implemented.")}flush(e){throw new Error("Method not implemented.")}refresh(e){throw new Error("Method not implemented.")}enterWithMetadata(e){}current(){throw new Error("Method not implemented.")}getKey(e){throw new Error("Method not implemented.")}set(e,r){throw new Error("Method not implemented.")}del(e){throw new Error("Method not implemented.")}update(e){throw new Error("Method not implemented.")}get parent(){return{append:()=>this.parent,set:()=>this.parent,del:()=>this.parent,increment:()=>this.parent,decrement:()=>this.parent,remove:()=>this.parent,stream:()=>Promise.resolve({[Symbol.asyncIterator]:()=>({next:()=>Promise.resolve({done:!0,value:void 0})})}),update:()=>this.parent}}get root(){return{append:()=>this.root,set:()=>this.root,del:()=>this.root,increment:()=>this.root,decrement:()=>this.root,remove:()=>this.root,stream:()=>Promise.resolve({[Symbol.asyncIterator]:()=>({next:()=>Promise.resolve({done:!0,value:void 0})})}),update:()=>this.root}}}const Ji="run-metadata",yh=new mh,xn=class xn{constructor(){V(this,F)}static getInstance(){return this._instance||(this._instance=new xn),this._instance}setGlobalManager(e){return ie(Ji,e)}enterWithMetadata(e){m(this,F,Z).call(this).enterWithMetadata(e)}current(){return m(this,F,Z).call(this).current()}getKey(e){return m(this,F,Z).call(this).getKey(e)}set(e,r){return m(this,F,Z).call(this).set(e,r),this}del(e){return m(this,F,Z).call(this).del(e),this}increment(e,r){return m(this,F,Z).call(this).increment(e,r),this}decrement(e,r){return m(this,F,Z).call(this).decrement(e,r),this}append(e,r){return m(this,F,Z).call(this).append(e,r),this}remove(e,r){return m(this,F,Z).call(this).remove(e,r),this}update(e){return m(this,F,Z).call(this).update(e),this}stream(e,r,a){return m(this,F,Z).call(this).stream(e,r,a)}fetchStream(e,r){return m(this,F,Z).call(this).fetchStream(e,r)}flush(e){return m(this,F,Z).call(this).flush(e)}refresh(e){return m(this,F,Z).call(this).refresh(e)}get parent(){return m(this,F,Z).call(this).parent}get root(){return m(this,F,Z).call(this).root}};F=new WeakSet,Z=function(){return _e(Ji)??yh},E(xn,"_instance");let ja=xn;var et={},dn={},fr={},fn={},zi;function hn(){if(zi)return fn;zi=1,Object.defineProperty(fn,"__esModule",{value:!0});var t=function(){function e(r,a,s){this.depth=0,this.depth=r,this.path=a,this.object=s}return e.prototype.flatten=function(){var r=this.object;return typeof this.object=="object"&&Array.isArray(this.object)&&this.depth>0&&(r=this.object.flat(this.depth)),new e(0,this.path,r)},e}();return fn.default=t,fn}var Yi;function _h(){if(Yi)return fr;Yi=1,Object.defineProperty(fr,"__esModule",{value:!0}),fr.SimpleKeyPathComponent=void 0;var t=hn(),e=function(){function r(a){this.isArray=!1,this.keyName=a;var s=parseInt(this.keyName,10);if(!isNaN(s)){var i=Number.isInteger(s);i&&(s<0||(this.isArray=!0))}}return r.fromString=function(a){var s=a;return r.unescapeExpressions.forEach(function(i){s=s.replace(i.search,i.replacement)}),new r(s)},r.prototype.toString=function(){var a=this.keyName;return r.escapeExpressions.forEach(function(s){a=a.replace(s.search,s.replacement)}),a},r.prototype.jsonPointer=function(){var a=this.keyName;return a=a.replace(/(\~)/g,"~0"),a=a.replace(/(\/)/g,"~1"),a},r.prototype.query=function(a){for(var s=[],i=0;i<a.length;i++){var o=a[i],c=o.object;if(typeof c=="object"){var u=c[this.keyName];if(u!==null){var l=new t.default(o.depth,o.path.child(this.keyName),u);s.push(l)}}}return s},r.escapeExpressions=[{search:new RegExp(/(\\)/g),replacement:"\\"},{search:new RegExp(/(\.)/g),replacement:"\\."}],r.unescapeExpressions=[{search:new RegExp(/(\\\.)/g),replacement:"."},{search:new RegExp(/(\\\\)/g),replacement:"\\"},{search:"~1",replacement:"/"}],r}();return fr.SimpleKeyPathComponent=e,fr}var hr={},qi;function vh(){if(qi)return hr;qi=1,Object.defineProperty(hr,"__esModule",{value:!0}),hr.WildcardPathComponent=void 0;var t=hn(),e=function(){function r(){this.keyName="*",this.isArray=!0}return r.fromString=function(a){return a==="*"?new r:null},r.prototype.toString=function(){return this.keyName},r.prototype.jsonPointer=function(){throw Error("JSON Pointers don't work with wildcards")},r.prototype.query=function(a){for(var s=[],i=0;i<a.length;i++){var o=a[i],c=o.object;if(typeof c=="object")for(var u in c){var l=c[u],d=new t.default(o.depth+1,o.path.child(u),l);s.push(d)}}return s},r}();return hr.WildcardPathComponent=e,hr}var pn={},Xi;function Qi(){if(Xi)return pn;Xi=1,Object.defineProperty(pn,"__esModule",{value:!0});var t=function(){function e(){this.keyName="$",this.isArray=!1}return e.fromString=function(r){return r==="$"?new e:null},e.prototype.toString=function(){return this.keyName},e.prototype.jsonPointer=function(){return""},e.prototype.query=function(r){return r},e}();return pn.default=t,pn}var pr={},eo;function bh(){if(eo)return pr;eo=1,Object.defineProperty(pr,"__esModule",{value:!0}),pr.SlicePathComponent=void 0;var t=hn(),e=function(){function r(a,s){this.endIndex=null,this.isArray=!0,this.startIndex=a,this.endIndex=s}return r.fromString=function(a){if(!r.regex.test(a))return null;r.regex.lastIndex=0;var s=r.regex.exec(a);if(s==null||s.groups==null)return null;var i=s.groups.startIndex,o=s.groups.endIndex,c=i==null||i===""?0:parseInt(i,10),u=o==null?null:parseInt(o,10);if(c==null&&u==null)return null;var l=Number.isInteger(c);return l?new r(c,u):null},r.prototype.toString=function(){return"[".concat(this.startIndex).concat(this.endIndex==null?"":":"+this.endIndex,"]")},r.prototype.jsonPointer=function(){throw Error("JSON Pointers don't work with wildcards")},r.prototype.query=function(a){for(var s=[],i=0;i<a.length;i++){var o=a[i],c=o.object;if(typeof c=="object"&&Array.isArray(c)){var u=void 0;this.endIndex==null?u=c.slice(this.startIndex):u=c.slice(this.startIndex,this.endIndex);for(var l=0;l<u.length;l++){var d=u[l];s.push(new t.default(o.depth+1,o.path.child("".concat(l+this.startIndex)),d))}}}return s},r.regex=/^\[(?<startIndex>[0-9]*):(?<endIndex>\-?[0-9]*)?\]$/g,r}();return pr.SlicePathComponent=e,pr}var to;function Eh(){if(to)return dn;to=1,Object.defineProperty(dn,"__esModule",{value:!0});var t=_h(),e=vh(),r=Qi(),a=bh(),s=function(){function i(){}return i.prototype.parse=function(o){i.pathPattern.lastIndex=0;var c=o.match(i.pathPattern),u=[new r.default];if(c==null||c.length==0||c.length==1&&c[0]=="")return u;var l=0;c[0]=="$"&&(l=1);for(var d=l;d<c.length;d++){var y=c[d],g=this.parseComponent(y);u.push(g)}return u},i.prototype.parsePointer=function(o){i.pathPattern.lastIndex=0;var c=o.match(i.pointerPattern),u=[new r.default];if(c==null||c.length==0||c.length==1&&c[0]=="")return u;for(var l=0,d=c;l<d.length;l++){var y=d[l];u.push(this.parseComponent(y))}return u},i.prototype.parseComponent=function(o){var c=e.WildcardPathComponent.fromString(o);if(c!=null)return c;if(o==null)throw new SyntaxError("Cannot create a path from null");if(o=="")throw new SyntaxError("Cannot create a path from an empty string");var u=a.SlicePathComponent.fromString(o);return u??t.SimpleKeyPathComponent.fromString(o)},i.pathPattern=/(?:[^\.\\]|\\.)+/g,i.pointerPattern=/(?:[^\/\\]|\\\/)+/g,i}();return dn.default=s,dn}var ro;function Th(){if(ro)return et;ro=1;var t=et&&et.__spreadArray||function(i,o,c){if(c||arguments.length===2)for(var u=0,l=o.length,d;u<l;u++)(d||!(u in o))&&(d||(d=Array.prototype.slice.call(o,0,u)),d[u]=o[u]);return i.concat(d||Array.prototype.slice.call(o))};Object.defineProperty(et,"__esModule",{value:!0}),et.JSONHeroPath=void 0;var e=Eh(),r=hn(),a=Qi(),s=function(){function i(o){if(typeof o=="string"){var c=new e.default;this.components=c.parse(o);return}o.length==0&&o.push(new a.default),o[0]instanceof a.default||o.unshift(new a.default),this.components=o}return i.fromPointer=function(o){var c=new e.default;return new i(c.parsePointer(o))},Object.defineProperty(i.prototype,"root",{get:function(){return new i(this.components.slice(0,1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRoot",{get:function(){return this.components.length>1?!1:this.components[0]instanceof a.default},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this.components.length==1?null:new i(this.components.slice(0,-1))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lastComponent",{get:function(){if(this.components.length!==0)return this.components[this.components.length-1]},enumerable:!1,configurable:!0}),i.prototype.child=function(o){var c=this.toString();return new i(c.concat(".".concat(o)))},i.prototype.replaceComponent=function(o,c){var u=new e.default,l=u.parseComponent(c),d=t([],this.components,!0);return d[o]=l,new i(d)},i.prototype.toString=function(){return this.components.map(function(o){return o.toString()}).join(".")},i.prototype.jsonPointer=function(){return this.components.length===1?"":this.components.map(function(o){return o.jsonPointer()}).join("/")},i.prototype.first=function(o,c){c===void 0&&(c={includePath:!1});var u=this.all(o,c);return u===null||u.length===0?null:u[0]},i.prototype.all=function(o,c){if(c===void 0&&(c={includePath:!1}),this.components.length==0)return[o];if(this.components.length==1&&this.components[0]instanceof a.default)return[o];var u=[],l=new r.default(0,this.root,o);u.push(l);for(var d=0;d<this.components.length;d++){var y=this.components[d];if(u=y.query(u),u===null||u.length===0)return[]}var g=u.map(function(A){return A.flatten()});if(!c.includePath)return g.map(function(A){return A.object});for(var f=[],d=0;d<g.length;d++){var h=g[d],b={value:h.object};c.includePath&&(b.path=h.path),f.push(b)}return f},i.prototype.set=function(o,c){var u=this.all(o,{includePath:!0});u.forEach(function(l){var d=l.path,y=d.parent,g=y==null?void 0:y.first(o);d.lastComponent&&(g[d.lastComponent.toString()]=c)})},i.prototype.merge=function(o,c){var u=this.all(o,{includePath:!0});u.forEach(function(l){var d=l.path,y=d.parent,g=y==null?void 0:y.first(o);if(d.lastComponent){var f=g[d.lastComponent.toString()];if(Array.isArray(f))g[d.lastComponent.toString()]=f.concat([c].flat());else{if(typeof c!="object"||Array.isArray(c))return;for(var h in c)f[h]=c[h]}}})},i}();return et.JSONHeroPath=s,et}Th();const be=ja.getInstance(),Ma="timeout";class Rh{abortAfterTimeout(e){return new AbortController().signal}}const wh=new Rh,On=class On{constructor(){V(this,wr)}static getInstance(){return this._instance||(this._instance=new On),this._instance}get signal(){return m(this,wr,as).call(this).signal}abortAfterTimeout(e){return m(this,wr,as).call(this).abortAfterTimeout(e)}setGlobalManager(e){return ie(Ma,e)}disable(){Ge(Ma)}};wr=new WeakSet,as=function(){return _e(Ma)??wh},E(On,"_instance");let Ua=On;const Sh=Ua.getInstance();class Ah{registerTaskMetadata(e){}registerTaskFileMetadata(e,r){}updateTaskMetadata(e,r){}listTaskManifests(){return[]}getTaskManifest(e){}getTask(e){}taskExists(e){return!1}disable(){}}const Da="task-catalog",Ih=new Ah,Pn=class Pn{constructor(){V(this,pe)}static getInstance(){return this._instance||(this._instance=new Pn),this._instance}setGlobalTaskCatalog(e){return ie(Da,e)}disable(){Ge(Da)}registerTaskMetadata(e){m(this,pe,Le).call(this).registerTaskMetadata(e)}updateTaskMetadata(e,r){m(this,pe,Le).call(this).updateTaskMetadata(e,r)}registerTaskFileMetadata(e,r){m(this,pe,Le).call(this).registerTaskFileMetadata(e,r)}listTaskManifests(){return m(this,pe,Le).call(this).listTaskManifests()}getTaskManifest(e){return m(this,pe,Le).call(this).getTaskManifest(e)}getTask(e){return m(this,pe,Le).call(this).getTask(e)}taskExists(e){return m(this,pe,Le).call(this).taskExists(e)}};pe=new WeakSet,Le=function(){return _e(Da)??Ih},E(Pn,"_instance");let $a=Pn;const gr=$a.getInstance();class kh extends Error{constructor(r,a,s){var e=(...Vg)=>(super(...Vg),E(this,"taskId"),E(this,"runId"),E(this,"cause"),this);s instanceof Error?(e(`Error in ${r}: ${s.message}`),this.cause=s,this.name="SubtaskUnwrapError"):(e(`Error in ${r}`),this.name="SubtaskUnwrapError",this.cause=s),this.taskId=r,this.runId=a}}class xh extends Promise{constructor(r,a){super(r);E(this,"taskId");this.taskId=a}unwrap(){return this.then(r=>{if(r.ok)return r.output;throw new kh(this.taskId,r.id,r.error)})}}function Oh(t){return typeof t=="string"&&t.length===64}async function La(t){if(t)return Oh(t)?t:await Ph(t,{scope:"global"})}async function Ph(t,e){return await Ch([...Array.isArray(t)?t:[t]].concat(Nh((e==null?void 0:e.scope)??"run")))}function Nh(t){switch(t){case"run":{if(L!=null&&L.ctx)return[L.ctx.run.id];break}case"attempt":{if(L!=null&&L.ctx)return[L.ctx.attempt.id];break}}return[]}async function Ch(t){const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t.join("-")));return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function jh(t,e){e instanceof Error?t.recordException(Mh(e)):typeof e=="string"?t.recordException(e.replace(/\0/g,"")):t.recordException(JSON.stringify(e).replace(/\0/g,"")),t.setStatus({code:zr.ERROR})}function Mh(t){var r;const e=new Error(t.message.replace(/\0/g,""));return e.name=t.name.replace(/\0/g,""),e.stack=(r=t.stack)==null?void 0:r.replace(/\0/g,""),e}class Uh{constructor(e){E(this,"_config");E(this,"_tracer");E(this,"_logger");this._config=e}get tracer(){if(!this._tracer){if("tracer"in this._config)return this._config.tracer;this._tracer=Md.getTracer(this._config.name,this._config.version)}return this._tracer}get logger(){if(!this._logger){if("logger"in this._config)return this._config.logger;this._logger=uh.getLogger(this._config.name,this._config.version)}return this._logger}extractContext(e){return hi.extract(Yr.active(),e??{})}startActiveSpan(e,r,a,s,i){const o=s??Yr.active(),c=(a==null?void 0:a.attributes)??{};let u=!1;return this.tracer.startActiveSpan(e,{...a,attributes:c,startTime:Gi.preciseNow()},o,async l=>{i==null||i.addEventListener("abort",()=>{u||(u=!0,jh(l,i.reason),l.end())}),L.ctx&&this.tracer.startSpan(e,{...a,attributes:{...c,[x.SPAN_PARTIAL]:!0,[x.SPAN_ID]:l.spanContext().spanId}},o).end();const d=_t.start();try{return await r(l)}catch(y){throw u||((typeof y=="string"||y instanceof Error)&&l.recordException(y),l.setStatus({code:zr.ERROR})),y}finally{if(!u){if(u=!0,L.ctx){const y=_t.stop(d),g=L.ctx.machine;l.setAttributes({[x.USAGE_DURATION_MS]:y.cpuTime,[x.USAGE_COST_IN_CENTS]:g!=null&&g.centsPerMs?y.cpuTime*g.centsPerMs:0})}l.end(Gi.preciseNow())}}})}startSpan(e,r,a){const s=a??Yr.active(),i=(r==null?void 0:r.attributes)??{},o=this.tracer.startSpan(e,r,a);return this.tracer.startSpan(e,{...r,attributes:{...i,[x.SPAN_PARTIAL]:!0,[x.SPAN_ID]:o.spanContext().spanId}},s).end(),o}}const Dh="3.3.13",je=new Uh({name:"@trigger.dev/sdk",version:Dh});function Wg(t){return t}function $h(t){var a;const e=t.queue?{name:((a=t.queue)==null?void 0:a.name)??`task/${t.id}`,...t.queue}:void 0,r={id:t.id,description:t.description,trigger:async(s,i)=>{const o=gr.getTaskManifest(t.id);return await Lh(o&&o.exportName?`${o.exportName}.trigger()`:"trigger()",t.id,s,void 0,{queue:e,...i})},batchTrigger:async(s,i)=>{const o=gr.getTaskManifest(t.id);return await Kh(o&&o.exportName?`${o.exportName}.batchTrigger()`:"batchTrigger()",t.id,s,i,void 0,void 0,e)},triggerAndWait:(s,i)=>{const o=gr.getTaskManifest(t.id);return new xh((c,u)=>{Wh(o&&o.exportName?`${o.exportName}.triggerAndWait()`:"triggerAndWait()",t.id,s,void 0,{queue:e,...i}).then(l=>{c(l)}).catch(l=>{u(l)})},t.id)},batchTriggerAndWait:async(s,i)=>{const o=gr.getTaskManifest(t.id);return await Bh(o&&o.exportName?`${o.exportName}.batchTriggerAndWait()`:"batchTriggerAndWait()",t.id,s,void 0,i,void 0,e)}};return gr.registerTaskMetadata({id:t.id,description:t.description,queue:t.queue,retry:t.retry?{...ti,...t.retry}:void 0,machine:typeof t.machine=="string"?{preset:t.machine}:t.machine,maxDuration:t.maxDuration,fns:{run:t.run,init:t.init,cleanup:t.cleanup,middleware:t.middleware,handleError:t.handleError,onSuccess:t.onSuccess,onFailure:t.onFailure,onStart:t.onStart}}),r[Symbol.for("trigger.dev/task")]=!0,r}async function Lh(t,e,r,a,s,i){var d,y;const o=or.clientOrThrow(),u=await Qr(r);return await o.triggerTask(e,{payload:u.data,options:{queue:s==null?void 0:s.queue,concurrencyKey:s==null?void 0:s.concurrencyKey,test:(d=L.ctx)==null?void 0:d.run.isTest,payloadType:u.dataType,idempotencyKey:await La(s==null?void 0:s.idempotencyKey),idempotencyKeyTTL:s==null?void 0:s.idempotencyKeyTTL,delay:s==null?void 0:s.delay,ttl:s==null?void 0:s.ttl,tags:s==null?void 0:s.tags,maxAttempts:s==null?void 0:s.maxAttempts,parentAttempt:(y=L.ctx)==null?void 0:y.attempt.id,metadata:s==null?void 0:s.metadata,maxDuration:s==null?void 0:s.maxDuration,machine:s==null?void 0:s.machine}},{spanParentAsLink:!0},{name:t,tracer:je,icon:"trigger",onResponseBody:(g,f)=>{g&&typeof g=="object"&&!Array.isArray(g)&&"id"in g&&typeof g.id=="string"&&f.setAttribute("runId",g.id)},...i})}async function Kh(t,e,r,a,s,i,o){const u=await or.clientOrThrow().batchTriggerV2({items:await Promise.all(r.map(async d=>{var f,h,b,A,K,ee,Re,Sr,Ar,Ir,kr,xr,Or;const y=d.payload,g=await Qr(y);return{task:e,payload:g.data,options:{queue:((f=d.options)==null?void 0:f.queue)??o,concurrencyKey:(h=d.options)==null?void 0:h.concurrencyKey,test:(b=L.ctx)==null?void 0:b.run.isTest,payloadType:g.dataType,idempotencyKey:await La((A=d.options)==null?void 0:A.idempotencyKey),idempotencyKeyTTL:(K=d.options)==null?void 0:K.idempotencyKeyTTL,delay:(ee=d.options)==null?void 0:ee.delay,ttl:(Re=d.options)==null?void 0:Re.ttl,tags:(Sr=d.options)==null?void 0:Sr.tags,maxAttempts:(Ar=d.options)==null?void 0:Ar.maxAttempts,parentAttempt:(Ir=L.ctx)==null?void 0:Ir.attempt.id,metadata:(kr=d.options)==null?void 0:kr.metadata,maxDuration:(xr=d.options)==null?void 0:xr.maxDuration,machine:(Or=d.options)==null?void 0:Or.machine}}}))},{spanParentAsLink:!0,idempotencyKey:await La(a==null?void 0:a.idempotencyKey),idempotencyKeyTTL:a==null?void 0:a.idempotencyKeyTTL,processingStrategy:a!=null&&a.triggerSequentially?"sequential":void 0},{name:t,tracer:je,icon:"trigger",onResponseBody(d,y){d&&typeof d=="object"&&!Array.isArray(d)&&("id"in d&&typeof d.id=="string"&&y.setAttribute("batchId",d.id),"runs"in d&&Array.isArray(d.runs)&&y.setAttribute("runCount",d.runs.length),"isCached"in d&&typeof d.isCached=="boolean"&&(d.isCached&&console.warn("Result is a cached response because the request was idempotent."),y.setAttribute("isCached",d.isCached)),"idempotencyKey"in d&&typeof d.idempotencyKey=="string"&&y.setAttribute("idempotencyKey",d.idempotencyKey))},...i});return{batchId:u.id,isCached:u.isCached,idempotencyKey:u.idempotencyKey,runs:u.runs,publicAccessToken:u.publicAccessToken}}async function Wh(t,e,r,a,s,i){const o=L.ctx;if(!o)throw new Error("triggerAndWait can only be used from inside a task.run()");const c=or.clientOrThrow(),l=await Qr(r);return await je.startActiveSpan(t,async d=>{var f,h;const y=await c.triggerTask(e,{payload:l.data,options:{dependentAttempt:o.attempt.id,lockToVersion:(f=L.worker)==null?void 0:f.version,queue:s==null?void 0:s.queue,concurrencyKey:s==null?void 0:s.concurrencyKey,test:(h=L.ctx)==null?void 0:h.run.isTest,payloadType:l.dataType,delay:s==null?void 0:s.delay,ttl:s==null?void 0:s.ttl,tags:s==null?void 0:s.tags,maxAttempts:s==null?void 0:s.maxAttempts,metadata:s==null?void 0:s.metadata,maxDuration:s==null?void 0:s.maxDuration,machine:s==null?void 0:s.machine}},{},i);d.setAttribute("runId",y.id);const g=await Ca.waitForTask({id:y.id,ctx:o});return await Ka(g,e)},{kind:ar.PRODUCER,attributes:{[x.STYLE_ICON]:"trigger",...qr({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function Bh(t,e,r,a,s,i,o){const c=L.ctx;if(!c)throw new Error("batchTriggerAndWait can only be used from inside a task.run()");const u=or.clientOrThrow();return await je.startActiveSpan(t,async l=>{const d=await u.batchTriggerV2({items:await Promise.all(r.map(async f=>{var A,K,ee,Re,Sr,Ar,Ir,kr,xr,Or,Wo;const h=f.payload,b=await Qr(h);return{task:e,payload:b.data,options:{lockToVersion:(A=L.worker)==null?void 0:A.version,queue:((K=f.options)==null?void 0:K.queue)??o,concurrencyKey:(ee=f.options)==null?void 0:ee.concurrencyKey,test:(Re=L.ctx)==null?void 0:Re.run.isTest,payloadType:b.dataType,delay:(Sr=f.options)==null?void 0:Sr.delay,ttl:(Ar=f.options)==null?void 0:Ar.ttl,tags:(Ir=f.options)==null?void 0:Ir.tags,maxAttempts:(kr=f.options)==null?void 0:kr.maxAttempts,metadata:(xr=f.options)==null?void 0:xr.metadata,maxDuration:(Or=f.options)==null?void 0:Or.maxDuration,machine:(Wo=f.options)==null?void 0:Wo.machine}}})),dependentAttempt:c.attempt.id},{processingStrategy:s!=null&&s.triggerSequentially?"sequential":void 0},i);l.setAttribute("batchId",d.id),l.setAttribute("runCount",d.runs.length),l.setAttribute("isCached",d.isCached),d.isCached&&console.warn("Result is a cached response because the request was idempotent."),d.idempotencyKey&&l.setAttribute("idempotencyKey",d.idempotencyKey);const y=await Ca.waitForBatch({id:d.id,runs:d.runs.map(f=>f.id),ctx:c}),g=await Fh(y.items,e);return{id:y.id,runs:g}},{kind:ar.PRODUCER,attributes:{[x.STYLE_ICON]:"trigger",...qr({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function Fh(t,e){return t.some(a=>a.ok&&a.outputType==="application/store")?await je.startActiveSpan("store.downloadPayloads",async a=>await Promise.all(t.map(async i=>await Ka(i,e))),{kind:ar.INTERNAL,[x.STYLE_ICON]:"cloud-download"}):await Promise.all(t.map(async s=>await Ka(s,e)))}async function Ka(t,e){if(t.ok){const r={data:t.output,dataType:t.outputType},a=await bi(r,je);return{ok:!0,id:t.id,taskIdentifier:t.taskIdentifier??e,output:await ma(a)}}else return{ok:!1,id:t.id,taskIdentifier:t.taskIdentifier??e,error:ef(t.error)}}const Wa=$h,Vh={for:async t=>je.startActiveSpan("wait.for()",async e=>{const r=Hh(t);await Ca.waitForDuration(r)},{attributes:{[x.STYLE_ICON]:"wait",...qr({items:[{text:Gh(t),variant:"normal"}],style:"codepath"})}})};function Gh(t){return"seconds"in t?t.seconds===1?"1 second":`${t.seconds} seconds`:"minutes"in t?t.minutes===1?"1 minute":`${t.minutes} minutes`:"hours"in t?t.hours===1?"1 hour":`${t.hours} hours`:"days"in t?t.days===1?"1 day":`${t.days} days`:"weeks"in t?t.weeks===1?"1 week":`${t.weeks} weeks`:"months"in t?t.months===1?"1 month":`${t.months} months`:"years"in t?t.years===1?"1 year":`${t.years} years`:"NaN"}function Hh(t){if("seconds"in t)return t.seconds*1e3;if("minutes"in t)return t.minutes*1e3*60;if("hours"in t)return t.hours*1e3*60*60;if("days"in t)return t.days*1e3*60*60*24;if("weeks"in t)return t.weeks*1e3*60*60*24*7;if("months"in t)return t.months*1e3*60*60*24*30;if("years"in t)return t.years*1e3*60*60*24*365;throw new Error("Invalid options")}be.parent,be.root;const tt={set:Zh,del:Jh,append:qh,remove:Xh,increment:zh,decrement:Yh,flush:Qh};({...tt});function Zh(t,e){return be.set(t,e),tt}function Jh(t){return be.del(t),tt}function zh(t,e=1){return be.increment(t,e),tt}function Yh(t,e=1){return be.decrement(t,e),tt}function qh(t,e){return be.append(t,e),tt}function Xh(t,e){return be.remove(t,e),tt}async function Qh(t){const e=M({tracer:je,name:"metadata.flush()",icon:"code-plus"},t);await be.flush(e)}Sh.signal;const no=process.env.TINYBIRD_TOKEN??void 0,ep=Wa({id:"copy_job",run:async t=>{const e=no??t.token;if(!e)throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.pipeId)throw new Error("Pipe ID not found");try{let r=`https://api.tinybird.co/v0/pipes/${t.pipeId}/copy`;if(t.params){const u=new URLSearchParams;for(const[l,d]of Object.entries(t.params))u.append(l,d.toString());r+=`?${u.toString()}`}const a=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${no}`}}).then(u=>u.json());if(!a||!("job"in a))throw q.error(a),new Error("Invalid response from Tinybird API");const s=a.job.job_id;q.log("Copy job started",{jobId:s});let i="";const o=30;let c=0;for(;c<o;){if(i=(await fetch(`https://api.tinybird.co/v0/jobs/${s}`,{headers:{Authorization:`Bearer ${e}`}}).then(l=>l.json())).status,q.log("Job status check",{jobId:s,status:i,attempt:c+1}),i==="done")return q.log("Copy job completed successfully",{jobId:s}),{success:!0,jobId:s};if(i==="error"||i==="failed")throw new Error(`Copy job failed with status: ${i}`);await Vh.for({seconds:5}),c++}throw new Error(`Job timed out after ${o} attempts`)}catch(r){throw q.error("Error in Tinybird copy job",{error:r}),r}}}),tp=process.env.TINYBIRD_TOKEN??void 0;var Ba=(t=>(t.CSV="CSV",t.CSVWithNames="CSVWithNames",t.JSON="JSON",t.TSV="TSV",t.TSVWithNames="TSVWithNames",t.PrettyCompact="PrettyCompact",t.JSONEachRow="JSONEachRow",t.Parquet="Parquet",t))(Ba||{});function ao(t){return Object.values(Ba).includes(t)}function rp(t){const e=t.trim().match(/FORMAT\s+(\w+)$/i);if(!e)return null;const r=e[1].toUpperCase();return ao(r)?r:null}const np=Wa({id:"tinybird-query",run:async t=>{var i;const e=tp??t.token;if(!e)throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.sql)throw new Error("SQL query is required");let r=t.sql;const a=rp(r);if(t.format&&!ao(t.format.toUpperCase()))throw new Error(`Invalid format: ${t.format}. Valid formats are: ${Object.values(Ba).join(", ")}`);const s=((i=t.format)==null?void 0:i.toUpperCase())??a??"JSON";a||(r+=` FORMAT ${s}`);try{const o=await fetch("https://api.tinybird.co/v0/sql",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({q:r,...t.params})}),c=await o.json();if(console.log(c),o.status!==200){let l={error:"error"};throw"error"in c&&(l=c,q.error("Tinybird query failed",{error:l.error,detail:l.detail})),new Error(`Tinybird query failed: ${l.error}`)}const u=c;return q.info("Query executed successfully",u),u}catch(o){throw q.error("Failed to execute Tinybird query",{error:o instanceof Error?o.message:"Unknown error",sql:t.sql}),o}}}),ap=process.env.TINYBIRD_TOKEN??void 0,sp=Wa({id:"tinybird-pipe",run:async t=>{const e=ap??t.token;if(!e)throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.name)throw new Error("Pipe name is required");try{q.log(`Calling pipe ${t.name}`);const r=new URL(`https://api.tinybird.co/v0/pipes/${t.name}.json`);if(t.params){const o=new URLSearchParams;for(const[c,u]of Object.entries(t.params))o.append(c,u.toString());r.search=o.toString()}q.log(`Calling ${r.toString()}`),q.log(`token ${e}`);const a=await fetch(r,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),s=await a.json();if(q.log(`Response from pipe ${t.name}. Status: ${a.status}`),a.status!==200){let o={error:"error"};throw"error"in s&&(o=s,q.error("Tinybird API request failed",{error:o.error,detail:o.detail})),new Error(`Tinybird API request failed: ${o.error}`)}return s}catch(r){throw q.error("Failed to call Tinybird API",{error:r instanceof Error?r.message:"Unknown error"}),r}}}),Fa=crypto,so=t=>t instanceof CryptoKey,vt=new TextEncoder,Va=new TextDecoder;function ip(...t){const e=t.reduce((s,{length:i})=>s+i,0),r=new Uint8Array(e);let a=0;for(const s of t)r.set(s,a),a+=s.length;return r}const op=t=>{let e=t;typeof e=="string"&&(e=vt.encode(e));const r=32768,a=[];for(let s=0;s<e.length;s+=r)a.push(String.fromCharCode.apply(null,e.subarray(s,s+r)));return btoa(a.join(""))},Ga=t=>op(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),cp=t=>{const e=atob(t),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return r},Ha=t=>{let e=t;e instanceof Uint8Array&&(e=Va.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return cp(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Y extends Error{constructor(e,r){var a;super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(a=Error.captureStackTrace)==null||a.call(Error,this,this.constructor)}}Y.code="ERR_JOSE_GENERIC";class up extends Y{constructor(e,r,a="unspecified",s="unspecified"){super(e,{cause:{claim:a,reason:s,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=a,this.reason=s,this.payload=r}}up.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class lp extends Y{constructor(e,r,a="unspecified",s="unspecified"){super(e,{cause:{claim:a,reason:s,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=a,this.reason=s,this.payload=r}}lp.code="ERR_JWT_EXPIRED";class dp extends Y{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}dp.code="ERR_JOSE_ALG_NOT_ALLOWED";class rt extends Y{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}rt.code="ERR_JOSE_NOT_SUPPORTED";class fp extends Y{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}fp.code="ERR_JWE_DECRYPTION_FAILED";class hp extends Y{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}hp.code="ERR_JWE_INVALID";class bt extends Y{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}bt.code="ERR_JWS_INVALID";class io extends Y{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}io.code="ERR_JWT_INVALID";class pp extends Y{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}pp.code="ERR_JWK_INVALID";class gp extends Y{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}gp.code="ERR_JWKS_INVALID";class mp extends Y{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}mp.code="ERR_JWKS_NO_MATCHING_KEY";class yp extends Y{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}yp.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class _p extends Y{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}}_p.code="ERR_JWKS_TIMEOUT";class vp extends Y{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}vp.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function Ee(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function gn(t,e){return t.name===e}function Za(t){return parseInt(t.name.slice(4),10)}function bp(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Ep(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const a=e.pop();r+=`one of ${e.join(", ")}, or ${a}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function Tp(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!gn(t.algorithm,"HMAC"))throw Ee("HMAC");const a=parseInt(e.slice(2),10);if(Za(t.algorithm.hash)!==a)throw Ee(`SHA-${a}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!gn(t.algorithm,"RSASSA-PKCS1-v1_5"))throw Ee("RSASSA-PKCS1-v1_5");const a=parseInt(e.slice(2),10);if(Za(t.algorithm.hash)!==a)throw Ee(`SHA-${a}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!gn(t.algorithm,"RSA-PSS"))throw Ee("RSA-PSS");const a=parseInt(e.slice(2),10);if(Za(t.algorithm.hash)!==a)throw Ee(`SHA-${a}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw Ee("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!gn(t.algorithm,"ECDSA"))throw Ee("ECDSA");const a=bp(e);if(t.algorithm.namedCurve!==a)throw Ee(a,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Ep(t,r)}function oo(t,e,...r){var a;if(r=r.filter(Boolean),r.length>2){const s=r.pop();t+=`one of type ${r.join(", ")}, or ${s}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(a=e.constructor)!=null&&a.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const co=(t,...e)=>oo("Key must be ",t,...e);function uo(t,e,...r){return oo(`Key for the ${t} algorithm must be `,e,...r)}const lo=t=>so(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",mn=["CryptoKey"],Rp=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(const a of e){const s=Object.keys(a);if(!r||r.size===0){r=new Set(s);continue}for(const i of s){if(r.has(i))return!1;r.add(i)}}return!0};function wp(t){return typeof t=="object"&&t!==null}function fo(t){if(!wp(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const Sp=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function mr(t){return fo(t)&&typeof t.kty=="string"}function Ap(t){return t.kty!=="oct"&&typeof t.d=="string"}function Ip(t){return t.kty!=="oct"&&typeof t.d>"u"}function kp(t){return mr(t)&&t.kty==="oct"&&typeof t.k=="string"}function xp(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new rt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new rt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new rt('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new rt('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const Op=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=xp(t),a=[e,t.ext??!1,t.key_ops??r],s={...t};return delete s.alg,delete s.use,Fa.subtle.importKey("jwk",s,...a)},ho=t=>Ha(t);let Et,Tt;const po=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",yn=async(t,e,r,a,s=!1)=>{let i=t.get(e);if(i!=null&&i[a])return i[a];const o=await Op({...r,alg:a});return s&&Object.freeze(e),i?i[a]=o:t.set(e,{[a]:o}),o},Pp={normalizePublicKey:(t,e)=>{if(po(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?ho(r.k):(Tt||(Tt=new WeakMap),yn(Tt,t,r,e))}return mr(t)?t.k?Ha(t.k):(Tt||(Tt=new WeakMap),yn(Tt,t,t,e,!0)):t},normalizePrivateKey:(t,e)=>{if(po(t)){let r=t.export({format:"jwk"});return r.k?ho(r.k):(Et||(Et=new WeakMap),yn(Et,t,r,e))}return mr(t)?t.k?Ha(t.k):(Et||(Et=new WeakMap),yn(Et,t,t,e,!0)):t}},Rt=t=>t==null?void 0:t[Symbol.toStringTag],Ja=(t,e,r)=>{var a,s;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((s=(a=e.key_ops).includes)==null?void 0:s.call(a,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},Np=(t,e,r,a)=>{if(!(e instanceof Uint8Array)){if(a&&mr(e)){if(kp(e)&&Ja(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!lo(e))throw new TypeError(uo(t,e,...mn,"Uint8Array",a?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${Rt(e)} instances for symmetric algorithms must be of type "secret"`)}},Cp=(t,e,r,a)=>{if(a&&mr(e))switch(r){case"sign":if(Ap(e)&&Ja(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(Ip(e)&&Ja(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!lo(e))throw new TypeError(uo(t,e,...mn,a?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${Rt(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${Rt(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${Rt(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${Rt(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${Rt(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function go(t,e,r,a){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?Np(e,r,a,t):Cp(e,r,a,t)}go.bind(void 0,!1);const jp=go.bind(void 0,!0);function Mp(t,e,r,a,s){if(s.crit!==void 0&&(a==null?void 0:a.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||a.crit===void 0)return new Set;if(!Array.isArray(a.crit)||a.crit.length===0||a.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...e.entries()]):i=e;for(const o of a.crit){if(!i.has(o))throw new rt(`Extension Header Parameter "${o}" is not recognized`);if(s[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&a[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(a.crit)}function Up(t,e){const r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new rt(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function Dp(t,e,r){if(e=await Pp.normalizePrivateKey(e,t),so(e))return Tp(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(co(e,...mn));return Fa.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(co(e,...mn,"Uint8Array","JSON Web Key"))}const nt=t=>Math.floor(t.getTime()/1e3),mo=60,yo=mo*60,za=yo*24,$p=za*7,Lp=za*365.25,Kp=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Ya=t=>{const e=Kp.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const r=parseFloat(e[2]),a=e[3].toLowerCase();let s;switch(a){case"sec":case"secs":case"second":case"seconds":case"s":s=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":s=Math.round(r*mo);break;case"hour":case"hours":case"hr":case"hrs":case"h":s=Math.round(r*yo);break;case"day":case"days":case"d":s=Math.round(r*za);break;case"week":case"weeks":case"w":s=Math.round(r*$p);break;default:s=Math.round(r*Lp);break}return e[1]==="-"||e[4]==="ago"?-s:s},Wp=async(t,e,r)=>{const a=await Dp(t,e,"sign");Sp(t,a);const s=await Fa.subtle.sign(Up(t,a.algorithm),a,r);return new Uint8Array(s)};class _o{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new bt("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Rp(this._protectedHeader,this._unprotectedHeader))throw new bt("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const a={...this._protectedHeader,...this._unprotectedHeader},s=Mp(bt,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,a);let i=!0;if(s.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new bt('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=a;if(typeof o!="string"||!o)throw new bt('JWS "alg" (Algorithm) Header Parameter missing or invalid');jp(o,e,"sign");let c=this._payload;i&&(c=vt.encode(Ga(c)));let u;this._protectedHeader?u=vt.encode(Ga(JSON.stringify(this._protectedHeader))):u=vt.encode("");const l=ip(u,vt.encode("."),c),d=await Wp(o,e,l),y={signature:Ga(d),payload:""};return i&&(y.payload=Va.decode(c)),this._unprotectedHeader&&(y.header=this._unprotectedHeader),this._protectedHeader&&(y.protected=Va.decode(u)),y}}class vo{constructor(e){this._flattened=new _o(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){const a=await this._flattened.sign(e,r);if(a.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${a.protected}.${a.payload}.${a.signature}`}}function at(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}class Bp{constructor(e={}){if(!fo(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:at("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:at("setNotBefore",nt(e))}:this._payload={...this._payload,nbf:nt(new Date)+Ya(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:at("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:at("setExpirationTime",nt(e))}:this._payload={...this._payload,exp:nt(new Date)+Ya(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:nt(new Date)}:e instanceof Date?this._payload={...this._payload,iat:at("setIssuedAt",nt(e))}:typeof e=="string"?this._payload={...this._payload,iat:at("setIssuedAt",nt(new Date)+Ya(e))}:this._payload={...this._payload,iat:at("setIssuedAt",e)},this}}class Fp extends Bp{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var s;const a=new vo(vt.encode(JSON.stringify(this._payload)));if(a.setProtectedHeader(this._protectedHeader),Array.isArray((s=this._protectedHeader)==null?void 0:s.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new io("JWTs MUST NOT use unencoded payload");return a.sign(e,r)}}const Vp=Object.freeze(Object.defineProperty({__proto__:null,CompactSign:vo,FlattenedSign:_o,SignJWT:Fp},Symbol.toStringTag,{value:"Module"}));class Gp{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,r){this.keyToValue.set(e,r),this.valueToKey.set(r,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class bo{constructor(e){this.generateIdentifier=e,this.kv=new Gp}register(e,r){this.kv.getByValue(e)||(r||(r=this.generateIdentifier(e)),this.kv.set(r,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}}class Hp extends bo{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(e,r.allowProps),super.register(e,r.identifier)):super.register(e,r)}getAllowedProps(e){return this.classToAllowedProps.get(e)}}function Zp(t){if("values"in Object)return Object.values(t);const e=[];for(const r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e}function Jp(t,e){const r=Zp(t);if("find"in r)return r.find(e);const a=r;for(let s=0;s<a.length;s++){const i=a[s];if(e(i))return i}}function wt(t,e){Object.entries(t).forEach(([r,a])=>e(a,r))}function _n(t,e){return t.indexOf(e)!==-1}function Eo(t,e){for(let r=0;r<t.length;r++){const a=t[r];if(e(a))return a}}class zp{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return Jp(this.transfomers,r=>r.isApplicable(e))}findByName(e){return this.transfomers[e]}}const Yp=t=>Object.prototype.toString.call(t).slice(8,-1),To=t=>typeof t>"u",qp=t=>t===null,yr=t=>typeof t!="object"||t===null||t===Object.prototype?!1:Object.getPrototypeOf(t)===null?!0:Object.getPrototypeOf(t)===Object.prototype,qa=t=>yr(t)&&Object.keys(t).length===0,Me=t=>Array.isArray(t),Xp=t=>typeof t=="string",Qp=t=>typeof t=="number"&&!isNaN(t),eg=t=>typeof t=="boolean",tg=t=>t instanceof RegExp,_r=t=>t instanceof Map,vr=t=>t instanceof Set,Ro=t=>Yp(t)==="Symbol",rg=t=>t instanceof Date&&!isNaN(t.valueOf()),ng=t=>t instanceof Error,wo=t=>typeof t=="number"&&isNaN(t),ag=t=>eg(t)||qp(t)||To(t)||Qp(t)||Xp(t)||Ro(t),sg=t=>typeof t=="bigint",ig=t=>t===1/0||t===-1/0,og=t=>ArrayBuffer.isView(t)&&!(t instanceof DataView),cg=t=>t instanceof URL,So=t=>t.replace(/\./g,"\\."),Xa=t=>t.map(String).map(So).join("."),br=t=>{const e=[];let r="";for(let s=0;s<t.length;s++){let i=t.charAt(s);if(i==="\\"&&t.charAt(s+1)==="."){r+=".",s++;continue}if(i==="."){e.push(r),r="";continue}r+=i}const a=r;return e.push(a),e};function he(t,e,r,a){return{isApplicable:t,annotation:e,transform:r,untransform:a}}const Ao=[he(To,"undefined",()=>null,()=>{}),he(sg,"bigint",t=>t.toString(),t=>typeof BigInt<"u"?BigInt(t):(console.error("Please add a BigInt polyfill."),t)),he(rg,"Date",t=>t.toISOString(),t=>new Date(t)),he(ng,"Error",(t,e)=>{const r={name:t.name,message:t.message};return e.allowedErrorProps.forEach(a=>{r[a]=t[a]}),r},(t,e)=>{const r=new Error(t.message);return r.name=t.name,r.stack=t.stack,e.allowedErrorProps.forEach(a=>{r[a]=t[a]}),r}),he(tg,"regexp",t=>""+t,t=>{const e=t.slice(1,t.lastIndexOf("/")),r=t.slice(t.lastIndexOf("/")+1);return new RegExp(e,r)}),he(vr,"set",t=>[...t.values()],t=>new Set(t)),he(_r,"map",t=>[...t.entries()],t=>new Map(t)),he(t=>wo(t)||ig(t),"number",t=>wo(t)?"NaN":t>0?"Infinity":"-Infinity",Number),he(t=>t===0&&1/t===-1/0,"number",()=>"-0",Number),he(cg,"URL",t=>t.toString(),t=>new URL(t))];function vn(t,e,r,a){return{isApplicable:t,annotation:e,transform:r,untransform:a}}const Io=vn((t,e)=>Ro(t)?!!e.symbolRegistry.getIdentifier(t):!1,(t,e)=>["symbol",e.symbolRegistry.getIdentifier(t)],t=>t.description,(t,e,r)=>{const a=r.symbolRegistry.getValue(e[1]);if(!a)throw new Error("Trying to deserialize unknown symbol");return a}),ug=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((t,e)=>(t[e.name]=e,t),{}),ko=vn(og,t=>["typed-array",t.constructor.name],t=>[...t],(t,e)=>{const r=ug[e[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(t)});function xo(t,e){return t!=null&&t.constructor?!!e.classRegistry.getIdentifier(t.constructor):!1}const Oo=vn(xo,(t,e)=>["class",e.classRegistry.getIdentifier(t.constructor)],(t,e)=>{const r=e.classRegistry.getAllowedProps(t.constructor);if(!r)return{...t};const a={};return r.forEach(s=>{a[s]=t[s]}),a},(t,e,r)=>{const a=r.classRegistry.getValue(e[1]);if(!a)throw new Error(`Trying to deserialize unknown class '${e[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(a.prototype),t)}),Po=vn((t,e)=>!!e.customTransformerRegistry.findApplicable(t),(t,e)=>["custom",e.customTransformerRegistry.findApplicable(t).name],(t,e)=>e.customTransformerRegistry.findApplicable(t).serialize(t),(t,e,r)=>{const a=r.customTransformerRegistry.findByName(e[1]);if(!a)throw new Error("Trying to deserialize unknown custom value");return a.deserialize(t)}),lg=[Oo,Io,Po,ko],No=(t,e)=>{const r=Eo(lg,s=>s.isApplicable(t,e));if(r)return{value:r.transform(t,e),type:r.annotation(t,e)};const a=Eo(Ao,s=>s.isApplicable(t,e));if(a)return{value:a.transform(t,e),type:a.annotation}},Co={};Ao.forEach(t=>{Co[t.annotation]=t});const dg=(t,e,r)=>{if(Me(e))switch(e[0]){case"symbol":return Io.untransform(t,e,r);case"class":return Oo.untransform(t,e,r);case"custom":return Po.untransform(t,e,r);case"typed-array":return ko.untransform(t,e,r);default:throw new Error("Unknown transformation: "+e)}else{const a=Co[e];if(!a)throw new Error("Unknown transformation: "+e);return a.untransform(t,r)}},St=(t,e)=>{if(e>t.size)throw new Error("index out of bounds");const r=t.keys();for(;e>0;)r.next(),e--;return r.next().value};function jo(t){if(_n(t,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(_n(t,"prototype"))throw new Error("prototype is not allowed as a property");if(_n(t,"constructor"))throw new Error("constructor is not allowed as a property")}const fg=(t,e)=>{jo(e);for(let r=0;r<e.length;r++){const a=e[r];if(vr(t))t=St(t,+a);else if(_r(t)){const s=+a,i=+e[++r]==0?"key":"value",o=St(t,s);switch(i){case"key":t=o;break;case"value":t=t.get(o);break}}else t=t[a]}return t},Qa=(t,e,r)=>{if(jo(e),e.length===0)return r(t);let a=t;for(let i=0;i<e.length-1;i++){const o=e[i];if(Me(a)){const c=+o;a=a[c]}else if(yr(a))a=a[o];else if(vr(a)){const c=+o;a=St(a,c)}else if(_r(a)){if(i===e.length-2)break;const u=+o,l=+e[++i]==0?"key":"value",d=St(a,u);switch(l){case"key":a=d;break;case"value":a=a.get(d);break}}}const s=e[e.length-1];if(Me(a)?a[+s]=r(a[+s]):yr(a)&&(a[s]=r(a[s])),vr(a)){const i=St(a,+s),o=r(i);i!==o&&(a.delete(i),a.add(o))}if(_r(a)){const i=+e[e.length-2],o=St(a,i);switch(+s==0?"key":"value"){case"key":{const u=r(o);a.set(u,a.get(o)),u!==o&&a.delete(o);break}case"value":{a.set(o,r(a.get(o)));break}}}return t};function es(t,e,r=[]){if(!t)return;if(!Me(t)){wt(t,(i,o)=>es(i,e,[...r,...br(o)]));return}const[a,s]=t;s&&wt(s,(i,o)=>{es(i,e,[...r,...br(o)])}),e(a,r)}function hg(t,e,r){return es(e,(a,s)=>{t=Qa(t,s,i=>dg(i,a,r))}),t}function pg(t,e){function r(a,s){const i=fg(t,br(s));a.map(br).forEach(o=>{t=Qa(t,o,()=>i)})}if(Me(e)){const[a,s]=e;a.forEach(i=>{t=Qa(t,br(i),()=>t)}),s&&wt(s,r)}else wt(e,r);return t}const gg=(t,e)=>yr(t)||Me(t)||_r(t)||vr(t)||xo(t,e);function mg(t,e,r){const a=r.get(t);a?a.push(e):r.set(t,[e])}function yg(t,e){const r={};let a;return t.forEach(s=>{if(s.length<=1)return;e||(s=s.map(c=>c.map(String)).sort((c,u)=>c.length-u.length));const[i,...o]=s;i.length===0?a=o.map(Xa):r[Xa(i)]=o.map(Xa)}),a?qa(r)?[a]:[a,r]:qa(r)?void 0:r}const Mo=(t,e,r,a,s=[],i=[],o=new Map)=>{const c=ag(t);if(!c){mg(t,s,e);const f=o.get(t);if(f)return a?{transformedValue:null}:f}if(!gg(t,r)){const f=No(t,r),h=f?{transformedValue:f.value,annotations:[f.type]}:{transformedValue:t};return c||o.set(t,h),h}if(_n(i,t))return{transformedValue:null};const u=No(t,r),l=(u==null?void 0:u.value)??t,d=Me(l)?[]:{},y={};wt(l,(f,h)=>{if(h==="__proto__"||h==="constructor"||h==="prototype")throw new Error(`Detected property ${h}. This is a prototype pollution risk, please remove it from your object.`);const b=Mo(f,e,r,a,[...s,h],[...i,t],o);d[h]=b.transformedValue,Me(b.annotations)?y[h]=b.annotations:yr(b.annotations)&&wt(b.annotations,(A,K)=>{y[So(h)+"."+K]=A})});const g=qa(y)?{transformedValue:d,annotations:u?[u.type]:void 0}:{transformedValue:d,annotations:u?[u.type,y]:y};return c||o.set(t,g),g};function Uo(t){return Object.prototype.toString.call(t).slice(8,-1)}function Do(t){return Uo(t)==="Array"}function _g(t){if(Uo(t)!=="Object")return!1;const e=Object.getPrototypeOf(t);return!!e&&e.constructor===Object&&e===Object.prototype}function vg(t,e,r,a,s){const i={}.propertyIsEnumerable.call(a,e)?"enumerable":"nonenumerable";i==="enumerable"&&(t[e]=r),s&&i==="nonenumerable"&&Object.defineProperty(t,e,{value:r,enumerable:!1,writable:!0,configurable:!0})}function ts(t,e={}){if(Do(t))return t.map(s=>ts(s,e));if(!_g(t))return t;const r=Object.getOwnPropertyNames(t),a=Object.getOwnPropertySymbols(t);return[...r,...a].reduce((s,i)=>{if(Do(e.props)&&!e.props.includes(i))return s;const o=t[i],c=ts(o,e);return vg(s,i,c,t,e.nonenumerable),s},{})}class N{constructor({dedupe:e=!1}={}){this.classRegistry=new Hp,this.symbolRegistry=new bo(r=>r.description??""),this.customTransformerRegistry=new zp,this.allowedErrorProps=[],this.dedupe=e}serialize(e){const r=new Map,a=Mo(e,r,this,this.dedupe),s={json:a.transformedValue};a.annotations&&(s.meta={...s.meta,values:a.annotations});const i=yg(r,this.dedupe);return i&&(s.meta={...s.meta,referentialEqualities:i}),s}deserialize(e){const{json:r,meta:a}=e;let s=ts(r);return a!=null&&a.values&&(s=hg(s,a.values,this)),a!=null&&a.referentialEqualities&&(s=pg(s,a.referentialEqualities)),s}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,r){this.classRegistry.register(e,r)}registerSymbol(e,r){this.symbolRegistry.register(e,r)}registerCustom(e,r){this.customTransformerRegistry.register({name:r,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}}N.defaultInstance=new N,N.serialize=N.defaultInstance.serialize.bind(N.defaultInstance),N.deserialize=N.defaultInstance.deserialize.bind(N.defaultInstance),N.stringify=N.defaultInstance.stringify.bind(N.defaultInstance),N.parse=N.defaultInstance.parse.bind(N.defaultInstance),N.registerClass=N.defaultInstance.registerClass.bind(N.defaultInstance),N.registerSymbol=N.defaultInstance.registerSymbol.bind(N.defaultInstance),N.registerCustom=N.defaultInstance.registerCustom.bind(N.defaultInstance),N.allowErrorProps=N.defaultInstance.allowErrorProps.bind(N.defaultInstance);const bg=N.serialize,Eg=N.deserialize,Tg=N.stringify,Rg=N.parse,wg=N.registerClass,Sg=N.registerCustom,Ag=N.registerSymbol,Ig=N.allowErrorProps,kg=Object.freeze(Object.defineProperty({__proto__:null,SuperJSON:N,allowErrorProps:Ig,default:N,deserialize:Eg,parse:Rg,registerClass:wg,registerCustom:Sg,registerSymbol:Ag,serialize:bg,stringify:Tg},Symbol.toStringTag,{value:"Module"}));j.tinybirdCopyTask=ep,j.tinybirdPipeTask=sp,j.tinybirdQueryTask=np,Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
