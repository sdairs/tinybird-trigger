(function(L,v){typeof exports=="object"&&typeof module<"u"?v(exports):typeof define=="function"&&define.amd?define(["exports"],v):(L=typeof globalThis<"u"?globalThis:L||self,v(L.TinybirdTriggerTasks={}))})(this,function(L){"use strict";var Dp=Object.defineProperty;var _o=L=>{throw TypeError(L)};var Up=(L,v,Z)=>v in L?Dp(L,v,{enumerable:!0,configurable:!0,writable:!0,value:Z}):L[v]=Z;var _=(L,v,Z)=>Up(L,typeof v!="symbol"?v+"":v,Z),$p=(L,v,Z)=>v.has(L)||_o("Cannot "+Z);var q=(L,v,Z)=>v.has(L)?_o("Cannot add the same private member more than once"):v instanceof WeakSet?v.add(L):v.set(L,Z);var m=(L,v,Z)=>($p(L,v,"access private method"),Z);var Rt,yn,cn,bo,un,vo,wt,_n,O,P,bn,yr,Ws,ye,rt,Pe,St,Ce,At,_r,Vs,fe,Me;var v;(function(t){t.assertEqual=a=>a;function e(a){}t.assertIs=e;function r(a){throw new Error}t.assertNever=r,t.arrayToEnum=a=>{const i={};for(const o of a)i[o]=o;return i},t.getValidEnumValues=a=>{const i=t.objectKeys(a).filter(c=>typeof a[a[c]]!="number"),o={};for(const c of i)o[c]=a[c];return t.objectValues(o)},t.objectValues=a=>t.objectKeys(a).map(function(i){return a[i]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const o in a)Object.prototype.hasOwnProperty.call(a,o)&&i.push(o);return i},t.find=(a,i)=>{for(const o of a)if(i(o))return o},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function s(a,i=" | "){return a.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}t.joinValues=s,t.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(v||(v={}));var Z;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(Z||(Z={}));const p=v.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_e=t=>{switch(typeof t){case"undefined":return p.undefined;case"string":return p.string;case"number":return isNaN(t)?p.nan:p.number;case"boolean":return p.boolean;case"function":return p.function;case"bigint":return p.bigint;case"symbol":return p.symbol;case"object":return Array.isArray(t)?p.array:t===null?p.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?p.promise:typeof Map<"u"&&t instanceof Map?p.map:typeof Set<"u"&&t instanceof Set?p.set:typeof Date<"u"&&t instanceof Date?p.date:p.object;default:return p.unknown}},f=v.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),To=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:");class J extends Error{constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const r=e||function(i){return i.message},s={_errors:[]},a=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(a);else if(o.code==="invalid_return_type")a(o.returnTypeError);else if(o.code==="invalid_arguments")a(o.argumentsError);else if(o.path.length===0)s._errors.push(r(o));else{let c=s,u=0;for(;u<o.path.length;){const l=o.path[u];u===o.path.length-1?(c[l]=c[l]||{_errors:[]},c[l]._errors.push(r(o))):c[l]=c[l]||{_errors:[]},c=c[l],u++}}};return a(this),s}static assert(e){if(!(e instanceof J))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,v.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){const r={},s=[];for(const a of this.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(e(a))):s.push(e(a));return{formErrors:s,fieldErrors:r}}get formErrors(){return this.flatten()}}J.create=t=>new J(t);const nt=(t,e)=>{let r;switch(t.code){case f.invalid_type:t.received===p.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case f.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,v.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:r=`Unrecognized key(s) in object: ${v.joinValues(t.keys,", ")}`;break;case f.invalid_union:r="Invalid input";break;case f.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${v.joinValues(t.options)}`;break;case f.invalid_enum_value:r=`Invalid enum value. Expected ${v.joinValues(t.options)}, received '${t.received}'`;break;case f.invalid_arguments:r="Invalid function arguments";break;case f.invalid_return_type:r="Invalid function return type";break;case f.invalid_date:r="Invalid date";break;case f.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:v.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case f.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case f.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case f.custom:r="Invalid input";break;case f.invalid_intersection_types:r="Intersection results could not be merged";break;case f.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case f.not_finite:r="Number must be finite";break;default:r=e.defaultError,v.assertNever(t)}return{message:r}};let Bs=nt;function Ro(t){Bs=t}function wr(){return Bs}const Sr=t=>{const{data:e,path:r,errorMaps:s,issueData:a}=t,i=[...r,...a.path||[]],o={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let c="";const u=s.filter(l=>!!l).slice().reverse();for(const l of u)c=l(o,{data:e,defaultError:c}).message;return{...a,path:i,message:c}},wo=[];function h(t,e){const r=wr(),s=Sr({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===nt?void 0:nt].filter(a=>!!a)});t.common.issues.push(s)}class B{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){const s=[];for(const a of r){if(a.status==="aborted")return R;a.status==="dirty"&&e.dirty(),s.push(a.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,r){const s=[];for(const a of r){const i=await a.key,o=await a.value;s.push({key:i,value:o})}return B.mergeObjectSync(e,s)}static mergeObjectSync(e,r){const s={};for(const a of r){const{key:i,value:o}=a;if(i.status==="aborted"||o.status==="aborted")return R;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||a.alwaysSet)&&(s[i.value]=o.value)}return{status:e.value,value:s}}}const R=Object.freeze({status:"aborted"}),st=t=>({status:"dirty",value:t}),F=t=>({status:"valid",value:t}),vn=t=>t.status==="aborted",En=t=>t.status==="dirty",It=t=>t.status==="valid",kt=t=>typeof Promise<"u"&&t instanceof Promise;function Ar(t,e,r,s){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(t)}function Fs(t,e,r,s,a){if(typeof e=="function"?t!==e||!0:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,r),r}typeof SuppressedError=="function"&&SuppressedError;var b;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(b||(b={}));var Ot,xt;class se{constructor(e,r,s,a){this._cachedPath=[],this.parent=e,this.data=r,this._path=s,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Hs=(t,e)=>{if(It(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new J(t.common.issues);return this._error=r,this._error}}};function w(t){if(!t)return{};const{errorMap:e,invalid_type_error:r,required_error:s,description:a}=t;if(e&&(r||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(o,c)=>{var u,l;const{message:d}=t;return o.code==="invalid_enum_value"?{message:d??c.defaultError}:typeof c.data>"u"?{message:(u=d??s)!==null&&u!==void 0?u:c.defaultError}:o.code!=="invalid_type"?{message:c.defaultError}:{message:(l=d??r)!==null&&l!==void 0?l:c.defaultError}},description:a}}class S{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return _e(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:_e(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new B,ctx:{common:e.parent.common,data:e.data,parsedType:_e(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const r=this._parse(e);if(kt(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){const r=this._parse(e);return Promise.resolve(r)}parse(e,r){const s=this.safeParse(e,r);if(s.success)return s.data;throw s.error}safeParse(e,r){var s;const a={common:{issues:[],async:(s=r==null?void 0:r.async)!==null&&s!==void 0?s:!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_e(e)},i=this._parseSync({data:e,path:a.path,parent:a});return Hs(a,i)}async parseAsync(e,r){const s=await this.safeParseAsync(e,r);if(s.success)return s.data;throw s.error}async safeParseAsync(e,r){const s={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:_e(e)},a=this._parse({data:e,path:s.path,parent:s}),i=await(kt(a)?a:Promise.resolve(a));return Hs(s,i)}refine(e,r){const s=a=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(a):r;return this._refinement((a,i)=>{const o=e(a),c=()=>i.addIssue({code:f.custom,...s(a)});return typeof Promise<"u"&&o instanceof Promise?o.then(u=>u?!0:(c(),!1)):o?!0:(c(),!1)})}refinement(e,r){return this._refinement((s,a)=>e(s)?!0:(a.addIssue(typeof r=="function"?r(s,a):r),!1))}_refinement(e){return new te({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ie.create(this,this._def)}nullable(){return Te.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ee.create(this,this._def)}promise(){return ct.create(this,this._def)}or(e){return Mt.create([this,e],this._def)}and(e){return jt.create(this,e,this._def)}transform(e){return new te({...w(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const r=typeof e=="function"?e:()=>e;return new Kt({...w(this._def),innerType:this,defaultValue:r,typeName:T.ZodDefault})}brand(){return new wn({typeName:T.ZodBranded,type:this,...w(this._def)})}catch(e){const r=typeof e=="function"?e:()=>e;return new Wt({...w(this._def),innerType:this,catchValue:r,typeName:T.ZodCatch})}describe(e){const r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Vt.create(this,e)}readonly(){return Gt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const So=/^c[^\s-]{8,}$/i,Ao=/^[0-9a-z]+$/,Io=/^[0-9A-HJKMNP-TV-Z]{26}$/,ko=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Oo=/^[a-z0-9_-]{21}$/i,xo=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,No=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Po="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Tn;const Co=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Mo=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,jo=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Zs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Do=new RegExp(`^${Zs}$`);function zs(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Uo(t){return new RegExp(`^${zs(t)}$`)}function Js(t){let e=`${Zs}T${zs(t)}`;const r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function $o(t,e){return!!((e==="v4"||!e)&&Co.test(t)||(e==="v6"||!e)&&Mo.test(t))}class Q extends S{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==p.string){const i=this._getOrReturnCtx(e);return h(i,{code:f.invalid_type,expected:p.string,received:i.parsedType}),R}const s=new B;let a;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,c=e.data.length<i.value;(o||c)&&(a=this._getOrReturnCtx(e,a),o?h(a,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&h(a,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")No.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"email",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Tn||(Tn=new RegExp(Po,"u")),Tn.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"emoji",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")ko.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"uuid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Oo.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"nanoid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")So.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"cuid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Ao.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"cuid2",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Io.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"ulid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),h(a,{validation:"url",code:f.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"regex",code:f.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Js(i).test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Do.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Uo(i).test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?xo.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"duration",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?$o(e.data,i.version)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"ip",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?jo.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"base64",code:f.invalid_string,message:i.message}),s.dirty()):v.assertNever(i);return{status:s.value,value:e.data}}_regex(e,r,s){return this.refinement(a=>e.test(a),{validation:r,code:f.invalid_string,...b.errToObj(s)})}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...b.errToObj(e)})}url(e){return this._addCheck({kind:"url",...b.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...b.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...b.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...b.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...b.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...b.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...b.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...b.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...b.errToObj(e)})}datetime(e){var r,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(r=e==null?void 0:e.offset)!==null&&r!==void 0?r:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,...b.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...b.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...b.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...b.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r==null?void 0:r.position,...b.errToObj(r==null?void 0:r.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...b.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...b.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...b.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...b.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...b.errToObj(r)})}nonempty(e){return this.min(1,b.errToObj(e))}trim(){return new Q({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Q({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Q({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get minLength(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}Q.create=t=>{var e;return new Q({checks:[],typeName:T.ZodString,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...w(t)})};function Lo(t,e){const r=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,a=r>s?r:s,i=parseInt(t.toFixed(a).replace(".","")),o=parseInt(e.toFixed(a).replace(".",""));return i%o/Math.pow(10,a)}class be extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==p.number){const i=this._getOrReturnCtx(e);return h(i,{code:f.invalid_type,expected:p.number,received:i.parsedType}),R}let s;const a=new B;for(const i of this._def.checks)i.kind==="int"?v.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:f.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Lo(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),h(s,{code:f.not_finite,message:i.message}),a.dirty()):v.assertNever(i);return{status:a.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,b.toString(r))}gt(e,r){return this.setLimit("min",e,!1,b.toString(r))}lte(e,r){return this.setLimit("max",e,!0,b.toString(r))}lt(e,r){return this.setLimit("max",e,!1,b.toString(r))}setLimit(e,r,s,a){return new be({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:b.toString(a)}]})}_addCheck(e){return new be({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:b.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:b.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:b.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:b.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:b.toString(e)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&v.isInteger(e.value))}get isFinite(){let e=null,r=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(r===null||s.value>r)&&(r=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(r)&&Number.isFinite(e)}}be.create=t=>new be({checks:[],typeName:T.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...w(t)});class ve extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==p.bigint){const i=this._getOrReturnCtx(e);return h(i,{code:f.invalid_type,expected:p.bigint,received:i.parsedType}),R}let s;const a=new B;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),h(s,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):v.assertNever(i);return{status:a.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,b.toString(r))}gt(e,r){return this.setLimit("min",e,!1,b.toString(r))}lte(e,r){return this.setLimit("max",e,!0,b.toString(r))}lt(e,r){return this.setLimit("max",e,!1,b.toString(r))}setLimit(e,r,s,a){return new ve({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:s,message:b.toString(a)}]})}_addCheck(e){return new ve({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:b.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:b.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:b.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:b.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:b.toString(r)})}get minValue(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}}ve.create=t=>{var e;return new ve({checks:[],typeName:T.ZodBigInt,coerce:(e=t==null?void 0:t.coerce)!==null&&e!==void 0?e:!1,...w(t)})};class Nt extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==p.boolean){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.boolean,received:s.parsedType}),R}return F(e.data)}}Nt.create=t=>new Nt({typeName:T.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...w(t)});class je extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==p.date){const i=this._getOrReturnCtx(e);return h(i,{code:f.invalid_type,expected:p.date,received:i.parsedType}),R}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return h(i,{code:f.invalid_date}),R}const s=new B;let a;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):v.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new je({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:b.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:b.toString(r)})}get minDate(){let e=null;for(const r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}}je.create=t=>new je({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:T.ZodDate,...w(t)});class Ir extends S{_parse(e){if(this._getType(e)!==p.symbol){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.symbol,received:s.parsedType}),R}return F(e.data)}}Ir.create=t=>new Ir({typeName:T.ZodSymbol,...w(t)});class Pt extends S{_parse(e){if(this._getType(e)!==p.undefined){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.undefined,received:s.parsedType}),R}return F(e.data)}}Pt.create=t=>new Pt({typeName:T.ZodUndefined,...w(t)});class Ct extends S{_parse(e){if(this._getType(e)!==p.null){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.null,received:s.parsedType}),R}return F(e.data)}}Ct.create=t=>new Ct({typeName:T.ZodNull,...w(t)});class at extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return F(e.data)}}at.create=t=>new at({typeName:T.ZodAny,...w(t)});class De extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return F(e.data)}}De.create=t=>new De({typeName:T.ZodUnknown,...w(t)});class he extends S{_parse(e){const r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:p.never,received:r.parsedType}),R}}he.create=t=>new he({typeName:T.ZodNever,...w(t)});class kr extends S{_parse(e){if(this._getType(e)!==p.undefined){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.void,received:s.parsedType}),R}return F(e.data)}}kr.create=t=>new kr({typeName:T.ZodVoid,...w(t)});class ee extends S{_parse(e){const{ctx:r,status:s}=this._processInputParams(e),a=this._def;if(r.parsedType!==p.array)return h(r,{code:f.invalid_type,expected:p.array,received:r.parsedType}),R;if(a.exactLength!==null){const o=r.data.length>a.exactLength.value,c=r.data.length<a.exactLength.value;(o||c)&&(h(r,{code:o?f.too_big:f.too_small,minimum:c?a.exactLength.value:void 0,maximum:o?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),s.dirty())}if(a.minLength!==null&&r.data.length<a.minLength.value&&(h(r,{code:f.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),s.dirty()),a.maxLength!==null&&r.data.length>a.maxLength.value&&(h(r,{code:f.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),s.dirty()),r.common.async)return Promise.all([...r.data].map((o,c)=>a.type._parseAsync(new se(r,o,r.path,c)))).then(o=>B.mergeArray(s,o));const i=[...r.data].map((o,c)=>a.type._parseSync(new se(r,o,r.path,c)));return B.mergeArray(s,i)}get element(){return this._def.type}min(e,r){return new ee({...this._def,minLength:{value:e,message:b.toString(r)}})}max(e,r){return new ee({...this._def,maxLength:{value:e,message:b.toString(r)}})}length(e,r){return new ee({...this._def,exactLength:{value:e,message:b.toString(r)}})}nonempty(e){return this.min(1,e)}}ee.create=(t,e)=>new ee({type:t,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...w(e)});function it(t){if(t instanceof K){const e={};for(const r in t.shape){const s=t.shape[r];e[r]=ie.create(it(s))}return new K({...t._def,shape:()=>e})}else return t instanceof ee?new ee({...t._def,type:it(t.element)}):t instanceof ie?ie.create(it(t.unwrap())):t instanceof Te?Te.create(it(t.unwrap())):t instanceof ae?ae.create(t.items.map(e=>it(e))):t}class K extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),r=v.objectKeys(e);return this._cached={shape:e,keys:r}}_parse(e){if(this._getType(e)!==p.object){const l=this._getOrReturnCtx(e);return h(l,{code:f.invalid_type,expected:p.object,received:l.parsedType}),R}const{status:s,ctx:a}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),c=[];if(!(this._def.catchall instanceof he&&this._def.unknownKeys==="strip"))for(const l in a.data)o.includes(l)||c.push(l);const u=[];for(const l of o){const d=i[l],y=a.data[l];u.push({key:{status:"valid",value:l},value:d._parse(new se(a,y,a.path,l)),alwaysSet:l in a.data})}if(this._def.catchall instanceof he){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of c)u.push({key:{status:"valid",value:d},value:{status:"valid",value:a.data[d]}});else if(l==="strict")c.length>0&&(h(a,{code:f.unrecognized_keys,keys:c}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of c){const y=a.data[d];u.push({key:{status:"valid",value:d},value:l._parse(new se(a,y,a.path,d)),alwaysSet:d in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of u){const y=await d.key,E=await d.value;l.push({key:y,value:E,alwaysSet:d.alwaysSet})}return l}).then(l=>B.mergeObjectSync(s,l)):B.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return b.errToObj,new K({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(r,s)=>{var a,i,o,c;const u=(o=(i=(a=this._def).errorMap)===null||i===void 0?void 0:i.call(a,r,s).message)!==null&&o!==void 0?o:s.defaultError;return r.code==="unrecognized_keys"?{message:(c=b.errToObj(e).message)!==null&&c!==void 0?c:u}:{message:u}}}:{}})}strip(){return new K({...this._def,unknownKeys:"strip"})}passthrough(){return new K({...this._def,unknownKeys:"passthrough"})}extend(e){return new K({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new K({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,r){return this.augment({[e]:r})}catchall(e){return new K({...this._def,catchall:e})}pick(e){const r={};return v.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(r[s]=this.shape[s])}),new K({...this._def,shape:()=>r})}omit(e){const r={};return v.objectKeys(this.shape).forEach(s=>{e[s]||(r[s]=this.shape[s])}),new K({...this._def,shape:()=>r})}deepPartial(){return it(this)}partial(e){const r={};return v.objectKeys(this.shape).forEach(s=>{const a=this.shape[s];e&&!e[s]?r[s]=a:r[s]=a.optional()}),new K({...this._def,shape:()=>r})}required(e){const r={};return v.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])r[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof ie;)i=i._def.innerType;r[s]=i}}),new K({...this._def,shape:()=>r})}keyof(){return Ys(v.objectKeys(this.shape))}}K.create=(t,e)=>new K({shape:()=>t,unknownKeys:"strip",catchall:he.create(),typeName:T.ZodObject,...w(e)}),K.strictCreate=(t,e)=>new K({shape:()=>t,unknownKeys:"strict",catchall:he.create(),typeName:T.ZodObject,...w(e)}),K.lazycreate=(t,e)=>new K({shape:t,unknownKeys:"strip",catchall:he.create(),typeName:T.ZodObject,...w(e)});class Mt extends S{_parse(e){const{ctx:r}=this._processInputParams(e),s=this._def.options;function a(i){for(const c of i)if(c.result.status==="valid")return c.result;for(const c of i)if(c.result.status==="dirty")return r.common.issues.push(...c.ctx.common.issues),c.result;const o=i.map(c=>new J(c.ctx.common.issues));return h(r,{code:f.invalid_union,unionErrors:o}),R}if(r.common.async)return Promise.all(s.map(async i=>{const o={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:o}),ctx:o}})).then(a);{let i;const o=[];for(const u of s){const l={...r,common:{...r.common,issues:[]},parent:null},d=u._parseSync({data:r.data,path:r.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const c=o.map(u=>new J(u));return h(r,{code:f.invalid_union,unionErrors:c}),R}}get options(){return this._def.options}}Mt.create=(t,e)=>new Mt({options:t,typeName:T.ZodUnion,...w(e)});const pe=t=>t instanceof Ut?pe(t.schema):t instanceof te?pe(t.innerType()):t instanceof $t?[t.value]:t instanceof Ee?t.options:t instanceof Lt?v.objectValues(t.enum):t instanceof Kt?pe(t._def.innerType):t instanceof Pt?[void 0]:t instanceof Ct?[null]:t instanceof ie?[void 0,...pe(t.unwrap())]:t instanceof Te?[null,...pe(t.unwrap())]:t instanceof wn||t instanceof Gt?pe(t.unwrap()):t instanceof Wt?pe(t._def.innerType):[];class Or extends S{_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==p.object)return h(r,{code:f.invalid_type,expected:p.object,received:r.parsedType}),R;const s=this.discriminator,a=r.data[s],i=this.optionsMap.get(a);return i?r.common.async?i._parseAsync({data:r.data,path:r.path,parent:r}):i._parseSync({data:r.data,path:r.path,parent:r}):(h(r,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),R)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,r,s){const a=new Map;for(const i of r){const o=pe(i.shape[e]);if(!o.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const c of o){if(a.has(c))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(c)}`);a.set(c,i)}}return new Or({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:r,optionsMap:a,...w(s)})}}function Rn(t,e){const r=_e(t),s=_e(e);if(t===e)return{valid:!0,data:t};if(r===p.object&&s===p.object){const a=v.objectKeys(e),i=v.objectKeys(t).filter(c=>a.indexOf(c)!==-1),o={...t,...e};for(const c of i){const u=Rn(t[c],e[c]);if(!u.valid)return{valid:!1};o[c]=u.data}return{valid:!0,data:o}}else if(r===p.array&&s===p.array){if(t.length!==e.length)return{valid:!1};const a=[];for(let i=0;i<t.length;i++){const o=t[i],c=e[i],u=Rn(o,c);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return r===p.date&&s===p.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class jt extends S{_parse(e){const{status:r,ctx:s}=this._processInputParams(e),a=(i,o)=>{if(vn(i)||vn(o))return R;const c=Rn(i.value,o.value);return c.valid?((En(i)||En(o))&&r.dirty(),{status:r.value,value:c.data}):(h(s,{code:f.invalid_intersection_types}),R)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,o])=>a(i,o)):a(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}jt.create=(t,e,r)=>new jt({left:t,right:e,typeName:T.ZodIntersection,...w(r)});class ae extends S{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==p.array)return h(s,{code:f.invalid_type,expected:p.array,received:s.parsedType}),R;if(s.data.length<this._def.items.length)return h(s,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),R;!this._def.rest&&s.data.length>this._def.items.length&&(h(s,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...s.data].map((o,c)=>{const u=this._def.items[c]||this._def.rest;return u?u._parse(new se(s,o,s.path,c)):null}).filter(o=>!!o);return s.common.async?Promise.all(i).then(o=>B.mergeArray(r,o)):B.mergeArray(r,i)}get items(){return this._def.items}rest(e){return new ae({...this._def,rest:e})}}ae.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ae({items:t,typeName:T.ZodTuple,rest:null,...w(e)})};class Dt extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==p.object)return h(s,{code:f.invalid_type,expected:p.object,received:s.parsedType}),R;const a=[],i=this._def.keyType,o=this._def.valueType;for(const c in s.data)a.push({key:i._parse(new se(s,c,s.path,c)),value:o._parse(new se(s,s.data[c],s.path,c)),alwaysSet:c in s.data});return s.common.async?B.mergeObjectAsync(r,a):B.mergeObjectSync(r,a)}get element(){return this._def.valueType}static create(e,r,s){return r instanceof S?new Dt({keyType:e,valueType:r,typeName:T.ZodRecord,...w(s)}):new Dt({keyType:Q.create(),valueType:e,typeName:T.ZodRecord,...w(r)})}}class xr extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==p.map)return h(s,{code:f.invalid_type,expected:p.map,received:s.parsedType}),R;const a=this._def.keyType,i=this._def.valueType,o=[...s.data.entries()].map(([c,u],l)=>({key:a._parse(new se(s,c,s.path,[l,"key"])),value:i._parse(new se(s,u,s.path,[l,"value"]))}));if(s.common.async){const c=new Map;return Promise.resolve().then(async()=>{for(const u of o){const l=await u.key,d=await u.value;if(l.status==="aborted"||d.status==="aborted")return R;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}})}else{const c=new Map;for(const u of o){const l=u.key,d=u.value;if(l.status==="aborted"||d.status==="aborted")return R;(l.status==="dirty"||d.status==="dirty")&&r.dirty(),c.set(l.value,d.value)}return{status:r.value,value:c}}}}xr.create=(t,e,r)=>new xr({valueType:e,keyType:t,typeName:T.ZodMap,...w(r)});class Ue extends S{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.parsedType!==p.set)return h(s,{code:f.invalid_type,expected:p.set,received:s.parsedType}),R;const a=this._def;a.minSize!==null&&s.data.size<a.minSize.value&&(h(s,{code:f.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),r.dirty()),a.maxSize!==null&&s.data.size>a.maxSize.value&&(h(s,{code:f.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),r.dirty());const i=this._def.valueType;function o(u){const l=new Set;for(const d of u){if(d.status==="aborted")return R;d.status==="dirty"&&r.dirty(),l.add(d.value)}return{status:r.value,value:l}}const c=[...s.data.values()].map((u,l)=>i._parse(new se(s,u,s.path,l)));return s.common.async?Promise.all(c).then(u=>o(u)):o(c)}min(e,r){return new Ue({...this._def,minSize:{value:e,message:b.toString(r)}})}max(e,r){return new Ue({...this._def,maxSize:{value:e,message:b.toString(r)}})}size(e,r){return this.min(e,r).max(e,r)}nonempty(e){return this.min(1,e)}}Ue.create=(t,e)=>new Ue({valueType:t,minSize:null,maxSize:null,typeName:T.ZodSet,...w(e)});class ot extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==p.function)return h(r,{code:f.invalid_type,expected:p.function,received:r.parsedType}),R;function s(c,u){return Sr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,wr(),nt].filter(l=>!!l),issueData:{code:f.invalid_arguments,argumentsError:u}})}function a(c,u){return Sr({data:c,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,wr(),nt].filter(l=>!!l),issueData:{code:f.invalid_return_type,returnTypeError:u}})}const i={errorMap:r.common.contextualErrorMap},o=r.data;if(this._def.returns instanceof ct){const c=this;return F(async function(...u){const l=new J([]),d=await c._def.args.parseAsync(u,i).catch(I=>{throw l.addIssue(s(u,I)),l}),y=await Reflect.apply(o,this,d);return await c._def.returns._def.type.parseAsync(y,i).catch(I=>{throw l.addIssue(a(y,I)),l})})}else{const c=this;return F(function(...u){const l=c._def.args.safeParse(u,i);if(!l.success)throw new J([s(u,l.error)]);const d=Reflect.apply(o,this,l.data),y=c._def.returns.safeParse(d,i);if(!y.success)throw new J([a(d,y.error)]);return y.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ot({...this._def,args:ae.create(e).rest(De.create())})}returns(e){return new ot({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,r,s){return new ot({args:e||ae.create([]).rest(De.create()),returns:r||De.create(),typeName:T.ZodFunction,...w(s)})}}class Ut extends S{get schema(){return this._def.getter()}_parse(e){const{ctx:r}=this._processInputParams(e);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}Ut.create=(t,e)=>new Ut({getter:t,typeName:T.ZodLazy,...w(e)});class $t extends S{_parse(e){if(e.data!==this._def.value){const r=this._getOrReturnCtx(e);return h(r,{received:r.data,code:f.invalid_literal,expected:this._def.value}),R}return{status:"valid",value:e.data}}get value(){return this._def.value}}$t.create=(t,e)=>new $t({value:t,typeName:T.ZodLiteral,...w(e)});function Ys(t,e){return new Ee({values:t,typeName:T.ZodEnum,...w(e)})}class Ee extends S{constructor(){super(...arguments),Ot.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const r=this._getOrReturnCtx(e),s=this._def.values;return h(r,{expected:v.joinValues(s),received:r.parsedType,code:f.invalid_type}),R}if(Ar(this,Ot)||Fs(this,Ot,new Set(this._def.values)),!Ar(this,Ot).has(e.data)){const r=this._getOrReturnCtx(e),s=this._def.values;return h(r,{received:r.data,code:f.invalid_enum_value,options:s}),R}return F(e.data)}get options(){return this._def.values}get enum(){const e={};for(const r of this._def.values)e[r]=r;return e}get Values(){const e={};for(const r of this._def.values)e[r]=r;return e}get Enum(){const e={};for(const r of this._def.values)e[r]=r;return e}extract(e,r=this._def){return Ee.create(e,{...this._def,...r})}exclude(e,r=this._def){return Ee.create(this.options.filter(s=>!e.includes(s)),{...this._def,...r})}}Ot=new WeakMap,Ee.create=Ys;class Lt extends S{constructor(){super(...arguments),xt.set(this,void 0)}_parse(e){const r=v.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==p.string&&s.parsedType!==p.number){const a=v.objectValues(r);return h(s,{expected:v.joinValues(a),received:s.parsedType,code:f.invalid_type}),R}if(Ar(this,xt)||Fs(this,xt,new Set(v.getValidEnumValues(this._def.values))),!Ar(this,xt).has(e.data)){const a=v.objectValues(r);return h(s,{received:s.data,code:f.invalid_enum_value,options:a}),R}return F(e.data)}get enum(){return this._def.values}}xt=new WeakMap,Lt.create=(t,e)=>new Lt({values:t,typeName:T.ZodNativeEnum,...w(e)});class ct extends S{unwrap(){return this._def.type}_parse(e){const{ctx:r}=this._processInputParams(e);if(r.parsedType!==p.promise&&r.common.async===!1)return h(r,{code:f.invalid_type,expected:p.promise,received:r.parsedType}),R;const s=r.parsedType===p.promise?r.data:Promise.resolve(r.data);return F(s.then(a=>this._def.type.parseAsync(a,{path:r.path,errorMap:r.common.contextualErrorMap})))}}ct.create=(t,e)=>new ct({type:t,typeName:T.ZodPromise,...w(e)});class te extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:r,ctx:s}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:o=>{h(s,o),o.fatal?r.abort():r.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const o=a.transform(s.data,i);if(s.common.async)return Promise.resolve(o).then(async c=>{if(r.value==="aborted")return R;const u=await this._def.schema._parseAsync({data:c,path:s.path,parent:s});return u.status==="aborted"?R:u.status==="dirty"||r.value==="dirty"?st(u.value):u});{if(r.value==="aborted")return R;const c=this._def.schema._parseSync({data:o,path:s.path,parent:s});return c.status==="aborted"?R:c.status==="dirty"||r.value==="dirty"?st(c.value):c}}if(a.type==="refinement"){const o=c=>{const u=a.refinement(c,i);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return c};if(s.common.async===!1){const c=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return c.status==="aborted"?R:(c.status==="dirty"&&r.dirty(),o(c.value),{status:r.value,value:c.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(c=>c.status==="aborted"?R:(c.status==="dirty"&&r.dirty(),o(c.value).then(()=>({status:r.value,value:c.value}))))}if(a.type==="transform")if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!It(o))return o;const c=a.transform(o.value,i);if(c instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:c}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>It(o)?Promise.resolve(a.transform(o.value,i)).then(c=>({status:r.value,value:c})):o);v.assertNever(a)}}te.create=(t,e,r)=>new te({schema:t,typeName:T.ZodEffects,effect:e,...w(r)}),te.createWithPreprocess=(t,e,r)=>new te({schema:e,effect:{type:"preprocess",transform:t},typeName:T.ZodEffects,...w(r)});class ie extends S{_parse(e){return this._getType(e)===p.undefined?F(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ie.create=(t,e)=>new ie({innerType:t,typeName:T.ZodOptional,...w(e)});class Te extends S{_parse(e){return this._getType(e)===p.null?F(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Te.create=(t,e)=>new Te({innerType:t,typeName:T.ZodNullable,...w(e)});class Kt extends S{_parse(e){const{ctx:r}=this._processInputParams(e);let s=r.data;return r.parsedType===p.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Kt.create=(t,e)=>new Kt({innerType:t,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...w(e)});class Wt extends S{_parse(e){const{ctx:r}=this._processInputParams(e),s={...r,common:{...r.common,issues:[]}},a=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return kt(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new J(s.common.issues)},input:s.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new J(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Wt.create=(t,e)=>new Wt({innerType:t,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...w(e)});class Nr extends S{_parse(e){if(this._getType(e)!==p.nan){const s=this._getOrReturnCtx(e);return h(s,{code:f.invalid_type,expected:p.nan,received:s.parsedType}),R}return{status:"valid",value:e.data}}}Nr.create=t=>new Nr({typeName:T.ZodNaN,...w(t)});const Ko=Symbol("zod_brand");class wn extends S{_parse(e){const{ctx:r}=this._processInputParams(e),s=r.data;return this._def.type._parse({data:s,path:r.path,parent:r})}unwrap(){return this._def.type}}class Vt extends S{_parse(e){const{status:r,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?R:i.status==="dirty"?(r.dirty(),st(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const a=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return a.status==="aborted"?R:a.status==="dirty"?(r.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:s.path,parent:s})}}static create(e,r){return new Vt({in:e,out:r,typeName:T.ZodPipeline})}}class Gt extends S{_parse(e){const r=this._def.innerType._parse(e),s=a=>(It(a)&&(a.value=Object.freeze(a.value)),a);return kt(r)?r.then(a=>s(a)):s(r)}unwrap(){return this._def.innerType}}Gt.create=(t,e)=>new Gt({innerType:t,typeName:T.ZodReadonly,...w(e)});function Xs(t,e={},r){return t?at.create().superRefine((s,a)=>{var i,o;if(!t(s)){const c=typeof e=="function"?e(s):typeof e=="string"?{message:e}:e,u=(o=(i=c.fatal)!==null&&i!==void 0?i:r)!==null&&o!==void 0?o:!0,l=typeof c=="string"?{message:c}:c;a.addIssue({code:"custom",...l,fatal:u})}}):at.create()}const Wo={object:K.lazycreate};var T;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(T||(T={}));const Vo=(t,e={message:`Input not instance of ${t.name}`})=>Xs(r=>r instanceof t,e),qs=Q.create,Qs=be.create,Go=Nr.create,Bo=ve.create,ea=Nt.create,Fo=je.create,Ho=Ir.create,Zo=Pt.create,zo=Ct.create,Jo=at.create,Yo=De.create,Xo=he.create,qo=kr.create,Qo=ee.create,ec=K.create,tc=K.strictCreate,rc=Mt.create,nc=Or.create,sc=jt.create,ac=ae.create,ic=Dt.create,oc=xr.create,cc=Ue.create,uc=ot.create,lc=Ut.create,dc=$t.create,fc=Ee.create,hc=Lt.create,pc=ct.create,ta=te.create,gc=ie.create,mc=Te.create,yc=te.createWithPreprocess,_c=Vt.create;var n=Object.freeze({__proto__:null,defaultErrorMap:nt,setErrorMap:Ro,getErrorMap:wr,makeIssue:Sr,EMPTY_PATH:wo,addIssueToContext:h,ParseStatus:B,INVALID:R,DIRTY:st,OK:F,isAborted:vn,isDirty:En,isValid:It,isAsync:kt,get util(){return v},get objectUtil(){return Z},ZodParsedType:p,getParsedType:_e,ZodType:S,datetimeRegex:Js,ZodString:Q,ZodNumber:be,ZodBigInt:ve,ZodBoolean:Nt,ZodDate:je,ZodSymbol:Ir,ZodUndefined:Pt,ZodNull:Ct,ZodAny:at,ZodUnknown:De,ZodNever:he,ZodVoid:kr,ZodArray:ee,ZodObject:K,ZodUnion:Mt,ZodDiscriminatedUnion:Or,ZodIntersection:jt,ZodTuple:ae,ZodRecord:Dt,ZodMap:xr,ZodSet:Ue,ZodFunction:ot,ZodLazy:Ut,ZodLiteral:$t,ZodEnum:Ee,ZodNativeEnum:Lt,ZodPromise:ct,ZodEffects:te,ZodTransformer:te,ZodOptional:ie,ZodNullable:Te,ZodDefault:Kt,ZodCatch:Wt,ZodNaN:Nr,BRAND:Ko,ZodBranded:wn,ZodPipeline:Vt,ZodReadonly:Gt,custom:Xs,Schema:S,ZodSchema:S,late:Wo,get ZodFirstPartyTypeKind(){return T},coerce:{string:t=>Q.create({...t,coerce:!0}),number:t=>be.create({...t,coerce:!0}),boolean:t=>Nt.create({...t,coerce:!0}),bigint:t=>ve.create({...t,coerce:!0}),date:t=>je.create({...t,coerce:!0})},any:Jo,array:Qo,bigint:Bo,boolean:ea,date:Fo,discriminatedUnion:nc,effect:ta,enum:fc,function:uc,instanceof:Vo,intersection:sc,lazy:lc,literal:dc,map:oc,nan:Go,nativeEnum:hc,never:Xo,null:zo,nullable:mc,number:Qs,object:ec,oboolean:()=>ea().optional(),onumber:()=>Qs().optional(),optional:gc,ostring:()=>qs().optional(),pipeline:_c,preprocess:yc,promise:pc,record:ic,set:cc,strictObject:tc,string:qs,symbol:Ho,transformer:ta,tuple:ac,undefined:Zo,union:rc,unknown:Yo,void:qo,NEVER:R,ZodIssueCode:f,quotelessJson:To,ZodError:J});const ra="3.3.5",bc="HS256",vc="https://id.trigger.dev",Ec="https://api.trigger.dev";async function na(t){const{SignJWT:e}=await Promise.resolve().then(()=>vh),r=new TextEncoder().encode(t.secretKey);return new e(t.payload).setIssuer(vc).setAudience(Ec).setProtectedHeader({alg:bc}).setIssuedAt().setExpirationTime(t.expirationTime??"15m").sign(r)}n.object({url:n.string().url(),authorizationCode:n.string()}),n.object({authorizationCode:n.string()}),n.object({token:n.object({token:n.string(),obfuscatedToken:n.string()}).nullable()});const Tc=n.union([n.string(),n.number(),n.boolean(),n.null()]),Bt=n.lazy(()=>n.union([Tc,n.array(Bt),n.record(Bt)])),Rc=n.union([n.string(),n.number(),n.boolean(),n.null(),n.date(),n.undefined(),n.symbol()]),sa=n.lazy(()=>n.union([Rc,n.array(sa),n.record(sa)])),wc=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4)]),Sc=n.union([n.literal(.25),n.literal(.5),n.literal(1),n.literal(2),n.literal(4),n.literal(8)]),aa=n.enum(["micro","small-1x","small-2x","medium-1x","medium-2x","large-1x","large-2x"]),ia=n.object({cpu:wc.optional(),memory:Sc.optional(),preset:aa.optional()}),Ft=n.object({name:aa,cpu:n.number(),memory:n.number(),centsPerMs:n.number()}),Ac=n.object({type:n.literal("BUILT_IN_ERROR"),name:n.string(),message:n.string(),stackTrace:n.string()}),Ic=n.object({type:n.literal("CUSTOM_ERROR"),raw:n.string()}),kc=n.object({type:n.literal("STRING_ERROR"),raw:n.string()}),Sn=n.object({type:n.literal("INTERNAL_ERROR"),code:n.enum(["COULD_NOT_FIND_EXECUTOR","COULD_NOT_FIND_TASK","COULD_NOT_IMPORT_TASK","CONFIGURED_INCORRECTLY","TASK_ALREADY_RUNNING","TASK_EXECUTION_FAILED","TASK_EXECUTION_ABORTED","TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE","TASK_PROCESS_SIGKILL_TIMEOUT","TASK_PROCESS_SIGSEGV","TASK_PROCESS_SIGTERM","TASK_PROCESS_OOM_KILLED","TASK_PROCESS_MAYBE_OOM_KILLED","TASK_RUN_CANCELLED","TASK_INPUT_ERROR","TASK_OUTPUT_ERROR","HANDLE_ERROR_ERROR","GRACEFUL_EXIT_TIMEOUT","TASK_RUN_HEARTBEAT_TIMEOUT","TASK_RUN_CRASHED","MAX_DURATION_EXCEEDED","DISK_SPACE_EXCEEDED","POD_EVICTED","POD_UNKNOWN_ERROR","OUTDATED_SDK_VERSION"]),message:n.string().optional(),stackTrace:n.string().optional()}),oa=Sn.shape.code.enum,ca=n.discriminatedUnion("type",[Ac,Ic,kc,Sn]),ua=n.object({id:n.string(),payload:n.string(),payloadType:n.string(),context:n.any(),tags:n.array(n.string()),isTest:n.boolean().default(!1),createdAt:n.coerce.date(),startedAt:n.coerce.date().default(()=>new Date),idempotencyKey:n.string().optional(),maxAttempts:n.number().optional(),durationMs:n.number().default(0),costInCents:n.number().default(0),baseCostInCents:n.number().default(0),version:n.string().optional(),metadata:n.record(Bt).optional(),maxDuration:n.number().optional()}),la=n.object({id:n.string(),filePath:n.string(),exportName:n.string()}),da=n.object({id:n.string(),number:n.number(),startedAt:n.coerce.date(),backgroundWorkerId:n.string(),backgroundWorkerTaskId:n.string(),status:n.string()}),fa=n.object({id:n.string(),slug:n.string(),type:n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"])}),ha=n.object({id:n.string(),slug:n.string(),name:n.string()}),pa=n.object({id:n.string(),ref:n.string(),slug:n.string(),name:n.string()}),ga=n.object({id:n.string(),name:n.string()}),ma=n.object({id:n.string()}),ge=n.object({task:la,attempt:da,run:ua,queue:ga,environment:fa,organization:ha,project:pa,batch:ma.optional(),machine:Ft.optional()});n.object({task:la,attempt:da.omit({backgroundWorkerId:!0,backgroundWorkerTaskId:!0}),run:ua.omit({payload:!0,payloadType:!0,metadata:!0}),queue:ga,environment:fa,organization:ha,project:pa,batch:ma.optional(),machine:Ft.optional()});const Oc=n.object({timestamp:n.number(),delay:n.number(),error:n.unknown().optional()}),ya=n.object({durationMs:n.number()}),Pr=n.object({ok:n.literal(!1),id:n.string(),error:ca,retry:Oc.optional(),skippedRetrying:n.boolean().optional(),usage:ya.optional(),taskIdentifier:n.string().optional()}),xc=n.object({ok:n.literal(!0),id:n.string(),output:n.string().optional(),outputType:n.string(),usage:ya.optional(),taskIdentifier:n.string().optional()}),re=n.discriminatedUnion("ok",[xc,Pr]),Nc=n.object({id:n.string(),items:re.array()}),_a=n.object({message:n.string(),name:n.string().optional(),stackTrace:n.string().optional()}),Cr=n.enum(["PRODUCTION","STAGING","DEVELOPMENT","PREVIEW"]);n.object({execution:ge,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()});const An=ge.extend({worker:n.object({id:n.string(),contentHash:n.string(),version:n.string()}),machine:Ft.default({name:"small-1x",cpu:1,memory:1,centsPerMs:0})}),Mr=n.object({execution:An,traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),Pc=n.object({type:n.literal("fixed-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])}),Cc=n.object({type:n.literal("sliding-window"),limit:n.number(),window:n.union([n.object({seconds:n.number()}),n.object({minutes:n.number()}),n.object({hours:n.number()})])});n.discriminatedUnion("type",[Pc,Cc]);const $e=n.object({maxAttempts:n.number().int().optional(),factor:n.number().optional(),minTimeoutInMs:n.number().int().optional(),maxTimeoutInMs:n.number().int().optional(),randomize:n.boolean().optional()}),jr=n.object({name:n.string().optional(),concurrencyLimit:n.number().int().min(0).max(1e3).optional()}),ba=n.object({cron:n.string(),timezone:n.string()}),va={id:n.string(),description:n.string().optional(),queue:jr.optional(),retry:$e.optional(),machine:ia.optional(),triggerSource:n.string().optional(),schedule:ba.optional(),maxDuration:n.number().optional()};n.object(va);const Mc=n.object({entry:n.string(),out:n.string()}),Ea={filePath:n.string(),exportName:n.string(),entryPoint:n.string()};n.object(Ea);const jc=n.object({...va,...Ea});n.enum(["index","create","restore"]),n.enum(["terminate"]);const Dc=n.custom(t=>{try{return typeof t.test=="function"}catch{return!1}});n.object({project:n.string(),triggerDirectories:n.string().array().optional(),triggerUrl:n.string().optional(),projectDir:n.string().optional(),tsconfigPath:n.string().optional(),retries:n.object({enabledInDev:n.boolean().default(!0),default:$e.optional()}).optional(),additionalPackages:n.string().array().optional(),additionalFiles:n.string().array().optional(),dependenciesToBundle:n.array(n.union([n.string(),Dc])).optional(),logLevel:n.string().optional(),enableConsoleLogging:n.boolean().optional(),postInstall:n.string().optional(),extraCACerts:n.string().optional()});const Ht=n.enum(["WAIT_FOR_DURATION","WAIT_FOR_TASK","WAIT_FOR_BATCH"]),In=n.object({runId:n.string(),attemptCount:n.number().optional(),messageId:n.string(),isTest:n.boolean(),traceContext:n.record(n.unknown()),environment:n.record(n.string()).optional()}),kn=n.object({id:n.string(),description:n.string().optional(),filePath:n.string(),exportName:n.string(),queue:jr.optional(),retry:$e.optional(),machine:ia.optional(),triggerSource:n.string().optional(),schedule:ba.optional(),maxDuration:n.number().optional()}),Uc=n.object({filePath:n.string(),contents:n.string(),contentHash:n.string(),taskIds:n.array(n.string())}),$c=n.object({packageVersion:n.string(),contentHash:n.string(),cliPackageVersion:n.string().optional(),tasks:n.array(kn),sourceFiles:n.array(Uc).optional()});n.object({contentHash:n.string(),imageTag:n.string()}),n.object({userId:n.string(),email:n.string().email(),dashboardUrl:n.string()});const Lc=n.object({id:n.string(),externalRef:n.string(),name:n.string(),slug:n.string(),createdAt:n.coerce.date(),organization:n.object({id:n.string(),title:n.string(),slug:n.string(),createdAt:n.coerce.date()})});n.array(Lc),n.object({apiKey:n.string(),name:n.string(),apiUrl:n.string(),projectId:n.string()}),n.object({localOnly:n.boolean(),metadata:$c,supportsLazyAttempts:n.boolean().optional()}),n.object({id:n.string(),version:n.string(),contentHash:n.string()});const Ta=n.string().max(128,"Tags must be less than 128 characters"),On=n.union([Ta,Ta.array()]),Kc=n.object({payload:n.any(),context:n.any(),options:n.object({dependentAttempt:n.string().optional(),parentAttempt:n.string().optional(),dependentBatch:n.string().optional(),parentBatch:n.string().optional(),lockToVersion:n.string().optional(),queue:jr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:On.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional()}).optional()}),Wc=n.object({id:n.string()});n.object({items:Kc.array(),dependentAttempt:n.string().optional()});const Vc=n.object({task:n.string(),payload:n.any(),context:n.any(),options:n.object({lockToVersion:n.string().optional(),queue:jr.optional(),concurrencyKey:n.string().optional(),idempotencyKey:n.string().optional(),idempotencyKeyTTL:n.string().optional(),test:n.boolean().optional(),payloadType:n.string().optional(),delay:n.string().or(n.coerce.date()).optional(),ttl:n.string().or(n.number().nonnegative().int()).optional(),tags:On.optional(),maxAttempts:n.number().int().optional(),metadata:n.any(),metadataType:n.string().optional(),maxDuration:n.number().optional(),parentAttempt:n.string().optional()}).optional()});n.object({items:Vc.array(),dependentAttempt:n.string().optional()});const Gc=n.object({id:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional(),runs:n.array(n.object({id:n.string(),taskIdentifier:n.string(),isCached:n.boolean(),idempotencyKey:n.string().optional()}))});n.object({batchId:n.string(),runs:n.string().array()}),n.object({id:n.string(),items:n.array(n.object({id:n.string(),taskRunId:n.string(),status:n.enum(["PENDING","CANCELED","COMPLETED","FAILED"])}))}),n.object({tags:On}),n.object({delay:n.string().or(n.coerce.date())}),n.object({variables:n.record(n.string())}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional()}),n.object({id:n.string(),contentHash:n.string()}),n.object({imageReference:n.string(),selfHosted:n.boolean().optional()});const Bc=n.object({buildId:n.string(),buildToken:n.string(),projectId:n.string()});n.object({id:n.string(),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageTag:n.string(),externalBuildData:Bc.optional().nullable(),registryHost:n.string().optional()}),n.object({contentHash:n.string(),userId:n.string().optional(),registryHost:n.string().optional(),selfHosted:n.boolean().optional(),namespace:n.string().optional()});const Ra=n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()});n.object({error:Ra}),n.object({id:n.string()}),n.object({id:n.string(),status:n.enum(["PENDING","BUILDING","DEPLOYING","DEPLOYED","FAILED","CANCELED","TIMED_OUT"]),contentHash:n.string(),shortCode:n.string(),version:n.string(),imageReference:n.string().nullish(),errorData:Ra.nullish(),worker:n.object({id:n.string(),version:n.string(),tasks:n.array(n.object({id:n.string(),slug:n.string(),filePath:n.string(),exportName:n.string()}))}).optional()});const wa=n.object({presignedUrl:n.string()}),Fc=n.object({id:n.string()}),Hc=n.object({id:n.string()}),Sa=n.union([n.literal("DECLARATIVE"),n.literal("IMPERATIVE")]);n.object({scheduleId:n.string(),type:Sa,timestamp:n.date(),lastTimestamp:n.date().optional(),externalId:n.string().optional(),timezone:n.string(),upcoming:n.array(n.date())}),n.object({task:n.string(),cron:n.string(),deduplicationKey:n.string(),externalId:n.string().optional(),timezone:n.string().optional()}).omit({deduplicationKey:!0});const Aa=n.object({type:n.literal("CRON"),expression:n.string(),description:n.string()}),Le=n.object({id:n.string(),type:Sa,task:n.string(),active:n.boolean(),deduplicationKey:n.string().nullish(),externalId:n.string().nullish(),generator:Aa,timezone:n.string(),nextRun:n.coerce.date().nullish(),environments:n.array(n.object({id:n.string(),type:n.string(),userName:n.string().nullish()}))}),Zc=n.object({id:n.string()});n.object({data:n.array(Le),pagination:n.object({currentPage:n.number(),totalPages:n.number(),count:n.number()})}),n.object({page:n.number().optional(),perPage:n.number().optional()}),n.object({timezones:n.array(n.string())});const zc=n.enum(["WAITING_FOR_DEPLOY","QUEUED","EXECUTING","REATTEMPTING","FROZEN","COMPLETED","CANCELED","FAILED","CRASHED","INTERRUPTED","SYSTEM_FAILURE","DELAYED","EXPIRED","TIMED_OUT"]),Jc=n.enum(["PENDING","EXECUTING","PAUSED","COMPLETED","FAILED","CANCELED"]),Yc=n.object({id:n.string(),name:n.string(),user:n.string().optional()}),Xc=n.object({id:n.string(),externalId:n.string().optional(),deduplicationKey:n.string().optional(),generator:Aa});n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]);const Ia={id:n.string(),status:zc,taskIdentifier:n.string(),idempotencyKey:n.string().optional(),version:n.string().optional(),isQueued:n.boolean(),isExecuting:n.boolean(),isCompleted:n.boolean(),isSuccess:n.boolean(),isFailed:n.boolean(),isCancelled:n.boolean(),isTest:n.boolean(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),finishedAt:n.coerce.date().optional(),delayedUntil:n.coerce.date().optional(),ttl:n.string().optional(),expiredAt:n.coerce.date().optional(),tags:n.string().array(),costInCents:n.number(),baseCostInCents:n.number(),durationMs:n.number(),metadata:n.record(n.any()).optional()},ka={...Ia,depth:n.number(),triggerFunction:n.enum(["triggerAndWait","trigger","batchTriggerAndWait","batchTrigger"]),batchId:n.string().optional()},xn=n.object(ka),Oa=n.object({...ka,payload:n.any().optional(),payloadPresignedUrl:n.string().optional(),output:n.any().optional(),outputPresignedUrl:n.string().optional(),error:_a.optional(),schedule:Xc.optional(),relatedRuns:n.object({root:xn.optional(),parent:xn.optional(),children:n.array(xn).optional()}),attempts:n.array(n.object({id:n.string(),status:Jc,createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().optional(),completedAt:n.coerce.date().optional(),error:_a.optional()}).optional()),attemptCount:n.number().default(0)}),Nn=n.object({...Ia,env:Yc});n.object({data:n.array(Nn),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),n.object({name:n.string(),value:n.string()}),n.object({value:n.string()}),n.object({variables:n.record(n.string()),override:n.boolean().optional()});const Dr=n.object({success:n.boolean()}),qc=n.object({value:n.string()}),Qc=n.object({name:n.string(),value:n.string()}),eu=n.array(Qc);n.object({metadata:n.record(Bt),metadataType:n.string().optional()});const tu=n.object({metadata:n.record(Bt)}),ru=n.object({id:n.string(),idempotencyKey:n.string().nullish(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),startedAt:n.coerce.date().nullish(),delayUntil:n.coerce.date().nullish(),queuedAt:n.coerce.date().nullish(),expiredAt:n.coerce.date().nullish(),completedAt:n.coerce.date().nullish(),taskIdentifier:n.string(),friendlyId:n.string(),number:n.number(),isTest:n.boolean(),status:n.string(),usageDurationMs:n.number(),costInCents:n.number(),baseCostInCents:n.number(),ttl:n.string().nullish(),payload:n.string().nullish(),payloadType:n.string().nullish(),metadata:n.string().nullish(),metadataType:n.string().nullish(),output:n.string().nullish(),outputType:n.string().nullish(),runTags:n.array(n.string()).nullish().default([]),error:ca.nullish()}),nu=n.enum(["PENDING","COMPLETED"]),su=n.object({id:n.string(),status:nu,idempotencyKey:n.string().optional(),createdAt:n.coerce.date(),updatedAt:n.coerce.date(),runCount:n.number()}),au=n.object({project:n.string(),dirs:n.string().array()}),iu=n.object({name:n.string(),version:n.string()}),ou=n.enum(["dev","deploy"]),xa=n.enum(["node","bun"]),cu=n.object({target:ou,packageVersion:n.string(),cliPackageVersion:n.string(),contentHash:n.string(),runtime:xa,environment:n.string(),config:au,files:n.array(Mc),sources:n.record(n.object({contents:n.string(),contentHash:n.string()})),outputPath:n.string(),runWorkerEntryPoint:n.string(),runControllerEntryPoint:n.string().optional(),indexWorkerEntryPoint:n.string(),indexControllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),configPath:n.string(),externals:iu.array().optional(),build:n.object({env:n.record(n.string()).optional(),commands:n.array(n.string()).optional()}),customConditions:n.array(n.string()).optional(),deploy:n.object({env:n.record(n.string()).optional(),sync:n.object({env:n.record(n.string()).optional()}).optional()}),image:n.object({pkgs:n.array(n.string()).optional(),instructions:n.array(n.string()).optional()}).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("index"),data:n.object({build:cu})});const Na=n.object({configPath:n.string(),tasks:jc.array(),workerEntryPoint:n.string(),controllerEntryPoint:n.string().optional(),loaderEntryPoint:n.string().optional(),runtime:xa,customConditions:n.array(n.string()).optional(),otelImportHook:n.object({include:n.array(n.string()).optional(),exclude:n.array(n.string()).optional()}).optional()});n.object({type:n.literal("worker-manifest"),data:n.object({manifest:Na})});const uu=n.object({message:n.string(),file:n.string(),stack:n.string().optional(),name:n.string().optional()}),lu=n.array(uu),Pa=n.discriminatedUnion("success",[n.object({success:n.literal(!1),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({success:n.literal(!0)})]),Ca=n.discriminatedUnion("type",[n.object({type:n.literal("CANCEL_ATTEMPT"),taskAttemptId:n.string(),taskRunId:n.string()}),n.object({type:n.literal("SCHEDULE_ATTEMPT"),image:n.string(),version:n.string(),machine:Ft,nextAttemptNumber:n.number().optional(),id:n.string().optional(),envId:n.string(),envType:Cr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({type:n.literal("EXECUTE_RUN_LAZY_ATTEMPT"),payload:In})]);n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ca});const Ma=n.discriminatedUnion("type",[n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_COMPLETED"),completion:re,execution:ge}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_FAILED_TO_RUN"),completion:Pr}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_HEARTBEAT"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.literal("TASK_RUN_HEARTBEAT"),id:n.string()})]),du=n.object({id:n.string(),version:n.string(),contentHash:n.string()});n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),inProgressRuns:n.string().array().optional()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ma});const ja=n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()}),origin:n.enum(["uncaughtException","unhandledRejection"])}),fu=n.object({version:n.literal("v1").default("v1"),tasks:n.unknown(),zodIssues:n.custom(t=>Array.isArray(t)&&t.every(e=>typeof e=="object"&&"message"in e))});n.object({version:n.literal("v1").default("v1"),manifest:Na,importErrors:lu}),n.object({version:n.literal("v1").default("v1"),execution:ge,result:re}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.undefined(),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),waitThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),friendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({version:n.literal("v1").default("v1"),execution:ge,traceContext:n.record(n.unknown()),metadata:du}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),completion:re,execution:ge}),n.object({version:n.literal("v2"),completion:re})]),n.object({version:n.literal("v1").default("v1")}),n.object({timeoutInMs:n.number()}),n.void(),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({version:n.literal("v1").default("v1"),data:n.string()}),n.object({status:n.literal("ok")}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),reason:n.string().optional(),exitCode:n.number().optional(),message:n.string().optional(),logs:n.string().optional(),overrideCompletion:n.boolean().optional(),errorCode:Sn.shape.code.optional()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()}),overrideCompletion:n.boolean().optional()}),n.object({version:n.literal("v1").default("v1"),imageTag:n.string(),shortCode:n.string(),apiKey:n.string(),apiUrl:n.string(),envId:n.string(),envType:Cr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()}),n.object({version:n.literal("v1").default("v1"),type:n.enum(["DOCKER","KUBERNETES"]),location:n.string(),reason:n.string().optional(),imageRef:n.string(),attemptNumber:n.number().optional(),machine:Ft,checkpointId:n.string(),envId:n.string(),envType:Cr,orgId:n.string(),projectId:n.string(),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),imageRef:n.string(),shortCode:n.string(),envId:n.string(),envType:Cr,orgId:n.string(),projectId:n.string(),deploymentId:n.string()});const Da=n.object({projectRef:n.string(),envId:n.string(),deploymentId:n.string(),metadata:n.object({cliPackageVersion:n.string().optional(),contentHash:n.string(),packageVersion:n.string(),tasks:kn.array()})});n.object({version:n.literal("v1").default("v1"),metadata:n.any(),text:n.string()}),n.discriminatedUnion("version",[Da.extend({version:n.literal("v1")}),Da.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Mr})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0),payload:Mr})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),envId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),lazyPayload:In})]),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string(),type:Ht}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:An,completion:re,checkpoint:n.object({docker:n.boolean(),location:n.string()}).optional()}),n.object({version:n.literal("v1").default("v1"),completion:Pr}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string().optional(),attemptFriendlyId:n.string(),docker:n.boolean(),location:n.string(),reason:n.discriminatedUnion("type",[n.object({type:n.literal("WAIT_FOR_DURATION"),ms:n.number(),now:n.number()}),n.object({type:n.literal("WAIT_FOR_BATCH"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array()}),n.object({type:n.literal("WAIT_FOR_TASK"),friendlyId:n.string()}),n.object({type:n.literal("RETRYING_AFTER_FAILURE"),attemptNumber:n.number()})])}),n.object({version:n.literal("v1").default("v1"),keepRunAlive:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:re.array(),executions:ge.array()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),attemptId:n.string(),attemptFriendlyId:n.string(),completions:re.array(),executions:ge.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),delayInMs:n.number().optional()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.literal("v1").default("v1"),checkpointThresholdInMs:n.number()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ma}),n.object({version:n.literal("v1").default("v1"),id:n.string()}),n.object({version:n.literal("v1").default("v1"),backgroundWorkerId:n.string(),data:Ca});const Ua=n.object({version:n.literal("v1"),deploymentId:n.string(),tasks:kn.array(),packageVersion:n.string()});n.object({version:n.literal("v1").default("v1")}),n.void(),n.discriminatedUnion("version",[Ua.extend({version:n.literal("v1")}),Ua.extend({version:n.literal("v2"),supportsLazyAttempts:n.boolean()})]),n.discriminatedUnion("success",[n.object({success:n.literal(!1)}),n.object({success:n.literal(!0)})]),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.object({version:n.literal("v1").default("v1"),runId:n.string(),totalCompletions:n.number()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1"),attemptFriendlyId:n.string(),type:Ht}),n.object({version:n.literal("v2"),attemptFriendlyId:n.string(),attemptNumber:n.number(),type:Ht})]),n.object({version:n.literal("v1").default("v1")}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),reason:Ht.optional()})]).default({version:"v1"}),n.object({version:n.literal("v2").default("v2"),checkpointCanceled:n.boolean(),reason:Ht.optional()}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string()}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({version:n.enum(["v1","v2"]).default("v1"),execution:An,completion:re}),n.object({willCheckpointAndRestore:n.boolean(),shouldExit:n.boolean()}),n.object({version:n.literal("v1").default("v1"),completion:Pr}),n.object({version:n.literal("v1").default("v1"),ms:n.number(),now:n.number(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),friendlyId:n.string(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.enum(["v1","v2"]).default("v1"),batchFriendlyId:n.string(),runFriendlyIds:n.string().array(),attemptFriendlyId:n.string()}),n.object({willCheckpointAndRestore:n.boolean()}),n.object({version:n.literal("v1").default("v1"),deploymentId:n.string(),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional(),stderr:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.discriminatedUnion("success",[n.object({success:n.literal(!1),reason:n.string().optional()}),n.object({success:n.literal(!0),executionPayload:Mr})]),n.object({version:n.literal("v1").default("v1"),error:n.object({name:n.string(),message:n.string(),stack:n.string().optional()})}),n.object({version:n.literal("v1").default("v1"),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string(),completions:re.array(),executions:ge.array()}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.object({version:n.literal("v1").default("v1"),executionPayload:Mr}),n.object({version:n.literal("v1").default("v1"),lazyPayload:In}),n.object({version:n.literal("v1").default("v1"),attemptId:n.string()}),n.discriminatedUnion("version",[n.object({version:n.literal("v1")}),n.object({version:n.literal("v2"),delayInMs:n.number().optional()})]),n.object({version:n.literal("v1").default("v1"),runId:n.string()}),n.object({contentHash:n.string(),projectRef:n.string(),envId:n.string(),runId:n.string(),attemptFriendlyId:n.string().optional(),attemptNumber:n.string().optional(),podName:n.string(),deploymentId:n.string(),deploymentVersion:n.string(),requiresCheckpointResumeWithMessage:n.string().optional()}),n.object({supportsDynamicConfig:n.string().optional()});const hu=n.enum(["primary"]),pu=n.object({text:n.string(),variant:n.string().optional(),url:n.string().optional()}),gu=n.object({items:n.array(pu),style:n.enum(["codepath"]).optional()});n.object({icon:n.string().optional(),variant:hu.optional(),accessory:gu.optional()}).default({icon:void 0,variant:void 0});const mu=[n.object({$endsWith:n.string()}),n.object({$startsWith:n.string()}),n.object({$ignoreCaseEquals:n.string()})],yu=n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean()),n.array(n.union([...mu,n.object({$exists:n.boolean()}),n.object({$isNull:n.boolean()}),n.object({$anythingBut:n.union([n.string(),n.number(),n.boolean()])}),n.object({$anythingBut:n.union([n.array(n.string()),n.array(n.number()),n.array(n.boolean())])}),n.object({$gt:n.number()}),n.object({$lt:n.number()}),n.object({$gte:n.number()}),n.object({$lte:n.number()}),n.object({$between:n.tuple([n.number(),n.number()])}),n.object({$includes:n.union([n.string(),n.number(),n.boolean()])}),n.object({$not:n.union([n.string(),n.number(),n.boolean()])})]))]),Pn=n.lazy(()=>n.record(n.union([yu,Pn]))),_u=n.object({strategy:n.literal("headers"),limitHeader:n.string(),remainingHeader:n.string(),resetHeader:n.string(),bodyFilter:Pn.optional(),resetFormat:n.enum(["unix_timestamp","unix_timestamp_in_ms","iso_8601","iso_8601_duration_openai_variant"]).default("unix_timestamp").optional()}),bu=$e.extend({strategy:n.literal("backoff"),bodyFilter:Pn.optional()}),vu=n.discriminatedUnion("strategy",[_u,bu]),Eu=n.record(n.string(),vu);n.object({durationInMs:n.number().optional(),retry:$e.optional()}),n.object({byStatus:Eu.optional(),timeout:$e.optional(),connectionError:$e.optional()});const Tu=n.object({type:n.string().optional(),message:n.string().optional(),stacktrace:n.string().optional()}),Ru=n.object({name:n.literal("exception"),time:n.coerce.date(),properties:n.object({exception:Tu})}),wu=n.object({name:n.literal("cancellation"),time:n.coerce.date(),properties:n.object({reason:n.string()})}),Su=n.object({name:n.string(),time:n.coerce.date(),properties:n.record(n.unknown())}),Au=n.union([Ru,wu,Su]);n.array(Au),n.object({system:n.string().optional(),client_id:n.string().optional(),operation:n.enum(["publish","create","receive","deliver"]),message:n.any(),destination:n.string().optional()});const Iu=typeof globalThis=="object"?globalThis:global,Ur=Symbol.for("dev.trigger.ts.api"),$r=Iu;function oe(t,e,r=!1){const s=$r[Ur]=$r[Ur]??{};return!r&&s[t]?!1:(s[t]=e,!0)}function Re(t){var e;return(e=$r[Ur])==null?void 0:e[t]}function Ke(t){const e=$r[Ur];e&&delete e[t]}const A={ENVIRONMENT_ID:"ctx.environment.id",ENVIRONMENT_TYPE:"ctx.environment.type",ORGANIZATION_ID:"ctx.organization.id",ORGANIZATION_SLUG:"ctx.organization.slug",ORGANIZATION_NAME:"ctx.organization.name",PROJECT_ID:"ctx.project.id",PROJECT_REF:"ctx.project.ref",PROJECT_NAME:"ctx.project.title",PROJECT_DIR:"project.dir",ATTEMPT_ID:"ctx.attempt.id",ATTEMPT_NUMBER:"ctx.attempt.number",RUN_ID:"ctx.run.id",RUN_IS_TEST:"ctx.run.isTest",BATCH_ID:"ctx.batch.id",TASK_SLUG:"ctx.task.id",TASK_PATH:"ctx.task.filePath",TASK_EXPORT_NAME:"ctx.task.exportName",QUEUE_NAME:"ctx.queue.name",QUEUE_ID:"ctx.queue.id",MACHINE_PRESET_NAME:"ctx.machine.name",MACHINE_PRESET_CPU:"ctx.machine.cpu",MACHINE_PRESET_MEMORY:"ctx.machine.memory",MACHINE_PRESET_CENTS_PER_MS:"ctx.machine.centsPerMs",SPAN_PARTIAL:"$span.partial",SPAN_ID:"$span.span_id",OUTPUT:"$output",OUTPUT_TYPE:"$mime_type_output",STYLE:"$style",STYLE_ICON:"$style.icon",STYLE_VARIANT:"$style.variant",STYLE_ACCESSORY:"$style.accessory",METADATA:"$metadata",TRIGGER:"$trigger",PAYLOAD:"$payload",PAYLOAD_TYPE:"$mime_type_payload",SHOW:"$show",SHOW_ACTIONS:"$show.actions",WORKER_ID:"worker.id",WORKER_VERSION:"worker.version",CLI_VERSION:"cli.version",SDK_VERSION:"sdk.version",SDK_LANGUAGE:"sdk.language",RETRY_AT:"retry.at",RETRY_DELAY:"retry.delay",RETRY_COUNT:"retry.count",LINK_TITLE:"$link.title",IDEMPOTENCY_KEY:"ctx.run.idempotencyKey",USAGE_DURATION_MS:"$usage.durationMs",USAGE_COST_IN_CENTS:"$usage.costInCents",RATE_LIMIT_LIMIT:"response.rateLimit.limit",RATE_LIMIT_REMAINING:"response.rateLimit.remaining",RATE_LIMIT_RESET:"response.rateLimit.reset"},Cn="task-context",on=class on{constructor(){q(this,Rt)}static getInstance(){return this._instance||(this._instance=new on),this._instance}get isInsideTask(){return m(this,Rt,yn).call(this)!==void 0}get ctx(){var e;return(e=m(this,Rt,yn).call(this))==null?void 0:e.ctx}get worker(){var e;return(e=m(this,Rt,yn).call(this))==null?void 0:e.worker}get attributes(){return this.ctx?{...this.contextAttributes,...this.workerAttributes}:{}}get workerAttributes(){return this.worker?{[A.WORKER_ID]:this.worker.id,[A.WORKER_VERSION]:this.worker.version}:{}}get contextAttributes(){var e,r,s,a,i;return this.ctx?{[A.ATTEMPT_ID]:this.ctx.attempt.id,[A.ATTEMPT_NUMBER]:this.ctx.attempt.number,[A.TASK_SLUG]:this.ctx.task.id,[A.TASK_PATH]:this.ctx.task.filePath,[A.TASK_EXPORT_NAME]:this.ctx.task.exportName,[A.QUEUE_NAME]:this.ctx.queue.name,[A.QUEUE_ID]:this.ctx.queue.id,[A.ENVIRONMENT_ID]:this.ctx.environment.id,[A.ENVIRONMENT_TYPE]:this.ctx.environment.type,[A.ORGANIZATION_ID]:this.ctx.organization.id,[A.PROJECT_ID]:this.ctx.project.id,[A.PROJECT_REF]:this.ctx.project.ref,[A.PROJECT_NAME]:this.ctx.project.name,[A.RUN_ID]:this.ctx.run.id,[A.RUN_IS_TEST]:this.ctx.run.isTest,[A.ORGANIZATION_SLUG]:this.ctx.organization.slug,[A.ORGANIZATION_NAME]:this.ctx.organization.name,[A.BATCH_ID]:(e=this.ctx.batch)==null?void 0:e.id,[A.IDEMPOTENCY_KEY]:this.ctx.run.idempotencyKey,[A.MACHINE_PRESET_NAME]:(r=this.ctx.machine)==null?void 0:r.name,[A.MACHINE_PRESET_CPU]:(s=this.ctx.machine)==null?void 0:s.cpu,[A.MACHINE_PRESET_MEMORY]:(a=this.ctx.machine)==null?void 0:a.memory,[A.MACHINE_PRESET_CENTS_PER_MS]:(i=this.ctx.machine)==null?void 0:i.centsPerMs}:{}}disable(){Ke(Cn)}setGlobalTaskContext(e){return oe(Cn,e)}};Rt=new WeakSet,yn=function(){return Re(Cn)},_(on,"_instance");let Mn=on;const W=Mn.getInstance(),ku=/[$_\p{ID_Start}][$\u200c\u200d\p{ID_Continue}]*/u;function Ou(t){return t.length===1?t[0].toString():t.reduce((e,r)=>{if(typeof r=="number")return e+"["+r.toString()+"]";if(r.includes('"'))return e+'["'+xu(r)+'"]';if(!ku.test(r))return e+'["'+r+'"]';const s=e.length===0?"":".";return e+s+r},"")}function xu(t){return t.replace(/"/g,'\\"')}function Nu(t){return t.length!==0}const Pu=99,Cu="; ",Mu=", or ",$a="Validation error",ju=": ";class Du extends Error{constructor(r,s=[]){super(r);_(this,"details");_(this,"name");this.details=s,this.name="ZodValidationError"}toString(){return this.message}}function La(t,e,r){if(t.code==="invalid_union")return t.unionErrors.reduce((s,a)=>{const i=a.issues.map(o=>La(o,e,r)).join(e);return s.includes(i)||s.push(i),s},[]).join(r);if(Nu(t.path)){if(t.path.length===1){const s=t.path[0];if(typeof s=="number")return`${t.message} at index ${s}`}return`${t.message} at "${Ou(t.path)}"`}return t.message}function Uu(t,e,r){return e!==null?t.length>0?[e,t].join(r):e:t.length>0?t:$a}function $u(t,e={}){const{maxIssuesInMessage:r=Pu,issueSeparator:s=Cu,unionSeparator:a=Mu,prefixSeparator:i=ju,prefix:o=$a}=e,c=t.errors.slice(0,r).map(l=>La(l,s,a)).join(s),u=Uu(c,o,i);return new Du(u,t.errors)}const Ka={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!0};function Wa(t,e){const r={...Ka,...t};if(e>=r.maxAttempts)return;const{factor:s,minTimeoutInMs:a,maxTimeoutInMs:i,randomize:o}=r,c=o?Math.random()+1:1,u=Math.min(i,c*a*Math.pow(s,e-1));return Math.round(u)}class G extends Error{constructor(r,s,a,i){super(`${G.makeMessage(r,s,a)}`);_(this,"status");_(this,"headers");_(this,"error");_(this,"code");_(this,"param");_(this,"type");this.name="TriggerApiError",this.status=r,this.headers=i;const o=s;this.error=o,this.code=o==null?void 0:o.code,this.param=o==null?void 0:o.param,this.type=o==null?void 0:o.type}static makeMessage(r,s,a){const i=s!=null&&s.message?typeof s.message=="string"?s.message:JSON.stringify(s.message):s?JSON.stringify(s):a;return r&&i?`${r} ${i}`:r?`${r} status code (no body)`:i||"(no status code or body)"}static generate(r,s,a,i){if(!r)return new Va({cause:zu(s)});const o=s==null?void 0:s.error;return r===400?new Lu(r,o,a,i):r===401?new Ku(r,o,a,i):r===403?new Wu(r,o,a,i):r===404?new Vu(r,o,a,i):r===409?new Gu(r,o,a,i):r===422?new Bu(r,o,a,i):r===429?new Fu(r,o,a,i):r>=500?new Hu(r,o,a,i):new G(r,o,a,i)}}class Va extends G{constructor({message:r,cause:s}){super(void 0,void 0,r||"Connection error.",void 0);_(this,"status");s&&(this.cause=s)}}class Lu extends G{constructor(){super(...arguments);_(this,"status",400)}}class Ku extends G{constructor(){super(...arguments);_(this,"status",401)}}class Wu extends G{constructor(){super(...arguments);_(this,"status",403)}}class Vu extends G{constructor(){super(...arguments);_(this,"status",404)}}class Gu extends G{constructor(){super(...arguments);_(this,"status",409)}}class Bu extends G{constructor(){super(...arguments);_(this,"status",422)}}class Fu extends G{constructor(){super(...arguments);_(this,"status",429)}get millisecondsUntilReset(){const r=(this.headers??{})["x-ratelimit-reset"];if(typeof r=="string"){const s=parseInt(r,10);return isNaN(s)?void 0:Math.max(s-Date.now()+Math.floor(Math.random()*2e3),0)}}}class Hu extends G{}class Zu extends G{constructor({message:r,cause:s,status:a,rawBody:i,headers:o}){super(a,void 0,r||"Validation error.",o);_(this,"status",200);_(this,"rawBody");s&&(this.cause=s),this.rawBody=i}}function zu(t){return t instanceof Error?t:new Error(t)}var Ju=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},We="1.9.0",Ga=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function Yu(t){var e=new Set([t]),r=new Set,s=t.match(Ga);if(!s)return function(){return!1};var a={major:+s[1],minor:+s[2],patch:+s[3],prerelease:s[4]};if(a.prerelease!=null)return function(u){return u===t};function i(c){return r.add(c),!1}function o(c){return e.add(c),!0}return function(u){if(e.has(u))return!0;if(r.has(u))return!1;var l=u.match(Ga);if(!l)return i(u);var d={major:+l[1],minor:+l[2],patch:+l[3],prerelease:l[4]};return d.prerelease!=null||a.major!==d.major?i(u):a.major===0?a.minor===d.minor&&a.patch<=d.patch?o(u):i(u):a.minor<=d.minor?o(u):i(u)}}var Xu=Yu(We),qu=We.split(".")[0],Zt=Symbol.for("opentelemetry.js.api."+qu),zt=Ju;function Jt(t,e,r,s){var a;s===void 0&&(s=!1);var i=zt[Zt]=(a=zt[Zt])!==null&&a!==void 0?a:{version:We};if(!s&&i[t]){var o=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+t);return r.error(o.stack||o.message),!1}if(i.version!==We){var o=new Error("@opentelemetry/api: Registration of version v"+i.version+" for "+t+" does not match previously registered API v"+We);return r.error(o.stack||o.message),!1}return i[t]=e,r.debug("@opentelemetry/api: Registered a global for "+t+" v"+We+"."),!0}function Ve(t){var e,r,s=(e=zt[Zt])===null||e===void 0?void 0:e.version;if(!(!s||!Xu(s)))return(r=zt[Zt])===null||r===void 0?void 0:r[t]}function Yt(t,e){e.debug("@opentelemetry/api: Unregistering a global for "+t+" v"+We+".");var r=zt[Zt];r&&delete r[t]}var Qu=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},el=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},tl=function(){function t(e){this._namespace=e.namespace||"DiagComponentLogger"}return t.prototype.debug=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Xt("debug",this._namespace,e)},t.prototype.error=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Xt("error",this._namespace,e)},t.prototype.info=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Xt("info",this._namespace,e)},t.prototype.warn=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Xt("warn",this._namespace,e)},t.prototype.verbose=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Xt("verbose",this._namespace,e)},t}();function Xt(t,e,r){var s=Ve("diag");if(s)return r.unshift(e),s[t].apply(s,el([],Qu(r),!1))}var Y;(function(t){t[t.NONE=0]="NONE",t[t.ERROR=30]="ERROR",t[t.WARN=50]="WARN",t[t.INFO=60]="INFO",t[t.DEBUG=70]="DEBUG",t[t.VERBOSE=80]="VERBOSE",t[t.ALL=9999]="ALL"})(Y||(Y={}));function rl(t,e){t<Y.NONE?t=Y.NONE:t>Y.ALL&&(t=Y.ALL),e=e||{};function r(s,a){var i=e[s];return typeof i=="function"&&t>=a?i.bind(e):function(){}}return{error:r("error",Y.ERROR),warn:r("warn",Y.WARN),info:r("info",Y.INFO),debug:r("debug",Y.DEBUG),verbose:r("verbose",Y.VERBOSE)}}var nl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},sl=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},al="diag",ce=function(){function t(){function e(a){return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var c=Ve("diag");if(c)return c[a].apply(c,sl([],nl(i),!1))}}var r=this,s=function(a,i){var o,c,u;if(i===void 0&&(i={logLevel:Y.INFO}),a===r){var l=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((o=l.stack)!==null&&o!==void 0?o:l.message),!1}typeof i=="number"&&(i={logLevel:i});var d=Ve("diag"),y=rl((c=i.logLevel)!==null&&c!==void 0?c:Y.INFO,a);if(d&&!i.suppressOverrideMessage){var E=(u=new Error().stack)!==null&&u!==void 0?u:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+E),y.warn("Current logger will overwrite one already registered from "+E)}return Jt("diag",y,r,!0)};r.setLogger=s,r.disable=function(){Yt(al,r)},r.createComponentLogger=function(a){return new tl(a)},r.verbose=e("verbose"),r.debug=e("debug"),r.info=e("info"),r.warn=e("warn"),r.error=e("error")}return t.instance=function(){return this._instance||(this._instance=new t),this._instance},t}(),il=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},ol=function(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],s=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},cl=function(){function t(e){this._entries=e?new Map(e):new Map}return t.prototype.getEntry=function(e){var r=this._entries.get(e);if(r)return Object.assign({},r)},t.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var r=il(e,2),s=r[0],a=r[1];return[s,a]})},t.prototype.setEntry=function(e,r){var s=new t(this._entries);return s._entries.set(e,r),s},t.prototype.removeEntry=function(e){var r=new t(this._entries);return r._entries.delete(e),r},t.prototype.removeEntries=function(){for(var e,r,s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var i=new t(this._entries);try{for(var o=ol(s),c=o.next();!c.done;c=o.next()){var u=c.value;i._entries.delete(u)}}catch(l){e={error:l}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i},t.prototype.clear=function(){return new t},t}();ce.instance();function ul(t){return t===void 0&&(t={}),new cl(new Map(Object.entries(t)))}function Ba(t){return Symbol.for(t)}var ll=function(){function t(e){var r=this;r._currentContext=e?new Map(e):new Map,r.getValue=function(s){return r._currentContext.get(s)},r.setValue=function(s,a){var i=new t(r._currentContext);return i._currentContext.set(s,a),i},r.deleteValue=function(s){var a=new t(r._currentContext);return a._currentContext.delete(s),a}}return t}(),dl=new ll,Ge=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,a){s.__proto__=a}||function(s,a){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(s[i]=a[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function s(){this.constructor=e}e.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}}(),fl=function(){function t(){}return t.prototype.createGauge=function(e,r){return Tl},t.prototype.createHistogram=function(e,r){return Rl},t.prototype.createCounter=function(e,r){return El},t.prototype.createUpDownCounter=function(e,r){return wl},t.prototype.createObservableGauge=function(e,r){return Al},t.prototype.createObservableCounter=function(e,r){return Sl},t.prototype.createObservableUpDownCounter=function(e,r){return Il},t.prototype.addBatchObservableCallback=function(e,r){},t.prototype.removeBatchObservableCallback=function(e){},t}(),Lr=function(){function t(){}return t}(),hl=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,s){},e}(Lr),pl=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.add=function(r,s){},e}(Lr),gl=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,s){},e}(Lr),ml=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.record=function(r,s){},e}(Lr),jn=function(){function t(){}return t.prototype.addCallback=function(e){},t.prototype.removeCallback=function(e){},t}(),yl=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(jn),_l=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(jn),bl=function(t){Ge(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(jn),vl=new fl,El=new hl,Tl=new gl,Rl=new ml,wl=new pl,Sl=new yl,Al=new _l,Il=new bl,kl={get:function(t,e){if(t!=null)return t[e]},keys:function(t){return t==null?[]:Object.keys(t)}},Ol={set:function(t,e,r){t!=null&&(t[e]=r)}},xl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},Nl=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},Pl=function(){function t(){}return t.prototype.active=function(){return dl},t.prototype.with=function(e,r,s){for(var a=[],i=3;i<arguments.length;i++)a[i-3]=arguments[i];return r.call.apply(r,Nl([s],xl(a),!1))},t.prototype.bind=function(e,r){return r},t.prototype.enable=function(){return this},t.prototype.disable=function(){return this},t}(),Cl=function(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var s=r.call(t),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=s.next()).done;)i.push(a.value)}catch(c){o={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return i},Ml=function(t,e,r){if(r||arguments.length===2)for(var s=0,a=e.length,i;s<a;s++)(i||!(s in e))&&(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))},Dn="context",jl=new Pl,Kr=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalContextManager=function(e){return Jt(Dn,e,ce.instance())},t.prototype.active=function(){return this._getContextManager().active()},t.prototype.with=function(e,r,s){for(var a,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];return(a=this._getContextManager()).with.apply(a,Ml([e,r,s],Cl(i),!1))},t.prototype.bind=function(e,r){return this._getContextManager().bind(e,r)},t.prototype._getContextManager=function(){return Ve(Dn)||jl},t.prototype.disable=function(){this._getContextManager().disable(),Yt(Dn,ce.instance())},t}(),Un;(function(t){t[t.NONE=0]="NONE",t[t.SAMPLED=1]="SAMPLED"})(Un||(Un={}));var Fa="0000000000000000",Ha="00000000000000000000000000000000",Dl={traceId:Ha,spanId:Fa,traceFlags:Un.NONE},qt=function(){function t(e){e===void 0&&(e=Dl),this._spanContext=e}return t.prototype.spanContext=function(){return this._spanContext},t.prototype.setAttribute=function(e,r){return this},t.prototype.setAttributes=function(e){return this},t.prototype.addEvent=function(e,r){return this},t.prototype.addLink=function(e){return this},t.prototype.addLinks=function(e){return this},t.prototype.setStatus=function(e){return this},t.prototype.updateName=function(e){return this},t.prototype.end=function(e){},t.prototype.isRecording=function(){return!1},t.prototype.recordException=function(e,r){},t}(),$n=Ba("OpenTelemetry Context Key SPAN");function Ln(t){return t.getValue($n)||void 0}function Ul(){return Ln(Kr.getInstance().active())}function Kn(t,e){return t.setValue($n,e)}function $l(t){return t.deleteValue($n)}function Ll(t,e){return Kn(t,new qt(e))}function Za(t){var e;return(e=Ln(t))===null||e===void 0?void 0:e.spanContext()}var Kl=/^([0-9a-f]{32})$/i,Wl=/^[0-9a-f]{16}$/i;function Vl(t){return Kl.test(t)&&t!==Ha}function Gl(t){return Wl.test(t)&&t!==Fa}function za(t){return Vl(t.traceId)&&Gl(t.spanId)}function Bl(t){return new qt(t)}var Wn=Kr.getInstance(),Ja=function(){function t(){}return t.prototype.startSpan=function(e,r,s){s===void 0&&(s=Wn.active());var a=!!(r!=null&&r.root);if(a)return new qt;var i=s&&Za(s);return Fl(i)&&za(i)?new qt(i):new qt},t.prototype.startActiveSpan=function(e,r,s,a){var i,o,c;if(!(arguments.length<2)){arguments.length===2?c=r:arguments.length===3?(i=r,c=s):(i=r,o=s,c=a);var u=o??Wn.active(),l=this.startSpan(e,i,u),d=Kn(u,l);return Wn.with(d,c,void 0,l)}},t}();function Fl(t){return typeof t=="object"&&typeof t.spanId=="string"&&typeof t.traceId=="string"&&typeof t.traceFlags=="number"}var Hl=new Ja,Zl=function(){function t(e,r,s,a){this._provider=e,this.name=r,this.version=s,this.options=a}return t.prototype.startSpan=function(e,r,s){return this._getTracer().startSpan(e,r,s)},t.prototype.startActiveSpan=function(e,r,s,a){var i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)},t.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Hl},t}(),zl=function(){function t(){}return t.prototype.getTracer=function(e,r,s){return new Ja},t}(),Jl=new zl,Ya=function(){function t(){}return t.prototype.getTracer=function(e,r,s){var a;return(a=this.getDelegateTracer(e,r,s))!==null&&a!==void 0?a:new Zl(this,e,r,s)},t.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:Jl},t.prototype.setDelegate=function(e){this._delegate=e},t.prototype.getDelegateTracer=function(e,r,s){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(e,r,s)},t}(),Qt;(function(t){t[t.INTERNAL=0]="INTERNAL",t[t.SERVER=1]="SERVER",t[t.CLIENT=2]="CLIENT",t[t.PRODUCER=3]="PRODUCER",t[t.CONSUMER=4]="CONSUMER"})(Qt||(Qt={}));var Wr;(function(t){t[t.UNSET=0]="UNSET",t[t.OK=1]="OK",t[t.ERROR=2]="ERROR"})(Wr||(Wr={}));var Vr=Kr.getInstance();ce.instance();var Yl=function(){function t(){}return t.prototype.getMeter=function(e,r,s){return vl},t}(),Xl=new Yl,Vn="metrics",ql=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalMeterProvider=function(e){return Jt(Vn,e,ce.instance())},t.prototype.getMeterProvider=function(){return Ve(Vn)||Xl},t.prototype.getMeter=function(e,r,s){return this.getMeterProvider().getMeter(e,r,s)},t.prototype.disable=function(){Yt(Vn,ce.instance())},t}();ql.getInstance();var Ql=function(){function t(){}return t.prototype.inject=function(e,r){},t.prototype.extract=function(e,r){return e},t.prototype.fields=function(){return[]},t}(),Gn=Ba("OpenTelemetry Baggage Key");function Xa(t){return t.getValue(Gn)||void 0}function ed(){return Xa(Kr.getInstance().active())}function td(t,e){return t.setValue(Gn,e)}function rd(t){return t.deleteValue(Gn)}var Bn="propagation",nd=new Ql,sd=function(){function t(){this.createBaggage=ul,this.getBaggage=Xa,this.getActiveBaggage=ed,this.setBaggage=td,this.deleteBaggage=rd}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalPropagator=function(e){return Jt(Bn,e,ce.instance())},t.prototype.inject=function(e,r,s){return s===void 0&&(s=Ol),this._getGlobalPropagator().inject(e,r,s)},t.prototype.extract=function(e,r,s){return s===void 0&&(s=kl),this._getGlobalPropagator().extract(e,r,s)},t.prototype.fields=function(){return this._getGlobalPropagator().fields()},t.prototype.disable=function(){Yt(Bn,ce.instance())},t.prototype._getGlobalPropagator=function(){return Ve(Bn)||nd},t}(),qa=sd.getInstance(),Fn="trace",ad=function(){function t(){this._proxyTracerProvider=new Ya,this.wrapSpanContext=Bl,this.isSpanContextValid=za,this.deleteSpan=$l,this.getSpan=Ln,this.getActiveSpan=Ul,this.getSpanContext=Za,this.setSpan=Kn,this.setSpanContext=Ll}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalTracerProvider=function(e){var r=Jt(Fn,this._proxyTracerProvider,ce.instance());return r&&this._proxyTracerProvider.setDelegate(e),r},t.prototype.getTracerProvider=function(){return Ve(Fn)||this._proxyTracerProvider},t.prototype.getTracer=function(e,r){return this.getTracerProvider().getTracer(e,r)},t.prototype.disable=function(){Yt(Fn,ce.instance()),this._proxyTracerProvider=new Ya},t}(),id=ad.getInstance();const Hn="$@null((",od="$@circular((";function Zn(t,e,r=new WeakSet){const s={};if(t===void 0)return s;if(t===null)return s[e||""]=Hn,s;if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")return s[e||""]=t,s;if(t instanceof Date)return s[e||""]=t.toISOString(),s;if(t!==null&&typeof t=="object"&&r.has(t))return s[e||""]=od,s;t!==null&&typeof t=="object"&&r.add(t);for(const[a,i]of Object.entries(t)){const o=`${e?`${e}.`:""}${Array.isArray(t)?`[${a}]`:a}`;if(Array.isArray(i))for(let c=0;c<i.length;c++)typeof i[c]=="object"&&i[c]!==null?Object.assign(s,Zn(i[c],`${o}.[${c}]`,r)):i[c]===null?s[`${o}.[${c}]`]=Hn:s[`${o}.[${c}]`]=i[c];else cd(i)?Object.assign(s,Zn(i,o,r)):typeof i=="number"||typeof i=="string"||typeof i=="boolean"?s[o]=i:i===null&&(s[o]=Hn)}return s}function cd(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function er(t){return Zn(t,A.STYLE_ACCESSORY)}class ud{constructor(e,r,s){_(this,"pageFetcher");_(this,"data");_(this,"pagination");this.pageFetcher=s,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return!!this.pagination.next}hasPreviousPage(){return!!this.pagination.previous}getNextPage(){if(!this.pagination.next)throw new Error("No next page available");return this.pageFetcher({after:this.pagination.next})}getPreviousPage(){if(!this.pagination.previous)throw new Error("No previous page available");return this.pageFetcher({before:this.pagination.previous})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}class ld{constructor(e,r,s){_(this,"pageFetcher");_(this,"data");_(this,"pagination");this.pageFetcher=s,this.data=e,this.pagination=r}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.pagination.currentPage<this.pagination.totalPages}hasPreviousPage(){return this.pagination.currentPage>1}getNextPage(){if(!this.hasNextPage())throw new Error("No next page available");return this.pageFetcher({page:this.pagination.currentPage+1})}getPreviousPage(){if(!this.hasPreviousPage())throw new Error("No previous page available");return this.pageFetcher({page:this.pagination.currentPage-1})}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[Symbol.asyncIterator](){for await(const e of this.iterPages())for(const r of e.getPaginatedItems())yield r}}const Qa={maxAttempts:3,factor:2,minTimeoutInMs:1e3,maxTimeoutInMs:6e4,randomize:!1};function j(t,e,r,s){return new Xn(Jn(t,e,r,s))}function zn(t,e,r,s,a){const i=new URLSearchParams(r.query);r.limit&&i.set("page[size]",String(r.limit)),r.after&&i.set("page[after]",r.after),r.before&&i.set("page[before]",r.before);const o=n.object({data:n.array(t),pagination:n.object({next:n.string().optional(),previous:n.string().optional()})}),c=new URL(e);c.search=i.toString();const u=Jn(o,c.href,s,a);return new yd(u,t,e,r,s,a)}function ei(t,e,r,s,a){const i=new URLSearchParams(r.query);r.limit&&i.set("perPage",String(r.limit)),r.page&&i.set("page",String(r.page));const o=n.object({data:n.array(t),pagination:n.object({currentPage:n.coerce.number(),totalPages:n.coerce.number(),count:n.coerce.number()})}),c=new URL(e);c.search=i.toString();const u=Jn(o,c.href,s,a);return new _d(u,t,e,r,s,a)}async function dd(t,e){var i,o,c;if(!((i=t.options)!=null&&i.tracer))return e();const r=new URL(t.url),s=((o=t.requestInit)==null?void 0:o.method)??"GET",a=t.options.name??`${s} ${r.pathname}`;return await t.options.tracer.startActiveSpan(a,async u=>await e(u),{attributes:{[A.STYLE_ICON]:((c=t.options)==null?void 0:c.icon)??"api",...t.options.attributes}})}async function Jn(t,e,r,s){let a=await r;return dd({url:e,requestInit:a,options:s},async i=>{a=bd(a);const o=await Yn(t,e,a,s);return s!=null&&s.onResponseBody&&i&&s.onResponseBody(o.data,i),o})}async function Yn(t,e,r,s,a=1){try{const i=await fetch(e,md(r)),o=gd(i.headers);if(!i.ok){const d=hd(i,a,s==null?void 0:s.retry);if(d.retry)return await ri(e,a+1,d.delay,s,r,i),await Yn(t,e,r,s,a+1);{const y=await i.text().catch(M=>ti(M).message),E=pd(y),I=E?void 0:y;throw G.generate(i.status,E,I,o)}}const c=await fd(i),u=t.safeParse(c);if(u.success)return{data:u.data,response:i};const l=$u(u.error);throw new Zu({status:i.status,cause:l,message:l.message,rawBody:c,headers:o})}catch(i){if(i instanceof G)throw i;if(s!=null&&s.retry){const o={...Qa,...s.retry},c=Wa(o,a);if(c)return await ri(e,a+1,c,s,r),await Yn(t,e,r,s,a+1)}throw new Va({cause:ti(i)})}}async function fd(t){try{return await t.clone().json()}catch{return}}function ti(t){return t instanceof Error?t:new Error(t)}function hd(t,e,r){function s(){const i={...Qa,...r},o=Wa(i,e);return o?{retry:!0,delay:o}:{retry:!1}}const a=t.headers.get("x-should-retry");if(a==="true")return s();if(a==="false")return{retry:!1};if(t.status===408||t.status===409)return s();if(t.status===429){if(e>=(typeof(r==null?void 0:r.maxAttempts)=="number"?r==null?void 0:r.maxAttempts:3))return{retry:!1};const i=t.headers.get("x-ratelimit-reset");if(i){const c=parseInt(i,10)-Date.now()+Math.floor(Math.random()*1e3);if(c>0)return{retry:!0,delay:c}}return s()}return t.status>=500?s():{retry:!1}}function pd(t){try{return JSON.parse(t)}catch{return}}function gd(t){return new Proxy(Object.fromEntries(t.entries()),{get(e,r){const s=r.toString();return e[s.toLowerCase()]||e[s]}})}function md(t){try{const e={...t,cache:"no-cache"},r=new Request("http://localhost",e);return e}catch{return t??{}}}class Xn extends Promise{constructor(r){super(s=>{s(null)});_(this,"responsePromise");this.responsePromise=r}asResponse(){return this.responsePromise.then(r=>r.response)}async withResponse(){const[r,s]=await Promise.all([this.parse(),this.asResponse()]);return{data:r,response:s}}parse(){return this.responsePromise.then(r=>r.data)}then(r,s){return this.parse().then(r,s)}catch(r){return this.parse().catch(r)}finally(r){return this.parse().finally(r)}}class yd extends Xn{constructor(r,s,a,i,o,c){super(r.then(u=>({data:new ud(u.data.data,u.data.pagination,m(this,cn,bo).bind(this)),response:u.response})));q(this,cn);_(this,"schema");_(this,"url");_(this,"params");_(this,"requestInit");_(this,"options");this.schema=s,this.url=a,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const s of r)yield s}}cn=new WeakSet,bo=function(r){return zn(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};class _d extends Xn{constructor(r,s,a,i,o,c){super(r.then(u=>({data:new ld(u.data.data,u.data.pagination,m(this,un,vo).bind(this)),response:u.response})));q(this,un);_(this,"schema");_(this,"url");_(this,"params");_(this,"requestInit");_(this,"options");this.schema=s,this.url=a,this.params=i,this.requestInit=o,this.options=c}async*[Symbol.asyncIterator](){const r=await this;for await(const s of r)yield s}}un=new WeakSet,vo=function(r){return ei(this.schema,this.url,{...this.params,...r},this.requestInit,this.options)};async function ri(t,e,r,s,a,i){if(s!=null&&s.tracer){const o=(a==null?void 0:a.method)??"GET";return s.tracer.startActiveSpan(i?`wait after ${i.status}`:"wait after error",async c=>{await new Promise(u=>setTimeout(u,r))},{attributes:{[A.STYLE_ICON]:"wait",...er({items:[{text:`retrying ${(s==null?void 0:s.name)??o.toUpperCase()} in ${r}ms`,variant:"normal"}],style:"codepath"})}})}await new Promise(o=>setTimeout(o,r))}function bd(t){const e=new Headers(t==null?void 0:t.headers);if(e.get("x-trigger-worker")!=="true")return t;const r=Object.fromEntries(e.entries());return qa.inject(Vr.active(),r),{...t,headers:new Headers(r)}}const tr={docs:{config:{home:"https://trigger.dev/docs/config/config-file",additionalPackages:"https://trigger.dev/docs/config/config-file#additionalpackages",extensions:"https://trigger.dev/docs/config/config-file#extensions",prisma:"https://trigger.dev/docs/config/config-file#prisma"},machines:{home:"https://trigger.dev/docs/v3/machines"},upgrade:{beta:"https://trigger.dev/docs/upgrading-beta"}},site:{home:"https://trigger.dev",contact:"https://trigger.dev/contact"}};function vd(t){switch(t.type){case"BUILT_IN_ERROR":{const e=new Error(t.message);return e.name=t.name,e.stack=t.stackTrace,e}case"STRING_ERROR":return t.raw;case"CUSTOM_ERROR":return JSON.parse(t.raw);case"INTERNAL_ERROR":{const e=new Error(t.message??`Internal error (${t.code})`);return e.name=t.code,e.stack=t.stackTrace,e}}}function Ed(t){const e=Rd(t);switch(e.type){case"BUILT_IN_ERROR":return{name:e.name,message:e.message,stackTrace:e.stackTrace};case"STRING_ERROR":return{message:e.raw};case"CUSTOM_ERROR":return{message:e.raw};case"INTERNAL_ERROR":return{message:`trigger.dev internal error (${e.code})`}}}const Td={TASK_PROCESS_OOM_KILLED:{message:"Your task ran out of memory. Try increasing the machine specs. If this doesn't fix it there might be a memory leak.",link:{name:"Machines",href:tr.docs.machines.home}},TASK_PROCESS_MAYBE_OOM_KILLED:{message:"We think your task ran out of memory, but we can't be certain. If this keeps happening, try increasing the machine specs.",link:{name:"Machines",href:tr.docs.machines.home}},TASK_PROCESS_SIGSEGV:{message:"Your task crashed with a segmentation fault (SIGSEGV). Most likely there's a bug in a package or binary you're using. If this keeps happening and you're unsure why, please get in touch.",link:{name:"Contact us",href:tr.site.contact,magic:"CONTACT_FORM"}},TASK_PROCESS_SIGTERM:{message:"Your task exited after receiving SIGTERM but we don't know why. If this keeps happening, please get in touch so we can investigate.",link:{name:"Contact us",href:tr.site.contact,magic:"CONTACT_FORM"}},OUTDATED_SDK_VERSION:{message:"Your task is using an outdated version of the SDK. Please upgrade to the latest version.",link:{name:"Beta upgrade guide",href:tr.docs.upgrade.beta}}},ue=t=>({type:"INTERNAL_ERROR",code:t,...Td[t]}),ni=(t,e=100)=>{if(!t)return;const r=e?t.slice(0,e):t;return r.includes("SIGTERM")?"SIGTERM":r.includes("SIGSEGV")?"SIGSEGV":r.includes("SIGKILL")?"SIGKILL":void 0};function Rd(t){switch(t.type){case"BUILT_IN_ERROR":{if(t.name==="UnexpectedExitError"&&t.message.startsWith("Unexpected exit with code -1"))switch(ni(t.stackTrace)){case"SIGTERM":return{...ue("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...ue("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...ue("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...ue("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}if(t.name==="Error"&&t.message==="ffmpeg was killed with signal SIGKILL")return{...ue("TASK_PROCESS_OOM_KILLED")};break}case"STRING_ERROR":break;case"CUSTOM_ERROR":break;case"INTERNAL_ERROR":{if(t.code===oa.TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE)switch(ni(t.message)){case"SIGTERM":return{...ue("TASK_PROCESS_SIGTERM")};case"SIGSEGV":return{...ue("TASK_PROCESS_SIGSEGV")};case"SIGKILL":return{...ue("TASK_PROCESS_MAYBE_OOM_KILLED")};default:return{...ue("TASK_PROCESS_EXITED_WITH_NON_ZERO_CODE"),message:t.message,stackTrace:t.stackTrace}}return{...t,...ue(t.code)}}}return t}function rr(t,e){return typeof process<"u"&&typeof process.env=="object"&&process.env!==null?process.env[t]??e:e}const nr="api-client";class wd extends Error{constructor(e){super(e),this.name="ApiClientMissingError"}}const ln=class ln{constructor(){q(this,wt)}static getInstance(){return this._instance||(this._instance=new ln),this._instance}disable(){Ke(nr)}get baseURL(){const e=m(this,wt,_n).call(this);return(e==null?void 0:e.baseURL)??rr("TRIGGER_API_URL")??"https://api.trigger.dev"}get accessToken(){const e=m(this,wt,_n).call(this);return(e==null?void 0:e.secretKey)??(e==null?void 0:e.accessToken)??rr("TRIGGER_SECRET_KEY")??rr("TRIGGER_ACCESS_TOKEN")}get client(){if(!(!this.baseURL||!this.accessToken))return new ui(this.baseURL,this.accessToken)}clientOrThrow(){if(!this.baseURL||!this.accessToken)throw new wd(this.apiClientMissingError());return new ui(this.baseURL,this.accessToken)}runWithConfig(e,r){const s=m(this,wt,_n).call(this),a={...s,...e};return oe(nr,a,!0),r().finally(()=>{oe(nr,s,!0)})}setGlobalAPIClientConfiguration(e){return oe(nr,e)}apiClientMissingError(){const e=!!this.baseURL,r=!!this.accessToken;if(!e&&!r)return"You need to set the TRIGGER_API_URL and TRIGGER_SECRET_KEY environment variables. See https://trigger.dev/docs/management/overview#authentication";if(e){if(!r)return"You need to set the TRIGGER_SECRET_KEY environment variable. See https://trigger.dev/docs/management/overview#authentication"}else return"You need to set the TRIGGER_API_URL environment variable. See https://trigger.dev/docs/management/overview#authentication";return"Unknown error"}};wt=new WeakSet,_n=function(){return Re(nr)},_(ln,"_instance");let qn=ln;const sr=qn.getInstance();async function Qn(t){if(t.data)switch(t.dataType){case"application/json":return JSON.parse(t.data);case"application/super+json":const{parse:e}=await ii();return e(t.data);case"text/plain":return t.data;case"application/store":throw new Error(`Cannot parse an application/store packet (${t.data}). Needs to be imported first.`);default:return t.data}}async function Sd(t,e){const r=await si(t,void 0,e);return await Qn(r)}async function Gr(t){if(t===void 0)return{dataType:"application/json"};if(typeof t=="string")return{data:t,dataType:"text/plain"};try{const{stringify:e}=await ii();return{data:e(t),dataType:"application/super+json"}}catch{return{data:t,dataType:"application/json"}}}const Ad={minTimeoutInMs:500,maxTimeoutInMs:5e3,maxAttempts:5,factor:2,randomize:!0};async function si(t,e,r){return t.dataType!=="application/store"?t:e?await e.startActiveSpan("store.downloadPayload",async a=>await ai(t,a,r),{attributes:{[A.STYLE_ICON]:"cloud-download"}})??t:await ai(t,void 0,r)}async function ai(t,e,r){if(!t.data)return t;const s=r??sr.client;if(!s)return t;const a=await s.getPayloadUrl(t.data),i=await j(n.any(),a.presignedUrl,void 0,{retry:Ad}).asResponse();if(!i.ok)throw new Error(`Failed to import packet ${a.presignedUrl}: ${i.statusText}`);const o=await i.text();return e==null||e.setAttribute("size",Buffer.byteLength(o,"utf8")),{data:o,dataType:i.headers.get("content-type")??"application/json"}}async function ii(){const t=await Promise.resolve().then(()=>sp);return t.registerCustom({isApplicable:e=>typeof Buffer=="function"&&Buffer.isBuffer(e),serialize:e=>[...e],deserialize:e=>Buffer.from(e)},"buffer"),t}async function Id(t,e,r,s){const{ShapeStream:a,Shape:i,FetchError:o}=await Promise.resolve().then(()=>jp),c=new a({url:e,headers:{...s==null?void 0:s.headers,"x-trigger-electric-version":"0.8.1"},fetchClient:s==null?void 0:s.fetchClient,signal:s==null?void 0:s.signal});try{const u=new i(c),l=await u.rows;for(const d of l)await r(t.parse(d));return u.subscribe(async d=>{for(const y of d.rows)await r(t.parse(y))})}catch(u){throw u instanceof o?G.generate(u.status,u.json,u.message,u.headers):u}}function oi(t,e){const r=t.pipeThrough(new TransformStream(e));return r[Symbol.asyncIterator]=()=>{const s=r.getReader();return{async next(){const{done:a,value:i}=await s.read();return a?{done:!0,value:void 0}:{done:!1,value:i}}}},r}var kd=Object.defineProperty,Od=(t,e,r)=>e in t?kd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Br=(t,e,r)=>Od(t,typeof e!="symbol"?e+"":e,r);class ci extends Error{constructor(e,r){super(e),Br(this,"type"),Br(this,"field"),Br(this,"value"),Br(this,"line"),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function es(t){}function xd(t){const{onEvent:e=es,onError:r=es,onRetry:s=es,onComment:a}=t;let i="",o=!0,c,u="",l="";function d(N){const U=o?N.replace(/^\xEF\xBB\xBF/,""):N,[V,$]=Nd(`${i}${U}`);for(const X of V)y(X);i=$,o=!1}function y(N){if(N===""){I();return}if(N.startsWith(":")){a&&a(N.slice(N.startsWith(": ")?2:1));return}const U=N.indexOf(":");if(U!==-1){const V=N.slice(0,U),$=N[U+1]===" "?2:1,X=N.slice(U+$);E(V,X,N);return}E(N,"",N)}function E(N,U,V){switch(N){case"event":l=U;break;case"data":u=`${u}${U}
`;break;case"id":c=U.includes("\0")?void 0:U;break;case"retry":/^\d+$/.test(U)?s(parseInt(U,10)):r(new ci(`Invalid \`retry\` value: "${U}"`,{type:"invalid-retry",value:U,line:V}));break;default:r(new ci(`Unknown field "${N.length>20?`${N.slice(0,20)}`:N}"`,{type:"unknown-field",field:N,value:U,line:V}));break}}function I(){u.length>0&&e({id:c,event:l||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),c=void 0,u="",l=""}function M(N={}){i&&N.consume&&y(i),c=void 0,u="",l="",i=""}return{feed:d,reset:M}}function Nd(t){const e=[];let r="";const s=t.length;for(let a=0;a<s;a++){const i=t[a];i==="\r"&&t[a+1]===`
`?(e.push(r),r="",a++):i==="\r"||i===`
`?(e.push(r),r=""):r+=i}return[e,r]}class Pd extends TransformStream{constructor({onError:e,onRetry:r,onComment:s}={}){let a;super({start(i){a=xd({onEvent:o=>{i.enqueue(o)},onError(o){e==="terminate"?i.error(o):typeof e=="function"&&e(o)},onRetry:r,onComment:s})},transform(i){a.feed(i)}})}}function ts(t,e){const r={provider:{async onShape(s){return Id(ru,t,s,e)}},streamFactory:new Md(rr("TRIGGER_STREAM_URL",rr("TRIGGER_API_URL"))??"https://api.trigger.dev",{headers:e==null?void 0:e.headers,signal:e==null?void 0:e.signal}),...e};return new jd(r)}class Cd{constructor(e,r){_(this,"url");_(this,"options");this.url=e,this.options=r}async subscribe(){return fetch(this.url,{headers:{Accept:"text/event-stream",...this.options.headers},signal:this.options.signal}).then(e=>{if(!e.ok)throw G.generate(e.status,{},"Could not subscribe to stream",Object.fromEntries(e.headers));if(!e.body)throw new Error("No response body");return e.body.pipeThrough(new TextDecoderStream).pipeThrough(new Pd).pipeThrough(new TransformStream({transform(r,s){s.enqueue(Ud(r.data))}}))})}}class Md{constructor(e,r){_(this,"baseUrl");_(this,"options");this.baseUrl=e,this.options=r}createSubscription(e,r,s){if(!e||!r)throw new Error("runId and streamKey are required");const a=`${s??this.baseUrl}/realtime/v1/streams/${e}/${r}`;return new Cd(a,this.options)}}class jd{constructor(e){_(this,"options");_(this,"abortController");_(this,"unsubscribeShape");_(this,"stream");_(this,"packetCache",new Map);_(this,"_closeOnComplete");_(this,"_isRunComplete",!1);this.options=e,this.abortController=new AbortController,this._closeOnComplete=typeof e.closeOnComplete>"u"?!0:e.closeOnComplete;const r=new ReadableStream({start:async s=>{this.unsubscribeShape=await this.options.provider.onShape(async a=>{s.enqueue(a),this._isRunComplete=!!a.completedAt,this._closeOnComplete&&this._isRunComplete&&!this.abortController.signal.aborted&&(s.close(),this.abortController.abort())})},cancel:()=>{this.unsubscribe()}});this.stream=oi(r,{transform:async(s,a)=>{const i=await this.transformRunShape(s);a.enqueue(i)}})}unsubscribe(){var e;this.abortController.signal.aborted||this.abortController.abort(),(e=this.unsubscribeShape)==null||e.call(this)}[Symbol.asyncIterator](){return this.stream[Symbol.asyncIterator]()}getReader(){return this.stream.getReader()}withStreams(){const e=new Set;return oi(this.stream,{transform:async(r,s)=>{var a;if(s.enqueue({type:"run",run:r}),r.metadata&&"$$streams"in r.metadata&&Array.isArray(r.metadata.$$streams))for(const i of r.metadata.$$streams)typeof i=="string"&&(e.has(i)||(e.add(i),(await this.options.streamFactory.createSubscription(r.id,i,(a=this.options.client)==null?void 0:a.baseUrl).subscribe()).pipeThrough(new TransformStream({transform(u,l){l.enqueue({type:i,chunk:u,run:r})}})).pipeTo(new WritableStream({write(u){s.enqueue(u)}})).catch(u=>{console.error(`Error in stream ${i}:`,u)})))}})}async transformRunShape(e){const r=e.payloadType?{data:e.payload??void 0,dataType:e.payloadType}:void 0,s=e.outputType?{data:e.output??void 0,dataType:e.outputType}:void 0,[a,i]=await Promise.all([{packet:r,key:"payload"},{packet:s,key:"output"}].map(async({packet:c,key:u})=>{if(!c)return;const l=this.packetCache.get(`${e.friendlyId}/${u}`);if(typeof l<"u")return l;const d=await Sd(c,this.options.client);return this.packetCache.set(`${e.friendlyId}/${u}`,d),d})),o=e.metadata&&e.metadataType?await Qn({data:e.metadata,dataType:e.metadataType}):void 0;return{id:e.friendlyId,payload:a,output:i,createdAt:e.createdAt,updatedAt:e.updatedAt,taskIdentifier:e.taskIdentifier,number:e.number,status:Dd(e.status),durationMs:e.usageDurationMs,costInCents:e.costInCents,baseCostInCents:e.baseCostInCents,tags:e.runTags??[],idempotencyKey:e.idempotencyKey??void 0,expiredAt:e.expiredAt??void 0,finishedAt:e.completedAt??void 0,startedAt:e.startedAt??void 0,delayedUntil:e.delayUntil??void 0,queuedAt:e.queuedAt??void 0,error:e.error?Ed(e.error):void 0,isTest:e.isTest,metadata:o}}}function Dd(t){switch(t){case"DELAYED":return"DELAYED";case"WAITING_FOR_DEPLOY":return"WAITING_FOR_DEPLOY";case"PENDING":return"QUEUED";case"PAUSED":case"WAITING_TO_RESUME":return"FROZEN";case"RETRYING_AFTER_FAILURE":return"REATTEMPTING";case"EXECUTING":return"EXECUTING";case"CANCELED":return"CANCELED";case"COMPLETED_SUCCESSFULLY":return"COMPLETED";case"SYSTEM_FAILURE":return"SYSTEM_FAILURE";case"INTERRUPTED":return"INTERRUPTED";case"CRASHED":return"CRASHED";case"COMPLETED_WITH_ERRORS":return"FAILED";case"EXPIRED":return"EXPIRED";default:throw new Error(`Unknown status: ${t}`)}}function Ud(t){try{return JSON.parse(t)}catch{return t}}const $d={retry:{maxAttempts:5,minTimeoutInMs:1e3,maxTimeoutInMs:3e4,factor:1.6,randomize:!1}};class ui{constructor(e,r,s={}){q(this,O);_(this,"baseUrl");_(this,"accessToken");_(this,"defaultRequestOptions");this.accessToken=r,this.baseUrl=e.replace(/\/$/,""),this.defaultRequestOptions=C($d,s)}get fetchClient(){const e=m(this,O,P).call(this,!1);return(s,a)=>{const i={...a,headers:{...a==null?void 0:a.headers,...e}};return fetch(s,i)}}async getRunResult(e,r){try{return await j(re,`${this.baseUrl}/api/v1/runs/${e}/result`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}catch(s){if(s instanceof G&&s.status===404)return;throw s}}async getBatchResults(e,r){return await j(Nc,`${this.baseUrl}/api/v1/batches/${e}/results`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}triggerTask(e,r,s,a){const i=encodeURIComponent(e);return j(Wc,`${this.baseUrl}/api/v1/tasks/${i}/trigger`,{method:"POST",headers:m(this,O,P).call(this,(s==null?void 0:s.spanParentAsLink)??!1),body:JSON.stringify(r)},C(this.defaultRequestOptions,a)).withResponse().then(async({response:o,data:c})=>{var E;const u=o.headers.get("x-trigger-jwt");if(typeof u=="string")return{...c,publicAccessToken:u};const l=o.headers.get("x-trigger-jwt-claims"),d=l?JSON.parse(l):void 0,y=await na({secretKey:this.accessToken,payload:{...d,scopes:[`read:runs:${c.id}`]},expirationTime:((E=a==null?void 0:a.publicAccessToken)==null?void 0:E.expirationTime)??"1h"});return{...c,publicAccessToken:y}})}batchTriggerV2(e,r,s){return j(Gc,`${this.baseUrl}/api/v1/tasks/batch`,{method:"POST",headers:m(this,O,P).call(this,(r==null?void 0:r.spanParentAsLink)??!1,{"idempotency-key":r==null?void 0:r.idempotencyKey,"idempotency-key-ttl":r==null?void 0:r.idempotencyKeyTTL}),body:JSON.stringify(e)},C(this.defaultRequestOptions,s)).withResponse().then(async({response:a,data:i})=>{var l;const o=a.headers.get("x-trigger-jwt-claims"),c=o?JSON.parse(o):void 0,u=await na({secretKey:this.accessToken,payload:{...c,scopes:[`read:batch:${i.id}`]},expirationTime:((l=s==null?void 0:s.publicAccessToken)==null?void 0:l.expirationTime)??"1h"});return{...i,publicAccessToken:u}})}createUploadPayloadUrl(e,r){return j(wa,`${this.baseUrl}/api/v1/packets/${e}`,{method:"PUT",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}getPayloadUrl(e,r){return j(wa,`${this.baseUrl}/api/v1/packets/${e}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}retrieveRun(e,r){return j(Oa,`${this.baseUrl}/api/v3/runs/${e}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}listRuns(e,r){const s=li(e);return zn(Nn,`${this.baseUrl}/api/v1/runs`,{query:s,limit:e==null?void 0:e.limit,after:e==null?void 0:e.after,before:e==null?void 0:e.before},{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}listProjectRuns(e,r,s){const a=li(r);return r!=null&&r.env&&a.append("filter[env]",Array.isArray(r.env)?r.env.join(","):r.env),zn(Nn,`${this.baseUrl}/api/v1/projects/${e}/runs`,{query:a,limit:r==null?void 0:r.limit,after:r==null?void 0:r.after,before:r==null?void 0:r.before},{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,s))}replayRun(e,r){return j(Fc,`${this.baseUrl}/api/v1/runs/${e}/replay`,{method:"POST",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}cancelRun(e,r){return j(Hc,`${this.baseUrl}/api/v2/runs/${e}/cancel`,{method:"POST",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}rescheduleRun(e,r,s){return j(Oa,`${this.baseUrl}/api/v1/runs/${e}/reschedule`,{method:"POST",headers:m(this,O,P).call(this,!1),body:JSON.stringify(r)},C(this.defaultRequestOptions,s))}addTags(e,r,s){return j(n.object({message:n.string()}),`${this.baseUrl}/api/v1/runs/${e}/tags`,{method:"POST",headers:m(this,O,P).call(this,!1),body:JSON.stringify(r)},C(this.defaultRequestOptions,s))}createSchedule(e,r){return j(Le,`${this.baseUrl}/api/v1/schedules`,{method:"POST",headers:m(this,O,P).call(this,!1),body:JSON.stringify(e)},C(this.defaultRequestOptions,r))}listSchedules(e,r){const s=new URLSearchParams;return e!=null&&e.page&&s.append("page",e.page.toString()),e!=null&&e.perPage&&s.append("perPage",e.perPage.toString()),ei(Le,`${this.baseUrl}/api/v1/schedules`,{page:e==null?void 0:e.page,limit:e==null?void 0:e.perPage},{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}retrieveSchedule(e,r){return j(Le,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}updateSchedule(e,r,s){return j(Le,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"PUT",headers:m(this,O,P).call(this,!1),body:JSON.stringify(r)},C(this.defaultRequestOptions,s))}deactivateSchedule(e,r){return j(Le,`${this.baseUrl}/api/v1/schedules/${e}/deactivate`,{method:"POST",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}activateSchedule(e,r){return j(Le,`${this.baseUrl}/api/v1/schedules/${e}/activate`,{method:"POST",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}deleteSchedule(e,r){return j(Zc,`${this.baseUrl}/api/v1/schedules/${e}`,{method:"DELETE",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}listEnvVars(e,r,s){return j(eu,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,s))}importEnvVars(e,r,s,a){return j(Dr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/import`,{method:"POST",headers:m(this,O,P).call(this,!1),body:JSON.stringify(s)},C(this.defaultRequestOptions,a))}retrieveEnvVar(e,r,s,a){return j(qc,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,a))}createEnvVar(e,r,s,a){return j(Dr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}`,{method:"POST",headers:m(this,O,P).call(this,!1),body:JSON.stringify(s)},C(this.defaultRequestOptions,a))}updateEnvVar(e,r,s,a,i){return j(Dr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"PUT",headers:m(this,O,P).call(this,!1),body:JSON.stringify(a)},C(this.defaultRequestOptions,i))}deleteEnvVar(e,r,s,a){return j(Dr,`${this.baseUrl}/api/v1/projects/${e}/envvars/${r}/${s}`,{method:"DELETE",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,a))}updateRunMetadata(e,r,s){return j(tu,`${this.baseUrl}/api/v1/runs/${e}/metadata`,{method:"PUT",headers:m(this,O,P).call(this,!1),body:JSON.stringify(r)},C(this.defaultRequestOptions,s))}subscribeToRun(e,r){return ts(`${this.baseUrl}/realtime/v1/runs/${e}`,{closeOnComplete:!0,headers:m(this,O,bn).call(this),client:this,signal:r==null?void 0:r.signal})}subscribeToRunsWithTag(e,r){const s=Ld({tags:e});return ts(`${this.baseUrl}/realtime/v1/runs${s?`?${s}`:""}`,{closeOnComplete:!1,headers:m(this,O,bn).call(this),client:this,signal:r==null?void 0:r.signal})}subscribeToBatch(e,r){return ts(`${this.baseUrl}/realtime/v1/batches/${e}`,{closeOnComplete:!1,headers:m(this,O,bn).call(this),client:this,signal:r==null?void 0:r.signal})}async generateJWTClaims(e){return j(n.record(n.any()),`${this.baseUrl}/api/v1/auth/jwt/claims`,{method:"POST",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,e))}retrieveBatch(e,r){return j(su,`${this.baseUrl}/api/v1/batches/${e}`,{method:"GET",headers:m(this,O,P).call(this,!1)},C(this.defaultRequestOptions,r))}}O=new WeakSet,P=function(e,r){const s={"Content-Type":"application/json",Authorization:`Bearer ${this.accessToken}`,"trigger-version":ra,...Object.entries(r??{}).reduce((a,[i,o])=>(o!==void 0&&(a[i]=o),a),{})};return W.isInsideTask&&(s["x-trigger-worker"]="true",e&&(s["x-trigger-span-parent-as-link"]="1")),typeof window<"u"&&typeof window.document<"u"&&(s["x-trigger-client"]="browser"),s},bn=function(){return{Authorization:`Bearer ${this.accessToken}`,"trigger-version":ra}};function Ld(t){const e=new URLSearchParams;return t.tasks&&e.append("tasks",Array.isArray(t.tasks)?t.tasks.join(","):t.tasks),t.tags&&e.append("tags",Array.isArray(t.tags)?t.tags.join(","):t.tags),e}function li(t){const e=new URLSearchParams;return t&&(t.status&&e.append("filter[status]",Array.isArray(t.status)?t.status.join(","):t.status),t.taskIdentifier&&e.append("filter[taskIdentifier]",Array.isArray(t.taskIdentifier)?t.taskIdentifier.join(","):t.taskIdentifier),t.version&&e.append("filter[version]",Array.isArray(t.version)?t.version.join(","):t.version),t.bulkAction&&e.append("filter[bulkAction]",t.bulkAction),t.tag&&e.append("filter[tag]",Array.isArray(t.tag)?t.tag.join(","):t.tag),t.schedule&&e.append("filter[schedule]",t.schedule),typeof t.isTest=="boolean"&&e.append("filter[isTest]",String(t.isTest)),t.from&&e.append("filter[createdAt][from]",t.from instanceof Date?t.from.getTime().toString():t.from.toString()),t.to&&e.append("filter[createdAt][to]",t.to instanceof Date?t.to.getTime().toString():t.to.toString()),t.period&&e.append("filter[createdAt][period]",t.period),t.batch&&e.append("filter[batch]",t.batch)),e}function C(t,e){return e?{...t,...e,retry:{...t.retry,...e.retry}}:t}var rs={};/*!
 * Copyright 2019 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Object.defineProperty(rs,"__esModule",{value:!0});var di=rs.PreciseDate=void 0;const Kd=/\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d{4,9}Z/,fi="BigInt only available in Node >= v10.7. Consider using getFullTimeString instead.";var ut;(function(t){t[t.NEGATIVE=-1]="NEGATIVE",t[t.POSITIVE=1]="POSITIVE",t[t.ZERO=0]="ZERO"})(ut||(ut={}));class Be extends Date{constructor(e){if(super(),this._micros=0,this._nanos=0,e&&typeof e!="number"&&!(e instanceof Date)){this.setFullTime(Be.parseFull(e));return}const r=Array.from(arguments),s=r.slice(0,7),a=new Date(...s),i=r.length===9?r.pop():0,o=r.length===8?r.pop():0;this.setTime(a.getTime()),this.setMicroseconds(o),this.setNanoseconds(i)}getFullTime(){if(typeof BigInt!="function")throw new Error(fi);return BigInt(this.getFullTimeString())}getFullTimeString(){const e=this._getSeconds();let r=this._getNanos();return r&&Math.sign(e)===ut.NEGATIVE&&(r=1e9-r),`${e}${ns(r,9)}`}getMicroseconds(){return this._micros}getNanoseconds(){return this._nanos}setMicroseconds(e){const r=Math.abs(e);let s=this.getUTCMilliseconds();return r>=1e3&&(s+=Math.floor(r/1e3)*Math.sign(e),e%=1e3),Math.sign(e)===ut.NEGATIVE&&(s-=1,e+=1e3),this._micros=e,this.setUTCMilliseconds(s),this.getFullTimeString()}setNanoseconds(e){const r=Math.abs(e);let s=this._micros;return r>=1e3&&(s+=Math.floor(r/1e3)*Math.sign(e),e%=1e3),Math.sign(e)===ut.NEGATIVE&&(s-=1,e+=1e3),this._nanos=e,this.setMicroseconds(s)}setFullTime(e){typeof e!="string"&&(e=e.toString());const r=Math.sign(Number(e));e=e.replace(/^-/,"");const s=Number(e.substr(0,e.length-9))*r,a=Number(e.substr(-9))*r;return this.setTime(s*1e3),this.setNanoseconds(a)}setTime(e){return this._micros=0,this._nanos=0,super.setTime(e)}toISOString(){const e=ns(this._micros,3),r=ns(this._nanos,3);return super.toISOString().replace(/z$/i,`${e}${r}Z`)}toStruct(){let e=this._getSeconds();const r=this._getNanos();return Math.sign(e)===ut.NEGATIVE&&r&&(e-=1),{seconds:e,nanos:r}}toTuple(){const{seconds:e,nanos:r}=this.toStruct();return[e,r]}_getSeconds(){const e=this.getTime(),r=Math.sign(e);return Math.floor(Math.abs(e)/1e3)*r}_getNanos(){const e=this.getUTCMilliseconds()*1e6,r=this._micros*1e3;return this._nanos+e+r}static parseFull(e){const r=new Be;if(Array.isArray(e)){const[s,a]=e;e={seconds:s,nanos:a}}if(Gd(e))r.setFullTime(e);else if(Bd(e)){const{seconds:s,nanos:a}=Vd(e);r.setTime(s*1e3),r.setNanoseconds(a)}else Fd(e)?r.setFullTime(Wd(e)):r.setTime(new Date(e).getTime());return r.getFullTimeString()}static fullUTC(...e){if(typeof BigInt!="function")throw new Error(fi);return BigInt(Be.fullUTCString(...e))}static fullUTCString(...e){const r=Date.UTC(...e.slice(0,7)),s=new Be(r);return e.length===9&&s.setNanoseconds(e.pop()),e.length===8&&s.setMicroseconds(e.pop()),s.getFullTimeString()}}di=rs.PreciseDate=Be;function Wd(t){let e="0";t=t.replace(/\.(\d+)/,(a,i)=>(e=i,".000"));const r=Number(Hd(e,9));return new Be(t).setNanoseconds(r)}function Vd({seconds:t=0,nanos:e=0}){return typeof t.toNumber=="function"&&(t=t.toNumber()),t=Number(t),e=Number(e),{seconds:t,nanos:e}}function Gd(t){return typeof t=="bigint"||typeof t=="string"&&/^\d+$/.test(t)}function Bd(t){return typeof t=="object"&&typeof t.seconds<"u"||typeof t.nanos=="number"}function Fd(t){return typeof t=="string"&&Kd.test(t)}function ns(t,e){return`${hi(t,e)}${t}`}function Hd(t,e){const r=hi(t,e);return`${t}${r}`}function hi(t,e){const r=Math.max(e-t.toString().length,0);return"0".repeat(r)}class Zd{preciseNow(){const r=new di().toStruct();return[r.seconds,r.nanos]}reset(){}}const pi="clock",zd=new Zd,dn=class dn{constructor(){q(this,yr)}static getInstance(){return this._instance||(this._instance=new dn),this._instance}setGlobalClock(e){return oe(pi,e)}preciseNow(){return m(this,yr,Ws).call(this).preciseNow()}reset(){m(this,yr,Ws).call(this).reset()}};yr=new WeakSet,Ws=function(){return Re(pi)??zd},_(dn,"_instance");let ss=dn;const gi=ss.getInstance();var Jd=function(){function t(){}return t.prototype.emit=function(e){},t}(),Yd=function(){function t(){}return t.prototype.getLogger=function(e,r,s){return new Jd},t}(),mi=new Yd,Xd=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},Fr=Symbol.for("io.opentelemetry.js.api.logs"),ar=Xd;function qd(t,e,r){return function(s){return s===t?e:r}}var yi=1,Qd=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new t),this._instance},t.prototype.setGlobalLoggerProvider=function(e){return ar[Fr]?this.getLoggerProvider():(ar[Fr]=qd(yi,e,mi),e)},t.prototype.getLoggerProvider=function(){var e,r;return(r=(e=ar[Fr])===null||e===void 0?void 0:e.call(ar,yi))!==null&&r!==void 0?r:mi},t.prototype.getLogger=function(e,r,s){return this.getLoggerProvider().getLogger(e,r,s)},t.prototype.disable=function(){delete ar[Fr]},t}(),ef=Qd.getInstance();class tf{debug(){}log(){}info(){}warn(){}error(){}trace(e,r){return r({})}}const as="logger",rf=new tf,fn=class fn{constructor(){q(this,ye)}static getInstance(){return this._instance||(this._instance=new fn),this._instance}disable(){Ke(as)}setGlobalTaskLogger(e){return oe(as,e)}debug(e,r){m(this,ye,rt).call(this).debug(e,r)}log(e,r){m(this,ye,rt).call(this).log(e,r)}info(e,r){m(this,ye,rt).call(this).info(e,r)}warn(e,r){m(this,ye,rt).call(this).warn(e,r)}error(e,r){m(this,ye,rt).call(this).error(e,r)}trace(e,r){return m(this,ye,rt).call(this).trace(e,r)}};ye=new WeakSet,rt=function(){return Re(as)??rf},_(fn,"_instance");let is=fn;const we=is.getInstance();class nf{disable(){}waitForDuration(e){return Promise.resolve()}waitUntil(e){return Promise.resolve()}waitForTask(e){return Promise.resolve({ok:!1,id:e.id,error:{type:"INTERNAL_ERROR",code:oa.CONFIGURED_INCORRECTLY}})}waitForBatch(e){return Promise.resolve({id:e.id,items:[]})}}class sf{disable(){}start(){return{sample:()=>({cpuTime:0,wallTime:0})}}stop(e){return e.sample()}pauseAsync(e){return e()}sample(){}}const os="usage",af=new sf,hn=class hn{constructor(){q(this,Pe)}static getInstance(){return this._instance||(this._instance=new hn),this._instance}setGlobalUsageManager(e){return oe(os,e)}disable(){m(this,Pe,St).call(this).disable(),Ke(os)}start(){return m(this,Pe,St).call(this).start()}stop(e){return m(this,Pe,St).call(this).stop(e)}pauseAsync(e){return m(this,Pe,St).call(this).pauseAsync(e)}sample(){return m(this,Pe,St).call(this).sample()}};Pe=new WeakSet,St=function(){return Re(os)??af},_(hn,"_instance");let cs=hn;const lt=cs.getInstance(),us="runtime",of=new nf,pn=class pn{constructor(){q(this,Ce)}static getInstance(){return this._instance||(this._instance=new pn),this._instance}waitForDuration(e){return lt.pauseAsync(()=>m(this,Ce,At).call(this).waitForDuration(e))}waitUntil(e){return lt.pauseAsync(()=>m(this,Ce,At).call(this).waitUntil(e))}waitForTask(e){return lt.pauseAsync(()=>m(this,Ce,At).call(this).waitForTask(e))}waitForBatch(e){return lt.pauseAsync(()=>m(this,Ce,At).call(this).waitForBatch(e))}setGlobalRuntimeManager(e){return oe(us,e)}disable(){m(this,Ce,At).call(this).disable(),Ke(us)}};Ce=new WeakSet,At=function(){return Re(us)??of},_(pn,"_instance");let ls=pn;const Hr=ls.getInstance(),ds="timeout";class cf{abortAfterTimeout(e){return new AbortController().signal}}const uf=new cf,gn=class gn{constructor(){q(this,_r)}static getInstance(){return this._instance||(this._instance=new gn),this._instance}get signal(){return m(this,_r,Vs).call(this).signal}abortAfterTimeout(e){return m(this,_r,Vs).call(this).abortAfterTimeout(e)}setGlobalManager(e){return oe(ds,e)}disable(){Ke(ds)}};_r=new WeakSet,Vs=function(){return Re(ds)??uf},_(gn,"_instance");let fs=gn;const lf=fs.getInstance();class df{registerTaskMetadata(e){}registerTaskFileMetadata(e,r){}updateTaskMetadata(e,r){}listTaskManifests(){return[]}getTaskManifest(e){}getTask(e){}taskExists(e){return!1}disable(){}}const hs="task-catalog",ff=new df,mn=class mn{constructor(){q(this,fe)}static getInstance(){return this._instance||(this._instance=new mn),this._instance}setGlobalTaskCatalog(e){return oe(hs,e)}disable(){Ke(hs)}registerTaskMetadata(e){m(this,fe,Me).call(this).registerTaskMetadata(e)}updateTaskMetadata(e,r){m(this,fe,Me).call(this).updateTaskMetadata(e,r)}registerTaskFileMetadata(e,r){m(this,fe,Me).call(this).registerTaskFileMetadata(e,r)}listTaskManifests(){return m(this,fe,Me).call(this).listTaskManifests()}getTaskManifest(e){return m(this,fe,Me).call(this).getTaskManifest(e)}getTask(e){return m(this,fe,Me).call(this).getTask(e)}taskExists(e){return m(this,fe,Me).call(this).taskExists(e)}};fe=new WeakSet,Me=function(){return Re(hs)??ff},_(mn,"_instance");let ps=mn;const ir=ps.getInstance();class hf extends Error{constructor(r,s,a){var e=(...Jp)=>(super(...Jp),_(this,"taskId"),_(this,"runId"),_(this,"cause"),this);a instanceof Error?(e(`Error in ${r}: ${a.message}`),this.cause=a,this.name="SubtaskUnwrapError"):(e(`Error in ${r}`),this.name="SubtaskUnwrapError",this.cause=a),this.taskId=r,this.runId=s}}class pf extends Promise{constructor(r,s){super(r);_(this,"taskId");this.taskId=s}unwrap(){return this.then(r=>{if(r.ok)return r.output;throw new hf(this.taskId,r.id,r.error)})}}function gf(t){return typeof t=="string"&&t.length===64}async function gs(t){if(t)return gf(t)?t:await mf(t,{scope:"global"})}async function mf(t,e){return await _f([...Array.isArray(t)?t:[t]].concat(yf((e==null?void 0:e.scope)??"run")))}function yf(t){switch(t){case"run":{if(W!=null&&W.ctx)return[W.ctx.run.id];break}case"attempt":{if(W!=null&&W.ctx)return[W.ctx.attempt.id];break}}return[]}async function _f(t){const e=await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t.join("-")));return Array.from(new Uint8Array(e)).map(r=>r.toString(16).padStart(2,"0")).join("")}function bf(t,e){e instanceof Error?t.recordException(vf(e)):typeof e=="string"?t.recordException(e.replace(/\0/g,"")):t.recordException(JSON.stringify(e).replace(/\0/g,"")),t.setStatus({code:Wr.ERROR})}function vf(t){var r;const e=new Error(t.message.replace(/\0/g,""));return e.name=t.name.replace(/\0/g,""),e.stack=(r=t.stack)==null?void 0:r.replace(/\0/g,""),e}class Ef{constructor(e){_(this,"_config");_(this,"_tracer");_(this,"_logger");this._config=e}get tracer(){if(!this._tracer){if("tracer"in this._config)return this._config.tracer;this._tracer=id.getTracer(this._config.name,this._config.version)}return this._tracer}get logger(){if(!this._logger){if("logger"in this._config)return this._config.logger;this._logger=ef.getLogger(this._config.name,this._config.version)}return this._logger}extractContext(e){return qa.extract(Vr.active(),e??{})}startActiveSpan(e,r,s,a,i){const o=a??Vr.active(),c=(s==null?void 0:s.attributes)??{};let u=!1;return this.tracer.startActiveSpan(e,{...s,attributes:c,startTime:gi.preciseNow()},o,async l=>{i==null||i.addEventListener("abort",()=>{u||(u=!0,bf(l,i.reason),l.end())}),W.ctx&&this.tracer.startSpan(e,{...s,attributes:{...c,[A.SPAN_PARTIAL]:!0,[A.SPAN_ID]:l.spanContext().spanId}},o).end();const d=lt.start();try{return await r(l)}catch(y){throw u||((typeof y=="string"||y instanceof Error)&&l.recordException(y),l.setStatus({code:Wr.ERROR})),y}finally{if(!u){if(u=!0,W.ctx){const y=lt.stop(d),E=W.ctx.machine;l.setAttributes({[A.USAGE_DURATION_MS]:y.cpuTime,[A.USAGE_COST_IN_CENTS]:E!=null&&E.centsPerMs?y.cpuTime*E.centsPerMs:0})}l.end(gi.preciseNow())}}})}startSpan(e,r,s){const a=s??Vr.active(),i=(r==null?void 0:r.attributes)??{},o=this.tracer.startSpan(e,r,s);return this.tracer.startSpan(e,{...r,attributes:{...i,[A.SPAN_PARTIAL]:!0,[A.SPAN_ID]:o.spanContext().spanId}},a).end(),o}}const Tf="3.3.5",Se=new Ef({name:"@trigger.dev/sdk",version:Tf});function Hp(t){return t}function Rf(t){var s;const e=t.queue?{name:((s=t.queue)==null?void 0:s.name)??`task/${t.id}`,...t.queue}:void 0,r={id:t.id,description:t.description,trigger:async(a,i)=>{const o=ir.getTaskManifest(t.id);return await wf(o&&o.exportName?`${o.exportName}.trigger()`:"trigger()",t.id,a,void 0,{queue:e,...i})},batchTrigger:async(a,i)=>{const o=ir.getTaskManifest(t.id);return await Sf(o&&o.exportName?`${o.exportName}.batchTrigger()`:"batchTrigger()",t.id,a,i,void 0,void 0,e)},triggerAndWait:(a,i)=>{const o=ir.getTaskManifest(t.id);return new pf((c,u)=>{Af(o&&o.exportName?`${o.exportName}.triggerAndWait()`:"triggerAndWait()",t.id,a,void 0,{queue:e,...i}).then(l=>{c(l)}).catch(l=>{u(l)})},t.id)},batchTriggerAndWait:async a=>{const i=ir.getTaskManifest(t.id);return await If(i&&i.exportName?`${i.exportName}.batchTriggerAndWait()`:"batchTriggerAndWait()",t.id,a,void 0,void 0,e)}};return ir.registerTaskMetadata({id:t.id,description:t.description,queue:t.queue,retry:t.retry?{...Ka,...t.retry}:void 0,machine:t.machine,maxDuration:t.maxDuration,fns:{run:t.run,init:t.init,cleanup:t.cleanup,middleware:t.middleware,handleError:t.handleError,onSuccess:t.onSuccess,onFailure:t.onFailure,onStart:t.onStart}}),r[Symbol.for("trigger.dev/task")]=!0,r}async function wf(t,e,r,s,a,i){var d,y;const o=sr.clientOrThrow(),u=await Gr(r);return await o.triggerTask(e,{payload:u.data,options:{queue:a==null?void 0:a.queue,concurrencyKey:a==null?void 0:a.concurrencyKey,test:(d=W.ctx)==null?void 0:d.run.isTest,payloadType:u.dataType,idempotencyKey:await gs(a==null?void 0:a.idempotencyKey),idempotencyKeyTTL:a==null?void 0:a.idempotencyKeyTTL,delay:a==null?void 0:a.delay,ttl:a==null?void 0:a.ttl,tags:a==null?void 0:a.tags,maxAttempts:a==null?void 0:a.maxAttempts,parentAttempt:(y=W.ctx)==null?void 0:y.attempt.id,metadata:a==null?void 0:a.metadata,maxDuration:a==null?void 0:a.maxDuration}},{spanParentAsLink:!0},{name:t,tracer:Se,icon:"trigger",onResponseBody:(E,I)=>{E&&typeof E=="object"&&!Array.isArray(E)&&"id"in E&&typeof E.id=="string"&&I.setAttribute("runId",E.id)},...i})}async function Sf(t,e,r,s,a,i,o){const u=await sr.clientOrThrow().batchTriggerV2({items:await Promise.all(r.map(async d=>{var I,M,N,U,V,$,X,br,vr,Er,Tr,Rr;const y=d.payload,E=await Gr(y);return{task:e,payload:E.data,options:{queue:((I=d.options)==null?void 0:I.queue)??o,concurrencyKey:(M=d.options)==null?void 0:M.concurrencyKey,test:(N=W.ctx)==null?void 0:N.run.isTest,payloadType:E.dataType,idempotencyKey:await gs((U=d.options)==null?void 0:U.idempotencyKey),idempotencyKeyTTL:(V=d.options)==null?void 0:V.idempotencyKeyTTL,delay:($=d.options)==null?void 0:$.delay,ttl:(X=d.options)==null?void 0:X.ttl,tags:(br=d.options)==null?void 0:br.tags,maxAttempts:(vr=d.options)==null?void 0:vr.maxAttempts,parentAttempt:(Er=W.ctx)==null?void 0:Er.attempt.id,metadata:(Tr=d.options)==null?void 0:Tr.metadata,maxDuration:(Rr=d.options)==null?void 0:Rr.maxDuration}}}))},{spanParentAsLink:!0,idempotencyKey:await gs(s==null?void 0:s.idempotencyKey),idempotencyKeyTTL:s==null?void 0:s.idempotencyKeyTTL},{name:t,tracer:Se,icon:"trigger",onResponseBody(d,y){d&&typeof d=="object"&&!Array.isArray(d)&&("id"in d&&typeof d.id=="string"&&y.setAttribute("batchId",d.id),"runs"in d&&Array.isArray(d.runs)&&y.setAttribute("runCount",d.runs.length),"isCached"in d&&typeof d.isCached=="boolean"&&(d.isCached&&console.warn("Result is a cached response because the request was idempotent."),y.setAttribute("isCached",d.isCached)),"idempotencyKey"in d&&typeof d.idempotencyKey=="string"&&y.setAttribute("idempotencyKey",d.idempotencyKey))},...i});return{batchId:u.id,isCached:u.isCached,idempotencyKey:u.idempotencyKey,runs:u.runs,publicAccessToken:u.publicAccessToken}}async function Af(t,e,r,s,a,i){const o=W.ctx;if(!o)throw new Error("triggerAndWait can only be used from inside a task.run()");const c=sr.clientOrThrow(),l=await Gr(r);return await Se.startActiveSpan(t,async d=>{var I,M;const y=await c.triggerTask(e,{payload:l.data,options:{dependentAttempt:o.attempt.id,lockToVersion:(I=W.worker)==null?void 0:I.version,queue:a==null?void 0:a.queue,concurrencyKey:a==null?void 0:a.concurrencyKey,test:(M=W.ctx)==null?void 0:M.run.isTest,payloadType:l.dataType,delay:a==null?void 0:a.delay,ttl:a==null?void 0:a.ttl,tags:a==null?void 0:a.tags,maxAttempts:a==null?void 0:a.maxAttempts,metadata:a==null?void 0:a.metadata,maxDuration:a==null?void 0:a.maxDuration}},{},i);d.setAttribute("runId",y.id);const E=await Hr.waitForTask({id:y.id,ctx:o});return await ms(E,e)},{kind:Qt.PRODUCER,attributes:{[A.STYLE_ICON]:"trigger",...er({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function If(t,e,r,s,a,i){const o=W.ctx;if(!o)throw new Error("batchTriggerAndWait can only be used from inside a task.run()");const c=sr.clientOrThrow();return await Se.startActiveSpan(t,async u=>{const l=await c.batchTriggerV2({items:await Promise.all(r.map(async E=>{var N,U,V,$,X,br,vr,Er,Tr,Rr;const I=E.payload,M=await Gr(I);return{task:e,payload:M.data,options:{lockToVersion:(N=W.worker)==null?void 0:N.version,queue:((U=E.options)==null?void 0:U.queue)??i,concurrencyKey:(V=E.options)==null?void 0:V.concurrencyKey,test:($=W.ctx)==null?void 0:$.run.isTest,payloadType:M.dataType,delay:(X=E.options)==null?void 0:X.delay,ttl:(br=E.options)==null?void 0:br.ttl,tags:(vr=E.options)==null?void 0:vr.tags,maxAttempts:(Er=E.options)==null?void 0:Er.maxAttempts,metadata:(Tr=E.options)==null?void 0:Tr.metadata,maxDuration:(Rr=E.options)==null?void 0:Rr.maxDuration}}})),dependentAttempt:o.attempt.id},{},a);u.setAttribute("batchId",l.id),u.setAttribute("runCount",l.runs.length),u.setAttribute("isCached",l.isCached),l.isCached&&console.warn("Result is a cached response because the request was idempotent."),l.idempotencyKey&&u.setAttribute("idempotencyKey",l.idempotencyKey);const d=await Hr.waitForBatch({id:l.id,runs:l.runs.map(E=>E.id),ctx:o}),y=await kf(d.items,e);return{id:d.id,runs:y}},{kind:Qt.PRODUCER,attributes:{[A.STYLE_ICON]:"trigger",...er({items:[{text:e,variant:"normal"}],style:"codepath"})}})}async function kf(t,e){return t.some(s=>s.ok&&s.outputType==="application/store")?await Se.startActiveSpan("store.downloadPayloads",async s=>await Promise.all(t.map(async i=>await ms(i,e))),{kind:Qt.INTERNAL,[A.STYLE_ICON]:"cloud-download"}):await Promise.all(t.map(async a=>await ms(a,e)))}async function ms(t,e){if(t.ok){const r={data:t.output,dataType:t.outputType},s=await si(r,Se);return{ok:!0,id:t.id,taskIdentifier:t.taskIdentifier??e,output:await Qn(s)}}else return{ok:!1,id:t.id,taskIdentifier:t.taskIdentifier??e,error:vd(t.error)}}const _i=Rf,Of={for:async t=>Se.startActiveSpan("wait.for()",async e=>{const r=Nf(t);await Hr.waitForDuration(r)},{attributes:{[A.STYLE_ICON]:"wait",...er({items:[{text:xf(t),variant:"normal"}],style:"codepath"})}}),until:async t=>Se.startActiveSpan("wait.until()",async e=>{const r=Date.now();if(t.throwIfInThePast&&t.date<new Date)throw new Error("Date is in the past");const s=t.date.getTime()-r;await Hr.waitForDuration(s)},{attributes:{[A.STYLE_ICON]:"wait",...er({items:[{text:t.date.toISOString(),variant:"normal"}],style:"codepath"})}})};function xf(t){return"seconds"in t?t.seconds===1?"1 second":`${t.seconds} seconds`:"minutes"in t?t.minutes===1?"1 minute":`${t.minutes} minutes`:"hours"in t?t.hours===1?"1 hour":`${t.hours} hours`:"days"in t?t.days===1?"1 day":`${t.days} days`:"weeks"in t?t.weeks===1?"1 week":`${t.weeks} weeks`:"months"in t?t.months===1?"1 month":`${t.months} months`:"years"in t?t.years===1?"1 year":`${t.years} years`:"NaN"}function Nf(t){if("seconds"in t)return t.seconds*1e3;if("minutes"in t)return t.minutes*1e3*60;if("hours"in t)return t.hours*1e3*60*60;if("days"in t)return t.days*1e3*60*60*24;if("weeks"in t)return t.weeks*1e3*60*60*24*7;if("months"in t)return t.months*1e3*60*60*24*30;if("years"in t)return t.years*1e3*60*60*24*365;throw new Error("Invalid options")}const Pf=2147483647;lf.signal;const ys=process.env.TINYBIRD_TOKEN??void 0,Cf=_i({id:"copy_job",run:async t=>{if(!(ys??t.token))throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.pipeId)throw new Error("Pipe ID not found");try{let r=`https://api.tinybird.co/v0/pipes/${t.pipeId}/copy`;if(t.params){const u=new URLSearchParams;for(const[l,d]of Object.entries(t.params))u.append(l,d.toString());r+=`?${u.toString()}`}const s=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${ys}`}}).then(u=>u.json());if(!s||!("job"in s))throw we.error(s),new Error("Invalid response from Tinybird API");const a=s.job.job_id;we.log("Copy job started",{jobId:a});let i="";const o=30;let c=0;for(;c<o;){if(i=(await fetch(`https://api.tinybird.co/v0/jobs/${a}`,{headers:{Authorization:`Bearer ${ys}`}}).then(l=>l.json())).status,we.log("Job status check",{jobId:a,status:i,attempt:c+1}),i==="done")return we.log("Copy job completed successfully",{jobId:a}),{success:!0,jobId:a};if(i==="error"||i==="failed")throw new Error(`Copy job failed with status: ${i}`);await Of.for({seconds:5}),c++}throw new Error(`Job timed out after ${o} attempts`)}catch(r){throw we.error("Error in Tinybird copy job",{error:r}),r}}}),bi=process.env.TINYBIRD_TOKEN??void 0;var _s=(t=>(t.CSV="CSV",t.CSVWithNames="CSVWithNames",t.JSON="JSON",t.TSV="TSV",t.TSVWithNames="TSVWithNames",t.PrettyCompact="PrettyCompact",t.JSONEachRow="JSONEachRow",t.Parquet="Parquet",t))(_s||{});function vi(t){return Object.values(_s).includes(t)}function Mf(t){const e=t.trim().match(/FORMAT\s+(\w+)$/i);if(!e)return null;const r=e[1].toUpperCase();return vi(r)?r:null}const jf=_i({id:"tinybird-query",run:async t=>{var i;if(!(bi??t.token))throw new Error("Tinybird API token not found. Either set the TINYBIRD_TOKEN environment variable, or provide a token in the task payload.");if(!t.sql)throw new Error("SQL query is required");let r=t.sql;const s=Mf(r);if(t.format&&!vi(t.format.toUpperCase()))throw new Error(`Invalid format: ${t.format}. Valid formats are: ${Object.values(_s).join(", ")}`);const a=((i=t.format)==null?void 0:i.toUpperCase())??s??"JSON";s||(r+=` FORMAT ${a}`);try{const o=await fetch("https://api.tinybird.co/v0/sql",{method:"POST",headers:{Authorization:`Bearer ${bi}`,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({q:r,...t.params})}),c=await o.json();if(console.log(c),o.status!==200){let l={error:"error"};throw"error"in c&&(l=c,we.error("Tinybird query failed",{error:l.error,detail:l.detail})),new Error(`Tinybird query failed: ${l.error}`)}const u=c;return we.info("Query executed successfully",u),u}catch(o){throw we.error("Failed to execute Tinybird query",{error:o instanceof Error?o.message:"Unknown error",sql:t.sql}),o}}}),bs=crypto,Ei=t=>t instanceof CryptoKey,dt=new TextEncoder,vs=new TextDecoder;function Df(...t){const e=t.reduce((a,{length:i})=>a+i,0),r=new Uint8Array(e);let s=0;for(const a of t)r.set(a,s),s+=a.length;return r}const Uf=t=>{let e=t;typeof e=="string"&&(e=dt.encode(e));const r=32768,s=[];for(let a=0;a<e.length;a+=r)s.push(String.fromCharCode.apply(null,e.subarray(a,a+r)));return btoa(s.join(""))},Es=t=>Uf(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),$f=t=>{const e=atob(t),r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r},Ts=t=>{let e=t;e instanceof Uint8Array&&(e=vs.decode(e)),e=e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return $f(e)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class H extends Error{constructor(e,r){var s;super(e,r),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(s=Error.captureStackTrace)==null||s.call(Error,this,this.constructor)}}H.code="ERR_JOSE_GENERIC";class Lf extends H{constructor(e,r,s="unspecified",a="unspecified"){super(e,{cause:{claim:s,reason:a,payload:r}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=s,this.reason=a,this.payload=r}}Lf.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class Kf extends H{constructor(e,r,s="unspecified",a="unspecified"){super(e,{cause:{claim:s,reason:a,payload:r}}),this.code="ERR_JWT_EXPIRED",this.claim=s,this.reason=a,this.payload=r}}Kf.code="ERR_JWT_EXPIRED";class Wf extends H{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}Wf.code="ERR_JOSE_ALG_NOT_ALLOWED";class Fe extends H{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}Fe.code="ERR_JOSE_NOT_SUPPORTED";class Vf extends H{constructor(e="decryption operation failed",r){super(e,r),this.code="ERR_JWE_DECRYPTION_FAILED"}}Vf.code="ERR_JWE_DECRYPTION_FAILED";class Gf extends H{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}Gf.code="ERR_JWE_INVALID";class ft extends H{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}ft.code="ERR_JWS_INVALID";class Ti extends H{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}Ti.code="ERR_JWT_INVALID";class Bf extends H{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}Bf.code="ERR_JWK_INVALID";class Ff extends H{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}Ff.code="ERR_JWKS_INVALID";class Hf extends H{constructor(e="no applicable key found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_NO_MATCHING_KEY"}}Hf.code="ERR_JWKS_NO_MATCHING_KEY";class Zf extends H{constructor(e="multiple matching keys found in the JSON Web Key Set",r){super(e,r),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Zf.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class zf extends H{constructor(e="request timed out",r){super(e,r),this.code="ERR_JWKS_TIMEOUT"}}zf.code="ERR_JWKS_TIMEOUT";class Jf extends H{constructor(e="signature verification failed",r){super(e,r),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}Jf.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";function me(t,e="algorithm.name"){return new TypeError(`CryptoKey does not support this operation, its ${e} must be ${t}`)}function Zr(t,e){return t.name===e}function Rs(t){return parseInt(t.name.slice(4),10)}function Yf(t){switch(t){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw new Error("unreachable")}}function Xf(t,e){if(e.length&&!e.some(r=>t.usages.includes(r))){let r="CryptoKey does not support this operation, its usages must include ";if(e.length>2){const s=e.pop();r+=`one of ${e.join(", ")}, or ${s}.`}else e.length===2?r+=`one of ${e[0]} or ${e[1]}.`:r+=`${e[0]}.`;throw new TypeError(r)}}function qf(t,e,...r){switch(e){case"HS256":case"HS384":case"HS512":{if(!Zr(t.algorithm,"HMAC"))throw me("HMAC");const s=parseInt(e.slice(2),10);if(Rs(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!Zr(t.algorithm,"RSASSA-PKCS1-v1_5"))throw me("RSASSA-PKCS1-v1_5");const s=parseInt(e.slice(2),10);if(Rs(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!Zr(t.algorithm,"RSA-PSS"))throw me("RSA-PSS");const s=parseInt(e.slice(2),10);if(Rs(t.algorithm.hash)!==s)throw me(`SHA-${s}`,"algorithm.hash");break}case"EdDSA":{if(t.algorithm.name!=="Ed25519"&&t.algorithm.name!=="Ed448")throw me("Ed25519 or Ed448");break}case"ES256":case"ES384":case"ES512":{if(!Zr(t.algorithm,"ECDSA"))throw me("ECDSA");const s=Yf(e);if(t.algorithm.namedCurve!==s)throw me(s,"algorithm.namedCurve");break}default:throw new TypeError("CryptoKey does not support this operation")}Xf(t,r)}function Ri(t,e,...r){var s;if(r=r.filter(Boolean),r.length>2){const a=r.pop();t+=`one of type ${r.join(", ")}, or ${a}.`}else r.length===2?t+=`one of type ${r[0]} or ${r[1]}.`:t+=`of type ${r[0]}.`;return e==null?t+=` Received ${e}`:typeof e=="function"&&e.name?t+=` Received function ${e.name}`:typeof e=="object"&&e!=null&&(s=e.constructor)!=null&&s.name&&(t+=` Received an instance of ${e.constructor.name}`),t}const wi=(t,...e)=>Ri("Key must be ",t,...e);function Si(t,e,...r){return Ri(`Key for the ${t} algorithm must be `,e,...r)}const Ai=t=>Ei(t)?!0:(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",zr=["CryptoKey"],Qf=(...t)=>{const e=t.filter(Boolean);if(e.length===0||e.length===1)return!0;let r;for(const s of e){const a=Object.keys(s);if(!r||r.size===0){r=new Set(a);continue}for(const i of a){if(r.has(i))return!1;r.add(i)}}return!0};function eh(t){return typeof t=="object"&&t!==null}function Ii(t){if(!eh(t)||Object.prototype.toString.call(t)!=="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}const th=(t,e)=>{if(t.startsWith("RS")||t.startsWith("PS")){const{modulusLength:r}=e.algorithm;if(typeof r!="number"||r<2048)throw new TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)}};function or(t){return Ii(t)&&typeof t.kty=="string"}function rh(t){return t.kty!=="oct"&&typeof t.d=="string"}function nh(t){return t.kty!=="oct"&&typeof t.d>"u"}function sh(t){return or(t)&&t.kty==="oct"&&typeof t.k=="string"}function ah(t){let e,r;switch(t.kty){case"RSA":{switch(t.alg){case"PS256":case"PS384":case"PS512":e={name:"RSA-PSS",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":e={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${t.alg.slice(-3)}`},r=t.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":e={name:"RSA-OAEP",hash:`SHA-${parseInt(t.alg.slice(-3),10)||1}`},r=t.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new Fe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"EC":{switch(t.alg){case"ES256":e={name:"ECDSA",namedCurve:"P-256"},r=t.d?["sign"]:["verify"];break;case"ES384":e={name:"ECDSA",namedCurve:"P-384"},r=t.d?["sign"]:["verify"];break;case"ES512":e={name:"ECDSA",namedCurve:"P-521"},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:"ECDH",namedCurve:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new Fe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}case"OKP":{switch(t.alg){case"EdDSA":e={name:t.crv},r=t.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":e={name:t.crv},r=t.d?["deriveBits"]:[];break;default:throw new Fe('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break}default:throw new Fe('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:e,keyUsages:r}}const ih=async t=>{if(!t.alg)throw new TypeError('"alg" argument is required when "jwk.alg" is not present');const{algorithm:e,keyUsages:r}=ah(t),s=[e,t.ext??!1,t.key_ops??r],a={...t};return delete a.alg,delete a.use,bs.subtle.importKey("jwk",a,...s)},ki=t=>Ts(t);let ht,pt;const Oi=t=>(t==null?void 0:t[Symbol.toStringTag])==="KeyObject",Jr=async(t,e,r,s,a=!1)=>{let i=t.get(e);if(i!=null&&i[s])return i[s];const o=await ih({...r,alg:s});return a&&Object.freeze(e),i?i[s]=o:t.set(e,{[s]:o}),o},oh={normalizePublicKey:(t,e)=>{if(Oi(t)){let r=t.export({format:"jwk"});return delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k?ki(r.k):(pt||(pt=new WeakMap),Jr(pt,t,r,e))}return or(t)?t.k?Ts(t.k):(pt||(pt=new WeakMap),Jr(pt,t,t,e,!0)):t},normalizePrivateKey:(t,e)=>{if(Oi(t)){let r=t.export({format:"jwk"});return r.k?ki(r.k):(ht||(ht=new WeakMap),Jr(ht,t,r,e))}return or(t)?t.k?Ts(t.k):(ht||(ht=new WeakMap),Jr(ht,t,t,e,!0)):t}},gt=t=>t==null?void 0:t[Symbol.toStringTag],ws=(t,e,r)=>{var s,a;if(e.use!==void 0&&e.use!=="sig")throw new TypeError("Invalid key for this operation, when present its use must be sig");if(e.key_ops!==void 0&&((a=(s=e.key_ops).includes)==null?void 0:a.call(s,r))!==!0)throw new TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(e.alg!==void 0&&e.alg!==t)throw new TypeError(`Invalid key for this operation, when present its alg must be ${t}`);return!0},ch=(t,e,r,s)=>{if(!(e instanceof Uint8Array)){if(s&&or(e)){if(sh(e)&&ws(t,e,r))return;throw new TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Ai(e))throw new TypeError(Si(t,e,...zr,"Uint8Array",s?"JSON Web Key":null));if(e.type!=="secret")throw new TypeError(`${gt(e)} instances for symmetric algorithms must be of type "secret"`)}},uh=(t,e,r,s)=>{if(s&&or(e))switch(r){case"sign":if(rh(e)&&ws(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(nh(e)&&ws(t,e,r))return;throw new TypeError("JSON Web Key for this operation be a public JWK")}if(!Ai(e))throw new TypeError(Si(t,e,...zr,s?"JSON Web Key":null));if(e.type==="secret")throw new TypeError(`${gt(e)} instances for asymmetric algorithms must not be of type "secret"`);if(r==="sign"&&e.type==="public")throw new TypeError(`${gt(e)} instances for asymmetric algorithm signing must be of type "private"`);if(r==="decrypt"&&e.type==="public")throw new TypeError(`${gt(e)} instances for asymmetric algorithm decryption must be of type "private"`);if(e.algorithm&&r==="verify"&&e.type==="private")throw new TypeError(`${gt(e)} instances for asymmetric algorithm verifying must be of type "public"`);if(e.algorithm&&r==="encrypt"&&e.type==="private")throw new TypeError(`${gt(e)} instances for asymmetric algorithm encryption must be of type "public"`)};function xi(t,e,r,s){e.startsWith("HS")||e==="dir"||e.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(e)?ch(e,r,s,t):uh(e,r,s,t)}xi.bind(void 0,!1);const lh=xi.bind(void 0,!0);function dh(t,e,r,s,a){if(a.crit!==void 0&&(s==null?void 0:s.crit)===void 0)throw new t('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||s.crit===void 0)return new Set;if(!Array.isArray(s.crit)||s.crit.length===0||s.crit.some(o=>typeof o!="string"||o.length===0))throw new t('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');let i;r!==void 0?i=new Map([...Object.entries(r),...e.entries()]):i=e;for(const o of s.crit){if(!i.has(o))throw new Fe(`Extension Header Parameter "${o}" is not recognized`);if(a[o]===void 0)throw new t(`Extension Header Parameter "${o}" is missing`);if(i.get(o)&&s[o]===void 0)throw new t(`Extension Header Parameter "${o}" MUST be integrity protected`)}return new Set(s.crit)}function fh(t,e){const r=`SHA-${t.slice(-3)}`;switch(t){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:t.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:e.namedCurve};case"EdDSA":return{name:e.name};default:throw new Fe(`alg ${t} is not supported either by JOSE or your javascript runtime`)}}async function hh(t,e,r){if(e=await oh.normalizePrivateKey(e,t),Ei(e))return qf(e,t,r),e;if(e instanceof Uint8Array){if(!t.startsWith("HS"))throw new TypeError(wi(e,...zr));return bs.subtle.importKey("raw",e,{hash:`SHA-${t.slice(-3)}`,name:"HMAC"},!1,[r])}throw new TypeError(wi(e,...zr,"Uint8Array","JSON Web Key"))}const He=t=>Math.floor(t.getTime()/1e3),Ni=60,Pi=Ni*60,Ss=Pi*24,ph=Ss*7,gh=Ss*365.25,mh=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,As=t=>{const e=mh.exec(t);if(!e||e[4]&&e[1])throw new TypeError("Invalid time period format");const r=parseFloat(e[2]),s=e[3].toLowerCase();let a;switch(s){case"sec":case"secs":case"second":case"seconds":case"s":a=Math.round(r);break;case"minute":case"minutes":case"min":case"mins":case"m":a=Math.round(r*Ni);break;case"hour":case"hours":case"hr":case"hrs":case"h":a=Math.round(r*Pi);break;case"day":case"days":case"d":a=Math.round(r*Ss);break;case"week":case"weeks":case"w":a=Math.round(r*ph);break;default:a=Math.round(r*gh);break}return e[1]==="-"||e[4]==="ago"?-a:a},yh=async(t,e,r)=>{const s=await hh(t,e,"sign");th(t,s);const a=await bs.subtle.sign(fh(t,s.algorithm),s,r);return new Uint8Array(a)};class Ci{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw new TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw new TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,r){if(!this._protectedHeader&&!this._unprotectedHeader)throw new ft("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!Qf(this._protectedHeader,this._unprotectedHeader))throw new ft("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");const s={...this._protectedHeader,...this._unprotectedHeader},a=dh(ft,new Map([["b64",!0]]),r==null?void 0:r.crit,this._protectedHeader,s);let i=!0;if(a.has("b64")&&(i=this._protectedHeader.b64,typeof i!="boolean"))throw new ft('The "b64" (base64url-encode payload) Header Parameter must be a boolean');const{alg:o}=s;if(typeof o!="string"||!o)throw new ft('JWS "alg" (Algorithm) Header Parameter missing or invalid');lh(o,e,"sign");let c=this._payload;i&&(c=dt.encode(Es(c)));let u;this._protectedHeader?u=dt.encode(Es(JSON.stringify(this._protectedHeader))):u=dt.encode("");const l=Df(u,dt.encode("."),c),d=await yh(o,e,l),y={signature:Es(d),payload:""};return i&&(y.payload=vs.decode(c)),this._unprotectedHeader&&(y.header=this._unprotectedHeader),this._protectedHeader&&(y.protected=vs.decode(u)),y}}class Mi{constructor(e){this._flattened=new Ci(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,r){const s=await this._flattened.sign(e,r);if(s.payload===void 0)throw new TypeError("use the flattened module for creating JWS with b64: false");return`${s.protected}.${s.payload}.${s.signature}`}}function Ze(t,e){if(!Number.isFinite(e))throw new TypeError(`Invalid ${t} input`);return e}class _h{constructor(e={}){if(!Ii(e))throw new TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return typeof e=="number"?this._payload={...this._payload,nbf:Ze("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:Ze("setNotBefore",He(e))}:this._payload={...this._payload,nbf:He(new Date)+As(e)},this}setExpirationTime(e){return typeof e=="number"?this._payload={...this._payload,exp:Ze("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:Ze("setExpirationTime",He(e))}:this._payload={...this._payload,exp:He(new Date)+As(e)},this}setIssuedAt(e){return typeof e>"u"?this._payload={...this._payload,iat:He(new Date)}:e instanceof Date?this._payload={...this._payload,iat:Ze("setIssuedAt",He(e))}:typeof e=="string"?this._payload={...this._payload,iat:Ze("setIssuedAt",He(new Date)+As(e))}:this._payload={...this._payload,iat:Ze("setIssuedAt",e)},this}}class bh extends _h{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,r){var a;const s=new Mi(dt.encode(JSON.stringify(this._payload)));if(s.setProtectedHeader(this._protectedHeader),Array.isArray((a=this._protectedHeader)==null?void 0:a.crit)&&this._protectedHeader.crit.includes("b64")&&this._protectedHeader.b64===!1)throw new Ti("JWTs MUST NOT use unencoded payload");return s.sign(e,r)}}const vh=Object.freeze(Object.defineProperty({__proto__:null,CompactSign:Mi,FlattenedSign:Ci,SignJWT:bh},Symbol.toStringTag,{value:"Module"}));class Eh{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(e,r){this.keyToValue.set(e,r),this.valueToKey.set(r,e)}getByKey(e){return this.keyToValue.get(e)}getByValue(e){return this.valueToKey.get(e)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class ji{constructor(e){this.generateIdentifier=e,this.kv=new Eh}register(e,r){this.kv.getByValue(e)||(r||(r=this.generateIdentifier(e)),this.kv.set(r,e))}clear(){this.kv.clear()}getIdentifier(e){return this.kv.getByValue(e)}getValue(e){return this.kv.getByKey(e)}}class Th extends ji{constructor(){super(e=>e.name),this.classToAllowedProps=new Map}register(e,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(e,r.allowProps),super.register(e,r.identifier)):super.register(e,r)}getAllowedProps(e){return this.classToAllowedProps.get(e)}}function Rh(t){if("values"in Object)return Object.values(t);const e=[];for(const r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e}function wh(t,e){const r=Rh(t);if("find"in r)return r.find(e);const s=r;for(let a=0;a<s.length;a++){const i=s[a];if(e(i))return i}}function mt(t,e){Object.entries(t).forEach(([r,s])=>e(s,r))}function Yr(t,e){return t.indexOf(e)!==-1}function Di(t,e){for(let r=0;r<t.length;r++){const s=t[r];if(e(s))return s}}class Sh{constructor(){this.transfomers={}}register(e){this.transfomers[e.name]=e}findApplicable(e){return wh(this.transfomers,r=>r.isApplicable(e))}findByName(e){return this.transfomers[e]}}const Ah=t=>Object.prototype.toString.call(t).slice(8,-1),Ui=t=>typeof t>"u",Ih=t=>t===null,cr=t=>typeof t!="object"||t===null||t===Object.prototype?!1:Object.getPrototypeOf(t)===null?!0:Object.getPrototypeOf(t)===Object.prototype,Is=t=>cr(t)&&Object.keys(t).length===0,Ae=t=>Array.isArray(t),kh=t=>typeof t=="string",Oh=t=>typeof t=="number"&&!isNaN(t),xh=t=>typeof t=="boolean",Nh=t=>t instanceof RegExp,ur=t=>t instanceof Map,lr=t=>t instanceof Set,$i=t=>Ah(t)==="Symbol",Ph=t=>t instanceof Date&&!isNaN(t.valueOf()),Ch=t=>t instanceof Error,Li=t=>typeof t=="number"&&isNaN(t),Mh=t=>xh(t)||Ih(t)||Ui(t)||Oh(t)||kh(t)||$i(t),jh=t=>typeof t=="bigint",Dh=t=>t===1/0||t===-1/0,Uh=t=>ArrayBuffer.isView(t)&&!(t instanceof DataView),$h=t=>t instanceof URL,Ki=t=>t.replace(/\./g,"\\."),ks=t=>t.map(String).map(Ki).join("."),dr=t=>{const e=[];let r="";for(let a=0;a<t.length;a++){let i=t.charAt(a);if(i==="\\"&&t.charAt(a+1)==="."){r+=".",a++;continue}if(i==="."){e.push(r),r="";continue}r+=i}const s=r;return e.push(s),e};function le(t,e,r,s){return{isApplicable:t,annotation:e,transform:r,untransform:s}}const Wi=[le(Ui,"undefined",()=>null,()=>{}),le(jh,"bigint",t=>t.toString(),t=>typeof BigInt<"u"?BigInt(t):(console.error("Please add a BigInt polyfill."),t)),le(Ph,"Date",t=>t.toISOString(),t=>new Date(t)),le(Ch,"Error",(t,e)=>{const r={name:t.name,message:t.message};return e.allowedErrorProps.forEach(s=>{r[s]=t[s]}),r},(t,e)=>{const r=new Error(t.message);return r.name=t.name,r.stack=t.stack,e.allowedErrorProps.forEach(s=>{r[s]=t[s]}),r}),le(Nh,"regexp",t=>""+t,t=>{const e=t.slice(1,t.lastIndexOf("/")),r=t.slice(t.lastIndexOf("/")+1);return new RegExp(e,r)}),le(lr,"set",t=>[...t.values()],t=>new Set(t)),le(ur,"map",t=>[...t.entries()],t=>new Map(t)),le(t=>Li(t)||Dh(t),"number",t=>Li(t)?"NaN":t>0?"Infinity":"-Infinity",Number),le(t=>t===0&&1/t===-1/0,"number",()=>"-0",Number),le($h,"URL",t=>t.toString(),t=>new URL(t))];function Xr(t,e,r,s){return{isApplicable:t,annotation:e,transform:r,untransform:s}}const Vi=Xr((t,e)=>$i(t)?!!e.symbolRegistry.getIdentifier(t):!1,(t,e)=>["symbol",e.symbolRegistry.getIdentifier(t)],t=>t.description,(t,e,r)=>{const s=r.symbolRegistry.getValue(e[1]);if(!s)throw new Error("Trying to deserialize unknown symbol");return s}),Lh=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((t,e)=>(t[e.name]=e,t),{}),Gi=Xr(Uh,t=>["typed-array",t.constructor.name],t=>[...t],(t,e)=>{const r=Lh[e[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(t)});function Bi(t,e){return t!=null&&t.constructor?!!e.classRegistry.getIdentifier(t.constructor):!1}const Fi=Xr(Bi,(t,e)=>["class",e.classRegistry.getIdentifier(t.constructor)],(t,e)=>{const r=e.classRegistry.getAllowedProps(t.constructor);if(!r)return{...t};const s={};return r.forEach(a=>{s[a]=t[a]}),s},(t,e,r)=>{const s=r.classRegistry.getValue(e[1]);if(!s)throw new Error("Trying to deserialize unknown class - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564");return Object.assign(Object.create(s.prototype),t)}),Hi=Xr((t,e)=>!!e.customTransformerRegistry.findApplicable(t),(t,e)=>["custom",e.customTransformerRegistry.findApplicable(t).name],(t,e)=>e.customTransformerRegistry.findApplicable(t).serialize(t),(t,e,r)=>{const s=r.customTransformerRegistry.findByName(e[1]);if(!s)throw new Error("Trying to deserialize unknown custom value");return s.deserialize(t)}),Kh=[Fi,Vi,Hi,Gi],Zi=(t,e)=>{const r=Di(Kh,a=>a.isApplicable(t,e));if(r)return{value:r.transform(t,e),type:r.annotation(t,e)};const s=Di(Wi,a=>a.isApplicable(t,e));if(s)return{value:s.transform(t,e),type:s.annotation}},zi={};Wi.forEach(t=>{zi[t.annotation]=t});const Wh=(t,e,r)=>{if(Ae(e))switch(e[0]){case"symbol":return Vi.untransform(t,e,r);case"class":return Fi.untransform(t,e,r);case"custom":return Hi.untransform(t,e,r);case"typed-array":return Gi.untransform(t,e,r);default:throw new Error("Unknown transformation: "+e)}else{const s=zi[e];if(!s)throw new Error("Unknown transformation: "+e);return s.untransform(t,r)}},yt=(t,e)=>{const r=t.keys();for(;e>0;)r.next(),e--;return r.next().value};function Ji(t){if(Yr(t,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Yr(t,"prototype"))throw new Error("prototype is not allowed as a property");if(Yr(t,"constructor"))throw new Error("constructor is not allowed as a property")}const Vh=(t,e)=>{Ji(e);for(let r=0;r<e.length;r++){const s=e[r];if(lr(t))t=yt(t,+s);else if(ur(t)){const a=+s,i=+e[++r]==0?"key":"value",o=yt(t,a);switch(i){case"key":t=o;break;case"value":t=t.get(o);break}}else t=t[s]}return t},Os=(t,e,r)=>{if(Ji(e),e.length===0)return r(t);let s=t;for(let i=0;i<e.length-1;i++){const o=e[i];if(Ae(s)){const c=+o;s=s[c]}else if(cr(s))s=s[o];else if(lr(s)){const c=+o;s=yt(s,c)}else if(ur(s)){if(i===e.length-2)break;const u=+o,l=+e[++i]==0?"key":"value",d=yt(s,u);switch(l){case"key":s=d;break;case"value":s=s.get(d);break}}}const a=e[e.length-1];if(Ae(s)?s[+a]=r(s[+a]):cr(s)&&(s[a]=r(s[a])),lr(s)){const i=yt(s,+a),o=r(i);i!==o&&(s.delete(i),s.add(o))}if(ur(s)){const i=+e[e.length-2],o=yt(s,i);switch(+a==0?"key":"value"){case"key":{const u=r(o);s.set(u,s.get(o)),u!==o&&s.delete(o);break}case"value":{s.set(o,r(s.get(o)));break}}}return t};function xs(t,e,r=[]){if(!t)return;if(!Ae(t)){mt(t,(i,o)=>xs(i,e,[...r,...dr(o)]));return}const[s,a]=t;a&&mt(a,(i,o)=>{xs(i,e,[...r,...dr(o)])}),e(s,r)}function Gh(t,e,r){return xs(e,(s,a)=>{t=Os(t,a,i=>Wh(i,s,r))}),t}function Bh(t,e){function r(s,a){const i=Vh(t,dr(a));s.map(dr).forEach(o=>{t=Os(t,o,()=>i)})}if(Ae(e)){const[s,a]=e;s.forEach(i=>{t=Os(t,dr(i),()=>t)}),a&&mt(a,r)}else mt(e,r);return t}const Fh=(t,e)=>cr(t)||Ae(t)||ur(t)||lr(t)||Bi(t,e);function Hh(t,e,r){const s=r.get(t);s?s.push(e):r.set(t,[e])}function Zh(t,e){const r={};let s;return t.forEach(a=>{if(a.length<=1)return;e||(a=a.map(c=>c.map(String)).sort((c,u)=>c.length-u.length));const[i,...o]=a;i.length===0?s=o.map(ks):r[ks(i)]=o.map(ks)}),s?Is(r)?[s]:[s,r]:Is(r)?void 0:r}const Yi=(t,e,r,s,a=[],i=[],o=new Map)=>{const c=Mh(t);if(!c){Hh(t,a,e);const I=o.get(t);if(I)return s?{transformedValue:null}:I}if(!Fh(t,r)){const I=Zi(t,r),M=I?{transformedValue:I.value,annotations:[I.type]}:{transformedValue:t};return c||o.set(t,M),M}if(Yr(i,t))return{transformedValue:null};const u=Zi(t,r),l=(u==null?void 0:u.value)??t,d=Ae(l)?[]:{},y={};mt(l,(I,M)=>{if(M==="__proto__"||M==="constructor"||M==="prototype")throw new Error(`Detected property ${M}. This is a prototype pollution risk, please remove it from your object.`);const N=Yi(I,e,r,s,[...a,M],[...i,t],o);d[M]=N.transformedValue,Ae(N.annotations)?y[M]=N.annotations:cr(N.annotations)&&mt(N.annotations,(U,V)=>{y[Ki(M)+"."+V]=U})});const E=Is(y)?{transformedValue:d,annotations:u?[u.type]:void 0}:{transformedValue:d,annotations:u?[u.type,y]:y};return c||o.set(t,E),E};function Xi(t){return Object.prototype.toString.call(t).slice(8,-1)}function qi(t){return Xi(t)==="Array"}function zh(t){if(Xi(t)!=="Object")return!1;const e=Object.getPrototypeOf(t);return!!e&&e.constructor===Object&&e===Object.prototype}function Jh(t,e,r,s,a){const i={}.propertyIsEnumerable.call(s,e)?"enumerable":"nonenumerable";i==="enumerable"&&(t[e]=r),a&&i==="nonenumerable"&&Object.defineProperty(t,e,{value:r,enumerable:!1,writable:!0,configurable:!0})}function Ns(t,e={}){if(qi(t))return t.map(a=>Ns(a,e));if(!zh(t))return t;const r=Object.getOwnPropertyNames(t),s=Object.getOwnPropertySymbols(t);return[...r,...s].reduce((a,i)=>{if(qi(e.props)&&!e.props.includes(i))return a;const o=t[i],c=Ns(o,e);return Jh(a,i,c,t,e.nonenumerable),a},{})}class x{constructor({dedupe:e=!1}={}){this.classRegistry=new Th,this.symbolRegistry=new ji(r=>r.description??""),this.customTransformerRegistry=new Sh,this.allowedErrorProps=[],this.dedupe=e}serialize(e){const r=new Map,s=Yi(e,r,this,this.dedupe),a={json:s.transformedValue};s.annotations&&(a.meta={...a.meta,values:s.annotations});const i=Zh(r,this.dedupe);return i&&(a.meta={...a.meta,referentialEqualities:i}),a}deserialize(e){const{json:r,meta:s}=e;let a=Ns(r);return s!=null&&s.values&&(a=Gh(a,s.values,this)),s!=null&&s.referentialEqualities&&(a=Bh(a,s.referentialEqualities)),a}stringify(e){return JSON.stringify(this.serialize(e))}parse(e){return this.deserialize(JSON.parse(e))}registerClass(e,r){this.classRegistry.register(e,r)}registerSymbol(e,r){this.symbolRegistry.register(e,r)}registerCustom(e,r){this.customTransformerRegistry.register({name:r,...e})}allowErrorProps(...e){this.allowedErrorProps.push(...e)}}x.defaultInstance=new x,x.serialize=x.defaultInstance.serialize.bind(x.defaultInstance),x.deserialize=x.defaultInstance.deserialize.bind(x.defaultInstance),x.stringify=x.defaultInstance.stringify.bind(x.defaultInstance),x.parse=x.defaultInstance.parse.bind(x.defaultInstance),x.registerClass=x.defaultInstance.registerClass.bind(x.defaultInstance),x.registerSymbol=x.defaultInstance.registerSymbol.bind(x.defaultInstance),x.registerCustom=x.defaultInstance.registerCustom.bind(x.defaultInstance),x.allowErrorProps=x.defaultInstance.allowErrorProps.bind(x.defaultInstance);const Yh=x.serialize,Xh=x.deserialize,qh=x.stringify,Qh=x.parse,ep=x.registerClass,tp=x.registerCustom,rp=x.registerSymbol,np=x.allowErrorProps,sp=Object.freeze(Object.defineProperty({__proto__:null,SuperJSON:x,allowErrorProps:np,default:x,deserialize:Xh,parse:Qh,registerClass:ep,registerCustom:tp,registerSymbol:rp,serialize:Yh,stringify:qh},Symbol.toStringTag,{value:"Module"}));var ap=Object.defineProperty,ip=Object.defineProperties,op=Object.getOwnPropertyDescriptors,qr=Object.getOwnPropertySymbols,Qi=Object.prototype.hasOwnProperty,eo=Object.prototype.propertyIsEnumerable,to=t=>{throw TypeError(t)},ro=(t,e,r)=>e in t?ap(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ze=(t,e)=>{for(var r in e||(e={}))Qi.call(e,r)&&ro(t,r,e[r]);if(qr)for(var r of qr(e))eo.call(e,r)&&ro(t,r,e[r]);return t},no=(t,e)=>ip(t,op(e)),cp=(t,e)=>{var r={};for(var s in t)Qi.call(t,s)&&e.indexOf(s)<0&&(r[s]=t[s]);if(t!=null&&qr)for(var s of qr(t))e.indexOf(s)<0&&eo.call(t,s)&&(r[s]=t[s]);return r},Ps=(t,e,r)=>e.has(t)||to("Cannot "+r),g=(t,e,r)=>(Ps(t,e,"read from private field"),r?r.call(t):e.get(t)),D=(t,e,r)=>e.has(t)?to("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),k=(t,e,r,s)=>(Ps(t,e,"write to private field"),e.set(t,r),r),z=(t,e,r)=>(Ps(t,e,"access private method"),r),_t=(t,e,r)=>new Promise((s,a)=>{var i=u=>{try{c(r.next(u))}catch(l){a(l)}},o=u=>{try{c(r.throw(u))}catch(l){a(l)}},c=u=>u.done?s(u.value):Promise.resolve(u.value).then(i,o);c((r=r.apply(t,e)).next())}),Qr=t=>Number(t),up=t=>t==="true"||t==="t",lp=t=>BigInt(t),so=t=>JSON.parse(t),dp=t=>t,fp={int2:Qr,int4:Qr,int8:lp,bool:up,float4:Qr,float8:Qr,json:so,jsonb:so};function hp(t,e){let r=0,s=null,a="",i=!1,o=0,c;function u(l){const d=[];for(;r<l.length;r++){if(s=l[r],i)s==="\\"?a+=l[++r]:s==='"'?(d.push(e(a)),a="",i=l[r+1]==='"',o=r+2):a+=s;else if(s==='"')i=!0;else if(s==="{")o=++r,d.push(u(l));else if(s==="}"){i=!1,o<r&&d.push(e(l.slice(o,r))),o=r+1;break}else s===","&&c!=="}"&&c!=='"'&&(d.push(e(l.slice(o,r))),o=r+1);c=s}return o<r&&d.push(e(l.slice(o,r+1))),d}return u(t)[0]}var pp=class{constructor(t){this.parser=ze(ze({},fp),t)}parse(t,e){return JSON.parse(t,(r,s)=>{if(r==="value"&&typeof s=="object"&&s!==null){const a=s;Object.keys(a).forEach(i=>{a[i]=this.parseRow(i,a[i],e)})}return s})}parseRow(t,e,r){var s;const a=r[t];if(!a)return e;const i=a,{type:o,dims:c}=i,u=cp(i,["type","dims"]),l=(s=this.parser[o])!=null?s:dp,d=ao(l,a,t);return c&&c>0?ao((E,I)=>hp(E,d),a,t)(e):d(e,u)}};function ao(t,e,r){var s;const a=!((s=e.not_null)!=null&&s);return i=>{if(gp(i)){if(!a)throw new Error(`Column ${r??"unknown"} is not nullable`);return null}return t(i,e)}}function gp(t){return t===null||t==="NULL"}function Cs(t){return"key"in t}function Ms(t){return!Cs(t)}function mp(t){return Ms(t)&&t.headers.control==="up-to-date"}var fr=class Eo extends Error{constructor(e,r,s,a,i,o){super(o||`HTTP Error ${e} at ${i}: ${r??JSON.stringify(s)}`),this.url=i,this.name="FetchError",this.status=e,this.text=r,this.json=s,this.headers=a}static fromResponse(e,r){return _t(this,null,function*(){const s=e.status,a=Object.fromEntries([...e.headers.entries()]);let i,o;const c=e.headers.get("content-type");return c&&c.includes("application/json")?o=yield e.json():i=yield e.text(),new Eo(s,i,o,a,r)})}},io=class extends Error{constructor(){super("Fetch with backoff aborted")}},yp="electric-cursor",js="electric-handle",oo="electric-offset",_p="electric-schema",bp="electric-up-to-date",vp="database_id",Ep="columns",Tp="cursor",co="handle",uo="live",lo="offset",Rp="table",wp="where",Sp="replica",Ap=[429],Ds={initialDelay:100,maxDelay:1e4,multiplier:1.3};function Ip(t,e=Ds){const{initialDelay:r,maxDelay:s,multiplier:a,debug:i=!1,onFailedAttempt:o}=e;return(...c)=>_t(this,null,function*(){var u;const l=c[0],d=c[1];let y=r,E=0;for(;;)try{const I=yield t(...c);if(I.ok)return I;throw yield fr.fromResponse(I,l.toString())}catch(I){if(o==null||o(),(u=d==null?void 0:d.signal)!=null&&u.aborted)throw new io;if(I instanceof fr&&!Ap.includes(I.status)&&I.status>=400&&I.status<500)throw I;yield new Promise(M=>setTimeout(M,y)),y=Math.min(y*a,s),i&&(E++,console.log(`Retry attempt #${E} after ${y}ms`))}})}var kp={maxChunksToPrefetch:2};function Op(t,e=kp){const{maxChunksToPrefetch:r}=e;let s;return(...i)=>_t(this,null,function*(){const o=i[0].toString(),c=s==null?void 0:s.consume(...i);if(c)return c;s==null||s.abort();const u=yield t(...i),l=Us(o,u);return l&&(s=new xp({fetchClient:t,maxPrefetchedRequests:r,url:l,requestInit:i[1]})),u})}var en,tn,Ie,bt,ke,hr,rn,xp=class{constructor(t){D(this,hr),D(this,en),D(this,tn),D(this,Ie,new Map),D(this,bt),D(this,ke);var e;k(this,en,(e=t.fetchClient)!=null?e:(...r)=>fetch(...r)),k(this,tn,t.maxPrefetchedRequests),k(this,bt,t.url.toString()),k(this,ke,g(this,bt)),z(this,hr,rn).call(this,t.url,t.requestInit)}abort(){g(this,Ie).forEach(([t,e])=>e.abort())}consume(...t){var e;const r=t[0].toString(),s=(e=g(this,Ie).get(r))==null?void 0:e[0];if(!(!s||r!==g(this,bt)))return g(this,Ie).delete(r),s.then(a=>{const i=Us(r,a);k(this,bt,i),g(this,ke)&&!g(this,Ie).has(g(this,ke))&&z(this,hr,rn).call(this,g(this,ke),t[1])}).catch(()=>{}),s}};en=new WeakMap,tn=new WeakMap,Ie=new WeakMap,bt=new WeakMap,ke=new WeakMap,hr=new WeakSet,rn=function(...t){var e,r;const s=t[0].toString();if(g(this,Ie).size>=g(this,tn))return;const a=new AbortController;try{const i=g(this,en).call(this,s,no(ze({},(e=t[1])!=null?e:{}),{signal:Np(a,(r=t[1])==null?void 0:r.signal)}));g(this,Ie).set(s,[i,a]),i.then(o=>{if(!o.ok||a.signal.aborted)return;const c=Us(s,o);if(!c||c===s){k(this,ke,void 0);return}return k(this,ke,c),z(this,hr,rn).call(this,c,t[1])}).catch(()=>{})}catch{}};function Us(t,e){const r=e.headers.get(js),s=e.headers.get(oo),a=e.headers.has(bp);if(!r||!s||a)return;const i=new URL(t);if(!i.searchParams.has(uo))return i.searchParams.set(co,r),i.searchParams.set(lo,s),i.toString()}function Np(t,e){return e&&(e.aborted?t.abort():e.addEventListener("abort",()=>t.abort(),{once:!0})),t.signal}var nn,sn,Je,Ye,vt,Et,Xe,de,qe,Oe,pr,Tt,an,gr,xe,$s,fo,ho,po,go,mo=class Gs{constructor(e){D(this,xe),D(this,nn),D(this,sn),D(this,Je,new Map),D(this,Ye,new Map),D(this,vt),D(this,Et),D(this,Xe),D(this,de,!1),D(this,qe,!1),D(this,Oe),D(this,pr),D(this,Tt),D(this,an),D(this,gr);var r,s,a;Cp(e),this.options=ze({subscribe:!0},e),k(this,vt,(r=this.options.offset)!=null?r:"-1"),k(this,Et,""),k(this,Oe,this.options.shapeHandle),k(this,pr,this.options.databaseId),k(this,sn,new pp(e.parser)),k(this,gr,this.options.replica);const i=(s=e.fetchClient)!=null?s:(...c)=>fetch(...c),o=Ip(i,no(ze({},(a=e.backoffOptions)!=null?a:Ds),{onFailedAttempt:()=>{var c,u;k(this,qe,!1),(u=(c=e.backoffOptions)==null?void 0:c.onFailedAttempt)==null||u.call(c)}}));k(this,nn,Op(o)),this.start()}get shapeHandle(){return g(this,Oe)}get isUpToDate(){return g(this,de)}get error(){return g(this,an)}start(){return _t(this,null,function*(){var e,r;k(this,de,!1);const{url:s,table:a,where:i,columns:o,signal:c}=this.options;try{for(;!(c!=null&&c.aborted)&&!g(this,de)||this.options.subscribe;){const u=new URL(s);a&&u.searchParams.set(Rp,a),i&&u.searchParams.set(wp,i),o&&o.length>0&&u.searchParams.set(Ep,o.join(",")),u.searchParams.set(lo,g(this,vt)),g(this,de)&&(u.searchParams.set(uo,"true"),u.searchParams.set(Tp,g(this,Et))),g(this,Oe)&&u.searchParams.set(co,g(this,Oe)),g(this,pr)&&u.searchParams.set(vp,g(this,pr)),((e=g(this,gr))!=null?e:Gs.Replica.DEFAULT)!=Gs.Replica.DEFAULT&&u.searchParams.set(Sp,g(this,gr));let l;try{l=yield g(this,nn).call(this,u.toString(),{signal:c,headers:this.options.headers}),k(this,qe,!0)}catch($){if($ instanceof io)break;if(!($ instanceof fr))throw $;if($.status==409){const X=$.headers[js];z(this,xe,go).call(this,X),yield z(this,xe,$s).call(this,$.json);continue}else if($.status>=400&&$.status<500)throw z(this,xe,po).call(this,$),z(this,xe,fo).call(this,$),$}const{headers:d,status:y}=l,E=d.get(js);E&&k(this,Oe,E);const I=d.get(oo);I&&k(this,vt,I);const M=d.get(yp);M&&k(this,Et,M);const N=()=>{const $=d.get(_p);return $?JSON.parse($):{}};k(this,Tt,(r=g(this,Tt))!=null?r:N());const U=y===204?"[]":yield l.text();y===204&&k(this,Xe,Date.now());const V=g(this,sn).parse(U,g(this,Tt));if(V.length>0){const $=g(this,de),X=V[V.length-1];mp(X)&&(k(this,Xe,Date.now()),k(this,de,!0)),yield z(this,xe,$s).call(this,V),!$&&g(this,de)&&z(this,xe,ho).call(this)}}}catch(u){k(this,an,u)}finally{k(this,qe,!1)}})}subscribe(e,r){const s=Math.random();return g(this,Je).set(s,[e,r]),()=>{g(this,Je).delete(s)}}unsubscribeAll(){g(this,Je).clear()}subscribeOnceToUpToDate(e,r){const s=Math.random();return g(this,Ye).set(s,[e,r]),()=>{g(this,Ye).delete(s)}}unsubscribeAllUpToDateSubscribers(){g(this,Ye).clear()}lastSyncedAt(){return g(this,Xe)}lastSynced(){return g(this,Xe)===void 0?1/0:Date.now()-g(this,Xe)}isConnected(){return g(this,qe)}isLoading(){return!this.isUpToDate}};nn=new WeakMap,sn=new WeakMap,Je=new WeakMap,Ye=new WeakMap,vt=new WeakMap,Et=new WeakMap,Xe=new WeakMap,de=new WeakMap,qe=new WeakMap,Oe=new WeakMap,pr=new WeakMap,Tt=new WeakMap,an=new WeakMap,gr=new WeakMap,xe=new WeakSet,$s=function(t){return _t(this,null,function*(){yield Promise.all(Array.from(g(this,Je).values()).map(e=>_t(this,[e],function*([r,s]){try{yield r(t)}catch(a){queueMicrotask(()=>{throw a})}})))})},fo=function(t){g(this,Je).forEach(([e,r])=>{r==null||r(t)})},ho=function(){g(this,Ye).forEach(([t])=>{t()})},po=function(t){g(this,Ye).forEach(([e,r])=>r(t))},go=function(t){k(this,vt,"-1"),k(this,Et,""),k(this,Oe,t),k(this,de,!1),k(this,qe,!1),k(this,Tt,void 0)},mo.Replica={FULL:"full",DEFAULT:"default"};var Pp=mo;function Cp(t){if(!t.url)throw new Error("Invalid shape options. It must provide the url");if(t.signal&&!(t.signal instanceof AbortSignal))throw new Error("Invalid signal option. It must be an instance of AbortSignal.");if(t.offset!==void 0&&t.offset!=="-1"&&!t.shapeHandle)throw new Error("shapeHandle is required if this isn't an initial fetch (i.e. offset > -1)")}var ne,Ne,Qe,mr,et,tt,yo,Ls,Ks,Mp=class{constructor(t){D(this,tt),D(this,ne),D(this,Ne,new Map),D(this,Qe,new Map),D(this,mr,!1),D(this,et,!1),k(this,ne,t),g(this,ne).subscribe(z(this,tt,yo).bind(this),z(this,tt,Ls).bind(this));const e=g(this,ne).subscribeOnceToUpToDate(()=>{e()},r=>{throw z(this,tt,Ls).call(this,r),r})}get isUpToDate(){return g(this,ne).isUpToDate}get rows(){return this.value.then(t=>Array.from(t.values()))}get currentRows(){return Array.from(this.currentValue.values())}get value(){return new Promise((t,e)=>{if(g(this,ne).isUpToDate)t(this.currentValue);else{const r=this.subscribe(({value:s})=>{r(),g(this,et)&&e(g(this,et)),t(s)})}})}get currentValue(){return g(this,Ne)}get error(){return g(this,et)}lastSyncedAt(){return g(this,ne).lastSyncedAt()}lastSynced(){return g(this,ne).lastSynced()}isLoading(){return g(this,ne).isLoading()}isConnected(){return g(this,ne).isConnected()}subscribe(t){const e=Math.random();return g(this,Qe).set(e,t),()=>{g(this,Qe).delete(e)}}unsubscribeAll(){g(this,Qe).clear()}get numSubscribers(){return g(this,Qe).size}};ne=new WeakMap,Ne=new WeakMap,Qe=new WeakMap,mr=new WeakMap,et=new WeakMap,tt=new WeakSet,yo=function(t){let e=!1,r=!1,s=!1;t.forEach(a=>{if(Cs(a))switch(e=["insert","update","delete"].includes(a.headers.operation),a.headers.operation){case"insert":g(this,Ne).set(a.key,a.value);break;case"update":g(this,Ne).set(a.key,ze(ze({},g(this,Ne).get(a.key)),a.value));break;case"delete":g(this,Ne).delete(a.key);break}if(Ms(a))switch(a.headers.control){case"up-to-date":r=!0,g(this,mr)||(s=!0);break;case"must-refetch":g(this,Ne).clear(),k(this,et,!1),k(this,mr,!1),r=!1,s=!1;break}}),(s||r&&e)&&(k(this,mr,!0),z(this,tt,Ks).call(this))},Ls=function(t){t instanceof fr&&(k(this,et,t),z(this,tt,Ks).call(this))},Ks=function(){g(this,Qe).forEach(t=>{t({value:this.currentValue,rows:this.currentRows})})};const jp=Object.freeze(Object.defineProperty({__proto__:null,BackoffDefaults:Ds,FetchError:fr,Shape:Mp,ShapeStream:Pp,isChangeMessage:Cs,isControlMessage:Ms},Symbol.toStringTag,{value:"Module"}));L.tinybirdCopyTask=Cf,L.tinybirdQueryTask=jf,Object.defineProperty(L,Symbol.toStringTag,{value:"Module"})});
